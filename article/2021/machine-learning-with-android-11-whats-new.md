> * åŸæ–‡åœ°å€ï¼š[Machine Learning with Android 11: Whatâ€™s new](https://proandroiddev.com/machine-learning-with-android-11-whats-new-1a8d084c7398)
> * åŸæ–‡ä½œè€…ï¼š[Rishit Dagli](https://medium.com/@rishit.dagli)
> * è¯‘æ–‡å‡ºè‡ªï¼š[æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)
> * æœ¬æ–‡æ°¸ä¹…é“¾æ¥ï¼š[https://github.com/xitu/gold-miner/blob/master/article/2021/machine-learning-with-android-11-whats-new.md](https://github.com/xitu/gold-miner/blob/master/article/2021/machine-learning-with-android-11-whats-new.md)
> * è¯‘è€…ï¼š[éœœç¾½ Hoarfroster](https://github.com/PassionPenguin)
> * æ ¡å¯¹è€…ï¼š[HumanBeing](https://github.com/HumanBeingXenon)ã€[keepmovingljzy](https://github.com/keepmovingljzy)ã€[lsvih](https://github.com/lsvih)

# ä½¿ç”¨ Android 11 è¿›è¡Œæœºå™¨å­¦ä¹ ï¼šæ–°åŠŸèƒ½

![ä½¿ç”¨ Android 11 è¿›è¡Œæœºå™¨å­¦ä¹ ï¼šæ–°åŠŸèƒ½](https://cdn-images-1.medium.com/max/3840/1*_6zTCa-SeOV2q549ey3b5Q.jpeg)

æœ¬æ–‡å°†ä¼šå‘å¤§å®¶å±•ç¤ºå¦‚ä½•ä½¿ç”¨ä¸“ä¸º [Android 11](https://developer.android.com/11) è®¾è®¡çš„å·¥å…·æˆ–æ’ä»¶æ¥å¼€å§‹ä½¿ç”¨è®¾å¤‡ä¸Šçš„ MLï¼ˆMachine Learningï¼Œæœºå™¨å­¦ä¹ ï¼‰åŠŸèƒ½ã€‚å¦‚æœä½ ä»¥å‰åœ¨ Android ä¸­ä½¿ç”¨è¿‡ MLï¼Œåˆ™å¯ä»¥è·Ÿéšæœ¬æ–‡ä¸€èµ·æ¢ç´¢å°†ä½ çš„ ML åº”ç”¨ç¨‹åºä¸ Android åº”ç”¨ç¨‹åºé›†æˆçš„æ›´ç®€ä¾¿æ–¹æ³•ã€‚è€Œå¦‚æœä½ æ²¡æœ‰åœ¨ Android ä¸­ä½¿ç”¨è¿‡ MLï¼Œé‚£ä¹ˆè¿™å¯èƒ½æ˜¯ä½ ä½¿ç”¨ Android è¿›è¡Œ ML çš„èµ·ç‚¹ï¼Œå¼€å§‹ä½ ä½¿ç”¨ ML ä¸ºä½ çš„ Android åº”ç”¨ç¨‹åºæä¾›è¶…å¼ºåŠŸèƒ½ä¹‹æ—…ã€‚åœ¨æ­¤åšå®¢ä¸­ï¼Œæˆ‘å°†ä¸»è¦æ¼”ç¤º Android 11 çš„ä¸¤ä¸ªæœ€å¼ºå¤§çš„æ›´æ–°ï¼š[ML æ¨¡å‹ç»‘å®šæ’ä»¶](https://developer.android.com/studio/preview/features#tensor-flow-lite-models)å’Œ[æ–°çš„ ML Kit å¥—ä»¶](https://g.co/mlkit)ã€‚æˆ‘ä»¬ä¸‹é¢è®¨è®ºçš„æ‰€æœ‰ç¤ºä¾‹åº”ç”¨ç¨‹åºä»£ç éƒ½å¯ä»¥åœ¨[æ­¤ GitHub å­˜å‚¨åº“](https://github.com/Rishit-dagli/ML-with-Android-11)ä¸­æ‰¾åˆ°ã€‚

ä½ ä¹Ÿå¯ä»¥åœ¨ [GitHub å­˜å‚¨åº“](https://github.com/Rishit-dagli/ML-with-Android-11/blob/master/talks.md)ä¸­æŸ¥çœ‹æœ‰å…³è¯¥ä¸»é¢˜çš„è®¨è®ºã€‚

## ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å…³å¿ƒ Android è®¾å¤‡ä¸Š ML åŠŸèƒ½ï¼Ÿ

å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬åœ¨æœ¬æ–‡ä¸­ä¸»è¦å…³æ³¨è®¾å¤‡ä¸Šçš„ MLã€‚Android 11 å¯¹è®¾å¤‡ä¸Šçš„ ML åšå‡ºäº†è®¸å¤šå¾ˆé…·çš„æ›´æ–°ï¼Œä½†å…ˆç®€è¿°ä¸€ä¸‹æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦å¯¹æ­¤åŠ ä»¥å…³æ³¨ã€‚ä½ ä¹Ÿå°†è¿™é‡ŒçŸ¥é“ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆå¤šå…³äº ML æˆ– ç»ˆç«¯ ML çš„å®£ä¼ ã€‚

**è®¾å¤‡ä¸Šçš„ ML èƒŒåçš„ç†å¿µï¼š**

è¿™é‡Œä½¿ç”¨ ML çš„æ–¹æ³•ä¸æˆ‘ä»¬çš„æ—§æœ‰æ–¹æ³•æ°å¥½ç›¸åï¼Œæˆ‘ä»¬ä¸å†å°†è®¾å¤‡ä¸Šçš„æ•°æ®å‘é€åˆ°æœåŠ¡å™¨æˆ–æŸä¸ªåŸºäºäº‘çš„ç³»ç»Ÿï¼Œåœ¨ä¸Šé¢ä½¿ç”¨ ML åˆ¤æ–­æ•°æ®ï¼Œç„¶åå†å°†å¾—å‡ºçš„ç»“è®ºè¿”å›ç»™è®¾å¤‡ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œç›´æ¥åˆ©ç”¨è®¾å¤‡ä¸Šçš„ ML æ¨¡å‹è·å–è¾“å‡ºæˆ–æ¨æ–­ï¼Œå³ä¸å†è®©è®¾å¤‡å‘é€æ•°æ®ç»™æœåŠ¡å™¨åˆ¤æ–­æ•°æ®ï¼Œåˆ©ç”¨ç§»åŠ¨è®¾å¤‡æœ¬èº«ï¼Œå®Œæˆæ‰€æœ‰çš„å¤„ç†å’Œæ¨æ–­ã€‚

![è®¾å¤‡ä¸Š ML èƒŒåçš„ç†å¿µ](https://cdn-images-1.medium.com/max/3836/1*O1a_Su6P-XggXk9IXTSzMQ.jpeg)

ä½ ä¸ä¼šç›´æ¥å°†æ¨¡å‹ç”¨äºä½ çš„è®¾å¤‡ï¼Œè€Œéœ€è¦åœ¨å¯¼å…¥å‰å…ˆå¯¹ä½ çš„æ¨¡å‹è¿›è¡Œå‹ç¼©æˆ–ä¼˜åŒ–ï¼Œä»¥ä¾¿èƒ½å¤Ÿåœ¨è®¾å¤‡ä¸Šæ­£å¸¸çš„è¿è¡Œå®ƒ â€”â€” å› ä¸ºç»ˆç«¯è®¾å¤‡çš„è®¡ç®—èƒ½åŠ›ã€ç½‘ç»œå¯ç”¨æ€§å’Œç£ç›˜ç©ºé—´æœ‰é™ã€‚ä½†åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è·³è¿‡ä¼˜åŒ–è¿‡ç¨‹ï¼Œç›´æ¥éƒ¨ç½² `.tflite` æ¨¡å‹æ–‡ä»¶ã€‚è€Œä½ å¯ä»¥è¿›ä¸€æ­¥äº†è§£ [TensorFlow Lite](https://www.tensorflow.org/lite/)å’Œ[æ¨¡å‹ä¼˜åŒ–è¿‡ç¨‹](https://www.tensorflow.org/lite/performance/model_optimization)ã€‚

**è®¾å¤‡ä¸Šè¿›è¡Œ ML çš„ä¼˜åŠ¿**

ä½¿ç”¨è®¾å¤‡ä¸Š ML çš„ä¸€äº›ä¼˜ç‚¹ï¼š

* èƒ½é‡æ¶ˆè€—

ä½ æ‰€èƒ½å¤Ÿæƒ³åˆ°çš„ç¬¬ä¸€ä»¶äº‹åº”è¯¥å°±æ˜¯èƒ½è€—ï¼šæ›¾ç»ä½ éœ€è¦è€—è´¹å¤§é‡çš„èƒ½é‡ï¼Œå°†ä½ çš„è§†é¢‘æ•°æ®è¿ç»­å‘é€æˆ–æµå¼ä¼ è¾“åˆ°æœåŠ¡å™¨ã€‚ä½†æœ‰æ—¶è¿™æ ·åšæ˜¯ä¸å¯è¡Œçš„ â€”â€” æ²¡æœ‰æ•°æ®ç½‘ç»œçš„æ—¶å€™ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¦‚æœä½ å¯¹ä½ çš„æ•°æ®å…ˆåšå¤§é‡çš„é¢„å¤„ç†ï¼Œå€’ä¹Ÿèƒ½èŠ‚çœäº›èƒ½è€—ã€‚

* æ¨ç†æ—¶é—´

å¦ä¸€é¡¹è¦è€ƒè™‘çš„é‡è¦äº‹é¡¹æ˜¯è·å–è¾“å‡ºæˆ–å®é™…è¿è¡Œæ¨¡å‹æ‰€èŠ±çš„æ—¶é—´ã€‚å¯¹äºå®æ—¶åº”ç”¨è€Œè¨€ï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸å½“é‡è¦çš„å±‚é¢ã€‚ç¨‹åºæ— éœ€å‘é€æˆ–æ¥å—æ•°æ®ï¼ŒåŠ å¿«äº†æ¨ç†çš„é€Ÿåº¦ã€‚

* ç½‘ç»œå¯ç”¨æ€§

ä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•åœ¨è€ƒè™‘ç½‘ç»œå¯ç”¨æ€§å±‚é¢ä¹Ÿæ˜¯ç›¸å½“æ˜‚è´µçš„ï¼Œå› ä¸ºä½ çš„è®¾å¤‡å¿…é¡»åœ¨é€‚å®œçš„å¸¦å®½æˆ–ç½‘ç»œç¯å¢ƒä¸­ï¼Œæ‰èƒ½è¿ç»­å‘é€æ•°æ®å¹¶ä»æœåŠ¡å™¨æ¥æ”¶æ•°æ®æ‰èƒ½æ­£å¸¸è·å– ML ç»“æœã€‚

* å®‰å…¨

æœ€åï¼Œä½ çš„æ•°æ®çš„å®‰å…¨æ€§ä¹Ÿå°†æå‡ï¼šè®¾å¤‡ä¸å†éœ€è¦å°†æ•°æ®å‘é€åˆ°æœåŠ¡å™¨æˆ–åŸºäºäº‘çš„ç³»ç»Ÿï¼Œå³ä¸å†å°†æ•°æ®å‘é€å‡ºè®¾å¤‡ï¼Œä»è€Œå¢å¼ºäº†å®‰å…¨æ€§ã€‚

## ML æ¨¡å‹ç»‘å®šæ’ä»¶

> æ³¨æ„ï¼šæ‚¨éœ€è¦ Android Studio 4.1 æˆ–æ›´é«˜ç‰ˆæœ¬æ‰èƒ½ä½¿ç”¨ ML æ¨¡å‹ç»‘å®šæ’ä»¶

**ML æ¨¡å‹ç»‘å®šæ’ä»¶ä¸»è¦å…³æ³¨ä»€ä¹ˆï¼Ÿ**

ä½ å¯ä»¥ä»â€œæ¨¡å‹æ„å»ºâ€è¿™ä¸ªåç§°ä¸­åšå‡ºè¶³å¤Ÿåˆç†çš„çŒœæµ‹ï¼Œä»è€Œäº†è§£ [ML æ¨¡å‹ç»‘å®šæ’ä»¶](https://developer.android.com/studio/preview/features#tensor-flow-lite-models)ã€‚å®ƒç¡®å®å¯ä»¥ä½¿æˆ‘ä»¬éå¸¸è½»æ¾åœ°ä½¿ç”¨è‡ªå®šä¹‰ TF Lite æ¨¡å‹ï¼Œè®©æˆ‘ä»¬è¿™ç¾¤å¼€å‘äººå‘˜å¯ä»¥æ–¹ä¾¿åœ°å¯¼å…¥ä»»ä½• TFLite æ¨¡å‹ï¼Œè¯»å–å¯¼å…¥çš„æ¨¡å‹çš„è¾“å…¥æˆ–è¾“å‡ºçš„ç­¾åï¼Œå¹¶ä¸”åªéœ€è¦å†è°ƒç”¨å‡ è¡Œä»£ç ï¼Œå°±å¯ä»¥ä½¿ç”¨ TensorFlow Lite Android æ”¯æŒåº“ã€‚

ML æ¨¡å‹ç»‘å®šæ’ä»¶ä½¿æ‚¨å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­è½»æ¾ä½¿ç”¨ TF æ¨¡å‹ã€‚ä»æœ¬è´¨ä¸Šè®²ï¼Œä½ éœ€è¦ç¼–å†™çš„è°ƒç”¨ TensorFlow Lite Android æ”¯æŒåº“çš„ä»£ç è¦å°‘å¾—å¤šã€‚å¦‚æœä½ æ›¾ç»ä½¿ç”¨è¿‡ TensorFlow Lite æ¨¡å‹ï¼Œåˆ™ä½ å¯èƒ½çŸ¥é“ä½ é¦–å…ˆéœ€è¦å°†æ‰€æœ‰å†…å®¹éƒ½è½¬æ¢ä¸º `ByteArray`ã€‚ä½¿ç”¨ ML æ¨¡å‹ç»‘å®šæ’ä»¶ï¼Œä½ å°†ä¸å†éœ€è¦å†å°†æ‰€æœ‰å†…å®¹éƒ½è½¬æ¢ä¸º `ByteArray`ã€‚

æˆ‘å–œæ¬¢è¿™ä¸ªæ–°æ’ä»¶çš„å¦ä¸€ä¸ªåŸå› æ˜¯æˆ‘å¯ä»¥è½»æ¾åœ°ä½¿ç”¨ GPU å’Œ NN APIã€‚ä½¿ç”¨ ML æ¨¡å‹ç»‘å®šæ’ä»¶ï¼Œä½¿ç”¨å®ƒä»¬ä»æœªå¦‚æ­¤ç®€å•ã€‚ç°åœ¨ï¼Œè¦ä½¿ç”¨å®ƒä»¬ï¼Œæˆ‘ä»¬ä»…ä»…åªéœ€è¦è°ƒç”¨ä¸€ä¸ªä¾èµ–é¡¹å’Œä¸€è¡Œä»£ç ã€‚éš¾é“ä½¿ç”¨ æ¨¡å‹ç»‘å®š æ’ä»¶ä¸é…·å˜›ï¼Ÿå€ŸåŠ© Android 11 ç¥ç»ç½‘ç»œ APIï¼Œæˆ‘ä»¬ç”šè‡³è¿˜æ‹¥æœ‰äº†æ— ç¬¦å·æ•´æ•°æƒé‡æ”¯æŒå’Œæ–°çš„æœåŠ¡è´¨é‡ï¼ˆQOSï¼‰APIï¼Œä¹ŸåŒæ—¶è¿˜æ”¯æŒäº†æ›´å¤šçš„ç»ˆç«¯åœºæ™¯ã€‚ä½¿ç”¨ä¸Šæ–‡è°ˆåŠçš„è¿™äº›åŠŸèƒ½ï¼Œä½ ç»å¯¹å¯ä»¥æ›´å¿«åœ°è¿›è¡Œå¼€å‘ï¼

**ä½¿ç”¨æ¨¡å‹ç»‘å®šæ’ä»¶**

ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å®ç°æ‰€è®¨è®ºçš„å†…å®¹ã€‚

å› æ­¤ï¼Œç¬¬ä¸€æ­¥æ˜¯å¯¼å…¥å¸¦æœ‰å…ƒæ•°æ®çš„ TensorFlow Lite æ¨¡å‹ã€‚Android Studio ç°åœ¨æœ‰ä¸€ä¸ªç”¨äºå¯¼å…¥ TensorFlow æ¨¡å‹çš„æ–°é€‰é¡¹ï¼šåªéœ€å³é”®å•å‡»è¦å¯¼å…¥å®ƒçš„æ¨¡å—ï¼Œéšåä½ å°†ä¼šåœ¨ `Others` ä¸‹çœ‹åˆ°ä¸€ä¸ªå« `TF Lite Model` çš„é€‰é¡¹ã€‚

![Android Studio ä¸­çš„å¯¼å…¥æ¨¡å‹é€‰é¡¹](https://cdn-images-1.medium.com/max/2500/1*fnNNyLYKqafERAjUfwPsxQ.jpeg)

æˆ‘ä»¬åªéœ€ä¼ é€’ `tflite` æ¨¡å‹çš„è·¯å¾„å³å¯ï¼Œè€Œå®ƒå°±ä¼šè‡ªåŠ¨åœ°åœ¨ä½ ä¹‹å‰é€‰æ‹©çš„ `ml` æ¨¡å—ä¸­çš„ç›®å½•ä¸­ä¸ºæˆ‘ä»¬å¯¼å…¥æ¨¡å‹ã€‚æˆ‘ä»¬ç°åœ¨å°±å¯ä»¥åœ¨å…¶ä¸­ä½¿ç”¨è¯¥æ¨¡å‹ï¼Œå¹¶ä¸”æˆ‘ä»¬åªéœ€å‡ ä¸ªå•å‡»å³å¯æ·»åŠ ä¾èµ–é¡¹ç›®å’Œä½¿ç”¨ GPU åŠ é€Ÿã€‚

![å¯¼å…¥ `tflite` æ¨¡å‹](https://cdn-images-1.medium.com/max/2502/1*wJmnVf7wtCOV50HnXXmmPQ.jpeg)

ç°åœ¨ä»æˆ‘çš„æ¨¡å‹å…ƒæ•°æ®ä¸­ï¼Œæˆ‘è¿˜å¯ä»¥çŸ¥é“è¾“å…¥ã€è¾“å‡ºçš„ç±»å‹ä»¥åŠå…¶ä»–éœ€è¦è¢«ä½¿ç”¨çš„ä¿¡æ¯ â€”â€” æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ Android Studio ä¸­æ‰“å¼€ `tflite` æ¨¡å‹æ–‡ä»¶æ¥æŸ¥çœ‹æ­¤ä¿¡æ¯ã€‚åœ¨è¿™ä¸ªå±å¹•æˆªå›¾ä¸­ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯æˆ‘åˆ¶ä½œçš„å¼€æºæ¨¡å‹æ¥å¯¹å‰ªåˆ€ã€çŸ³å¤´ã€å¸ƒè¿›è¡ŒåŒºåˆ†ã€‚æˆ‘ä»¬åªéœ€å°†æ‰‹æ”¾åœ¨æ‘„åƒå¤´å‰å³å¯è¯†åˆ«å‡ºæ˜¯å‰ªåˆ€è¿˜æ˜¯çŸ³å¤´è¿˜æ˜¯å¸ƒï¼Œè¿™ä¹Ÿæ˜¯æˆ‘åœ¨æœ¬æ–‡ä¸­æ¼”ç¤ºçš„å†…å®¹ã€‚

![æŸ¥çœ‹æ¨¡å‹å…ƒæ•°æ®](https://cdn-images-1.medium.com/max/2502/1*ZHuSORcTLhxtSWr60TzxWA.jpeg)

æœ€åï¼Œè®©æˆ‘ä»¬å¼€å§‹ä½¿ç”¨è¯¥æ¨¡å‹ï¼Œä»¥ä¾¿è¿›è¡Œæµæ¨æ–­ï¼Œè¿™å¾ˆå¯èƒ½ä¹Ÿæ˜¯ä½ æƒ³è¦æ‰§è¡Œçš„æ“ä½œï¼šå®æ—¶å›¾åƒåˆ†ç±»ã€‚è¦å®ç°è¿™ä¸ªï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨ Camera Xï¼Œå¹¶å°†æ¯ä¸ªå¸§ä¼ é€’ç»™å¯ä»¥æ‰§è¡Œæ¨ç†çš„å‡½æ•°ã€‚åœ¨è¿™é‡Œï¼Œå…¶å®æˆ‘æ„Ÿå…´è¶£çš„æ˜¯è¿›è¡Œæ¨æ–­çš„å‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥å‘ç°æ‰§è¡Œæ­¤æ“ä½œçœŸçš„æ˜¯éå¸¸å®¹æ˜“ï¼šåœ¨å¯¼å…¥å¯ä»¥ä½¿ç”¨çš„ TF Lite æ¨¡å‹æ—¶ï¼Œä¼¼ä¹ä¹ŸåŒæ—¶ç”Ÿæˆäº†ä¸€ä»½ç¤ºä¾‹ä»£ç ã€‚

```kotlin
private val rpsModel = RPSModel.newInstance(ctx)
```

è¿™é‡Œæˆ‘ä»¬å°†é¦–å…ˆå®ä¾‹åŒ–ä¸€ä¸ª `rps` æ¨¡å‹ï¼Œè¯¥æ¨¡å‹æ˜¯å‰ªåˆ€çŸ³å¤´å¸ƒæ¨¡å‹çš„ç¼©å†™ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™ä¸Šä¸‹æ–‡ã€‚åœ¨ä½¿ç”¨è¿™ä¸ªæ’ä»¶ï¼ŒåŒæ—¶æˆ‘çš„æ¨¡å‹åç§°ä¸º `RPS Model.tflite` çš„æƒ…å†µä¸‹ï¼Œç¨‹åºä¸ºæˆ‘åˆ›å»ºäº†ä¸€ä¸ªå®Œå…¨ç›¸åŒåç§°çš„ç±»ï¼Œä¸€ä¸ªåä¸º `RPS Model` çš„ç±»ã€‚

```kotlin
val tfImage = TensorImage.fromBitmap(toBitmap(imageProxy))
```

ç°åœ¨æˆ‘ä»¬éœ€è¦å°†æ•°æ®è½¬æ¢ä¸ºå¯ä½¿ç”¨çš„æ ¼å¼ï¼Œä»¥ä¾¿å°†å…¶ä» `Bitmap` è½¬æ¢ä¸º `Tensor Image`ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ TF è§£é‡Šå™¨ï¼Œåˆ™æˆ‘ä»¬éœ€è¦å°†å›¾åƒè½¬æ¢ä¸ºä¸€ä¸ª`ByteArray`ã€‚ä½†ç°åœ¨æˆ‘ä»¬æ— éœ€å†è¿™æ ·åšäº† â€”â€” ç›´æ¥äº¤ç»™ä¸€ä¸ªå›¾ç‰‡ä»£ç†å»å¤„ç†å³å¯ã€‚

```kotlin
val outputs = rpsModel.process(tfImage)
    .probabilityAsCategoryList.apply {
        sortByDescending { it.score } // æ’åºï¼Œé«˜åŒ¹é…ç‡ä¼˜å…ˆ
    }.take(MAX_RESULT_DISPLAY) // æŠ±èµ°ç¬¬ä¸€
```

ç°åœ¨æˆ‘ä»¬å·²ç»å°†æ•°æ®ä¼ é€’ç»™æ¨¡å‹ï¼Œæˆ‘ä»¬å°†å¤„ç†æ¨¡å‹ä¸­çš„å›¾åƒå¹¶è·å¾—è¾“å‡ºï¼Œæˆ‘ä»¬å°†åŸºæœ¬ä¸Šå¾—åˆ°ä¸€ä¸ªåŒ¹é…ç‡çš„æ•°ç»„å¹¶å¯¹å…¶è¿›è¡Œé™åºæ’åºï¼Œä»¥è·å–å…·æœ‰æœ€å¤§å€¼çš„æ¦‚ç‡ï¼Œç„¶åé€‰æ‹©é™åºåˆ—è¡¨çš„ç¬¬ä¸€åæ˜¾ç¤ºå‡ºæ¥ã€‚

```kotlin
for (output in outputs) {
    items.add(
        Recognition(
            output.label,
            output.score
        )
    )
}
```

æœ€åï¼Œæˆ‘éœ€è¦å‘ç”¨æˆ·æ˜¾ç¤ºæ ‡ç­¾ï¼Œå› æ­¤æˆ‘å°†åœ¨è¾“å‡ºä¸­æ·»åŠ ä¸æ¯ä¸ªæ¡ç›®ç›¸å¯¹åº”çš„æ ‡ç­¾ã€‚è¿™å°±æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„å…¨éƒ¨ä»£ç ï¼ ğŸš€ï½

**ä½¿ç”¨ GPU åŠ é€Ÿ**

å¦‚æœæˆ‘ä»¬æƒ³è¦ä½¿ç”¨ GPU åŠ é€Ÿï¼Œå…¶å®åšæ³•éå¸¸ç®€å•ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨è¦ä½¿ç”¨ GPU å¹¶è¿›è¡Œæ„å»ºæ¨¡å‹çš„åœ°æ–¹åˆ›å»ºä¸€ä¸ª `options` å¯¹è±¡ã€‚æˆ‘åªæ˜¯å°†å…¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™å®ä¾‹åŒ–è¿‡ç¨‹ã€‚æˆ‘ä»¬ç°åœ¨å°±å¯ä»¥ä½¿ç”¨ GPUï¼Œè¿™ä¸ªç®€æ˜“æ“ä½œè®©ä½¿ç”¨ NN API åŠ é€Ÿå¹¶åœ¨ Android 11 ä¸Šæ‰§è¡Œæ›´å¤šæ“ä½œå˜å¾—éå¸¸å®¹æ˜“ã€‚

```kotlin
private val options = Model.Options.Builder().setDevice(Model.Device.GPU).build()
private val rpsModel = rpsModel.newInstance(ctx, options)
```

## ä¸€ä¸ªæ–°çš„ ML Kit å¥—ä»¶

> æˆ‘ä»¬ç°åœ¨ä¸å†éœ€è¦ Firebase é¡¹ç›®æ¥ä¸ ML Kit ä¸€èµ·ä½¿ç”¨ï¼Œè™½ç„¶è¯´æˆ‘ä»¬ä¾æ—§å¯ä»¥åœ¨ Firebase ä¸­ä½¿ç”¨å®ƒã€‚

å¦ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„æ›´æ–°æ˜¯å¯ä»¥é€šè¿‡ [ML Kit](https://g.co/mlkit) ä½¿ç”¨ TensorFlow Lite æ¨¡å‹ã€‚è€Œä¸”å³ä½¿æˆ‘ä»¬ä¸ä½¿ç”¨ Firebase é¡¹ç›®ï¼Œæˆ‘ä»¬ç°åœ¨ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ ML Kit äº†ã€‚

æ­£å¦‚æˆ‘ä¹‹å‰æåˆ°çš„ï¼Œç”±äºæˆ‘ä¹‹å‰æåˆ°çš„å¥½å¤„ï¼ŒAndroid 11 ä¸­æœ‰è®¸å¤šæ›´æ–°é›†ä¸­åœ¨è®¾å¤‡ä¸Šçš„ ML ä¸Šã€‚ç°åœ¨ï¼Œæ–°çš„ ML Kit åœ¨è®¾å¤‡ä¸Šå…·æœ‰æ›´å¥½çš„å¯ç”¨æ€§ã€‚ML Kit çš„[å›¾åƒåˆ†ç±»](https://developers.google.com/ml-kit/vision/image-labeling/custom-models/android)å’Œ[å¯¹è±¡æ£€æµ‹å’Œè·Ÿè¸ªï¼ˆODTï¼‰](https://developers.google.com/ml-kit/vision/object-detection/custom-models/android)ç°åœ¨ä¹Ÿæ”¯æŒè‡ªå®šä¹‰æ¨¡å‹ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `tflite` æ¨¡å‹æ–‡ä»¶èµ°é Android çš„ ML äº†ã€‚è¿™ä¹Ÿæ„å‘³ç€å¦‚æœæˆ‘ä»¬æ­£åœ¨å¤„ç†æŸäº›å¸¸è§åœºæ™¯ï¼Œä¾‹å¦‚å¯¹ç‰¹å®šç±»å‹çš„å¯¹è±¡æ£€æµ‹ï¼Œé‚£ä¹ˆ ML Kit æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚

**ä½¿ç”¨ ML Kit**

è®©æˆ‘ä»¬åœ¨ä»£ç ä¸­çœ‹çœ‹å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ï½æˆ‘ä»¬ç°åœ¨å°†è¦å»ºç«‹ä¸€ä¸ªå¯ä»¥å¯¹ä¸åŒé£Ÿå“åˆ†ç±»çš„æ¨¡å‹ï¼Œ

```kotlin
private localModel = LocalModel.Builder()
    .setAssetFilePath("lite-model_aiy_vision_classifier_food_V1_1.tflite").
    .build()
```

åœ¨è¿™é‡Œæˆ‘å°†é¦–å…ˆé€šè¿‡è®¾ç½®æ¨¡å‹å¹¶ä¸ºå…¶æŒ‡å®š `tflite` æ¨¡å‹æ–‡ä»¶è·¯å¾„å¼€å§‹ã€‚

```kotlin
private val customObjectDetectorOptions = CustomObjectDetectorOptions
    .Builder(localModel)
    .setDetectorMode(CustomObjectDetectorOptions.STREAM_MODE) 
    .setClassificationConfidenceThreshold(0.8f) 
    .build()
```

ç„¶åï¼Œæ­¤ `tflite` æ¨¡å‹å°†åœ¨å¸¦æœ‰ ML Kit çš„å¯¹è±¡æ£€æµ‹æ¨¡å‹çš„é¡¶éƒ¨è¿è¡Œã€‚æˆ‘ä»¬ç°åœ¨å¯ä»¥ç¨å¾®è‡ªå®šä¹‰è¿™äº›é€‰é¡¹ã€‚åœ¨è¿™é‡Œï¼Œç”±äºè¦ä½¿ç”¨æµè¾“å…¥å¹¶æŒ‡å®šç½®ä¿¡åº¦é˜ˆå€¼ï¼Œå› æ­¤æˆ‘ä¸“é—¨è®¾ç½®äº† `STREAM_MODE`ã€‚

```kotlin
private val objectDetector = ObjectDetection.getClient(customObjectDetectorOptions) objectDetector.process(image) 
    .addOnFailureListener(Log.d(...))

    .addOnSuccessListener{ 
        graphicsOverlay.clear() 
        for (detectedObject in it){ 
            graphicsOverlay.add(ObjectGraphic(graphicsOverlay, detectedObject))
        } 
        graphicsOverlay.postInvalidate()} 

    .addOnCompleteListenerl imageProxy.close() }
```

è®©æˆ‘ä»¬è¿›å…¥è¿è¡Œæ¨¡å‹çš„é‚£ä¸€éƒ¨åˆ†ï¼Œè¿™æ ·æˆ‘ä»¬å¯èƒ½ä¼šçœ‹åˆ°ä¸€äº›ç±»ä¼¼äºæ­¤å¤„å‰é¢ç¤ºä¾‹çš„è¯­æ³•ã€‚æˆ‘å°†å¤„ç†æˆ‘çš„å›¾åƒï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰€æœ‰å¤„äºå¤±è´¥æˆ–æˆåŠŸçŠ¶æ€çš„ä¾¦å¬å™¨éƒ½æ˜¯å¿…ä¸å¯ç¼ºçš„ä»£ç ï¼Œåœ¨æˆ‘ä»¬çš„æ¯æ¬¡è¿è¡Œä¸Šéƒ½éœ€è¦é™„åŠ ä¸Šè¿™äº›ä¾¦å¬å™¨ã€‚è¿™å°±æ˜¯æˆ‘ä»¬æ‰€æœ‰éœ€è¦ç¼–å†™çš„ä»£ç ï¼æˆ‘ä»¬å·²ç»æå®šäº†ï¼ğŸš€ï½

## æŸ¥æ‰¾æ¨¡å‹

æˆ‘ä»¬è®¨è®ºäº†å¾ˆå¤šæœ‰å…³æ¨¡å‹åˆ¶ä½œåçš„å†…å®¹ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä¸ºæ‚¨çš„ç”¨ä¾‹æ‰¾åˆ°æ¨¡å‹ã€‚

* TF Lite Model Maker

TensorFlow å›¢é˜Ÿä¹Ÿäº 2020 å¹´åˆå¼€å¯äº† TF Lite Model Makerã€‚è¿™ä½¿å¾—åˆ¶ä½œå¥½çš„æ¨¡å‹è¶…çº§å®¹æ˜“ä½¿ç”¨ï¼Œå…·æœ‰å¾ˆé«˜çš„æ€§èƒ½ï¼Œè¿˜å¯ä»¥è¿›è¡Œå¤§é‡çš„è‡ªå®šä¹‰ã€‚æˆ‘ä»¬ç°åœ¨å¯ä»¥ç®€å•åœ°ä¼ é€’æ•°æ®å¹¶ä½¿ç”¨å¾ˆå°‘çš„ä»£ç æ¥æ„å»º `tflite` æ¨¡å‹ã€‚æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹å®˜ç½‘ä¸­çš„ [TensorFlow Lite Model Maker ç¤ºä¾‹](https://github.com/Rishit-dagli/ML-with-Android-11/blob/dev/TensorFlow_Lite_Model_Maker_example.ipynb)ã€‚

* TensorFlow Hub

TensorFlow Hub æ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç å­˜å‚¨åº“ï¼Œå…¶ä¸­åŒ…å«æœ€æ–°æŠ€æœ¯å’Œæœ‰æ®å¯æŸ¥çš„æ¨¡å‹ã€‚æˆ‘ä»¬ä½¿ç”¨ ML Kit æ„å»ºçš„é£Ÿå“åˆ†ç±»åº”ç”¨ç¨‹åºä¹Ÿå‡ºç°åœ¨ TF Hub ä¸Šã€‚æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨[ç¤¾åŒº tfhub.dev](https://tfhub.dev/) ä¸­çš„æ¨¡å‹ã€‚

![tfhub.dev ä¸Šçš„ä¸€äº›å‘å¸ƒè€…](https://cdn-images-1.medium.com/max/2022/0*cv-fzgw2WPuf4PQI.png)

![TF Hub ä¸­çš„è¿‡æ»¤å™¨](https://cdn-images-1.medium.com/max/2000/1*Cu-XiVrzOi2MdKatQ1dpzw.png)

å¦‚æœä½ åªæƒ³æŸ¥æ‰¾åŸºäºå›¾åƒæˆ–æ–‡æœ¬çš„æ¨¡å‹ï¼Œåˆ™å¯ä»¥åœ¨ TF Hub ä¸­é€šè¿‡æ·»åŠ è¿‡æ»¤æ¡ä»¶æ¥æœç´¢ã€‚ä¾‹å¦‚å¦‚æœæˆ‘ä»¬è¦åœ¨ç½‘ç»œã€ç»ˆç«¯è®¾å¤‡æˆ– Corals ä¸Šè¿è¡Œ MLï¼Œè¯·é€šè¿‡æ¶æ„ã€ä½¿ç”¨çš„æ•°æ®é›†ç­‰ç­›é€‰ç­‰ç­‰ã€‚

æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥ç›´æ¥ä» TF Hub ä¸‹è½½è¿™äº›æ¨¡å‹ï¼Œä¹Ÿå¯ä»¥éå¸¸è½»æ¾åœ°ä½¿ç”¨æ‚¨è‡ªå·±çš„æ•°æ®å¯¹è¿™äº›æ¨¡å‹è¿›è¡Œè¿ç§»å­¦ä¹ ã€‚ä½†æ˜¯ï¼Œåœ¨æœ¬æ–‡ä¸­æˆ‘ä»¬å°†ä¸è¿›ä¸€æ­¥ä»‹ç»ä½¿ç”¨ TF Hub çš„è¿ç§»å­¦ä¹ äº†ã€‚æœ‰å…³ TF Hub çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‰å¾€[æˆ‘çš„åšå®¢](https://towardsdatascience.com/building-better-ai-apps-with-tf-hub-88716b302265)æŸ¥çœ‹ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸å°‘çš„æœåŠ¡æä¾›å•†ï¼Œä¾‹å¦‚ [Teachable Machine](https://teachablemachine.withgoogle.com/)ï¼Œ[AutoML](https://cloud.google.com/automl)ï¼Œä½†ä¸Šè¿°çš„éƒ½ç®—æ˜¯æ¯”è¾ƒå¸¸è§çš„æä¾›å•†ã€‚

---

[GitHub ä»“åº“](https://github.com/Rishit-dagli/ML-with-Android-11) ä¸­æä¾›äº†æ­¤å¤„å±•ç¤ºçš„æ‰€æœ‰æœ‰å…³ TF Lite Model Maker çš„ç¤ºä¾‹çš„ä»£ç ã€‚æˆ‘è¿˜ä¸ºæ‚¨ä½ ä¾›äº†ä¸€äº›å·²è®­ç»ƒçš„æ¨¡å‹ï¼Œä¾›åˆå­¦è€…å…¥é—¨å’Œå®éªŒã€‚

> å¦‚æœå‘ç°è¯‘æ–‡å­˜åœ¨é”™è¯¯æˆ–å…¶ä»–éœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼Œæ¬¢è¿åˆ° [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner) å¯¹è¯‘æ–‡è¿›è¡Œä¿®æ”¹å¹¶ PRï¼Œä¹Ÿå¯è·å¾—ç›¸åº”å¥–åŠ±ç§¯åˆ†ã€‚æ–‡ç« å¼€å¤´çš„ **æœ¬æ–‡æ°¸ä¹…é“¾æ¥** å³ä¸ºæœ¬æ–‡åœ¨ GitHub ä¸Šçš„ MarkDown é“¾æ¥ã€‚

---

> [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner) æ˜¯ä¸€ä¸ªç¿»è¯‘ä¼˜è´¨äº’è”ç½‘æŠ€æœ¯æ–‡ç« çš„ç¤¾åŒºï¼Œæ–‡ç« æ¥æºä¸º [æ˜é‡‘](https://juejin.im) ä¸Šçš„è‹±æ–‡åˆ†äº«æ–‡ç« ã€‚å†…å®¹è¦†ç›– [Android](https://github.com/xitu/gold-miner#android)ã€[iOS](https://github.com/xitu/gold-miner#ios)ã€[å‰ç«¯](https://github.com/xitu/gold-miner#å‰ç«¯)ã€[åç«¯](https://github.com/xitu/gold-miner#åç«¯)ã€[åŒºå—é“¾](https://github.com/xitu/gold-miner#åŒºå—é“¾)ã€[äº§å“](https://github.com/xitu/gold-miner#äº§å“)ã€[è®¾è®¡](https://github.com/xitu/gold-miner#è®¾è®¡)ã€[äººå·¥æ™ºèƒ½](https://github.com/xitu/gold-miner#äººå·¥æ™ºèƒ½)ç­‰é¢†åŸŸï¼Œæƒ³è¦æŸ¥çœ‹æ›´å¤šä¼˜è´¨è¯‘æ–‡è¯·æŒç»­å…³æ³¨ [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)ã€[å®˜æ–¹å¾®åš](http://weibo.com/juejinfanyi)ã€[çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/juejinfanyi)ã€‚
