> * åŸæ–‡åœ°å€ï¼š[Building a read-through cache using CDN](https://levelup.gitconnected.com/building-a-read-through-cache-using-cdn-59988a3d75ce)
> * åŸæ–‡ä½œè€…ï¼š[Aritra Das](https://medium.com/@dev.aritradas)
> * è¯‘æ–‡å‡ºè‡ªï¼š[æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)
> * æœ¬æ–‡æ°¸ä¹…é“¾æ¥ï¼š[https://github.com/xitu/gold-miner/blob/master/article/2021/building-a-read-through-cache-using-cdn.md](https://github.com/xitu/gold-miner/blob/master/article/2021/building-a-read-through-cache-using-cdn.md)
> * è¯‘è€…ï¼š[éœœç¾½ Hoarfroster](https://github.com/PassionPenguin)
> * æ ¡å¯¹è€…ï¼š

# ä½¿ç”¨ CDN æ„å»ºç›´è¯»å¼ç¼“å­˜

![ç”± Pikisuperstar / Freepik è®¾è®¡](https://cdn-images-1.medium.com/max/3000/1*vEUuzXh0fRgDxebH95faWg.png)

å½“ä½ ä¸ºéœ€è¦é«˜ååé‡çš„ç³»ç»Ÿæ„å»º API æ—¶ï¼Œç¼“å­˜å‡ ä¹æ˜¯ä¸å¯é¿å…çš„ã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸Šå·¥ä½œçš„æ¯ä¸ªå¼€å‘è€…å¤šå¤šå°‘å°‘éƒ½åœ¨æŸäº›æ—¶å€™ä½¿ç”¨äº†ä¸€äº›ç¼“å­˜æœºåˆ¶ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£ä½¿ç”¨ CDN æ„å»ºç›´è¯»å¼ç¼“å­˜çš„è®¾è®¡ã€‚è¿™ç§åšæ³•ä¸ä»…ä¼˜åŒ–äº† APIï¼Œè¿˜èƒ½é™ä½åŸºç¡€æ¶æ„æˆæœ¬ã€‚

> æ‹¥æœ‰ä¸€äº›å…³äºç¼“å­˜å’Œ CDN çš„äº†è§£å°†æœ‰åŠ©äºäº†è§£è¿™ç¯‡æ–‡ç« ã€‚å¦‚æœä½ å®Œå…¨æ²¡æœ‰äº†è§£è¿‡è¿™äº›çŸ¥è¯†çš„è¯ï¼Œæˆ‘å¸Œæœ›ä½ å…ˆç¨å¾®äº†è§£ä¸€ç‚¹è¿™äº›çŸ¥è¯†ï¼Œç„¶åå†å›æ¥é˜…è¯»è¿™ç¯‡æ–‡ç« ã€‚

## ä¸€ç‚¹èƒŒæ™¯

åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œæˆ‘æ­£ä¸ [Glance](https://www.glance.com/) åˆä½œã€‚Glance æ˜¯ä¸–ç•Œä¸Šæœ€å¤§çš„åŸºäºé”å±çš„å†…å®¹å‘ç°å¹³å°ï¼Œåœ¨è¿™ä¸€é¢†åŸŸä¸Šæœ‰å¤§çº¦ 1.4 äº¿ä¸ªæ´»è·ƒçš„ç”¨æˆ·ã€‚æ‰€ä»¥ä½ å¯ä»¥æƒ³è±¡æˆ‘ä»¬éœ€è¦è¿è¡Œçš„æœåŠ¡çš„è§„æ¨¡ä¹‹å¤§ã€‚è€Œä¸”åœ¨è¿™ç§è§„æ¨¡ä¸­ï¼Œå³ä½¿æ˜¯æœ€ç®€å•çš„äº‹æƒ…ä¹Ÿèƒ½å˜å¾—è¶…çº§å¤æ‚ã€‚ä½œä¸ºåç«¯å¼€å‘è€…ï¼Œæˆ‘ä»¬å§‹ç»ˆåŠªåŠ›å»ºç«‹é«˜åº¦ä¼˜åŒ–çš„ APIï¼Œä¸ºç”¨æˆ·æä¾›è‰¯å¥½çš„ä½“éªŒã€‚æ•…äº‹ä»è¿™é‡Œå¼€å§‹ï¼Œè®²è¿°æˆ‘ä»¬å¦‚ä½•é¢å¯¹ä¸€å®šçš„é—®é¢˜ï¼Œç„¶åæˆ‘ä»¬åˆæ˜¯å¦‚ä½•è§£å†³äº†è¿™äº›é—®é¢˜çš„ã€‚æˆ‘å¸Œæœ›åœ¨é˜…è¯»æœ¬æ–‡åï¼Œä½ èƒ½åœ¨å¤§è§„æ¨¡çš„ç³»ç»Ÿè®¾è®¡ä¸Šå­¦æœ‰æ‰€æˆã€‚

## é—®é¢˜

æˆ‘ä»¬éœ€è¦å¼€å‘ä¸€äº›å…·æœ‰ä»¥ä¸‹ç‰¹å¾çš„ APIï¼š

1. æ•°æ®ä¸ä¼šç»å¸¸å˜åŒ–ã€‚
2. æ‰€æœ‰ç”¨æˆ·çš„å“åº”æ˜¯ç›¸åŒçš„ï¼Œæ²¡æœ‰æ„å¤–çš„æŸ¥è¯¢å‚æ•°ï¼Œç®€å•ç›´æ¥è·å– APIã€‚
3. æœ€å¤§å“åº”æ•°æ®é‡ä¸º 600 kBã€‚
4. æˆ‘ä»¬é¢„è®¡ API ä¼šæœ‰é¢„æœŸéå¸¸é«˜çš„ååé‡ï¼ˆæœ€ç»ˆå·¦å³ 5~6 ä¸‡æ¯ç§’ï¼‰ã€‚

é‚£ä¹ˆä½ å…ˆçœ‹åˆ°è¿™ä¸ªé—®é¢˜æ—¶ï¼Œä½ æƒ³åˆ°äº†ä»€ä¹ˆï¼Ÿå¯¹æˆ‘æ¥è¯´ï¼Œåªè¦åœ¨èŠ‚ç‚¹ä¸Šï¼ˆç”±äºæ•°æ®é‡ä½ï¼‰å¾€ API ä¸­æ·»åŠ å†…å­˜ç¼“å­˜ï¼ˆå¯èƒ½æ˜¯ Google Guavaï¼‰ï¼Œä½¿ç”¨ Kafka å‘é€æ— æ•ˆæ¶ˆæ¯ï¼ˆå› ä¸ºæˆ‘å–œæ¬¢ Kafka ğŸ˜† å¹¶ä¸”å®ƒæ˜¯å¯é çš„ï¼‰ï¼Œè®¾ç½®ä¸ºæœåŠ¡å®ä¾‹å¯åŠ¨è§„æ¨¡è‡ªåŠ¨è°ƒèŠ‚ï¼ˆå› ä¸ºæ•´ä¸ªæ—¥é—´çš„æµé‡å¹¶ä¸ç»Ÿä¸€ï¼‰ã€‚å¦‚å›¾æ‰€ç¤ºï¼š

![è®¾è®¡ v1](https://cdn-images-1.medium.com/max/2000/1*f60s9scn5jvmgutdcowpkg.jpeg)

bamï¼é—®é¢˜è§£å†³äº†ï¼å¾ˆå®¹æ˜“å—ï¼Ÿå¥½å§ï¼Œå…¶å®å¹¶éå¦‚æ­¤ã€‚æ­£å¦‚ä»»ä½•å…¶ä»–è®¾è®¡ä¸€æ ·ï¼Œè¿™ä¸€ä¸ªè®¾è®¡å…¶å®ä¹Ÿæœ‰ä¸€äº›ç¼ºé™·ã€‚ä¾‹å¦‚ï¼Œè¿™ä¸ªè®¾è®¡å¯¹äºç®€å•ç”¨ä¾‹è€Œè¨€æœ‰ä¸€ç‚¹ç‚¹å¤ªå¤æ‚äº†ï¼ŒåŸºç¡€è®¾æ–½æˆæœ¬ä¸Šå‡äº† â€”â€” æˆ‘ä»¬ç°åœ¨éœ€è¦æ„å»ºä¸€ä¸ª Kafka + Zookeeper é›†ç¾¤ï¼Œå†åŠ ä¸Š 50k è¯·æ±‚/ç§’çš„è§„æ¨¡ï¼Œæˆ‘ä»¬éœ€è¦æ°´å¹³ç¼©æ”¾æˆ‘ä»¬çš„æœåŠ¡å®ä¾‹ï¼ˆå¯¹æˆ‘ä»¬è€Œè¨€æ˜¯ Kubernetes Podsï¼‰ã€‚è¿™è½¬åŒ–ä¸ºè£¸æœºèŠ‚ç‚¹æˆ–è™šæ‹Ÿæœºçš„å¢åŠ ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬å¯»æ‰¾æ›´ç®€å•ä¸”å…·æœ‰æˆæœ¬æ•ˆç›Šçš„æ–¹æ³•ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ä¸ºä½•æœ€ç»ˆä¼šä½¿ç”¨â€œä½¿ç”¨ CDN ç›´è¯»å¼ç¼“å­˜â€è¿™ä¸€è§£å†³æ–¹æ¡ˆã€‚æˆ‘å°†è®¨è®ºæ¶æ„çš„ç»†èŠ‚ä»¥åŠç¨åçš„æƒè¡¡ã€‚

---

ä½†åœ¨è¿›ä¸€æ­¥è¿›ä¸€æ­¥ä¹‹å‰ï¼Œè®©æˆ‘ä»¬äº†è§£è®¾è®¡çš„æ„å»ºå—ã€‚

## é€šè¿‡ç¼“å­˜è¯»å–

æ ‡å‡†ç¼“å­˜æ›´æ–°ç­–ç•¥æ˜¯è¿™æ ·çš„

1. **Cache aside**
2. **Read-through**
3. **Write-through**
4. **Write back**
5. **Refresh ahead**

æˆ‘ä¸ä¼šè¯¦ç»†ä»‹ç»å…¶ä»–ç­–ç•¥ï¼Œåªæœ‰åªæ˜¯æœ¬æ–‡åªæœ‰è¿™ä¸€ç‚¹ã€‚è®©æˆ‘ä»¬è¿›ä¸€æ­¥æŒ–æ˜ä¸€ç‚¹ï¼Œäº†è§£å®ƒçš„å·¥ä½œåŸç†ã€‚

> user1  -> åªæ˜¯ä¸€ä¸ªæƒ³è±¡ä¸­çš„è¯•å›¾è·å–çš„æ•°æ®

![](https://cdn-images-1.medium.com/max/2000/1*cz3w153osigeqh1u09nfnq.png)

ä¸Šå›¾ä¸è¨€è‡ªæ˜ï¼Œç”¨äºæ€»ç»“ä¸Šæ–‡ã€‚

1. åº”ç”¨ç¨‹åºä»æœªç›´æ¥ä¸æ•°æ®åº“è¿›è¡Œäº¤äº’ï¼Œè€Œæ˜¯å§‹ç»ˆä¸ç¼“å­˜äº¤äº’ã€‚
2. æ²¡æœ‰ç¼“å­˜æ—¶ï¼Œå°†ä»æ•°æ®åº“è¯»å–å¹¶ä¸°å¯Œç¼“å­˜ã€‚
3. æœ‰ç¼“å­˜æ—¶ï¼Œæ•°æ®æ¥è‡ªç¼“å­˜ã€‚

ä½ å¯ä»¥çœ‹åˆ°ï¼Œæ•°æ®åº“çš„è®¿é—®é¢‘ç‡å¾ˆä½ï¼Œå¹¶ä¸”ç”±äºæˆ‘ä»¬çš„ç¼“å­˜ä¸»è¦éƒ½æ˜¯å†…å­˜ç¼“å­˜ï¼ˆREDIS / MEMCACHEDï¼‰ï¼Œå› æ­¤å“åº”å¾ˆæ˜¯å¿«é€Ÿã€‚ç°åœ¨æˆ‘ä»¬å·²ç»è§£å†³äº†ä¸å°‘é—®é¢˜ ğŸ˜…

## CDN

äº’è”ç½‘ä¸Šå…³äº CDN çš„å®šä¹‰æ˜¯â€œ**å†…å®¹ä¼ é€’ç½‘ç»œï¼ˆCDNï¼‰æ˜¯ä¸€ä¸ªå…¨å±€åˆ†å¸ƒçš„ä»£ç†æœåŠ¡å™¨ç½‘ç»œï¼Œä»é è¿‘ç”¨æˆ·çš„ä½ç½®æœåŠ¡äºå†…å®¹ï¼Œå¹¶ä¸”ç”¨äºæä¾›è¯¸å¦‚å›¾åƒã€è§†é¢‘ã€HTMLã€CSS ä¹‹ç±»çš„é™æ€æ–‡ä»¶**â€œã€‚ä½†æˆ‘ä»¬å°†åå‘ä½¿ç”¨ CDN å¹¶ä¸ºç”¨æˆ·æä¾›åŠ¨æ€å†…å®¹ï¼ˆJSON å“åº”ï¼Œè€Œä¸æ˜¯é™æ€çš„ JSON æ–‡ä»¶ï¼‰ã€‚

æ­¤å¤–ï¼Œé€šå¸¸æœ‰ä¸¤ç§ CDN çš„æ¦‚å¿µ

1. **Push CDN**ï¼šè´Ÿè´£å°†æ•°æ®ä¸Šä¼ åˆ° CDN æœåŠ¡å™¨
2. **Pull CDN**ï¼šCDN å°†ä»ä½ çš„æœåŠ¡å™¨ä¸­æå–æ•°æ®ï¼ˆåŸå§‹æœåŠ¡å™¨ï¼‰

æˆ‘ä»¬å°†ä½¿ç”¨ Pull CDN è‡ªæ¨é€æ–¹æ³•ï¼Œæˆ‘å¿…é¡»å¤„ç†é‡è¯•å’Œå…¶ä»–äº‹æƒ…ï¼Œå¯¹æˆ‘æ¥è¯´æ˜¯ä¸€ä¸ªé¢å¤–çš„ç—›è‹¦ï¼Œä¹Ÿå¹¶æ²¡æœ‰çœŸæ­£å¯¹æ­¤ç”¨ä¾‹æœ‰ä»€ä¹ˆä»·å€¼ã€‚

## æŠŠ CDN å½“ä½œç›´è¯»å¼ç¼“å­˜

è¿™ä¸ªæƒ³æ³•å¾ˆç®€å•ï¼Œæˆ‘ä»¬å°† CDN ä½œä¸ºç”¨æˆ·å’Œå®é™…åç«¯æœåŠ¡ä¹‹é—´çš„ç¼“å­˜å±‚ã€‚

![è®¾è®¡ v2](https://cdn-images-1.medium.com/max/2000/1*fn-zmpouy7r3xows5c-mzq.jpeg)

æ­£å¦‚ä½ å¯ä»¥çœ‹åˆ° CDN ä½äºå®¢æˆ·ç«¯å’Œåç«¯æœåŠ¡ä¹‹é—´ï¼Œä¹Ÿå°±æˆä¸ºäº†ç¼“å­˜ã€‚åœ¨æ•°æ®æµåºåˆ—ä¸­çœ‹èµ·æ¥åƒè¿™æ ·ï¼š

![é…å›¾](https://cdn-images-1.medium.com/max/2000/1*47ogxf26v7e7myagkl4mtna.png)

è®©æˆ‘ä»¬æ›´æ·±å…¥åœ°æŒ–æ˜å®ƒï¼Œå› ä¸ºè¿™æ˜¯è®¾è®¡çš„ç—‡ç»“

### è¦ä½¿ç”¨çš„ç¼©å†™

> **T1**  -> time instance 1 + å‡ æ¯«ç§’
>
> **T2**  -> time instance 1 + ä¸€åˆ†é’Ÿ + å‡ æ¯«ç§’
>
> **TTL**  -> ç•™å­˜æ—¶é—´
>
> **åŸå§‹æœåŠ¡å™¨**  -> åœ¨è¿™ç§æƒ…å†µä¸‹ä½ çš„å®é™…åç«¯æœåŠ¡

1. T1ï¼šå®¢æˆ·ç«¯å‘èµ·è¯·æ±‚è·å– user1ã€‚
2. T1ï¼šè¯·æ±‚è½¬ç§»åˆ° CDN ä¸Šã€‚
3. T1ï¼šCDN å‘ç°åœ¨ç¼“å­˜ä¸­æ²¡æœ‰ user1 ç›¸å…³çš„å¯†é’¥ã€‚
4. T1ï¼šCDN å‘ä¸Šè¯·æ±‚ï¼Œå³è¯·æ±‚ä½ çš„å®é™…åç«¯æœåŠ¡å™¨ï¼Œä»¥è·å– user1ã€‚
5. T1ï¼šåç«¯æœåŠ¡å°† user1 ä»¥æ ‡å‡† JSON æ ¼å¼å“åº”è¿”å›ã€‚
6. T1ï¼šCDN æ”¶åˆ° JSON å¹¶å­˜å‚¨è¯¥ JSON
7. ç°åœ¨å®ƒéœ€è¦å†³å®šè¿™ä¸ªæ•°æ®çš„ TTL åº”è¯¥æ˜¯ä»€ä¹ˆï¼Œå®ƒå¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ï¼Ÿ
8. é€šå¸¸æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼ŒåŸå§‹æœåŠ¡å™¨æŒ‡å®šåº”é«˜é€Ÿç¼“å­˜çš„é•¿åº¦æˆ–åœ¨ CDN é…ç½®ä¸Šè®¾ç½®äº†å¸¸é‡å€¼ã€‚å®ƒä¼šä½¿ç”¨è¯¥æ—¶é—´æ¥è®¾ç½® TTLã€‚
9. è®©åŸå§‹æœåŠ¡å™¨æ¥è®¾ç½® TTL æ˜¯ä¸ªæ›´å¥½çš„é€‰æ‹©ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä»¥æˆ‘ä»¬å–œæ¬¢çš„æ–¹å¼æ§åˆ¶ TTL æˆ–æœ‰æ¡ä»¶åœ°è®¾ç½® TTLã€‚
10. ç°åœ¨é—®é¢˜æå‡ºäº†åŸå§‹æœåŠ¡å™¨å¦‚ä½•æŒ‡å®š TTLã€‚`Cache-control` æ ‡å¤´æ­¤æ—¶èµ·åˆ°äº†ä½œç”¨ã€‚æ¥è‡ªåŸå§‹æœåŠ¡å™¨çš„å“åº”å¯ä»¥åŒ…å« `Cache-control` æ ‡å¤´ï¼Œå¦‚ `Cache-control: Public;Max-Age: 180`ï¼ŒæŒ‡ç¤º CDN å¯ä»¥å…¬å¼€åœ°ç¼“å­˜æ­¤æ•°æ®ï¼Œå®ƒæœ‰æ•ˆæœŸä¸º 180 ç§’ã€‚
11. T1ï¼šç°åœ¨ CDN å¾—åˆ°è¿™ä¸ªä¿¡æ¯ï¼Œä»¥ 180s çš„ TTL ç¼“å­˜æ•°æ®ã€‚
12. T1ï¼šCDN ç”¨ user1 çš„ JSON æ–‡ä»¶å“åº”å®¢æˆ·ç«¯ã€‚
13. T2ï¼šå¦ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚ user1ã€‚
14. T2ï¼šè¯·æ±‚è½¬ç§»åˆ° CDN ä¸Šã€‚
15. T2ï¼šCDN çœ‹åˆ°å®ƒæœ‰å­˜å‚¨åœ¨å…¶å­˜å‚¨ä¸­çš„ user1 å¯†é’¥ï¼Œå› æ­¤å®ƒä¸ä¼šè¯·æ±‚åŸå§‹æœåŠ¡å™¨ä»¥è·å– JSONã€‚
16. T3ï¼šé«˜é€Ÿç¼“å­˜åœ¨ 180 ç§’ååœ¨ CDN ä¸Šè¿‡æœŸã€‚
17. T4ï¼šå¦ä¸€äº›å®¢æˆ·ç«¯è¯·æ±‚ user1ï¼Œä½†ç”±äºç¼“å­˜æ˜¯ç©ºçš„ï¼Œå› æ­¤ CDN ä»æ­¥éª¤ 3 å¼€å§‹é‡å¤æ­¥éª¤ï¼Œä»¥æ­¤å¾€å¤ã€‚

ä½ ä¸ä¸€å®šåªèƒ½å°† TTL ä¿ç•™ä¸º 180 ç§’ï¼Œè€Œæ˜¯åªéœ€è¦æ ¹æ®ä½ åº”è¯¥ä¸ºé™ˆæ—§æ•°æ®æä¾›ç¼“å­˜çš„æ—¶é—´é•¿åº¦æ¥é€‰æ‹© TTLã€‚å¦‚æœè¿™è®©ä½ æœ‰äº†è¿™ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆä¸èƒ½åœ¨æ•°æ®æ›´æ”¹æ—¶å€™è®©ç¼“å­˜æ— æ•ˆï¼Œç¨åæˆ‘å°†åœ¨ç¼ºç‚¹éƒ¨åˆ†ä¸­å›ç­”ã€‚

## æ‰§è¡Œ

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬é«˜è°ˆé˜”è®ºï¼Œä¸€ç›´èŠç€è®¾è®¡ï¼Œè€Œæ²¡æœ‰çœŸæ­£è¿›å…¥å®é™…å®ç°ã€‚ä½œä¸ºè®¾è®¡çš„åŸå› éå¸¸ç®€å•ï¼Œå¯ä»¥åœ¨ä»»ä½•è®¾ç½®ä¸­å®ç°ã€‚å¯¹äºæˆ‘ä»¬æ¥è¯´ï¼Œæˆ‘ä»¬çš„ CDN åœ¨ Google Cloud ä¸Šï¼Œåç«¯æœåŠ¡è¿è¡Œçš„ Kubernetes é›†ç¾¤åœ¨ Azure ä¸Šï¼Œå› æ­¤æˆ‘ä»¬æ ¹æ®æˆ‘ä»¬çš„éœ€æ±‚è¿›è¡Œäº†è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥é€‰æ‹©åœ¨ CloudFlare CDN ä¸Šæ‰§è¡Œæ­¤æ“ä½œï¼Œå› æ­¤æœªè¿›å…¥å®æ–½å¹¶ä¿æŒæŠ½è±¡ã€‚ä½†åªæ˜¯ä¸ºäº†å¥½å¥‡çš„æ€æƒ³ï¼Œè¿™æ˜¯æˆ‘ä»¬çš„ç”Ÿäº§è®¾ç½®æ–¹å¼ã€‚

![é…å›¾](https://cdn-images-1.medium.com/max/3316/1*vrlryfpbkky5iqdbruida.jpeg)

å¦‚æœä½ ä¸æ˜ç™½è¿™ä¸ªï¼Œå¦‚æœä½ ç†è§£è¿™ä¸ªæ¦‚å¿µï¼Œå»ºç«‹è¿™å°†æ˜¯ä¸€å—è›‹ç³•ã€‚

è¿™æ˜¯ Google Cloud çš„ä¸€ç¯‡å®Œç¾çš„[æ–‡æ¡£](https://cloud.google.com/cdn/docs/setting-up-cdn-with-external-origin)ä¾›ä½ äº†è§£ã€‚

---

å¥½çš„ï¼Œæˆ‘ä»¬ç°åœ¨æ­£åœ¨æ¥è¿‘ç»“æŸï¼Œä»»ä½•è®¾è®¡éƒ½ä¸å®Œæ•´ï¼Œåˆ©ç”¨åˆ©å¼Šåˆ†æã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬ç¨å¾®åˆ†æä¸€ä¸‹è®¾è®¡ï¼Œçœ‹çœ‹è¿™ä¸ªè®¾è®¡å¸®äº†æˆ‘ä»¬ä»€ä¹ˆï¼Œä»¥åŠæ˜¯æ€æ ·å¸®äº†æˆ‘ä»¬çš„ã€‚

## è®¾è®¡ä¼˜ç‚¹

1. **ç®€å•æ€§ï¼š**è¿™ç§è®¾è®¡è¶…çº§ç®€å•ï¼Œæ˜“äºå®æ–½å’Œç»´æŠ¤ã€‚
2. **å“åº”æ—¶é—´ï¼š**ä½ çŸ¥é“ CDN æœåŠ¡å™¨åœ¨åœ°ç†ä¸Šå®šä½ä»¥ä¼˜åŒ–æ•°æ®ä¼ è¾“ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬çš„å“åº”æ—¶é—´ä¹Ÿå˜å¾—è¶…å¿«é€Ÿã€‚ä¾‹å¦‚ï¼Œ60msï¼ˆå¿½ç•¥ TCP è¿æ¥å»ºç«‹æ—¶é—´ï¼‰æ˜¯ä¸æ˜¯å¾ˆæ£’ï¼Ÿ
3. **å‡å°‘è´Ÿè½½ï¼š**ç”±äºç°åœ¨çš„å®é™…åç«¯æœåŠ¡å™¨ç°åœ¨æ˜¯åƒæ˜¯æ¯ 180s æ‰æ”¶åˆ°ä¸€æ¬¡è¯·æ±‚ï¼Œå› æ­¤è´Ÿè½½è¶…ä½ã€‚
4. **åŸºç¡€è®¾æ–½æˆæœ¬ï¼š**å¦‚æœæˆ‘ä»¬æ²¡æœ‰è¿™æ ·åšï¼Œé‚£ä¹ˆå¤„ç†è¿™ç§è£…è½½æˆ‘ä»¬å¿…é¡»æ‰©å±•æˆ‘ä»¬çš„åŸºç¡€æ¶æ„ï¼Œè¿™å…·æœ‰å¾ˆå¤§çš„æˆæœ¬ã€‚ä½† [**Glance**](https://www.glance.com/) å·²ç»åœ¨ CDN ä¸­å·²ç»å¤§é‡æŠ•èµ„ã€‚å› ä¸ºæˆ‘ä»¬æ˜¯ä¸€ä¸ªå†…å®¹å¹³å°ï¼Œæ‰€ä»¥ä¸ºä»€ä¹ˆä¸ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Ÿæ”¯æŒè¿™äº› API çš„æˆæœ¬å¢åŠ ç°åœ¨æ˜¯å¾®ä¸è¶³é“çš„ã€‚

## è®¾è®¡çš„ç¼ºç‚¹

1. **ç¼“å­˜å¤±æ•ˆï¼š**ç¼“å­˜å¤±æ•ˆæ˜¯åœ¨è®¡ç®—æœºç§‘å­¦ä¸­æƒ³è¦è·å¾—æ­£ç¡®çš„æœ€å›°éš¾çš„äº‹æƒ…ä¹‹ä¸€ï¼Œè€Œä¸”å½“ CDN æˆä¸ºé«˜é€Ÿç¼“å­˜å®ƒç”šè‡³æ›´éš¾è§£å†³ã€‚CDN ä¸Šçš„ä»»ä½•å³å…´éŸ³ä¹ç¼“å­˜æ— æ•ˆæ˜¯ä¸€ä¸ªæ˜‚è´µçš„è¿‡ç¨‹ï¼Œä¸€èˆ¬ä¸ä¼šåœ¨å®æ—¶å‘ç”Ÿã€‚å¦‚æœä½ çš„æ•°æ®æ›´æ”¹ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•åœ¨ CDN ä¸Šä½¿ç¼“å­˜æ— æ•ˆï¼Œå› æ­¤ä½ çš„å®¢æˆ·ç«¯å¯èƒ½ä¼šåœ¨æŸäº›æ—¶é—´å†…è·å¾—é™ˆæ—§çš„æ•°æ®ï¼Œä¸è¿‡è¿™å–å†³äºä½ çš„ TTLã€‚å¦‚æœä½ çš„ TTL è®¾ç½®åœ¨äº†å‡ å°æ—¶å†…ï¼Œé‚£ä¹ˆä½ ä¹Ÿå¯ä»¥åœ¨ CDN ä¸Šè®©ç¼“å­˜å¤±æ•ˆã€‚ä½†å¦‚æœ TTL åœ¨å‡ ç§’é’Ÿ/åˆ†é’Ÿå†…ï¼Œé‚£å°±ä¼šå‡ºå¤§é—®é¢˜ï¼æ­¤å¤–ï¼Œè¯·è®°ä½ï¼Œå¹¶éæ‰€æœ‰ CDN æä¾›å•†éƒ½å…¬å¼€ API ä»¥ä½¿ CDN ç¼“å­˜å¤±æ•ˆã€‚
2. **ç¼ºå°‘æ§åˆ¶ï¼š**ç”±äºè¯·æ±‚ç°åœ¨æ²¡æœ‰ç›´æ¥å‘é€åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸Šï¼Œæˆ‘ä»¬ä¼šæ„Ÿè§‰ï¼Œä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬æ²¡æœ‰è¶³å¤Ÿåœ°æ§åˆ¶ç³»ç»Ÿï¼ˆæˆ–è€…åªæ˜¯ä¸€ä¸ªäººæ˜¯ä¸ªæ§åˆ¶æ€ªç‰© ğŸ˜ˆï¼‰ã€‚å¯è§‚å¯Ÿæ€§å¯èƒ½ä¼šç¨å¾®å‡å°ã€‚æˆ‘ä»¬å¯ä»¥éšæ—¶åœ¨ CDN ä¸Šè®¾ç½®æ—¥å¿—è®°å½•å’Œç›‘æ§ï¼Œä½†é€šå¸¸è¿™æœ‰ä¸€å®šæˆæœ¬ã€‚

## å‡ å¥æ„Ÿæƒ³

åˆ†å¸ƒå¼ä¸–ç•Œä¸­çš„ä»»ä½•è®¾è®¡éƒ½æ˜¯ç•¥æœ‰ä¸»è§‚çš„ï¼Œå¹¶ä¸”æ€»æ˜¯æœ‰ä¸€äº›æƒè¡¡ã€‚ä½œä¸ºå¼€å‘è€…æˆ–æ¶æ„å¸ˆï¼Œæˆ‘ä»¬çš„èŒè´£åœ¨è¿™å…¶ä¸­æƒè¡¡å¹¶é€‰æ‹©é’ˆå¯¹æˆ‘ä»¬å·¥ä½œçš„è®¾è®¡ã€‚æ®è¯´ï¼Œæ²¡æœ‰è®¾è®¡æ˜¯å…·ä½“çš„ï¼Œè¶³ä»¥æ°¸è¿œç»§ç»­ï¼Œæ‰€ä»¥é‰´äºçº¦æŸï¼Œæˆ‘ä»¬é€‰æ‹©äº†ä¸€å®šçš„è®¾è®¡ï¼Œå…·ä½“å–å†³äºå®ƒå¯¹æˆ‘ä»¬çš„é€‚ç”¨æ–¹å¼æˆ‘ä»¬å¯èƒ½ä¹Ÿè¿›ä¸€æ­¥å‘å±•ã€‚

---

è°¢è°¢é˜…è¯»ï¼

> å¦‚æœå‘ç°è¯‘æ–‡å­˜åœ¨é”™è¯¯æˆ–å…¶ä»–éœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼Œæ¬¢è¿åˆ° [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner) å¯¹è¯‘æ–‡è¿›è¡Œä¿®æ”¹å¹¶ PRï¼Œä¹Ÿå¯è·å¾—ç›¸åº”å¥–åŠ±ç§¯åˆ†ã€‚æ–‡ç« å¼€å¤´çš„ **æœ¬æ–‡æ°¸ä¹…é“¾æ¥** å³ä¸ºæœ¬æ–‡åœ¨ GitHub ä¸Šçš„ MarkDown é“¾æ¥ã€‚

---

> [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner) æ˜¯ä¸€ä¸ªç¿»è¯‘ä¼˜è´¨äº’è”ç½‘æŠ€æœ¯æ–‡ç« çš„ç¤¾åŒºï¼Œæ–‡ç« æ¥æºä¸º [æ˜é‡‘](https://juejin.im) ä¸Šçš„è‹±æ–‡åˆ†äº«æ–‡ç« ã€‚å†…å®¹è¦†ç›– [Android](https://github.com/xitu/gold-miner#android)ã€[iOS](https://github.com/xitu/gold-miner#ios)ã€[å‰ç«¯](https://github.com/xitu/gold-miner#å‰ç«¯)ã€[åç«¯](https://github.com/xitu/gold-miner#åç«¯)ã€[åŒºå—é“¾](https://github.com/xitu/gold-miner#åŒºå—é“¾)ã€[äº§å“](https://github.com/xitu/gold-miner#äº§å“)ã€[è®¾è®¡](https://github.com/xitu/gold-miner#è®¾è®¡)ã€[äººå·¥æ™ºèƒ½](https://github.com/xitu/gold-miner#äººå·¥æ™ºèƒ½)ç­‰é¢†åŸŸï¼Œæƒ³è¦æŸ¥çœ‹æ›´å¤šä¼˜è´¨è¯‘æ–‡è¯·æŒç»­å…³æ³¨ [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)ã€[å®˜æ–¹å¾®åš](http://weibo.com/juejinfanyi)ã€[çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/juejinfanyi)ã€‚
