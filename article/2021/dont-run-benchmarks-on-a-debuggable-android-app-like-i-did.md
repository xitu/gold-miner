> - åŸæ–‡åœ°å€ï¼š[Donâ€™t Run Benchmarks on a Debuggable Android App (Like I Did for Coroutines)](https://medium.com/specto/dont-run-benchmarks-on-a-debuggable-android-app-like-i-did-34d95331cabb)
> - åŸæ–‡ä½œè€…ï¼š[Nathanael](https://medium.com/@nathanaelsilverman)
> - è¯‘æ–‡å‡ºè‡ªï¼š[æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)
> - æœ¬æ–‡æ°¸ä¹…é“¾æ¥ï¼š[https://github.com/xitu/gold-miner/blob/master/article/2021/dont-run-benchmarks-on-a-debuggable-android-app-like-i-did.md](https://github.com/xitu/gold-miner/blob/master/article/2021/dont-run-benchmarks-on-a-debuggable-android-app-like-i-did.md)
> - è¯‘è€…ï¼š[keepmovingljzy](https://github.com/keepmovingljzy)
> - æ ¡å¯¹è€…ï¼š[PassionPenguin](https://github.com/PassionPenguin)ã€[5Reasons](https://github.com/5Reasons)

# ä¸è¦åœ¨å¯è°ƒè¯•çš„ Android App ä¸Šè¿è¡ŒåŸºå‡†æµ‹è¯• (å°±åƒæˆ‘å¯¹åç¨‹åšçš„é‚£æ ·)

ä¸Šå‘¨æˆ‘å†™äº†ä¸€ç¯‡å…³äº [Kotlin åç¨‹åœ¨ Android ä¸Šåˆå§‹åŒ–è€—æ—¶è¶…è¿‡ 100ms](https://medium.com/specto/android-startup-tip-dont-use-kotlin-coroutines-a7b3f7176fe5)ã€‚Knuttyse é—®æˆ‘æ˜¯å¦ä½¿ç”¨äº†â€œç”Ÿäº§æ„å»ºä¼˜åŒ–â€æ¥è¿›è¡Œæµ‹è¯•ï¼Œç„¶è€Œå®é™…ä¸Šæˆ‘å¹¶æ²¡æœ‰è¿™ä¹ˆåšã€‚æˆ‘æœ¬ä»¥ä¸ºè¿™ä¸ä¼šæœ‰å¤ªå¤§çš„åŒºåˆ«ï¼Œæ‰€ä»¥æˆ‘å°è¯•äº†ä¸€ä¸‹ï¼Œæ²¡æƒ³åˆ°å·®åˆ«å¤§åˆ°éš¾ä»¥æƒ³è±¡ã€‚

![å›¾æº [Alex E. Proimos](https://www.flickr.com/photos/proimos/4199675334/) â€” [CC BY 2.0](https://commons.wikimedia.org/w/index.php?curid=22535544)](https://cdn-images-1.medium.com/max/2048/1*W1KWLWBcLKVYLKYI0r1sYg.jpeg)

ä¸€å¼€å§‹æˆ‘åœ¨è°ƒè¯•ç‰ˆæœ¬ä¸‹è¿›è¡Œæµ‹è¯•ï¼Œè¿™æ¬¡æˆ‘ä»¬ä»å‘è¡Œç‰ˆæœ¬å¼€å§‹ï¼Œå¯ç”¨äº†ä»£ç ç¼©å‡å’Œèµ„æºç¼©å‡ï¼Œè¿è¡Œç›¸åŒçš„ä»£ç ï¼š

```Kotlin
class MyApplication : Application() {

    override fun onCreate() {
        super.onCreate()
        
        // Tasks that must happen synchronously.

        CoroutineScope(Dispatchers.Default).launch {
            // Everything else.
        }
    }
}
```

åœ¨è¿è¡Œ Android 9 çš„ Moto G6 ä¸Šæµ‹è¯•è¯¥åº”ç”¨ï¼ˆè°ƒè¯•ç‰ˆæœ¬ï¼‰ï¼Œå¯åŠ¨åç¨‹å¹³å‡é˜»å¡ä¸»çº¿ç¨‹ 110Â±18msï¼Œå¦‚æœæ˜¯å‘è¡Œç‰ˆæœ¬åªéœ€è¦ 9Â±1msï¼ˆn=10, åç¨‹ç‰ˆæœ¬ `1.4.2`ï¼‰ã€‚æˆ‘æƒ³æˆ‘æ¬ å¼€å‘åç¨‹çš„äººä»¬ä¸€ä¸ªé“æ­‰ï¼Œä½†åŒæ—¶æˆ‘ä¹Ÿå¥½å¥‡åˆ°åº•å‘ç”Ÿä»€ä¹ˆï¼Œä»£ç ç¼©å‡æœ‰é‚£ä¹ˆå¥½å—ï¼Ÿ

ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…³é—­ä»£ç ç¼©å‡ä¼šä½¿é˜»å¡æ—¶é—´å‡ä½åˆ° 14Â±1msã€‚ä»ç„¶æ¯”è°ƒè¯•ç‰ˆæœ¬å¿«å¾—å¤šã€‚æˆ‘å¼€å§‹ç ”ç©¶è°ƒè¯•ç‰ˆæœ¬å’Œå‘è¡Œç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚ï¼Œä½†æ²¡æœ‰å‘ç°ä»»ä½•å¯ä»¥è§£é‡Šè¿™ä¸ªå·¨å¤§çš„å·®å¼‚ã€‚æ‰€ä»¥æˆ‘å››å¤„è¯¢é—®ï¼Œä¸€äº›å‹å¥½çš„å·¥ç¨‹å¸ˆï¼ˆæ„Ÿè°¢ Romain Guyï¼Œcketti å’Œ John Reckï¼‰è§£é‡Šè¯´ï¼Œä¸¥æ ¼æ¥è¯´è¿™ä¸æ˜¯æ„å»ºçš„åŒºåˆ«ï¼Œè°ƒè¯•æ„å»ºé€šå¸¸è¢«é…ç½®ä¸ºå¯è°ƒè¯•çš„ï¼Œè¿™åè¿‡æ¥æ”¹å˜äº†è¿è¡Œæ—¶çš„è¡Œä¸ºã€‚è®©æˆ‘ä»¬æ·±å…¥åˆ†æä¸€ä¸‹ã€‚

â€œdebugâ€ æ˜¯ Android ä¸­é»˜è®¤ä¸¤ç§æ„å»ºæ–¹å¼ä¹‹ä¸€ï¼Œå¦ä¸€ç§æ˜¯ â€œreleaseâ€ã€‚é™¤éä¿®æ”¹è¿‡ï¼Œå¦åˆ™è°ƒè¯•æ„å»ºç±»å‹ä¼šå°† â€œdebuggableâ€ è®¾ç½®ä¸º`true`ã€‚ä»»ä½•æ„å»ºç±»å‹éƒ½å¯ä»¥è¿™æ ·é…ç½®ï¼ŒåŒ…æ‹¬ â€œreleaseâ€ã€‚å¯è°ƒè¯•çš„è®¾ç½®ä¸ä¼šå½±å“ç¼–è¯‘è¿‡ç¨‹ï¼Œä½†æ˜¯å¯ä»¥å°†è°ƒè¯•å™¨é™„åŠ åˆ°åº”ç”¨ç¨‹åºã€‚ç°åœ¨æˆ‘çŸ¥é“å®é™…ä¸Šé™„åŠ è°ƒè¯•å™¨ä¼šå‡æ…¢é€Ÿåº¦ï¼Œä½†ä¹‹å‰å´æ²¡æœ‰æ„è¯†åˆ°å¯ç”¨é™„åŠ è°ƒè¯•å™¨**å¯èƒ½**ä¹Ÿä¼šå¦‚æ­¤ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿä¸ªäººè§‰å¾—ï¼Œå› ä¸ºåº”ç”¨ç¨‹åºå¿…é¡»åšå¥½å‡†å¤‡å»é™„åŠ è°ƒè¯•å™¨ï¼Œå¯¼è‡´æŸäº›è¿è¡Œæ—¶çš„ä¼˜åŒ–ä¸èƒ½è¢«åº”ç”¨ï¼Œå¿…é¡»ä¸æ–­æ”¶é›†å…ƒæ•°æ®ï¼Œç­‰ç­‰ã€‚

æ— è®ºå¦‚ä½•ï¼Œæˆ‘å†³å®šæµ‹è¯•æ‰€æœ‰åœºæ™¯ï¼ˆåæ¬¡ç»Ÿè®¡å¹³å‡è€—æ—¶ï¼‰ï¼š

- Non-debuggable, minified release æ„å»ºï¼š9Â±1ms
- Non-debuggable, **non-minified** æ„å»ºï¼š14Â±1ms
- **Debuggable**, **minified** release æ„å»ºï¼š45Â±5ms
- Debuggable, **non-minified** release æ„å»ºï¼š92Â±2ms
- Debuggable, non-minified **debug** æ„å»ºï¼š93Â±5ms

é¦–å…ˆï¼Œæˆ‘å¾ˆé«˜å…´åœ°å‘ç°æˆ‘çš„æ‰‹æœºæ¯”å‰ä¸€å‘¨å¿«äº† 15%ï¼Œä¸€ä¸ªï¼ˆå¯è°ƒè¯•çš„ï¼‰è°ƒè¯•ç‰ˆæœ¬çš„å¹³å‡è€—æ—¶ç°åœ¨æ˜¯ 93msï¼Œè€Œä¸æ˜¯110msã€‚å½“ç„¶ï¼Œè¿™æ˜¯å¯èƒ½å‘ç”Ÿçš„ï¼Œè¿™åªæ˜¯è¯´æ˜åº”è¯¥åœ¨å°½å¯èƒ½ç›¸ä¼¼çš„ç¯å¢ƒä¸­è¿›è¡ŒåŸºå‡†æ¯”è¾ƒã€‚å®ƒè¿˜è¯å®äº†å¯è°ƒè¯•å’Œä»£ç ç¼©å‡è®¾ç½®æ˜¯é»˜è®¤æ„å»ºç±»å‹ä¹‹é—´å”¯ä¸€çš„æ€§èƒ½å·®å¼‚ã€‚é™¤æ­¤ä¹‹å¤–æˆ‘ä»¬è¿˜èƒ½å¾—å‡ºä»€ä¹ˆç»“è®ºå‘¢ï¼Ÿ

å‡è®¾ä½ çš„å‘è¡Œç‰ˆæœ¬æ˜¯ä¸å¯è°ƒè¯•çš„ï¼ˆé»˜è®¤è®¾ç½®ï¼‰ï¼Œæ­£å¦‚æˆ‘ä¹‹å‰æ‰€è¯´çš„ï¼Œ**Kotlin åç¨‹åœ¨ Android ä¸Šåˆå§‹åŒ–æ‰€éœ€çš„æ—¶é—´åŸºæœ¬ä¸ä¼šè¶…è¿‡ 100ms**ã€‚è‡³å°‘åœ¨æˆ‘çš„è®¾å¤‡ä¸Šï¼Œä¸Šè¿°æ•°æ®æ˜¯æˆç«‹çš„ï¼Œæˆ‘è®¤ä¸ºè¿™ä¸ªç»“è®ºä¹Ÿé€‚ç”¨äºç°åœ¨å¤§éƒ¨åˆ†å¸¸ç”¨çš„è®¾å¤‡ã€‚Kotlin åç¨‹çš„åˆå§‹åŒ–å¯èƒ½éœ€è¦ 15ms å·¦å³çš„æ—¶é—´ï¼Œè¿™ä¹ˆçŸ­çš„è€—æ—¶å¯ä»¥è¯´æ˜¯æ— è¶³è½»é‡çš„ã€‚å¯¹äºå¼€å¤´æåˆ°çš„ã€æˆ‘ä¹‹å‰å†™çš„é‚£ç¯‡æ–‡ç« æ‰€é€ æˆçš„è¯¯è§£ï¼Œæˆ‘æ·±æ„ŸæŠ±æ­‰ã€‚ğŸ™‡â€â™‚ï¸

åŒæ ·å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¯ç”¨å¯ä»¥è°ƒè¯•æ¨¡å¼ä¼šå¯¼è‡´åç¨‹çš„åˆå§‹åŒ–æ—¶é—´å¢åŠ  650%ã€‚è¿œè¿œè¶…å‡ºäº†[Android æ€§èƒ½å·¥ç¨‹å¸ˆæŠ¥å‘Š](https://youtu.be/ZffMCJdA5Qc?t=635)çš„ 0**â€‘**80%ã€‚å½“ä¸ä½¿ç”¨è°ƒè¯•å™¨æ—¶ï¼Œä½ å¯ä»¥å…³é—­è°ƒè¯•æ¨¡å¼ä»¥æé«˜é€Ÿåº¦ã€‚

æœ€åï¼Œç»å†äº†è¿™æ¬¡æƒ¨ç—›çš„æ•™è®­ï¼š**æ°¸è¿œä¸è¦åœ¨å¯è°ƒå¼çš„åº”ç”¨ç¨‹åºä¸Šè¿è¡ŒåŸºå‡†æµ‹è¯•**ã€‚Android æ–‡æ¡£åœ¨[æ–°çš„åŸºå‡†åº“](https://developer.android.com/studio/profile/benchmark#configuration-errors)ä¸Šç®€å•åœ°æäº†ä¸€ä¸‹ï¼Œä½†æ˜¯æˆ‘æ²¡æƒ³åˆ°å®ƒä¼šäº§ç”Ÿè¿™æ ·çš„å½±å“ã€‚ä½ å‘¢ï¼Ÿç”šè‡³ Android Profiler ä¹Ÿç”¨äºå¯è°ƒè¯•çš„åº”ç”¨ç¨‹åºï¼Œè¿™æ„å‘³ç€åœ¨åˆ†æè¿‡ç¨‹ä¸­æ‰€é‡‡å–çš„æ—¶é—´åº¦é‡å°†ä¸èƒ½ä»£è¡¨ç”Ÿäº§æ€§èƒ½ã€‚

------

å¦‚æœä½ å¸Œæœ›è½»æ¾åœ°ç›‘æ§ä½ çš„åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Ÿåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå…³é—­å¯è°ƒè¯•æ¨¡å¼ï¼Œå¹¶ä¸”å¼€é”€ä¸åˆ° 5%ï¼Ÿ[ä½ è¯´å¯¹äº†ï¼](https://specto.dev)

> å¦‚æœå‘ç°è¯‘æ–‡å­˜åœ¨é”™è¯¯æˆ–å…¶ä»–éœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼Œæ¬¢è¿åˆ° [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner) å¯¹è¯‘æ–‡è¿›è¡Œä¿®æ”¹å¹¶ PRï¼Œä¹Ÿå¯è·å¾—ç›¸åº”å¥–åŠ±ç§¯åˆ†ã€‚æ–‡ç« å¼€å¤´çš„ **æœ¬æ–‡æ°¸ä¹…é“¾æ¥** å³ä¸ºæœ¬æ–‡åœ¨ GitHub ä¸Šçš„ MarkDown é“¾æ¥ã€‚

------

> [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner) æ˜¯ä¸€ä¸ªç¿»è¯‘ä¼˜è´¨äº’è”ç½‘æŠ€æœ¯æ–‡ç« çš„ç¤¾åŒºï¼Œæ–‡ç« æ¥æºä¸º [æ˜é‡‘](https://juejin.im) ä¸Šçš„è‹±æ–‡åˆ†äº«æ–‡ç« ã€‚å†…å®¹è¦†ç›– [Android](https://github.com/xitu/gold-miner#android)ã€[iOS](https://github.com/xitu/gold-miner#ios)ã€[å‰ç«¯](https://github.com/xitu/gold-miner#å‰ç«¯)ã€[åç«¯](https://github.com/xitu/gold-miner#åç«¯)ã€[åŒºå—é“¾](https://github.com/xitu/gold-miner#åŒºå—é“¾)ã€[äº§å“](https://github.com/xitu/gold-miner#äº§å“)ã€[è®¾è®¡](https://github.com/xitu/gold-miner#è®¾è®¡)ã€[äººå·¥æ™ºèƒ½](https://github.com/xitu/gold-miner#äººå·¥æ™ºèƒ½)ç­‰é¢†åŸŸï¼Œæƒ³è¦æŸ¥çœ‹æ›´å¤šä¼˜è´¨è¯‘æ–‡è¯·æŒç»­å…³æ³¨ [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)ã€[å®˜æ–¹å¾®åš](http://weibo.com/juejinfanyi)ã€[çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/juejinfanyi)ã€‚
