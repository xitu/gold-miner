> * åŸæ–‡åœ°å€ï¼š[Nginx concepts I wish I knew years ago](https://dev.to/aemiej/nginx-concepts-i-wish-i-knew-years-ago-23o0)
> * åŸæ–‡ä½œè€…ï¼š[Aemie Jariwala](https://dev.to/aemiej)
> * è¯‘æ–‡å‡ºè‡ªï¼š[æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)
> * æœ¬æ–‡æ°¸ä¹…é“¾æ¥ï¼š[https://github.com/xitu/gold-miner/blob/master/article/2021/nginx-concepts-i-wish-i-knew-years-ago.md](https://github.com/xitu/gold-miner/blob/master/article/2021/nginx-concepts-i-wish-i-knew-years-ago.md)
> * è¯‘è€…ï¼š[joyking7](https://github.com/joyking7)
> * æ ¡å¯¹è€…ï¼š[PassionPenguin](https://github.com/PassionPenguin)ã€[ningzhy3](https://github.com/ningzhy3)

![è·¯ç”±å™¨](https://res.cloudinary.com/practicaldev/image/fetch/s--B8sTzGjW--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/i/jldvigb958mnww2rvcvx.jpeg)

# æˆ‘å¸Œæœ›å¤šå¹´å‰å°±çŸ¥é“çš„ Nginx æ¦‚å¿µ
*Nginx æ˜¯ä¸€ä¸ªéµå¾ªä¸»ä»æ¶æ„çš„ Web æœåŠ¡å™¨ï¼Œå¯ä»¥ç”¨ä½œåå‘ä»£ç†ã€è´Ÿè½½å‡è¡¡å™¨ã€é‚®ä»¶ä»£ç†å’Œ HTTP ç¼“å­˜ã€‚*

å“‡ï¼å¤æ‚çš„æœ¯è¯­å’Œæ··ä¹±çš„å®šä¹‰ï¼Œé‡Œé¢å……æ–¥ç€å¤§é‡ä»¤äººå›°æƒ‘çš„è¯è¯­ï¼Œå¯¹å§ï¼Ÿä¸ç”¨æ‹…å¿ƒï¼Œæˆ‘å¯ä»¥å¸®å¤§å®¶å…ˆäº†è§£ Nginx çš„åŸºæœ¬æ¶æ„å’Œæœ¯è¯­ï¼Œç„¶åæˆ‘ä»¬å°†å®‰è£…å¹¶åˆ›å»º **Nginx** é…ç½®ã€‚

![è¿·æƒ‘è¡¨æƒ….gif](https://res.cloudinary.com/practicaldev/image/fetch/s--mxz4Qgrr--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/fbj8exwkli91ord2xscz.gif)

ä¸ºäº†è®©äº‹æƒ…å˜ç®€å•ï¼Œåªéœ€è¦è®°ä½ï¼š*Nginx æ˜¯ä¸€ä¸ªç¥å¥‡çš„ Web æœåŠ¡å™¨*ã€‚

ç®€å•æ¥è¯´ï¼ŒWeb æœåŠ¡å™¨å°±åƒä¸ªä¸­é—´äººã€‚æ¯”å¦‚ä½ æƒ³è®¿é—® dev.toï¼Œè¾“å…¥åœ°å€ `https://dev.to`ï¼Œä½ çš„æµè§ˆå™¨å°±ä¼šæ‰¾å‡º `https://dev.to` çš„ Web æœåŠ¡å™¨åœ°å€ï¼Œç„¶åå°†å…¶å®šå‘åˆ°åå°æœåŠ¡å™¨ï¼Œåå°æœåŠ¡å™¨ä¼šæŠŠå“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

## ä»£ç† vs åå‘ä»£ç†

Nginx çš„åŸºæœ¬åŠŸèƒ½æ˜¯ä»£ç†ï¼Œæ‰€ä»¥ç°åœ¨å°±éœ€è¦äº†è§£ä»€ä¹ˆæ˜¯ä»£ç†å’Œåå‘ä»£ç†ã€‚

### ä»£ç†

å¥½çš„ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå®¢æˆ·ç«¯ã€ä¸€ä¸ªä¸­é—´ Web æœåŠ¡å™¨ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç§°å®ƒä¸ºä»£ç†ï¼‰å’Œä¸€ä¸ªæœåŠ¡å™¨ã€‚è¿™å…¶ä¸­æœ€ä¸»è¦çš„äº‹æƒ…æ˜¯æœåŠ¡å™¨ä¸çŸ¥é“å“ªä¸ªå®¢æˆ·ç«¯æ­£åœ¨è¯·æ±‚ã€‚æ˜¯ä¸æ˜¯æœ‰ç‚¹å›°æƒ‘ï¼Ÿè®©æˆ‘ç”¨ä¸€å¼ ç¤ºæ„å›¾æ¥è§£é‡Šä¸€ä¸‹ã€‚

![ä»£ç†ç¤ºæ„å›¾](https://res.cloudinary.com/practicaldev/image/fetch/s--tPAqn11I--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/1moanfdnfnh5d0dqs4wd.png)

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯ client1 å’Œ client2 é€šè¿‡ä»£ç†æœåŠ¡å™¨å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ request1 å’Œ request2ï¼Œåå°æœåŠ¡å™¨ä¸ä¼šçŸ¥é“ request1 æ˜¯ç”± client1 è¿˜æ˜¯ client2 å‘é€çš„ï¼Œåªä¼šæ‰§è¡Œæ“ä½œã€‚

### åå‘ä»£ç†

ç”¨æœ€ç®€å•çš„è¯æ¥è¯´ï¼Œåå‘ä»£ç†å°±æ˜¯æŠŠä»£ç†çš„å·¥ä½œåè¿‡æ¥ã€‚æ¯”æ–¹è¯´æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯ã€ä¸€ä¸ªä¸­é—´ Web æœåŠ¡å™¨å’Œä¸€ä¸ªæˆ–å¤šä¸ªåå°æœåŠ¡å™¨ã€‚è®©æˆ‘ä»¬ç»§ç»­é€šè¿‡ä¸€å¼ ç¤ºæ„å›¾è§£é‡Šå§ï¼

![åå‘ä»£ç†ç¤ºæ„å›¾](https://res.cloudinary.com/practicaldev/image/fetch/s--iUfM34yx--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/64jk21oeqlki2t3bx1kz.png)

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å°†é€šè¿‡ Web æœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚ï¼ŒWeb æœåŠ¡å™¨ä¼šé€šè¿‡ä¸€ç§ç®—æ³•å°†è¯·æ±‚å®šå‘åˆ°ä¼—å¤šæœåŠ¡å™¨çš„ä»»æ„ä¸€ä¸ªï¼Œå…¶ä¸­ä¸€ç§ç®—æ³•æ˜¯è½®è¯¢è°ƒåº¦ï¼ˆRound-Robinï¼‰ï¼ˆæœ€å¯çˆ±çš„ä¸€ä¸ªï¼ï¼‰ï¼Œç„¶åå†å°†å“åº”é€šè¿‡ Web æœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å› æ­¤åœ¨è¿™é‡Œï¼Œå®¢æˆ·ç«¯å¹¶ä¸çŸ¥é“ä¸ä¹‹äº¤äº’çš„æ˜¯å“ªä¸€ä¸ªåå°æœåŠ¡å™¨ã€‚

## è´Ÿè½½å‡è¡¡

å¯æ¶ï¼Œåˆæ˜¯ä¸€ä¸ªæ–°è¯ï¼Œä½†æ˜¯è¿™ä¸ªè¯æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œå› ä¸ºå®ƒæ˜¯**åå‘ä»£ç†**æœ¬èº«çš„ä¸€ä¸ªå®é™…åº”ç”¨ã€‚

æˆ‘ä»¬å…ˆè¯´è¯´åŸºæœ¬çš„åŒºåˆ«ã€‚åœ¨è´Ÿè½½å‡è¡¡ä¸­ï¼Œå¿…é¡»è¦æœ‰ä¸¤ä¸ªæˆ–è€…æ›´å¤šçš„åå°æœåŠ¡å™¨ï¼Œä½†åœ¨åå‘ä»£ç†è®¾ç½®ä¸­ï¼Œè¿™ä¸æ˜¯å¿…é¡»çš„ï¼Œå®ƒç”šè‡³å¯ä»¥åªè·Ÿå•å°åå°æœåŠ¡å™¨ä¸€èµ·ä½¿ç”¨ã€‚

è®©æˆ‘ä»¬ä»å¹•åçœ‹ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬æœ‰å¤§é‡æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œè¿™ä¸ªè´Ÿè½½å‡è¡¡å™¨ä¼šæ£€æŸ¥æ¯ä¸ªåå°æœåŠ¡å™¨çš„çŠ¶æ€å¹¶åˆ†é…è¯·æ±‚çš„è´Ÿè½½ï¼Œç„¶åå°†å“åº”æ›´å¿«åœ°å‘é€ç»™å®¢æˆ·ç«¯ã€‚

## æœ‰çŠ¶æ€åº”ç”¨ vs æ— çŠ¶æ€åº”ç”¨

å¥½çš„å„ä½ï¼Œæˆ‘ä¿è¯æˆ‘å¾ˆå¿«å°±è¦è®²åˆ° Nginx ä»£ç äº†ï¼Œå…ˆè®©æˆ‘ä»¬æŠŠæ‰€æœ‰çš„åŸºæœ¬æ¦‚å¿µææ¸…æ¥šï¼

### æœ‰çŠ¶æ€åº”ç”¨

è¿™ä¸ªåº”ç”¨ç¨‹åºå­˜å‚¨äº†ä¸€ä¸ªé¢å¤–çš„å˜é‡ï¼Œç”¨äºä¿å­˜åªé€‚ç”¨äºå•ä¸ªæœåŠ¡å™¨å®ä¾‹çš„ä¿¡æ¯ã€‚

![æœ‰çŠ¶æ€åº”ç”¨å›¾ä¾‹](https://res.cloudinary.com/practicaldev/image/fetch/s--Ng8XRfi_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/bb9kkupl1z9dpacex8vt.png)

æˆ‘çš„æ„æ€æ˜¯ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨ *server1* å­˜å‚¨äº†ä¸€äº›ä¿¡æ¯ï¼Œé‚£ä¹ˆå®ƒä¸ä¼šè¢«å­˜å‚¨åœ¨ *server2* ä¸Šï¼Œå› æ­¤è¿›è¡Œäº¤äº’çš„å®¢æˆ·ç«¯ï¼ˆè¿™é‡ŒæŒ‡ Bobï¼‰å¯èƒ½å¾—ä¸åˆ°æƒ³è¦çš„ç»“æœï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šä¸ server1 æˆ–è€… server2 äº¤äº’ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œserver1 å°†å…è®¸ Bob æŸ¥çœ‹é…ç½®æ–‡ä»¶ï¼Œä½† server2 ä¸ä¼šå…è®¸ã€‚å› æ­¤ï¼Œå³ä½¿æœ‰çŠ¶æ€åº”ç”¨é˜»æ­¢äº†è®¸å¤š API è°ƒç”¨æ•°æ®åº“ï¼Œå¹¶ä¸”é€Ÿåº¦æ›´å¿«ï¼Œä½†å´å¯èƒ½ä¼šåœ¨ä¸åŒæœåŠ¡å™¨ä¸Šå¯¼è‡´ä¸Šè¿°é—®é¢˜ã€‚

### æ— çŠ¶æ€åº”ç”¨

ç°åœ¨ï¼Œæ— çŠ¶æ€æ˜¯å¯¹æ•°æ®åº“çš„ API è°ƒç”¨æ›´å¤šï¼Œä½†å®¢æˆ·ç«¯ä¸ä¸åŒåå°æœåŠ¡å™¨äº¤äº’æ—¶ï¼Œå­˜åœ¨çš„é—®é¢˜å°±æ›´å°‘äº†ã€‚ã€‚

![æ— çŠ¶æ€åº”ç”¨å›¾ä¾‹](https://res.cloudinary.com/practicaldev/image/fetch/s--42mTsbTP--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/c44w9vi7jmgfeo9rea1l.png)

æˆ‘çŸ¥é“ä½ æ²¡æœ‰æ˜ç™½æˆ‘çš„æ„æ€ã€‚ç®€å•æ¥è¯´ï¼Œå¦‚æœæˆ‘ä»å®¢æˆ·ç«¯é€šè¿‡ Web æœåŠ¡å™¨å‘æ¯”å¦‚è¯´åå°æœåŠ¡å™¨ *server1* å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œå®ƒå°†å‘å®¢æˆ·ç«¯æä¾›ä¸€ä¸ªä»¤ç‰Œä»¥ç”¨äºè®¿é—®å…¶ä»–ä»»ä½•è¯·æ±‚ã€‚å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨ä»¤ç‰Œå¹¶å°†è¯·æ±‚å‘é€ç»™ Web æœåŠ¡å™¨ï¼Œè¯¥ Web æœåŠ¡å™¨å°†è¯·æ±‚å’Œä»¤ç‰Œä¸€èµ·å‘é€ç»™ä»»æ„åå°æœåŠ¡å™¨ï¼Œæ¯ä¸ªæœåŠ¡å™¨éƒ½å°†è¿”å›ç›¸åŒçš„æœŸæœ›è¾“å‡ºã€‚

## ä»€ä¹ˆæ˜¯ Nginxï¼Ÿ

Nginx å°±æ˜¯ Web æœåŠ¡å™¨ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä¸€ç›´åœ¨æ•´ç¯‡åšå®¢ä¸­ä½¿ç”¨ Web æœåŠ¡å™¨è¿™ä¸ªè¯ï¼Œè€å®è¯´ï¼Œå®ƒå°±åƒä¸€ä¸ª*ä¸­é—´äºº*ã€‚

![Nginxç¤ºæ„å›¾](https://res.cloudinary.com/practicaldev/image/fetch/s--Z6CIUUND--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/2u3l8t4klwflv8k36rtg.png)

è¿™å¼ å›¾å¹¶ä¸éš¾æ‡‚ï¼Œå®ƒåªæ˜¯ç»“åˆäº†æˆ‘åˆ°ç°åœ¨ä¸ºæ­¢è§£é‡Šçš„æ‰€æœ‰æ¦‚å¿µã€‚åœ¨è¿™å¼ å›¾ä¸­ï¼Œæˆ‘ä»¬æœ‰ 3 å°åˆ†åˆ«è¿è¡Œåœ¨ 3001ã€3002ã€3003 ç«¯å£çš„åå°æœåŠ¡å™¨ï¼Œè¿™äº›åå°æœåŠ¡å™¨å…±åŒä½¿ç”¨è¿è¡Œåœ¨ 5432 ç«¯å£çš„æ•°æ®åº“ã€‚

ç°åœ¨ï¼Œå½“å®¢æˆ·ç«¯å‘ `https://localhost`ï¼ˆé»˜è®¤ 443 ç«¯å£ï¼‰å‘é€è¯·æ±‚ `GET /employees` æ—¶ï¼ŒNginx å°†æ ¹æ®ç®—æ³•æŠŠè¿™ä¸ªè¯·æ±‚å‘é€ç»™ä»»æ„ä¸€ä¸ªåå°æœåŠ¡å™¨ï¼Œåå°æœåŠ¡å™¨ä»æ•°æ®åº“ä¸­è·å–ä¿¡æ¯ï¼Œç„¶åæŠŠ JSON ç»“æœå‘é€å› Nginx Web æœåŠ¡å™¨ï¼ŒNginx å†å‘é€å›å®¢æˆ·ç«¯ã€‚

å¦‚æœæˆ‘ä»¬è¦ä½¿ç”¨è¯¸å¦‚**è½®è¯¢è°ƒåº¦**è¿™æ ·çš„ç®—æ³•ï¼ŒNginx ä¼šè¿™æ ·åšï¼šæ¯”å¦‚ client2 å‘é€äº†ä¸€ä¸ªè¯·æ±‚åˆ° `https://localhost`ï¼Œé‚£ä¹ˆ Nginx æœåŠ¡å™¨ä¼šå…ˆæŠŠè¯·æ±‚ä¼ åˆ° 3001 ç«¯å£ï¼Œç„¶åæŠŠå“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å¯¹äºå¦ä¸€ä¸ªè¯·æ±‚ï¼ŒNginx ä¼šæŠŠè¯·æ±‚ä¼ åˆ° 3002 ç«¯å£ï¼Œä»¥æ­¤ç±»æ¨ã€‚

è¿™ä¹Ÿå¤ªå¤šæ¦‚å¿µäº†å§ï¼ä½†æ˜¯åˆ°æ­¤ä¸ºæ­¢ï¼Œä½ åº”è¯¥å·²ç»æ¸…æ¥šåœ°äº†è§£äº†ä»€ä¹ˆæ˜¯ Nginx åŠå…¶ç›¸å…³æœ¯è¯­ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†ç»§ç»­äº†è§£ Nginx çš„å®‰è£…å’Œé…ç½®ã€‚

## å®‰è£…è¿‡ç¨‹

ç»ˆäºåˆ°è¿™ä¸€æ­¥äº†ï¼å¦‚æœä½ èƒ½ç†è§£ Nginx æ¦‚å¿µå¹¶çœ‹åˆ°äº†ä»£ç è¿™éƒ¨åˆ†ï¼Œé‚£çœŸæ˜¯æ£’æ£’å“’ï¼

![ååˆ†æ„ŸåŠ¨.gif](https://res.cloudinary.com/practicaldev/image/fetch/s--7rgP-NQB--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/4mju73ad1f22gy1ni3gu.gif)

å¥½çš„ï¼Œè€å®è¯´ï¼Œåœ¨ä»»ä½•æ“ä½œç³»ç»Ÿä¸Šå®‰è£… Nginx éƒ½åªéœ€è¦ä¸€è¡Œå‘½ä»¤ã€‚æˆ‘æ˜¯ Mac OSX ç”¨æˆ·ï¼Œæ‰€ä»¥ä¼šåŸºäºå®ƒæ¥å†™å‘½ä»¤ã€‚ä½†å¯¹äº [Ubuntu](https://ubuntu.com/tutorials/install-and-configure-nginx#2-installing-nginx) å’Œ [Windows](https://www.maketecheasier.com/install-nginx-server-windows/) ä»¥åŠå…¶ä»– Linux å‘è¡Œç‰ˆï¼Œä¹Ÿæœ‰ç±»ä¼¼çš„å‘½ä»¤ã€‚

```
$ brew install Nginx
```

åªéœ€è¦ä¸€è¡Œå‘½ä»¤ï¼Œä½ çš„ç³»ç»Ÿå°±å·²ç»å®‰è£…ä¸Š Nginx äº†!éå¸¸ Amazingï¼

### è¿è¡Œ So easy!ğŸ˜›

è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥æ£€æŸ¥ Nginx æ˜¯å¦åœ¨ä½ çš„ç³»ç»Ÿä¸Šè¿è¡Œèµ·æ¥äº†ï¼Œåˆæ˜¯éå¸¸ç®€å•çš„ä¸€æ­¥ã€‚

```
$ nginx 
# OR 
$ sudo nginx
```

è¿è¡Œå®Œå‘½ä»¤ä¹‹åï¼Œä½¿ç”¨ä½ æœ€å–œæ¬¢çš„æµè§ˆå™¨è®¿é—® `http://localhost:8080/`ï¼Œä½ å°†åœ¨å±å¹•ä¸Šçœ‹åˆ°ä¸‹é¢çš„ç”»é¢ï¼

![Nginxç½‘é¡µ](https://res.cloudinary.com/practicaldev/image/fetch/s--q4OAcvwJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/9mlhwlzgqhs6l8aw8sxi.png)

### åŸºæœ¬é…ç½®å’Œç¤ºä¾‹

å¥½çš„ï¼Œæˆ‘ä»¬å°†é€šè¿‡ä¸€ä¸ªç¤ºä¾‹æ¥å±•ç¤º Nginx çš„ç¥å¥‡ä¹‹å¤„ã€‚é¦–å…ˆï¼Œåœ¨æœ¬åœ°æœºå™¨ä¸Šåˆ›å»ºå¦‚ä¸‹çš„ç›®å½•ç»“æ„ï¼š

```
.
â”œâ”€â”€ nginx-demo
â”‚  â”œâ”€â”€ content
â”‚  â”‚  â”œâ”€â”€ first.txt
â”‚  â”‚  â”œâ”€â”€ index.html
â”‚  â”‚  â””â”€â”€ index.md
â”‚  â””â”€â”€ main
â”‚    â””â”€â”€ index.html
â””â”€â”€ temp-nginx
  â””â”€â”€ outsider
    â””â”€â”€ index.html
```

åŒæ—¶ï¼Œåœ¨ **html** å’Œ **md** æ–‡ä»¶ä¸­å†™ä¸ŠåŸºæœ¬çš„ä¸Šä¸‹æ–‡å†…å®¹ã€‚

### æˆ‘ä»¬è¦è¾¾åˆ°ä»€ä¹ˆæ•ˆæœï¼Ÿ

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªå•ç‹¬çš„æ–‡ä»¶å¤¹ `nginx-demo` å’Œ `temp-nginx`ï¼Œæ¯ä¸ªæ–‡ä»¶å¤¹éƒ½åŒ…å«é™æ€ HTML æ–‡ä»¶ã€‚æˆ‘ä»¬å°†ä¸“æ³¨äºåœ¨ä¸€ä¸ªå…±åŒç«¯å£ä¸Šè¿è¡Œè¿™ä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼Œå¹¶è®¾ç½®æˆ‘ä»¬å–œæ¬¢çš„è§„åˆ™ã€‚

ç°åœ¨å›åˆ°æ­£è½¨ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹ä½äº `/usr/local/etc/nginx` ï¼ˆè¯‘è€…æ³¨ï¼šé»˜è®¤å®‰è£…è·¯å¾„ï¼‰è·¯å¾„ä¸‹çš„ `nginx.conf` æ–‡ä»¶ï¼Œå®ç°å¯¹ Nginx é»˜è®¤é…ç½®çš„ä»»ä½•æ”¹åŠ¨ã€‚å¦å¤–ï¼Œæˆ‘çš„ç³»ç»Ÿä¸­æœ‰ Vimï¼Œæ‰€ä»¥æˆ‘å°†ç”¨ Vim è¿›è¡Œä¿®æ”¹ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªç”±ä½¿ç”¨æ‰€é€‰çš„ç¼–è¾‘å™¨ã€‚

```
$ cd /usr/local/etc/nginx
$ vim nginx.conf
```

è¿™å°†æ‰“å¼€ä¸€ä¸ªé»˜è®¤çš„ Nginx é…ç½®æ–‡ä»¶ï¼Œä½†æˆ‘çœŸçš„ä¸æƒ³ä½¿ç”¨å®ƒçš„é»˜è®¤é…ç½®ã€‚å› æ­¤ï¼Œæˆ‘é€šå¸¸ä¼šå¤åˆ¶è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œç„¶åå¯¹åŸæ–‡ä»¶è¿›è¡Œä¿®æ”¹ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬ä¹Ÿè¿™æ ·åšã€‚

```
$ cp nginx.conf copy-nginx.conf
$ rm nginx.conf && vim nginx.conf 
```

ç°åœ¨æ‰“å¼€ä¸€ä¸ªç©ºæ–‡ä»¶ï¼Œæˆ‘ä»¬å°†ç»™å®ƒæ·»åŠ æˆ‘ä»¬çš„é…ç½®ã€‚

1. æ·»åŠ ä¸€ä¸ªåŸºæœ¬é…ç½®ã€‚æ·»åŠ  `events {}` æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºå¯¹äº Nginx æ¶æ„æ¥è®²ï¼Œå®ƒé€šå¸¸è¢«ç”¨æ¥è¡¨ç¤º Worker çš„æ•°é‡ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨ `http` æ¥å‘Šè¯‰ Nginxï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ [OSI æ¨¡å‹](https://bit.ly/2LGdbYB) çš„ç¬¬ 7 å±‚ã€‚

    åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è®© Nginx ç›‘å¬ 5000 ç«¯å£ï¼Œå¹¶æŒ‡å‘ `/nginx-demo/main` æ–‡ä»¶å¤¹ä¸‹çš„é™æ€æ–‡ä»¶ã€‚

    ```
      http {

         server {
           listen 5000;
           root /path/to/nginx-demo/main/; 
          }

      }

      events {}
    ```

2. æ¥ä¸‹æ¥æˆ‘ä»¬å°†å¯¹ `/content` å’Œ `/outsider` URL æ·»åŠ é¢å¤–çš„è§„åˆ™ï¼Œå…¶ä¸­ **outsider** å°†æŒ‡å‘ç¬¬ä¸€æ­¥ä¸­æåˆ°çš„æ ¹ç›®å½•ï¼ˆ`/nginx-demo`ï¼‰ä»¥å¤–çš„ç›®å½•ã€‚

    è¿™é‡Œ `location /content` è¡¨ç¤ºæ— è®ºæˆ‘åœ¨å­ç›®å½•ä¸­å®šä¹‰äº†å“ªä¸€ä¸ªæ ¹ç›®å½•ï¼Œ**content** å­ URL éƒ½ä¼šè¢«æ·»åŠ åˆ°å®šä¹‰çš„æ ¹ç›®å½•æœ«å°¾ã€‚å› æ­¤ï¼Œè¿™é‡Œå½“æˆ‘æŒ‡å®šæ ¹ç›®å½•ä¸º `root /path/to/nginx-demo/` æ—¶ï¼Œä»…ä»…è¡¨ç¤ºæˆ‘å‘Šè¯‰ Nginx åœ¨ `http://localhost:5000/path/to/nginx-demo/content/` å‘æˆ‘å±•ç¤ºæ–‡ä»¶å¤¹å†…é™æ€æ–‡ä»¶çš„å†…å®¹ã€‚

    ```
      http {

        server {
            listen 5000;
            root /path/to/nginx-demo/main/; 

            location /content {
              root /path/to/nginx-demo/;
            }   

            location /outsider {
              root /path/temp-nginx/;
            }
       }

      }

      events {}
    ```

    > å¥½é…·ï¼ç°åœ¨ Nginx ä¸ä»…é™äºå®šä¹‰æ ¹ URLï¼Œè¿˜å¯ä»¥è®¾ç½®è§„åˆ™ï¼Œä»¥ä¾¿äºæˆ‘å¯ä»¥é˜»æ­¢å®¢æˆ·ç«¯è®¿é—®æŸäº›æ–‡ä»¶ã€‚

3. æˆ‘ä»¬å°†åœ¨å®šä¹‰çš„ä¸»æœåŠ¡å™¨ä¸­å†™å…¥ä¸€æ¡é™„åŠ è§„åˆ™ï¼Œç”¨æ¥é˜»æ­¢è®¿é—®ä»»ä½• **.md** æ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ Nginx ä¸­ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œè§„åˆ™å®šä¹‰å¦‚ä¸‹ï¼š

    ```
       location ~ .md {
            return 403;
       }
    ```

4. æœ€åæˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹æµè¡Œçš„å‘½ä»¤ `proxy_pass`ã€‚ç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£äº†ä»€ä¹ˆæ˜¯ä»£ç†å’Œåå‘ä»£ç†ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆå®šä¹‰å¦ä¸€ä¸ªè¿è¡Œåœ¨ 8888 ç«¯å£çš„åå°æœåŠ¡å™¨ï¼Œæ‰€ä»¥ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº† 2 ä¸ªåˆ†åˆ«è¿è¡Œåœ¨ 5000 å’Œ 8888 ç«¯å£çš„åå°æœåŠ¡å™¨ã€‚

    æˆ‘ä»¬è¦åšçš„æ˜¯ï¼Œå½“å®¢æˆ·ç«¯é€šè¿‡ Nginx è®¿é—® 8888 ç«¯å£æ—¶ï¼Œå°†è¿™ä¸ªè¯·æ±‚ä¼ åˆ° 5000 ç«¯å£ï¼Œå¹¶å‘å®¢æˆ·ç«¯è¿”å›å“åº”ï¼

    ```
       server {
           listen 8888;

           location / {
               proxy_pass http://localhost:5000/;
           }

           location /new {
               proxy_pass http://localhost:5000/outsider/;
           }
      }
    ```

### æœ€åä¸€èµ·æ¥çœ‹çœ‹å®Œæ•´çš„ä»£ç ï¼ğŸ˜

```
   http {

        server {
            listen 5000;
            root /path/to/nginx-demo/main/; 

            location /content {
                root /path/to/nginx-demo/;
            }   

            location /outsider {
               root /path/temp-nginx/;
            }

                    location ~ .md {
              return 403;
            }
       }

         server {
           listen 8888;

           location / {
               proxy_pass http://localhost:5000/;
           }

           location /new {
               proxy_pass http://localhost:5000/outsider/;
           }
      }

   }

   events {}
```

é€šè¿‡ `sudo nginx` æ¥è¿è¡Œä»£ç ã€‚

## é¢å¤–çš„ Nginx å‘½ä»¤ï¼

1. é¦–æ¬¡å¯åŠ¨ Nginx Web æœåŠ¡å™¨ã€‚

    ```
      $ nginx 
      #OR 
      $ sudo nginx
    ```

2. é‡æ–°åŠ è½½æ­£åœ¨è¿è¡Œçš„ Nginx Web æœåŠ¡å™¨ã€‚

    ```
      $ nginx -s reload
      #OR 
      $ sudo nginx -s reload
    ```

3. å…³é—­æ­£åœ¨è¿è¡Œçš„ Nginx Web æœåŠ¡å™¨ã€‚

    ```
      $ nginx -s stop
      #OR 
      $ sudo nginx -s stop
    ```

4. æŸ¥æ‰¾æœ‰å“ªäº› Nginx è¿›ç¨‹æ­£åœ¨ç³»ç»Ÿä¸­è¿è¡Œ

    ```
      $ ps -ef | grep Nginx
    ```

ç¬¬ 4 æ¡å‘½ä»¤å¾ˆé‡è¦ï¼Œå½“å‰ 3 æ¡å‘½ä»¤å‡ºç°é”™è¯¯æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç¬¬ 4 æ¡å‘½ä»¤æ‰¾åˆ°æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ Nginx è¿›ç¨‹ï¼Œç„¶å kill æ‰è¿™äº›è¿›ç¨‹ï¼Œé‡æ–°å¯åŠ¨ Nginx æœåŠ¡ã€‚

è¦ kill ä¸€ä¸ªè¿›ç¨‹ï¼Œä½ éœ€è¦å…ˆçŸ¥é“å®ƒçš„ PIDï¼Œç„¶åç”¨ä¸‹é¢çš„å‘½ä»¤ kill å®ƒï¼š

```
$ kill -9 <PID>
#OR 
$ sudo kill -9 <PID>
```

åœ¨ç»“æŸè¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œå£°æ˜ä¸€ä¸‹æˆ‘æ‰€ä½¿ç”¨å›¾ç‰‡å’Œè§†è§‰æ•ˆæœæ¥è‡ª Goole å›¾ç‰‡å’Œç”± [Hussein Nasser](https://www.youtube.com/user/GISIGeometry) æä¾›çš„ Youtube æ•™ç¨‹ã€‚

å…³äº Nginx çš„åŸºæœ¬è®¤è¯†å’Œé…ç½®ï¼Œæˆ‘ä»¬å°±è®²åˆ°è¿™é‡Œã€‚å¦‚æœä½ å¯¹ Nginx çš„è¿›é˜¶é…ç½®æ„Ÿå…´è¶£ï¼Œè¯·é€šè¿‡è¯„è®ºå‘Šè¯‰æˆ‘ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œè¯·äº«å—ç¼–ç¨‹çš„ä¹è¶£ï¼Œæ¢ç´¢ Nginx çš„é­”åŠ›ï¼ğŸ‘‹

> å¦‚æœå‘ç°è¯‘æ–‡å­˜åœ¨é”™è¯¯æˆ–å…¶ä»–éœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼Œæ¬¢è¿åˆ° [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner) å¯¹è¯‘æ–‡è¿›è¡Œä¿®æ”¹å¹¶ PRï¼Œä¹Ÿå¯è·å¾—ç›¸åº”å¥–åŠ±ç§¯åˆ†ã€‚æ–‡ç« å¼€å¤´çš„ **æœ¬æ–‡æ°¸ä¹…é“¾æ¥** å³ä¸ºæœ¬æ–‡åœ¨ GitHub ä¸Šçš„ MarkDown é“¾æ¥ã€‚

---

> [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner) æ˜¯ä¸€ä¸ªç¿»è¯‘ä¼˜è´¨äº’è”ç½‘æŠ€æœ¯æ–‡ç« çš„ç¤¾åŒºï¼Œæ–‡ç« æ¥æºä¸º [æ˜é‡‘](https://juejin.im) ä¸Šçš„è‹±æ–‡åˆ†äº«æ–‡ç« ã€‚å†…å®¹è¦†ç›– [Android](https://github.com/xitu/gold-miner#android)ã€[iOS](https://github.com/xitu/gold-miner#ios)ã€[å‰ç«¯](https://github.com/xitu/gold-miner#å‰ç«¯)ã€[åç«¯](https://github.com/xitu/gold-miner#åç«¯)ã€[åŒºå—é“¾](https://github.com/xitu/gold-miner#åŒºå—é“¾)ã€[äº§å“](https://github.com/xitu/gold-miner#äº§å“)ã€[è®¾è®¡](https://github.com/xitu/gold-miner#è®¾è®¡)ã€[äººå·¥æ™ºèƒ½](https://github.com/xitu/gold-miner#äººå·¥æ™ºèƒ½)ç­‰é¢†åŸŸï¼Œæƒ³è¦æŸ¥çœ‹æ›´å¤šä¼˜è´¨è¯‘æ–‡è¯·æŒç»­å…³æ³¨ [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)ã€[å®˜æ–¹å¾®åš](http://weibo.com/juejinfanyi)ã€[çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/juejinfanyi)ã€‚
