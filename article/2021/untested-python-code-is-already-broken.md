> * åŸæ–‡åœ°å€ï¼š[Untested Python Code is Already Broken](https://python.plainenglish.io/untested-python-code-is-already-broken-934cb40b547b)
> * åŸæ–‡ä½œè€…ï¼š[Matthew Hull](https://medium.com/@tigenzero)
> * è¯‘æ–‡å‡ºè‡ªï¼š[æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)
> * æœ¬æ–‡æ°¸ä¹…é“¾æ¥ï¼š[https://github.com/xitu/gold-miner/blob/master/article/2021/untested-python-code-is-already-broken.md](https://github.com/xitu/gold-miner/blob/master/article/2021/untested-python-code-is-already-broken.md)
> * è¯‘è€…ï¼š[jaredliw](https://github.com/jaredliw)
> * æ ¡å¯¹è€…ï¼š[ItzMiracleOwO](https://github.com/ItzMiracleOwO)ã€[KimYangOfCat](https://github.com/KimYangOfCat)

# ä¸ç»æµ‹è¯•çš„ Python ä»£ç å°±å·²ç¦»å´©æºƒä¸è¿œäº†

![Image by [Hier und jetzt endet leider meine Reise auf Pixabay ğŸ˜¢](https://pixabay.com/users/alexas_fotos-686414/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=1873171) from [Pixabay](https://pixabay.com/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=1873171)](https://cdn-images-1.medium.com/max/3840/1*CN92tzyClc_mkk4LWWEXtQ.jpeg)

æˆ‘çš„ç¬¬ä¸€ä½å¯¼å¸ˆæå…¶çš„ä»¤äººéš¾ä»¥ç½®ä¿¡ã€‚ä»–å‘æˆ‘å±•ç¤ºäº†ç¼–ç ã€æ—¥å¿—è®°å½•ã€æ–‡æ¡£ç¼–åˆ¶çš„æœ€ä½³å®è·µå’Œå…¶å¸¦æ¥çš„æ”¶ç›Šã€‚ä½†æœ‰ä¸€ä»¶äº‹ä»–ä¸€ç›´æ— æ³•çŒè¾“ç»™æˆ‘ï¼Œé‚£å°±æ˜¯æµ‹è¯•ã€‚ä»–çš„æµ‹è¯•ä»£ç æ–¹å¼å¾ˆå¤æ‚ï¼ŒåŒ…æ‹¬è¯´å…ˆå†™æµ‹è¯•ç¨‹åºï¼Œç„¶åç¼–ç å®ç°ï¼ä»–çš„æ–¹å¼ä¸æˆ‘çš„ç¼–ç é£æ ¼å¯¹ç«‹ï¼Œè¿™è®©æˆ‘è§‰å¾—ï¼š"**å¦‚æœæˆ‘åœ¨å†™å‡½æ•°å‰å°±å†™å¥½äº†æµ‹è¯•ï¼Œé‚£ä¹ˆæˆ‘è¿˜ä¸å¦‚ä¸å†™æµ‹è¯•ã€‚**â€â€¦â€¦ è¿™æ ·æƒ³è®©æˆ‘æ„Ÿè§‰å¥½å¤šäº†ã€‚

å¯é—®é¢˜åœ¨äºï¼šä½ çš„ä»£ç éœ€è¦æµ‹è¯•ã€‚å› ä¸ºæ‰€æœ‰ä»£ç ï¼Œå³ä¾¿æ˜¯å¥½çš„ä»£ç ï¼Œéƒ½ä¸ bug åªæœ‰ä¸€çº¿ä¹‹éš”ã€‚å¯¹äºæ–°æ‰‹æ¥è¯´ï¼šbug æ˜¯ä»£ç ä¸­æ„å¤–çš„åŠŸèƒ½æˆ–é”™è¯¯ã€‚ä½ å¯èƒ½å¯¹è‡ªå·±çš„ä»£ç åŠå…¶å±€é™æ€§éå¸¸äº†è§£ï¼Œä½†æ˜¯æ–°é˜Ÿå‹å‘¢ï¼Ÿæˆ–è€…ï¼Œåœ¨ä¸€å¹´åï¼Œä½ æƒ³ä¸ºä¸€ä¸ªä½ å·²ç»åŸºæœ¬å¿˜è®°çš„é¡¹ç›®æ·»åŠ ä¸€ä¸ªåŠŸèƒ½ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿæµ‹è¯•å°±å¥½æ¯”ä¿é¾„çƒé“ä¸Šçš„ä¿é™©æ ï¼Œè®©ä½ æ¯æ¬¡éƒ½å¯ä»¥å¯¹æäº¤çš„ä»£ç è·å¾—æ»¡åˆ†å……æ»¡ä¿¡å¿ƒã€‚

æœ¬æ–‡å°†é‡ç”¨æˆ‘çš„ Python å­¦ä¹ ç³»åˆ—ä¸­[ç¬¬ 3 éƒ¨åˆ†](https://python.plainenglish.io/build-a-fast-food-order-taker-in-python-87188efcbbdd)çš„ä»£ç ï¼Œå¹¶ä½¿ç”¨æˆ‘åœ¨[æ­¤å¤„](https://python.plainenglish.io/stop-making-excuses-and-use-make-9da448efed12)ä»‹ç»çš„ `Makefile`ã€‚å¦‚æœä½ æ˜¯ Python æ–°æ‰‹ï¼Œä¸ºä½•ä¸å…ˆæ¥çœ‹çœ‹[ç¬¬ 1 éƒ¨åˆ†](https://python.plainenglish.io/create-your-own-dice-roller-with-python-40d65c16eb84)å’Œ[ç¬¬ 2 éƒ¨åˆ†](https://python.plainenglish.io/draw-a-random-playing-card-in-python-848393d6d868)ï¼Ÿæ­¤å¤–ï¼Œå¦‚æœä½ æ²¡æœ‰è‡ªå·±çš„ Python å·¥ä½œç¯å¢ƒï¼Œè¯·åœ¨[æ­¤å¤„](https://python.plainenglish.io/new-python-developers-need-these-tools-979a17cdffc9)æŸ¥çœ‹ä½ æ‰€éœ€è¦çš„æ•™ç¨‹ã€‚

è®¨è®ºçš„è¯¾é¢˜ï¼š

* å•å…ƒæµ‹è¯•
* ç»§æ‰¿
* Mocking å’Œ patch
* Makefile
* ä»€ä¹ˆæ—¶å€™è¿›è¡Œæµ‹è¯•ï¼Ÿ

ç”±äºè¿™éœ€è¦ä¸€äº›ä»£ç ï¼Œæˆ‘å·²ç»åˆ›å»ºäº†ä¸€ä¸ª [Github Project](https://github.com/Tigenzero/medium_test_with_order_taker) æ¥å¸®åŠ©æˆ‘ä»¬å¼€å§‹è¿™ä¸ªè¯é¢˜ã€‚è·å–å®ƒæœ€ç®€å•çš„æ–¹æ³•æ˜¯é€šè¿‡ Github Desktop å…‹éš†å®ƒï¼Œæˆ–å°†å…¶ä¸‹è½½ä¸º ZIP æ–‡ä»¶ã€‚æ–‡ä»¶å¤¹ä¸­åŒ…å« `order_up.py`ã€ä¸€ä¸ª `Makefile` å’Œä¸€ä¸ª `Pipfile`ï¼Œè¿˜æœ‰ä¸€ä¸ª `Solutions` æ–‡ä»¶å¤¹ï¼Œä½†æˆ‘ä»¬æš‚æ—¶å…ˆä¸ç®¡å®ƒã€‚

åˆ›å»ºä¸€ä¸ªåä¸º `tests` çš„ Python åŒ…ã€‚é‚£å¦‚ä½•åˆ›å»ºï¼Ÿè¿™æœ‰äº›å¤æ‚ â€”â€” é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåœ¨é‡Œé¢åˆ›å»ºä¸€ä¸ªåä¸º `__init__.py` çš„ç©ºæ–‡ä»¶ã€‚æ˜¯çš„ï¼Œè¿™æ ·å°±å®Œæˆäº†ã€‚ç„¶ååœ¨æ–°çš„ `tests` æ–‡ä»¶å¤¹ä¸­ï¼Œå†åˆ›å»ºä¸€ä¸ªåä¸º `test_order_up.py` çš„æ–‡ä»¶ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å§‹äº†ã€‚æ³¨æ„ï¼šunittestï¼ˆå’Œ pytestï¼‰æ ¹æ®ä»¥ â€œtestâ€ å¼€å¤´çš„æ–‡ä»¶ç¡®å®šæµ‹è¯•çš„ä»£ç ï¼Œå› æ­¤åœ¨å‘½åéæµ‹è¯•æ–‡ä»¶æ—¶è¯·é¿å…è¿™ä¸€ç‚¹ï¼

## æµ‹è¯•æ˜¯ä»€ä¹ˆï¼Ÿ

ç®€è€Œè¨€ä¹‹ï¼Œæµ‹è¯•å›ç­”äº†â€œç¨‹åºçš„æ‰§è¡Œç»“æœæ˜¯å¦ç¬¦åˆæˆ‘ä»¬çš„æœŸæœ›ï¼Ÿâ€è¿™ä¸ªé—®é¢˜ã€‚è¦æƒ³å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨é¢„é€‰è¾“å…¥æ¥è¿è¡Œä¸€ä¸ªå‡½æ•°å¹¶æ£€æŸ¥è¾“å‡ºæ˜¯å¦ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸã€‚ä½ å¯ä»¥é€šè¿‡è¿è¡Œä¸€ä¸ªå‡½æ•°å¹¶éªŒè¯è¾“å‡ºï¼Œç¡®ä¿å®ƒä¸ä¼šæŠ›å‡ºé”™è¯¯ï¼Œæˆ–è€…ç¡®ä¿å®ƒ**ç¡®å®**æŠ›å‡ºé”™è¯¯ï¼Œä»¥æ­¤æ¥ä¿è¯ä»£ç å·²è¢«å…¨é¢çš„æµ‹è¯•ã€‚ä¸€ç»„å¥½çš„æµ‹è¯•åº”åŒ…å«æ­£å¸¸ç”¨ä¾‹ã€è¾¹ç¼˜ç”¨ä¾‹å’Œæœ‰åˆ›æ„çš„ç”¨ä¾‹ã€‚ä½ ä¸ä»…è¦ç¡®ä¿ä½ çš„ä»£ç æŒ‰åŸæ ·è¿è¡Œï¼Œè€Œä¸”è¿˜è¦ç¡®ä¿ä½ çš„**æµ‹è¯•å°†æ•è·ä½ æˆ–å…¶ä»–äººå°†æ¥æ‰€åšçš„ä»»ä½•æ„šè ¢è¡Œä¸º**ã€‚

## Unittest

Unittest æ˜¯ Python çš„å†…ç½®æµ‹è¯•æ¡†æ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä»è¿™é‡Œå¼€å§‹ã€‚å°†æ­¤ä»£ç æ”¾å…¥ä½ çš„æµ‹è¯•æ–‡ä»¶ä¸­ï¼š

```python
import unittest
import order_up


class TestOrderUp(unittest.TestCase):
    def test_get_order_one_item(self):
        order = ["fries"]
        
        result = order_up.get_order(order)
        
        self.assertEqual(order, result)
```

é¦–å…ˆï¼Œæˆ‘ä»¬ `import unittest`ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨äºæµ‹è¯•ä»£ç çš„ Python å†…ç½®åŒ…ï¼Œç„¶åæˆ‘ä»¬å¯¼å…¥ `order_up.py` æ–‡ä»¶ï¼ˆæ³¨æ„æˆ‘ä»¬çœç•¥äº† `.py` æ‰©å±•åï¼‰ã€‚

> **æ³¨**ï¼šå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ PyCharm å¹¶åœ¨ `order_up` ä¸‹çœ‹åˆ°äº†çº¢è‰²çš„ä¸‹åˆ’çº¿ï¼Œè¿™è¡¨ç¤ºæ‰¾ä¸åˆ°æ­¤åŒ…ã€‚ä½ å¯ä»¥é‡æ–°åœ¨ Github é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ‰“å¼€è¿™ä¸ªé¡¹ç›®æˆ–å³é”®å•å‡»é¡¹ç›®æ–‡ä»¶å¤¹å¹¶é€‰æ‹© â€œMark Directory asâ€ -> â€œSources Rootâ€ æ¥è§£å†³æ­¤é—®é¢˜ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º `TestOrderUp` çš„ç±»ï¼Œå®ƒçš„åç§°å’Œæˆ‘ä»¬çš„æ–‡ä»¶åç›¸åŒ¹é…ï¼Œè¿™æ ·ä¸€æ¥æˆ‘ä»¬èƒ½æ›´å®¹æ˜“æ‰¾åˆ°å¤±è´¥çš„æµ‹è¯•ã€‚å“¦ï¼Œä½†æ˜¯æ‹¬å·é‡Œæœ‰ä¸ªä¸œè¥¿ï¼Œ`unittest.TestCase`ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬çš„ç±»ç»§æ‰¿äº† `TestCase` ç±»ã€‚

### ç»§æ‰¿

ç»§æ‰¿è¡¨ç¤ºä¸€ä¸ªç±»ä»çˆ¶ç±»æ¥æ”¶å‡½æ•°å’Œå˜é‡ã€‚å¯¹äºæˆ‘ä»¬çš„è¿™ç§æƒ…å†µæ¥è¯´ï¼Œæˆ‘ä»¬ä» `TestCase` ç»§æ‰¿äº†ä¸°å¯Œçš„åŠŸèƒ½ä»¥æ–¹ä¾¿æˆ‘ä»¬çš„æµ‹è¯•å·¥ä½œã€‚ç»§æ‰¿äº†ä»€ä¹ˆå‡½æ•°å’Œå˜é‡ï¼Ÿæˆ‘ä»¬ä¹‹åä¼šæ¢è®¨è¿™ä¸ªé—®é¢˜ã€‚

## åˆ›å»ºä¸€ä¸ªæµ‹è¯•

åœ¨æˆ‘ä»¬çš„ç±»ä¸‹é¢æœ‰ä¸ªåä¸º `test_output_order_one_item` çš„å‡½æ•°ï¼Œå®ƒåº”è¯¥å¤§è‡´åœ°è§£é‡Šæˆ‘ä»¬åœ¨æµ‹è¯•ä¸­æ‰€åšçš„äº‹æƒ…ã€‚æˆ‘ä»¬å°†ç”¨å…¶äºæµ‹è¯• `get_order()` å‡½æ•°å¹¶æ£€æŸ¥è¾“å‡ºæ˜¯å¦ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸã€‚è®©æˆ‘ä»¬è¿è¡Œå®ƒï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼ä½ å¯ä»¥åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œ `python -m unittest`ï¼Œæˆ–è€…ç‚¹å‡» PyCharm ä¸­å‡½æ•°æ—è¾¹çš„ç»¿è‰²ç®­å¤´ã€‚ä½ ä¹Ÿå¯ä»¥é€‰æ‹©æ‰§è¡Œ `make unit-test`ï¼Œè®©ä»£ç åœ¨è™šæ‹Ÿç¯å¢ƒä¸­è¿è¡Œ ( æˆ‘å€‘å°‡æœƒåœ¨ä¹‹å¾Œæåˆ° `Makefile`ï¼‰ã€‚çœ‹çœ‹ç»“æœï¼š

![æ¼‚äº®ï¼Œä½ æˆåŠŸåœ°æ‰§è¡Œäº†ä½ çš„ç¬¬ä¸€ä¸ªæµ‹è¯•ï¼](https://cdn-images-1.medium.com/max/2000/1*nB9QtcujX_565oxvjNDS9g.png)

### æ–­è¨€ï¼ˆassertï¼‰

æˆ‘ä»¬ä» `unittest.TestCase` ä¸­ç»§æ‰¿çš„å‡½æ•°åŒ…æ‹¬æ–­è¨€ï¼Œå®ƒèƒ½ä¿å‡½æ•°çš„ç»“æœåœ¨æˆ‘ä»¬çš„é¢„æœŸä¹‹å†…ã€‚åœ¨ Pycharm ä¸­ï¼Œè¾“å…¥ `self.assert`ï¼Œä»£ç å®ŒæˆåŠŸèƒ½å°†æ˜¾ç¤ºæ‰€æœ‰ä¸åŒçš„é€‰é¡¹ã€‚è¿™æœ‰å¾ˆå¤šï¼Œä½†æˆ‘ä¸»è¦ä½¿ç”¨æ˜¯ `self.assertEqual`ï¼Œå®ƒæ£€æŸ¥ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸åŒï¼Œä»¥åŠ `self.assertTrue`/`self.assertFalse`ï¼ŒåŠŸèƒ½ä¸è¨€è‡ªæ˜ã€‚

ç°åœ¨ï¼Œ`order_up` çš„ä¸»è¦åŠŸèƒ½æ˜¯è·å–è®¢å•ï¼Œåˆ é™¤ä¸åœ¨èœå•ä¸Šçš„é¡¹ç›®ï¼Œä»¥åŠå…è®¸é‡å¤é¡¹ç›®ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬æ·»åŠ æµ‹è¯•ä»¥ç¡®ä¿æˆ‘ä»¬åœ¨ä»£ç ä¸­ä¿ç•™è¿™äº›åŠŸèƒ½ã€‚

```python
# ç¡®ä¿è¿™äº›å‡½æ•°åœ¨ç±»ä¸­ç¼©è¿›ã€‚
def test_get_order_duplicate_in_list(self):
    order = ["fries", "fries", "fries", "burger"]
    
    result = order_up.get_order(order)
    
    self.assertEqual(order, result)

def test_get_order_not_on_menu(self):
    order = ["banana", "cereal", "cookie"]
    expected_result = ["cookie"]
    
    result = order_up.get_order(order)
    
    self.assertEqual(expected_result, result)
```

ç°åœ¨æˆ‘ä»¬æ­£åœ¨æ£€æŸ¥æˆ‘ä»¬çš„å‡½æ•°æ˜¯å¦å¯ä»¥å¤„ç†é‡å¤é¡¹ç›®å’Œä¸åœ¨èœå•ä¸Šçš„é¡¹ç›®ã€‚è¿è¡Œè¿™äº›æµ‹è¯•å¹¶ç¡®ä¿å®ƒä»¬é€šè¿‡ï¼æ—æ³¨ï¼šæœ€å¥½çš„åšæ³•æ˜¯åœ¨å†™æµ‹è¯•æ—¶è®©æ‰§è¡Œçš„ä»£ç å’ŒéªŒè¯çš„ä»£ç ä¹‹é—´éš”å¼€ä¸€è¡Œã€‚è¿™æ ·ï¼Œä½ å’Œä½ çš„é˜Ÿå‹å°±å¯ä»¥å¾ˆå®¹æ˜“åœ°åˆ†è¾¨å“ªä¸ªæ˜¯å“ªä¸ªã€‚

## Patch

æˆ‘å¿…é¡»æ‰¿è®¤ï¼šæˆ‘ä½œäº†ä¸€ç‚¹å¼Šã€‚å¦‚æœä½ å°†[ç¬¬ 3 éƒ¨åˆ†](https://python.plainenglish.io/build-a-fast-food-order-taker-in-python-87188efcbbdd)ä¸­çš„ä»£ç ä¸å½“å‰çš„ `order_up.py` è¿›è¡Œæ¯”è¾ƒï¼Œä½ å°†æˆ‘ä¼šæ³¨æ„åˆ°æˆ‘æ·»åŠ äº†ä¸€ä¸ªåŠŸèƒ½æ¥å®¹çº³ä¸€ä¸ªæ–°å˜é‡ï¼š`test_order`ã€‚æœ‰äº†è¿™ä¸ªæ–°å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥ç»•è¿‡å¼•å…¥ `input()`ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ä¼šåœ¨æ¯æ¬¡è¿è¡Œæµ‹è¯•æ—¶è®©ç¨‹åºè¦æ±‚ç”¨æˆ·è¾“å…¥ã€‚ä½†æ˜¯ç°åœ¨æˆ‘ä»¬å·²ç»æŒæ¡äº†æµ‹è¯•çš„åŸºç¡€çŸ¥è¯†ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹å°è¯•ä½¿ç”¨ mockã€‚Mock èƒ½æ¨¡ä»¿å¹¶åˆ›é€ å‡½æ•°/å¯¹è±¡ï¼Œä½¿å¾—æˆ‘ä»¬çš„æµ‹è¯•å¯ä»¥ä¸“æ³¨äºé€»è¾‘æ–¹é¢ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†â€œè¡¥ç¼€â€ `input()` å‡½æ•°ï¼Œæˆ–è€…æš‚æ—¶é‡å†™å®ƒï¼Œä»¥ç®€å•åœ°è¿”å›æˆ‘ä»¬æƒ³è¦çš„è¾“å‡ºã€‚çœ‹çœ‹ï¼š

```python
@patch("builtins.input", return_value="yes")
def test_is_order_complete_yes(self, input_patch):
    self.assertEqual(builtins.input, input_patch)
    
    result = order_up.is_order_complete()
    
    self.assertFalse(result)
```

é¦–å…ˆï¼Œåœ¨æµ‹è¯•æ–‡ä»¶çš„å¼€å¤´æ·»åŠ  `from unittest.mock import patch`ã€‚ä¸€å¼€å§‹ï¼Œæˆ‘ä»¬æ­£åœ¨è¡¥ç¼€ `builtins.input()` å‡½æ•°å¹¶å‘Šè¯‰å®ƒè¿”å› â€œyesâ€ã€‚ç„¶åï¼Œæˆ‘ä»¬æ‰§è¡Œæ–­è¨€ä»¥æ£€æŸ¥ä»è¡¥ä¸ä¸­è·å¾—çš„å‚æ•°æ˜¯å¦ä¸ `input` çš„å®Œå…¨ä¸€è‡´ï¼æ³¨æ„åˆ° `builtins.input` æ²¡æœ‰æ‹¬å·äº†å—ï¼Ÿæˆ‘ä»¬å¯ä»¥å¼•ç”¨å‡½æ•°çš„ç­¾åè¿›è¡ŒéªŒè¯ï¼Œè€Œä¸æ˜¯æ‰§è¡Œå‡½æ•°ã€‚ä¹‹åï¼Œæˆ‘ä»¬å›åˆ°æ­£å¸¸çš„æµ‹è¯•åè®®ï¼šè¿è¡Œå‡½æ•°ï¼Œè·å–ç»“æœï¼Œå¹¶æ–­è¨€ç»“æœã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå› ä¸ºæˆ‘ä»¬çš„ `input()` è¿”å›å€¼æ˜¯ â€œyesâ€ï¼Œæˆ‘ä»¬é æœŸ `is_order_complete()` è¿”å› `False`ã€‚å°†å®ƒæ·»åŠ åˆ°ä½ çš„æµ‹è¯•ç±»ä¸­ï¼Œå•å‡»è¿è¡Œï¼Œè·å¾—çº¢è‰² OK æˆ–ç»¿è‰²å¤é€‰æ ‡è®°ï¼Œè®©æˆ‘ä»¬ç»§ç»­å‰è¿›ï¼

### Side Effect

ç°åœ¨æˆ‘ä»¬å·²ç»å­¦ä¼šäº† patchï¼Œæˆ‘ä»¬å¯ä»¥è§£å†³ `get_output()` ä¸­çš„è¾“å…¥é—®é¢˜ï¼å—¯ï¼Œå·®ä¸å¤šã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ `side_effect`ï¼Œå½“æˆ‘ä»¬éœ€è¦ä¸ºåŒä¸€ä¸ªå‡½æ•°æä¾›ä¸åŒçš„è¿”å›å€¼æ—¶ï¼Œå®ƒæ˜¯æˆ‘ä»¬çš„æ•‘æ˜Ÿã€‚åœ¨ `get_output()` ä¸­ï¼Œé€šè¿‡ `input()`ï¼Œæˆ‘ä»¬è¢«é—®åˆ°â€œä½ æƒ³è¦ä»€ä¹ˆï¼Ÿâ€å’Œâ€œä½ å®Œæˆäº†å—ï¼Ÿâ€ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦è®© `input()` è¿”å›çš„ä¸ä»…ä»…æ˜¯ä¸€ä¸ªè€Œæ˜¯å¤šä¸ªè¾“å‡ºä»¥é€‚åº”æ¯ç§æƒ…å†µã€‚çœ‹çœ‹ï¼š

```python
@patch("builtins.input", side_effect=["banana", "cookie", "yes", "fries", "no"])
def test_get_order_valid(self, input_patch):
    self.assertEqual(builtins.input, input_patch)
    expected_result = ["cookie", "fries"]

    result = order_up.get_order()

    self.assertEqual(expected_result, result)
```

ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä¸èµ‹å€¼ `return_value`ï¼Œè€Œæ˜¯ç‚º `side_effect` åˆ†é…ä¸€ä¸ªåˆ—è¡¨ã€‚

> **å¤‡æ³¨**ï¼šä½ ä¹Ÿå¯ä»¥åœ¨æµ‹è¯•å‡½æ•°ä¸­èµ‹å€¼ `side_effect` æˆ– `return_value`ã€‚

`side_effect` å°†è·å–åˆ—è¡¨ä¸­çš„æ¯ä¸ªé¡¹ç›®ï¼Œå¹¶åœ¨æ¯æ¬¡è°ƒç”¨ patch å‡½æ•°æ—¶å•ç‹¬æä¾›å®ƒã€‚æ·»åŠ è¯¥ä»£ç å¹¶ç‚¹å‡»æµ‹è¯•æŒ‰é’®/å‘½ä»¤ï¼æœ€åä¸€ä»¶äº‹ï¼šåœ¨ â€œbananaâ€ å’Œ â€œcookieâ€ ä¸­æ²¡æœ‰æ˜¯/å¦ï¼Œå› ä¸ºå¦‚æœ `MENU` ä¸­ä¸å­˜åœ¨è¯¥é¡¹ç›®ï¼Œ`get_order()`ä¸ä¼šè¯¢é—®â€œä½ æƒ³è®¢è´­æ›´å¤šå—ï¼Ÿâ€ã€‚å¦‚æœä½ æƒ³è‡ªå·±ç©å¼„è¿™ä¸ªåˆ—è¡¨ï¼Œè¯·è®°ä½è¿™ä»¶äº‹æƒ…ã€‚

## Makefile

è¯´å®Œäº†æµ‹è¯•çš„åŸºç¡€çŸ¥è¯†ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€çœ‹ `Makefile`ã€‚ æˆ‘ä¸ä¼šå¤åˆ¶/ç²˜è´´ä»£ç åˆ°è¿™é‡Œï¼Œå› ä¸ºä½ å¯ä»¥åœ¨é¡¹ç›®ä¸­çœ‹åˆ°å®ƒã€‚ä¸»è¦æ–¹æ³•æ˜¯`unit-test`å’Œ `run`ã€‚`unit-test` éœ€è¦ `venv` æ¥æ‰§è¡Œï¼Œæ ¹æ®æˆ‘ä»¬çš„ `Pipfile` é…ç½®å¯åŠ¨ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒã€‚æ³¨æ„åœ¨`unit-test`çš„æœ«å°¾ï¼Œæˆ‘ä»¬æ‰§è¡Œäº† `python3 -m pipenv run python3 -m unittest;`ï¼Œè¿™å°±æ˜¯æµ‹è¯•é­”æ³•å‘ç”Ÿçš„åœ°æ–¹ï¼Œå³ä½¿ä½ å¿˜è®°å¦‚ä½•è¿è¡Œæµ‹è¯•ï¼Œä½ ä¹Ÿèƒ½åœ¨é‚£é‡Œæ‰¾åˆ°å®ƒï¼

## ä»€ä¹ˆæ—¶å€™ç¼–å†™æµ‹è¯•ï¼Ÿ

é‚£ä¹ˆä»€ä¹ˆæ—¶å€™ç¼–å†™æµ‹è¯•å‘¢ï¼Ÿ**è¿™ä¸é‡è¦**ã€‚é‡ç‚¹æ˜¯æ‰€å†™çš„æµ‹è¯•èƒ½æ¶µç›–å¤§éƒ¨åˆ†ä»£ç ä»¥åŠå®ƒå¯èƒ½é‡åˆ°çš„æ½œåœ¨ç”¨ä¾‹ã€‚å¦‚æœä½ ä¸èƒ½æ­£ç¡®åœ°æµ‹è¯•ä½ çš„ä»£ç æˆ–è€…è¯´éœ€è¦ 8 ä¸ªä¸åŒçš„æµ‹è¯•æ¥è¦†ç›–ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆä½ å¾ˆæœ‰å¯èƒ½éœ€è¦é‡æ„ä½ çš„ä»£ç ã€‚è¿™å¹¶ä¸ä¼šè®©ä½ æˆä¸ºä¸€ä¸ªç³Ÿç³•çš„ç¨‹åºå‘˜ï¼Œè¿™åªæ˜¯ç¼–ç¨‹è¿‡ç¨‹/ç»éªŒçš„ä¸€éƒ¨åˆ†ã€‚

### æµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTDDï¼‰

è®©æˆ‘è°ˆè°ˆæµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTDDï¼‰çš„é—®é¢˜å§ã€‚TDD æ˜¯ä¸€ç§å¼€å‘å®è·µï¼Œå…ˆç¼–å†™å¤±è´¥çš„æµ‹è¯•ç¨‹åºå†ç¼–å†™å‡½æ•°æ¥é€šè¿‡å®ƒã€‚**æ•…äº‹æ—¶é—´**ï¼šæˆ‘åŠ å…¥äº†ä¸€å®¶åˆåˆ›å…¬å¸ï¼Œè¯¥åˆåˆ›å…¬å¸å°† Robert C. Martinï¼ˆã€Šä»£ç æ•´æ´ä¹‹é“ã€‹å’Œå…¶ä»–ä¹¦ç±çš„ä½œè€…ï¼‰çš„ TDD å’Œåé¢æ¨¡å¼æ¦‚å¿µï¼Œæˆ–è¦é¿å…çš„ä¸è‰¯ç¼–ç å®è·µï¼Œä½œä¸ºä¿¡ä»°ã€‚ æœ‰ä¸€æ¬¡ï¼Œæˆ‘ä»¬å¬å¼€äº†ä¸€æ¬¡å…³äº TDD åŠå…¶å¥½å¤„çš„ä¼šè®®æ¥é¼“åŠ±å›¢é˜Ÿä»¥é¢†å¯¼è®¤ä¸ºæ›´â€œæœ‰æ•ˆâ€çš„æ–¹å¼è¿›è¡Œç¼–ç ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œå¤§éƒ¨åˆ†æ—¶é—´éƒ½èŠ±åœ¨äº‰è®º TDD çš„å®šä¹‰å’Œæ­£ç¡®ç”¨æ³•ä¸Šã€‚ä¼šè®®ç»„ç»‡è€…ï¼Œä¸€ä½é«˜çº§å·¥ç¨‹å¸ˆï¼Œè®¤ä¸ºæˆ‘ä»¬â€œç¼–ç ç¼–å¾—å¤ªå¿«â€ï¼Œå¹¶æ²¡æœ‰é€šè¿‡ç¼–å†™"èªæ˜"çš„æµ‹è¯•æˆ–åŠŸèƒ½è¶…è¿‡æµ‹è¯•çš„å‡½æ•°æ¥æ­£ç¡®å®ç° TDD çš„åŸåˆ™ã€‚

æˆ‘å¸¦ç€ä¸€ä¸ªæƒ³æ³•ç¦»å¼€é‚£æ¬¡ä¼šè®®ï¼šè®©ä½ çš„å“²å­¦è¾©è®ºä»æˆ‘çš„å·¥ä½œä¸­**æ¶ˆå¤±**ã€‚

æœ¬ç¯‡çš„é‡ç‚¹æ˜¯ï¼š**æ‰¾åˆ°ä¸€ç§åˆé€‚çš„æ–¹æ³•å°†æµ‹è¯•å›Šæ‹¬åˆ°é¡¹ç›®ä¸­**ã€‚æˆ‘æ²¡æœ‰å…·ä½“çš„ç»™å‡ºå®ç°å®ƒä»¬çš„æ–¹æ³•æˆ–ä½•æ—¶å®ç°ï¼Œåªè¦å®ƒä»¬èƒ½é˜»æ­¢ä½ çš„ä»£ç åœ¨ä¸‹ä¸€æ¬¡æäº¤åè¿›å…¥æ’æ°´æ²Ÿå°±ç®—æˆåŠŸäº†ã€‚å†è§ï¼

> å¦‚æœå‘ç°è¯‘æ–‡å­˜åœ¨é”™è¯¯æˆ–å…¶ä»–éœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼Œæ¬¢è¿åˆ° [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner) å¯¹è¯‘æ–‡è¿›è¡Œä¿®æ”¹å¹¶ PRï¼Œä¹Ÿå¯è·å¾—ç›¸åº”å¥–åŠ±ç§¯åˆ†ã€‚æ–‡ç« å¼€å¤´çš„ **æœ¬æ–‡æ°¸ä¹…é“¾æ¥** å³ä¸ºæœ¬æ–‡åœ¨ GitHub ä¸Šçš„ MarkDown é“¾æ¥ã€‚

---

> [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner) æ˜¯ä¸€ä¸ªç¿»è¯‘ä¼˜è´¨äº’è”ç½‘æŠ€æœ¯æ–‡ç« çš„ç¤¾åŒºï¼Œæ–‡ç« æ¥æºä¸º [æ˜é‡‘](https://juejin.im) ä¸Šçš„è‹±æ–‡åˆ†äº«æ–‡ç« ã€‚å†…å®¹è¦†ç›– [Android](https://github.com/xitu/gold-miner#android)ã€[iOS](https://github.com/xitu/gold-miner#ios)ã€[å‰ç«¯](https://github.com/xitu/gold-miner#å‰ç«¯)ã€[åç«¯](https://github.com/xitu/gold-miner#åç«¯)ã€[åŒºå—é“¾](https://github.com/xitu/gold-miner#åŒºå—é“¾)ã€[äº§å“](https://github.com/xitu/gold-miner#äº§å“)ã€[è®¾è®¡](https://github.com/xitu/gold-miner#è®¾è®¡)ã€[äººå·¥æ™ºèƒ½](https://github.com/xitu/gold-miner#äººå·¥æ™ºèƒ½)ç­‰é¢†åŸŸï¼Œæƒ³è¦æŸ¥çœ‹æ›´å¤šä¼˜è´¨è¯‘æ–‡è¯·æŒç»­å…³æ³¨ [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)ã€[å®˜æ–¹å¾®åš](http://weibo.com/juejinfanyi)ã€[çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/juejinfanyi)ã€‚
