> * åŸæ–‡åœ°å€ï¼š[New Standards to Access User Device Hardware using JavaScript](https://blog.bitsrc.io/new-standards-to-access-user-device-hardware-using-javascript-86b0c156dd3d)
> * åŸæ–‡ä½œè€…ï¼š[Viduni Wickramarachchi](https://medium.com/@viduniwickramarachchi)
> * è¯‘æ–‡å‡ºè‡ªï¼š[æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)
> * æœ¬æ–‡æ°¸ä¹…é“¾æ¥ï¼š[https://github.com/xitu/gold-miner/blob/master/article/2021/new-standards-to-access-user-device-hardware-using-javascript.md](https://github.com/xitu/gold-miner/blob/master/article/2021/new-standards-to-access-user-device-hardware-using-javascript.md)
> * è¯‘è€…ï¼š[Badd](https://juejin.cn/user/1134351730353207)
> * æ ¡å¯¹è€…ï¼š[Chorer](https://github.com/Chorer)ï¼Œ[KimYangOfCat](https://github.com/KimYangOfCat)

# ç”¨ JavaScript è®¿é—®ç”¨æˆ·è®¾å¤‡ç¡¬ä»¶çš„æ–°æ ‡å‡†

![](https://cdn-images-1.medium.com/max/5760/1*qfJbVEgiwXf7b-nEviGJHg.jpeg)

ä½ æ˜¯å¦æ›¾ä»…ä¸ºäº†èƒ½è®¿é—®ç”¨æˆ·è®¾å¤‡ç¡¬ä»¶è€Œä¸å¾—ä¸å¼€å‘ä¸€ä¸ªæ¡Œé¢åº”ç”¨ï¼Ÿä½ ä¸æ˜¯å”¯ä¸€ä¸€ä¸ªæ·±å—å…¶è‹¦çš„äººã€‚å°±åœ¨ä¸ä¹…ä¹‹å‰ï¼Œç”¨ JavaScript è®¿é—®ç¡¬ä»¶çš„æ–¹å¼è¿˜æ˜¯å‹‰å¼ºè€Œéº»çƒ¦çš„ã€‚ ç„¶è€Œï¼Œéšç€è¿‘æœŸçš„ Chrome å¼€å‘å·¥å…·çš„æ›´æ–°ï¼Œç”¨ JavaScript ä¸ç¡¬ä»¶äº¤äº’å·²æ˜¯æ¢¦æƒ³æˆçœŸã€‚

å› æ­¤ï¼Œåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†ä¼šä»‹ç» 3 ä¸ªæ–°çš„ JavaScript APIï¼Œå³ **WebHID**ã€**WebNFC** ä»¥åŠ **WebUSB**ï¼Œå®ƒä»¬å°†å¯ç”¨äºè®¿é—®è®¾å¤‡ç¡¬ä»¶ã€‚ä¸‹é¢è®©æˆ‘ä»¬æ¥é€ä¸€äº†è§£æ¯ä¸ªæ–°æŠ€æœ¯ç‚¹ã€‚

## 1. ä»€ä¹ˆæ˜¯ WebHIDï¼Ÿ

åœ¨æŠŠä¸€ä¸ª HIDï¼ˆHuman Interface Deviceï¼Œäººæœºæ¥å£è®¾å¤‡ï¼‰é›†æˆåˆ°è½¯ä»¶ä¸­çš„æ—¶å€™ï¼Œå¼€å‘è€…é¢å¯¹çš„ä¸»è¦é—®é¢˜å°±æ˜¯éœ€è¦åšå¤§é‡çš„å…¼å®¹å·¥ä½œï¼ŒåŒ…æ‹¬å¯¹æ—§/æ–°è®¾å¤‡ã€é€šç”¨/éé€šç”¨æ¨¡å‹ç­‰çš„å…¼å®¹ã€‚

> WebHID æä¾›äº†ä¸€ä¸ª API æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ­¤ API è®©æˆ‘ä»¬èƒ½å¤Ÿç”¨ JavaScript å®ç°é’ˆå¯¹ç‰¹å®šè®¾å¤‡çš„é€»è¾‘ã€‚

ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå¦‚æœä½ æƒ³è¦ç”¨ä»»å¤©å ‚ Switch çš„ Joy-Con æ‰‹æŸ„ç© Chrome çš„ç¦»çº¿å°æé¾™ ğŸ¦– æ¸¸æˆï¼Œæœ‰äº† WebHID å°±å¯ä»¥å®ç°ã€‚æ˜¯ä¸æ˜¯æŒºé…·çš„ï¼Ÿ

ç”¨ä¸‹é¢è¿™æ®µä»£ç ï¼Œä½ å°±èƒ½æ£€æµ‹è¿è¡Œç¯å¢ƒæ˜¯å¦æ”¯æŒ WebHIDã€‚

```js
if ("hid" in navigator) { /* æ”¯æŒ WebHID APIã€‚ */ }
```

å½“ä¸€ä¸ªåº”ç”¨ä½¿ç”¨äº† WebHID å»è¿æ¥ä¸€ä¸ªè®¾å¤‡ï¼Œå°±ä¼šæ˜¾ç¤ºä¸‹å›¾è¿™æ ·çš„æç¤ºå¼¹çª—ã€‚

![](https://cdn-images-1.medium.com/max/2560/1*jGpe3g9CW13dDzmCCbBaYQ.jpeg)

è€Œä½ éœ€è¦åšçš„å°±æ˜¯ï¼Œé€‰æ‹©æ­£ç¡®çš„è®¾å¤‡ï¼Œç„¶åç‚¹å‡»è¿æ¥ï¼ˆConnectï¼‰ã€‚å°±è¿™ä¹ˆç®€å•ã€‚

> WebHID API æ˜¯å¼‚æ­¥çš„ã€‚å› æ­¤åœ¨ç­‰å¾…è¿æ¥æ–°è®¾å¤‡æˆ–è€…ç”¨æˆ·è¾“å…¥æ—¶ï¼Œç•Œé¢ä¹Ÿä¸ä¼šè¢«é˜»å¡ã€‚

### å®‰å…¨æ€§è€ƒé‡

æˆ‘çŸ¥é“å½“ä½ äº†è§£äº† WebHID èƒ½åšä»€ä¹ˆä¹‹åï¼Œä¸€å®šä¼šæƒ³åˆ°å®‰å…¨é—®é¢˜ã€‚

Chromium æ–‡æ¡£è§„å®šäº†[å¯¹å¼ºå¤§çš„ Web å¹³å°ç‰¹æ€§çš„è®¿é—®æ§åˆ¶](https://chromium.googlesource.com/chromium/src/+/lkgr/docs/security/permissions-for-powerful-web-platform-features.md)ï¼Œè€Œè¿™ä¸ª API æ­£æ˜¯æ ¹æ®æ–‡æ¡£ä¸­å®šä¹‰çš„æ ¸å¿ƒåŸåˆ™å¼€å‘çš„ï¼ŒåŒ…æ‹¬ç”¨æˆ·æ§åˆ¶ã€é€æ˜åº¦ã€äººä½“å·¥ç¨‹å­¦ç­‰æ–¹é¢çš„åŸåˆ™ã€‚æ›´ä¸¥æ ¼çš„æ˜¯ï¼ŒåŒä¸€æ—¶åˆ»åªå…è®¸è¿æ¥ä¸€ä¸ª HID è®¾å¤‡ã€‚

å¦å¤–ï¼ŒChrome å¼€å‘è€…å·¥å…·é’ˆå¯¹æµè§ˆå™¨å½“å‰è¿æ¥çš„è®¾å¤‡æä¾›äº†æ—¥å¿—è¾“å‡ºåŠŸèƒ½ï¼Œè¿™è®©è°ƒè¯•è®¾å¤‡è¿æ¥æ›´åŠ å®¹æ˜“ã€‚è¯¥æ—¥å¿—å¯åœ¨ `chrome://device-log`ï¼ˆChrome å†…éƒ¨é¡µé¢ï¼‰ä¸­çœ‹åˆ°ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä¸ä¼šæ¶‰åŠåº•å±‚å®ç°ç»†èŠ‚ã€‚å¦‚æœä½ æƒ³è¦äº†è§£å®ç°ç»†èŠ‚ï¼Œè¯·åœ¨è¯„è®ºåŒºç•™è¨€ã€‚

### æµè§ˆå™¨å…¼å®¹æ€§

ç›®å‰æ¡Œé¢ç«¯çš„ Chrome å’Œ Edge æ”¯æŒ WebHIDã€‚

![å¼•ç”¨è‡ª [https://developer.mozilla.org/en-US/docs/Web/API/WebHID_API](https://developer.mozilla.org/en-US/docs/Web/API/WebHID_API)](https://cdn-images-1.medium.com/max/2004/1*F47jvMuDaIypYRjt_PFbaA.png)

æ¥ç€è®©æˆ‘ä»¬æ¥çœ‹çœ‹ WebNFCã€‚

## 2. ä»€ä¹ˆæ˜¯ WebNFCï¼Ÿ

ç›¸ä¿¡ä½ ä¹‹å‰è‚¯å®šæ¥è§¦è¿‡ NFCï¼ˆNear field communicationsï¼Œè¿‘è·ç¦»é€šä¿¡æŠ€æœ¯ï¼‰è¿™ä¸ªç¼©å†™åè¯ã€‚

æœ‰äº† WebNFCï¼Œå½“ä¸€ä¸ª NFC æ ‡ç­¾ä½äºä½ çš„è®¾å¤‡çš„è¯†åˆ«èŒƒå›´ä¹‹å†…æ—¶ï¼Œä½ å°±èƒ½å¯¹å…¶è¯»å–æˆ–å†™å…¥æ•°æ®äº†ã€‚è¿™æ˜¯é€šè¿‡ NDEFï¼ˆNFC æ•°æ®äº¤æ¢æ ¼å¼ï¼‰æŠ€æœ¯å®ç°çš„ï¼Œæ˜¯ NFC æ ‡ç­¾æ”¯æŒçš„ä¸€ç§æ ¼å¼ã€‚

### ä½¿ç”¨ WebNFC

å‡è®¾ä¸€ä¸ªåœºæ™¯ï¼šä½ éœ€è¦ç®¡ç†è‡ªå®¶åº—é“ºçš„åº“å­˜ã€‚ä½ å¯ä»¥é€šè¿‡ WebNFC å‘åº“å­˜å•†å“ä¸Šçš„ NFC æ ‡ç­¾è¯»/å†™æ•°æ®ï¼Œè¿™æ ·å°±èƒ½æ­å»ºèµ·ä¸€ä¸ªåº“å­˜ç®¡ç†ç«™ç‚¹ã€‚

WebNFC å¸¦æ¥çš„å¯èƒ½æ€§æ˜¯æ— é™çš„ã€‚è¿™æ˜¯ä¸€ä¸ªæœºä¼šï¼Œä¸€ä¸ªèƒ½è®©è®¸å¤šè¿‡ç¨‹è‡ªåŠ¨åŒ–ã€è®©æ—¥å¸¸å·¥ä½œææ•ˆçš„æœºä¼šã€‚

ä¸ WebHID ç±»ä¼¼ï¼Œä½ å¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç æ£€æŸ¥ WebNFC çš„æ”¯æŒæƒ…å†µã€‚

```js
if ('NDEFReader' in window) { /* æ‰«æã€å†™å…¥ NFC æ ‡ç­¾ */ }
```

### å®‰å…¨æ€§è€ƒé‡

> ä¸ºäº†é˜²æ‚£äºæœªç„¶ï¼Œåªæœ‰é¡¶å±‚æ¡†æ¶å’Œå®‰å…¨çš„æµè§ˆç¯å¢ƒï¼ˆåªå…è®¸ HTTPS åè®®ï¼‰èƒ½å¤Ÿä½¿ç”¨ WebNFCã€‚

å¦‚æœä¸€ä¸ªå®ç°äº† WebNFC åŠŸèƒ½çš„ç½‘é¡µæ¶ˆå¤±äº†æˆ–è‚‰çœ¼ä¸å¯è§ï¼Œé‚£ä¹ˆå’Œè¯¥ç½‘é¡µè¿æ¥çš„æ‰€æœ‰ NFC æ ‡ç­¾éƒ½ä¼šè¢«æŒ‚èµ·è¿æ¥ã€‚å½“é¡µé¢é‡æ–°å¯è§æ—¶ï¼Œè¿™äº›è¿æ¥æ‰ä¼šæ¢å¤ã€‚é¡µé¢å¯è§æ€§ API å¯ä»¥å¸®ä½ è¯†åˆ« NFC æ“ä½œçš„è¿æ¥çŠ¶æ€ã€‚

å¦‚æœä½ ä¸ç†Ÿæ‚‰é¡µé¢å¯è§æ€§ API çš„è¯ï¼Œå¯ä»¥è¯»è¯»[è¿™ç¯‡æ–‡ç« ](https://blog.bitsrc.io/page-lifecycle-api-a-browser-api-every-frontend-developer-should-know-b1c74948bd74)ã€‚

### æµè§ˆå™¨å…¼å®¹æ€§

ç›®å‰ä»…æœ‰ Android ç«¯çš„ Chrome æ”¯æŒ WebNFCã€‚

![å¼•ç”¨è‡ª [https://developer.mozilla.org/en-US/docs/Web/API/Web_NFC_API](https://developer.mozilla.org/en-US/docs/Web/API/Web_NFC_API)](https://cdn-images-1.medium.com/max/4048/1*fN-b18bMyZ8OPvq3eYzNvQ.png)

ä¸‹é¢ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹ WebUSB APIã€‚

## 3. ä»€ä¹ˆæ˜¯ WebUSBï¼Ÿ

ä» Chrome 61 ç‰ˆæœ¬å¼€å§‹ï¼ŒWebUSB API è®©ä½ å¯ä»¥ç”¨ JavaScript ä¸ USB ç«¯å£è¿›è¡Œé€šä¿¡ã€‚

ç„¶è€Œï¼Œä½ å¯èƒ½ä¼šæƒ³ï¼Œæˆ‘ä»¬æ€ä¹ˆæ‰èƒ½è®¿é—®æ¯ä¸ª USB è®¾å¤‡çš„ç›¸å…³é©±åŠ¨ï¼Œå¯¹å§ï¼Ÿæœ‰äº† WebHID API çš„æ”¯æŒï¼Œç¡¬ä»¶å‚å•†èƒ½å¤Ÿé’ˆå¯¹è‡ªå®¶çš„ç¡¬ä»¶è®¾å¤‡å¼€å‘å‡ºè·¨å¹³å°çš„ JavaScript SDKã€‚

ä¸ä¸Šè¿° API ç±»ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹åˆ—ä»£ç æ£€æµ‹ WebUSB çš„æ”¯æŒæƒ…å†µã€‚

```js
if ("usb" in navigator) { /* æ”¯æŒ WebUSB APIã€‚ */ }
```

### å®‰å…¨æ€§

æœ‰è®¸å¤šæ§åˆ¶æªæ–½å¯ä»¥ä¿æŠ¤æœªæˆæƒçš„ USB è®¿é—®çš„å®‰å…¨æ€§ï¼Œè€Œä¸”å®ƒä»…åœ¨åªå…è®¸ HTTPS åè®®çš„å®‰å…¨ç¯å¢ƒè¿è¡Œï¼Œä»¥æ­¤æ¥ä¿æŠ¤ä¼ è¾“çš„æ•°æ®ã€‚å¦å¤–ï¼Œä¼šæœ‰æ ‡å‡†æµè§ˆå™¨æˆæƒæµç¨‹æ¥è¯·æ±‚å’Œæˆäºˆè®¿é—®æƒé™ã€‚

WebUSB API ç›¸å…³çš„è°ƒè¯•ä»»åŠ¡ä¹Ÿå¯ä»¥åœ¨ `chrome://device-log` é¡µé¢çœ‹åˆ°ï¼Œé¡µé¢é‡Œä¼šåˆ—å‡ºå½“å‰è¿æ¥çš„æ‰€æœ‰ USB è®¾å¤‡åŠç›¸å…³äº‹ä»¶ã€‚

### æµè§ˆå™¨å…¼å®¹æ€§

æ¡Œé¢ç«¯ Chromeã€Edgeï¼Œä»¥åŠ Android ç«¯ Chrome æ”¯æŒ WebUSBã€‚

![å¼•ç”¨è‡ª [https://developer.mozilla.org/en-US/docs/Web/API/USB](https://developer.mozilla.org/en-US/docs/Web/API/USB)](https://cdn-images-1.medium.com/max/2006/1*l3vDUrDveghLc6IUMAD2Mg.png)

å…³äº WebUSB API çš„æ›´å¤šç»†èŠ‚ï¼Œä½ å¯ä»¥å‚é˜… [Web ç«¯è®¿é—® USB è®¾å¤‡æ–‡æ¡£](https://web.dev/usb/)ã€‚

## æ€»ç»“

ä¸ç®¡æ˜¯ä½ çš„ç½‘ç«™è¦å’Œç¡¬ä»¶äº¤äº’ï¼Œè¿˜æ˜¯ä½ æœ‰è¦å’Œ Web åº”ç”¨äº¤äº’çš„ç¡¬ä»¶ï¼Œæ–°æ ‡å‡†å¸¦æ¥çš„éƒ½æ˜¯åŒèµ¢ï¼Œå› ä¸ºå®ƒä»¬æ— éœ€å†å®‰è£…ä¸“é—¨çš„é©±åŠ¨æˆ–è½¯ä»¶å°±èƒ½è¿›è¡Œè¿æ¥äº†ã€‚

åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™ä¸ªæ–°åŠŸèƒ½å¤ªé…·äº†ï¼Œä¼šè®©ç”Ÿæ´»æ›´åŠ ä¾¿æ·ã€‚

æ¬¢è¿å’Œæˆ‘åˆ†äº«ä½ å¯¹æ­¤çš„æƒ³æ³•ã€‚æ„Ÿè°¢é˜…è¯»ï¼

> å¦‚æœå‘ç°è¯‘æ–‡å­˜åœ¨é”™è¯¯æˆ–å…¶ä»–éœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼Œæ¬¢è¿åˆ° [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner) å¯¹è¯‘æ–‡è¿›è¡Œä¿®æ”¹å¹¶ PRï¼Œä¹Ÿå¯è·å¾—ç›¸åº”å¥–åŠ±ç§¯åˆ†ã€‚æ–‡ç« å¼€å¤´çš„ **æœ¬æ–‡æ°¸ä¹…é“¾æ¥** å³ä¸ºæœ¬æ–‡åœ¨ GitHub ä¸Šçš„ MarkDown é“¾æ¥ã€‚

---

> [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner) æ˜¯ä¸€ä¸ªç¿»è¯‘ä¼˜è´¨äº’è”ç½‘æŠ€æœ¯æ–‡ç« çš„ç¤¾åŒºï¼Œæ–‡ç« æ¥æºä¸º [æ˜é‡‘](https://juejin.im) ä¸Šçš„è‹±æ–‡åˆ†äº«æ–‡ç« ã€‚å†…å®¹è¦†ç›– [Android](https://github.com/xitu/gold-miner#android)ã€[iOS](https://github.com/xitu/gold-miner#ios)ã€[å‰ç«¯](https://github.com/xitu/gold-miner#å‰ç«¯)ã€[åç«¯](https://github.com/xitu/gold-miner#åç«¯)ã€[åŒºå—é“¾](https://github.com/xitu/gold-miner#åŒºå—é“¾)ã€[äº§å“](https://github.com/xitu/gold-miner#äº§å“)ã€[è®¾è®¡](https://github.com/xitu/gold-miner#è®¾è®¡)ã€[äººå·¥æ™ºèƒ½](https://github.com/xitu/gold-miner#äººå·¥æ™ºèƒ½)ç­‰é¢†åŸŸï¼Œæƒ³è¦æŸ¥çœ‹æ›´å¤šä¼˜è´¨è¯‘æ–‡è¯·æŒç»­å…³æ³¨ [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)ã€[å®˜æ–¹å¾®åš](http://weibo.com/juejinfanyi)ã€[çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/juejinfanyi)ã€‚
