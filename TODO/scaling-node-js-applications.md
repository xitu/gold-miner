
> * åŸæ–‡åœ°å€ï¼š[Scaling Node.js Applications](https://medium.freecodecamp.org/scaling-node-js-applications-8492bd8afadc)
> * åŸæ–‡ä½œè€…ï¼š[Samer Buna](https://medium.freecodecamp.org/@samerbuna)
> * è¯‘æ–‡å‡ºè‡ªï¼š[æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)
> * æœ¬æ–‡æ°¸ä¹…é“¾æ¥ï¼š[https://github.com/xitu/gold-miner/blob/master/TODO/scaling-node-js-applications.md](https://github.com/xitu/gold-miner/blob/master/TODO/scaling-node-js-applications.md)
> * è¯‘è€…ï¼š[mnikn](http://github.com/mnikn)
> * æ ¡å¯¹è€…ï¼š[shawnchenxmu](https://github.com/shawnchenxmu)ï¼Œ[reid3290](https://github.com/reid3290)

# æ‰©å±• Node.js åº”ç”¨

## ä½ åº”è¯¥çŸ¥é“çš„åœ¨ Node.js å†…ç½®æ¨¡å—çš„åº”ç”¨äºæ‰©å±•çš„å·¥å…·

![](https://cdn-images-1.medium.com/max/2000/1*5zOn0-deg1nQ5YzxUFGCPA.png)

æ¥è‡ª Pluralsight è¯¾ç¨‹ä¸­çš„æˆªå›¾ - Node.js è¿›é˜¶

å¯æ‰©å±•æ€§åœ¨ Node.js å¹¶ä¸æ˜¯äº‹åæ·»åŠ çš„æ¦‚å¿µï¼Œè¿™ä¸€æ¦‚å¿µåœ¨å‰æœŸå°±å·²ç»ä½“ç°å‡ºå…¶æ ¸å¿ƒåœ°ä½ã€‚Node ä¹‹æ‰€ä»¥è¢«å‘½åä¸º Node çš„åŸå› å°±æ˜¯å¼ºè°ƒä¸€ä¸ªæƒ³æ³•ï¼šæ¯ä¸€ä¸ª Node åº”ç”¨åº”è¯¥ç”±å¤šä¸ªå°å‹çš„åˆ†æ•£ **Node åº”ç”¨**ç›¸äº’è”ç³»æ¥æ„æˆã€‚

ä½ æ›¾ç»åœ¨ä½ çš„ Node åº”ç”¨ä¸Šè¿è¡Œå¤šä¸ª Node åº”ç”¨å—ï¼Ÿä½ æ›¾ç»è¯•è¿‡è®©ç”Ÿäº§ç¯å¢ƒä¸Šçš„æœºå™¨çš„æ¯ä¸ª CPU è¿è¡Œä¸€ä¸ª Node ç¨‹åºï¼Œå¹¶ä¸”å¯¹æ‰€æœ‰çš„è¯·æ±‚è¿›è¡Œè´Ÿè½½å‡è¡¡å¤„ç†å—ï¼Ÿä½ çŸ¥é“ Node æœ‰ä¸€ä¸ªå†…ç½®æ¨¡å—èƒ½åšä¸Šè¿°äº‹æƒ…å—ï¼Ÿ

Node çš„ **cluster** æ¨¡å—ä¸åªæ˜¯æä¾›ä¸€ä¸ªé»‘ç®±çš„è§£å†³æ–¹æ¡ˆæ¥å……åˆ†åˆ©ç”¨æœºå™¨ä¸­çš„ CPUï¼ŒåŒæ—¶å®ƒä¹Ÿèƒ½å¸®åŠ©ä½ æé«˜ Node åº”ç”¨çš„å¯ç”¨æ€§ï¼Œæä¾›ä¸€ä¸ªç¬æ—¶é‡å¯æ•´ä¸ªåº”ç”¨çš„é€‰é¡¹ï¼Œè¿™ç¯‡æ–‡ç« å°†é˜è¿°å…¶ä¸­çš„æ‰€æœ‰å¥½å¤„ã€‚

> è¿™ç¯‡æ–‡ç« æ˜¯ [Pluralsight Node.js è¯¾ç¨‹](https://www.pluralsight.com/courses/nodejs-advanced) ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»è§†é¢‘ä¸­æ•´ç†å‡ºäº†ç›¸å…³çš„å†…å®¹ã€‚

### å®ç°æ‰©å±•çš„ç­–ç•¥

æˆ‘ä»¬æ‰©å±•ä¸€ä¸ªåº”ç”¨çš„æœ€ä¸»è¦çš„åŸå› æ˜¯åº”ç”¨çš„è´Ÿè½½ï¼Œä½†æ˜¯ä¸åªæ˜¯è¿™ä¸€ä¸ªåŸå› ã€‚æˆ‘ä»¬åŒæ—¶é€šè¿‡è®©åº”ç”¨å…·å¤‡å¯æ‰©å±•æ€§æ¥æé«˜åº”ç”¨çš„å¯ç”¨æ€§å’Œå®¹é”™æ€§ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‰ç§ä¸»æµçš„æ–¹å¼æ¥æ‹“å±•åº”ç”¨ï¼š

#### 1â€Šâ€”â€Šå…‹éš†

æ‰©å±•ä¸€ä¸ªå¤§å‹åº”ç”¨æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯å¤šæ¬¡å…‹éš†å®ƒï¼Œå¹¶è®©æ¯ä¸€ä¸ªå…‹éš†å®ä¾‹å¤„ç†ä¸€éƒ¨åˆ†å·¥ä½œï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨ï¼‰ã€‚è¿™ç§åšæ³•ä¸ä¼šå ç”¨å¼€å‘å‘¨æœŸå¤ªå¤šæ—¶é—´ï¼Œå¹¶ä¸”çœŸçš„å¾ˆç®¡ç”¨ã€‚æƒ³è¦åœ¨æœ€ä½é™åº¦ä¸Šå®ç°æ‰©å±•ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼ŒNode.js æœ‰ä¸ªå†…ç½®æ¨¡å— `cluster` æ¥è®©ä½ åœ¨ä¸€ä¸ªå•ä¸€çš„æœåŠ¡å™¨ä¸Šæ›´ç®€å•åœ°å®ç°å…‹éš†æ–¹æ³•ã€‚

#### 2â€Šâ€”â€Šåˆ†è§£

åŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ [åˆ†è§£](https://builttoadapt.io/whats-your-decomposition-strategy-e19b8e72ac8f) æ¥æ‰©å±•ä¸€ä¸ªåº”ç”¨ï¼Œè¿™ç§æ–¹æ³•å–å†³äºåº”ç”¨çš„å‡½æ•°å’ŒæœåŠ¡ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬æœ‰å¤šä¸ªä¸åŒçš„åº”ç”¨ï¼Œå„æœ‰ç€ä¸åŒçš„åŸºæ¶ä»£ç ï¼Œæœ‰æ—¶è¿˜ä¼šæœ‰å…¶ç‹¬è‡ªçš„æ•°æ®åº“å’Œç”¨æˆ·æ¥å£ã€‚

è¿™ä¸ªç­–ç•¥ä¸€èˆ¬å’Œ**å¾®æœåŠ¡**è”ç³»åœ¨ä¸€èµ·ï¼Œå…¶ä¸­çš„å¾®æ˜¯æŒ‡æ¯ä¸ªæœåŠ¡åº”è¯¥è¶Šå°è¶Šå¥½ï¼Œä½†å®é™…ä¸Šï¼ŒæœåŠ¡çš„è§„æ¨¡æ— å…³ç´§è¦ï¼Œä¸ºçš„æ˜¯å¼ºè¿«äººä»¬è§£è€¦å’Œè®©æœåŠ¡ä¹‹é—´é«˜å†…èšã€‚å®ç°è¿™ä¸ªç­–ç•¥å¹¶ä¸å®¹æ˜“ï¼Œå¹¶æœ‰å¯èƒ½å¸¦æ¥ä¸€ç³»åˆ—é¢„æƒ³ä¸åˆ°çš„é—®é¢˜ï¼Œä½†æ˜¯å…¶ç›Šå¤„ä¹Ÿæ˜¯å¾ˆæ˜¾è‘—çš„ã€‚

#### 3â€Šâ€”â€Šåˆ†ç¦»

æˆ‘ä»¬åŒæ—¶ä¹Ÿå¯ä»¥æŠŠåº”ç”¨åˆ†æˆå¤šä¸ªå®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹åªè´Ÿè´£åº”ç”¨çš„ä¸€éƒ¨åˆ†æ•°æ®ã€‚è¿™ä¸ªæ–¹æ³•åœ¨æ•°æ®åº“é¢†åŸŸå†…é€šå¸¸è¢«ç§°ä¸º**æ¨ªå‘åˆ†å‰²**æˆ–**ç¢ç‰‡åŒ–**ã€‚æ•°æ®åˆ†å‰²è¦æ±‚æ¯ä¸€æ­¥æ“ä½œå‰éƒ½éœ€è¦æŸ¥æ‰¾å½“å‰åœ¨ä½¿ç”¨å“ªä¸€ä¸ªå®ä¾‹ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä¹Ÿè®¸æƒ³è¦æ ¹æ®ç”¨æˆ·æ‰€åœ¨çš„å›½å®¶æˆ–è€…æ‰€ç”¨çš„è¯­è¨€è¿›è¡Œåˆ†åŒºï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦æŸ¥æ‰¾ç›¸å…³ä¿¡æ¯ã€‚

æˆåŠŸæ‰©å±•ä¸€ä¸ªå¤§å‹åº”ç”¨æœ€ç»ˆåº”è¯¥å®ç°è¿™ä¸‰ä¸ªç­–ç•¥ã€‚Node.js è®©è¿™ä¸€åˆ‡å˜å¾—ç®€å•ï¼Œå› æ­¤è¿™ç¯‡æ–‡ç« æˆ‘å°†ä¼šæŠŠæ³¨æ„åŠ›é›†ä¸­åœ¨å…‹éš†ç­–ç•¥ä¸Šï¼Œçœ‹çœ‹ Node.js æœ‰ä»€ä¹ˆå¯ç”¨çš„å†…ç½®å·¥å…·æ¥å®ç°è¿™ä¸ªç­–ç•¥ã€‚

è¯·æ³¨æ„åˆ°åœ¨è¯»è¿™ç¯‡æ–‡ç« å‰ä½ éœ€è¦ç†è§£å¥½ Node.js çš„**å­è¿›ç¨‹**ã€‚å¦‚æœä½ ä¸å¤ªäº†è§£ï¼Œæˆ‘å»ºè®®ä½ å¯ä»¥å…ˆè¯»è¿™ç¯‡æ–‡ç« ï¼š

[![](https://ws4.sinaimg.cn/large/006tNc79ly1fhzggwsiaej31400a6jsm.jpg)](https://medium.freecodecamp.org/node-js-child-processes-everything-you-need-to-know-e69498fe970a)

### cluster æ¨¡å—

æƒ³è¦åœ¨åŒä¸€ç¯å¢ƒä¸‹å¤šä¸ª CPU çš„æƒ…å†µå¼€å¯è´Ÿè½½å‡è¡¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ cluster æ¨¡å—ã€‚è¿™åŸºäºå­è¿›ç¨‹æ¨¡å—çš„ `fork` æ–¹æ³•ï¼ŒåŸºæœ¬ä¸Šå®ƒå…è®¸æˆ‘ä»¬å¤šæ¬¡ fork ä¸»åº”ç”¨å¹¶ç”¨åœ¨å¤šä¸ª CPU ä¸Šã€‚ç„¶åå®ƒæ¥ç®¡æ‰€æœ‰çš„å­è¿›ç¨‹ï¼Œå¹¶å°†æ‰€æœ‰å¯¹ä¸»è¿›ç¨‹çš„è¯·æ±‚è´Ÿè½½å‡è¡¡åˆ°å­è¿›ç¨‹ä¸­å»ã€‚

Node.js çš„ cluster æ¨¡å—å¸®åŠ©æˆ‘ä»¬å®ç°å¯æ‹“å±•æ€§å…‹éš†ç­–ç•¥ï¼Œä½†æ˜¯è¿™åªé€‚ç”¨äºåœ¨åªæœ‰ä¸€å°æœåŠ¡å™¨ä¸Šçš„æƒ…å†µã€‚å¦‚æœä½ æœ‰ä¸€å°å¯ä»¥å‚¨å­˜ç€å¤§é‡çš„èµ„æºçš„æœåŠ¡å™¨ï¼Œæˆ–è€…åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šæ·»åŠ èµ„æºæ¯”å¢æ·»æ–°æœåŠ¡å™¨æ›´å®¹æ˜“å’Œä¾¿å®œæ—¶ï¼Œé‡‡ç”¨ cluster æ¨¡å—æ¥å¿«é€Ÿæ‰§è¡Œå…‹éš†ç­–ç•¥æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚

å³ä½¿æ˜¯ä¸€ä¸ªå°å‹çš„æœåŠ¡å™¨é€šå¸¸ä¹Ÿä¼šæœ‰å¤šä¸ªå†…æ ¸ï¼Œç”šè‡³å¦‚æœä½ ä¸æ‹…å¿ƒ Node æœåŠ¡å™¨è´Ÿè½½è¿‡é‡çš„è¯ï¼Œå¯ä»¥ä»»æ„å¼€å¯ cluster æ¨¡å—æ¥æé«˜æœåŠ¡å™¨çš„å¯ç”¨æ€§å’Œå®¹é”™æ€§ã€‚æ‰§è¡Œè¿™ä¸€æ­¥æ“ä½œå¾ˆç®€å•ï¼Œå½“ä½ ä½¿ç”¨åƒ PM2 è¿™æ ·çš„è¿›ç¨‹ç®¡ç†å™¨ï¼Œä½ è¦åšçš„å°±åªæ˜¯ç®€å•åœ°ç»™å¯åŠ¨å‘½ä»¤æä¾›ä¸€ä¸ªå‚æ•°è€Œå·²ï¼

æ¥ç€è®©æˆ‘æ¥è·Ÿä½ è®²è®²è¯¥å¦‚ä½•ä½¿ç”¨åŸç”Ÿçš„ cluster æ¨¡å—ï¼Œå¹¶ä¸”æˆ‘ä¼šè§£é‡Šå®ƒæ˜¯æ€ä¹ˆå·¥ä½œçš„ã€‚

cluster æ¨¡å—çš„ç»“æ„å¾ˆç®€å•ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª **master** è¿›ç¨‹ï¼Œå¹¶ä¸”è®©è¿™ä¸ª master è¿›ç¨‹ fork å¤šä¸ª **worker** è¿›ç¨‹å¹¶ç®¡ç†å®ƒä»¬ï¼Œæ¯ä¸€ä¸ª worker è¿›ç¨‹ä»£è¡¨éœ€è¦å¯æ‹“å±•çš„åº”ç”¨çš„å®ä¾‹ã€‚æ‰€æœ‰è¯·æ±‚éƒ½ç”± master è¿›ç¨‹å¤„ç†ï¼Œè¿™ä¸ªè¿›ç¨‹ä¼šç»™æ¯ä¸ª worker è¿›ç¨‹åˆ†é…å…¶ä¸­ä¸€éƒ¨åˆ†éœ€è¦å¤„ç†çš„è¯·æ±‚ã€‚

![](https://cdn-images-1.medium.com/max/2000/1*C7ICI8d7aAna_zTZvZ64MA.png)

Pluralsight è¯¾ç¨‹ä¸Šçš„æˆªå›¾â€Šâ€”â€ŠNode.js è¿›é˜¶

master è¿›ç¨‹çš„å·¥ä½œå¾ˆç®€å•ï¼Œå®é™…ä¸Šå®ƒåªæ˜¯ä½¿ç”¨**è½®æ›¿**ç®—æ³•æ¥æŒ‘é€‰ worker è¿›ç¨‹ã€‚é™¤äº† Windows ä»¥å¤–çš„æ“ä½œç³»ç»Ÿéƒ½é»˜è®¤å¼€å¯äº†è¿™ä¸ªç®—æ³•ï¼Œå¹¶ä¸”å®ƒèƒ½é€šè¿‡å…¨å±€ä¿®æ”¹æ¥è®©æ“ä½œç³»ç»Ÿæœ¬èº«æ¥å¤„ç†è´Ÿè½½å‡è¡¡ã€‚

è½®æ›¿ç®—æ³•è®©è´Ÿè½½è½®æµåœ°å‡åŒ€åˆ†å¸ƒåœ¨å¯ç”¨è¿›ç¨‹ã€‚ç¬¬ä¸€ä¸ªè¯·æ±‚ä¼šæŒ‡å‘ç¬¬ä¸€ä¸ª worker è¿›ç¨‹ï¼Œç¬¬äºŒä¸ªè¯·æ±‚æŒ‡å‘åˆ—è¡¨ä¸Šçš„ä¸‹ä¸€ä¸ªè¿›ç¨‹ï¼Œä»¥æ­¤ç±»æ¨ã€‚å½“åˆ—è¡¨å·²ç»éå†å®Œï¼Œç®—æ³•ä¼šä»å¤´å¼€å§‹ã€‚

è¿™æ˜¯å…¶ä¸­ä¸€ç§æœ€ç®€æ˜“å¹¶ä¸”ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯åªæœ‰è¿™ä¸€ä¸ªã€‚è¿˜æœ‰å¾ˆå¤šå„å…·ç‰¹è‰²çš„ç®—æ³•èƒ½åˆ†é…ä¼˜å…ˆçº§å’ŒæŠ½é€‰è´Ÿè½½æœ€å°æˆ–è€…å“åº”é€Ÿåº¦æœ€å¿«çš„æœåŠ¡å™¨ã€‚

#### HTTP æœåŠ¡å™¨ä¸Šçš„è´Ÿè½½å‡è¡¡

è®©æˆ‘ä»¬å…‹éš†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨å¹¶é€šè¿‡ cluster æ¨¡å—å®ç°è´Ÿè½½å‡è¡¡ã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ Node hello-word ä¾‹å­ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹è®©å®ƒæ¨¡æ‹Ÿå“åº”å‰çš„ CPU å·¥ä½œã€‚

    // server.js

    const http = require('http');
    const pid = process.pid;

    http.createServer((req, res) => {
      for (let i=0; i<1e7; i++); // simulate CPU work
      res.end(`Handled by process ${pid}`);
    }).listen(8080, () => {
      console.log(`Started process ${pid}`);
    });

ä¸ºäº†æ£€éªŒè´Ÿè½½å‡è¡¡å™¨æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€äº›ä¸œè¥¿æ¥è®©å®ƒå·¥ä½œï¼Œæˆ‘å·²ç»åœ¨ HTTP å“åº”ä¸­å¼•è¿›äº†ç¨‹åº `pid` æ¥è¯†åˆ«ç›®å‰æ­£åœ¨å¤„ç†è¯·æ±‚çš„åº”ç”¨çš„å®ä¾‹ã€‚

åœ¨æˆ‘ä»¬ä½¿ç”¨ cluster æ¨¡å—æŠŠæœåŠ¡å™¨ä¸­çš„ä¸»è¿›ç¨‹å…‹éš†æˆå¤šä¸ª worker è¿›ç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬åº”è¯¥å…ˆè°ƒæŸ¥ä¸‹æœåŠ¡å™¨æ¯ç§’èƒ½å¤Ÿå¤„ç†å¤šå°‘ä¸ªè¯·æ±‚ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ [Apache åŸºå‡†æµ‹è¯•å·¥å…·](https://httpd.apache.org/docs/2.4/programs/ab.html) æ¥åšè¿™ä»¶äº‹ã€‚åœ¨è¿è¡Œ `server.js` ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ‰§è¡Œ `ab` å‘½ä»¤ï¼š

    ab -c200 -t10 http://localhost:8080/

è¿™ä¸ªå‘½ä»¤ä¼šåœ¨ 10 ç§’å†…å‘èµ· 200 ä¸ªå¹¶å‘è¿æ¥æ¥æµ‹è¯•æœåŠ¡å™¨çš„è´Ÿè½½æ€§èƒ½ã€‚

![](https://cdn-images-1.medium.com/max/2000/1*w8VmzV81atlTzHn7pDXu1g.png)

æ¥è‡ª Pluralsight è¯¾ç¨‹ä¸­çš„æˆªå›¾â€Šâ€”â€ŠNode.js è¿›é˜¶

åœ¨æˆ‘çš„æœåŠ¡å™¨ä¸Šï¼Œå•ç‹¬ä¸€ä¸ª node æœåŠ¡å™¨æ¯ç§’å¯ä»¥å¤„ç† 51 ä¸ªè¯·æ±‚ã€‚å½“ç„¶ï¼Œç»“æœä¼šéšç€å¹³å°çš„ä¸åŒè€Œæœ‰æ‰€å˜åŒ–ï¼Œè¿™åªæ˜¯ä¸€ä¸ªéå¸¸ç®€åŒ–çš„æ€§èƒ½æµ‹è¯•ï¼Œå¹¶ä¸èƒ½ä¿è¯ç»“æœ 100% å‡†ç¡®ï¼Œä½†æ˜¯å®ƒå°†ä¼šæ¸…æ™°åœ°æ˜¾ç¤º cluster æ¨¡å—ç»™å¤šæ ¸çš„åº”ç”¨ç¯å¢ƒæ‰€å¸¦æ¥çš„ä¸åŒã€‚

æ—¢ç„¶æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå‚ç…§çš„åŸºå‡†ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ cluster æ¨¡å—æ¥å®ç°å…‹éš†ç­–ç•¥ï¼Œä»¥æ­¤æ¥æ‹“å±•ä¸€ä¸ªåº”ç”¨çš„è§„æ¨¡ã€‚

åœ¨ `server.js` çš„åŒçº§ç›®å½•ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªåå« `cluster.js` çš„æ–°æ–‡ä»¶ï¼Œç”¨æ¥æä¾› master è¿›ç¨‹ï¼š

    // cluster.js

    const cluster = require('cluster');
    const os = require('os');

    if (cluster.isMaster) {
      const cpus = os.cpus().length;

      console.log(`Forking for ${cpus} CPUs`);
      for (let i = 0; i<cpus; i++) {
        cluster.fork();
      }
    } else {
      require('./server');
    }

åœ¨ `cluster.js` æ–‡ä»¶é‡Œï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥ `cluster` å’Œ `os` æ¨¡å—ï¼Œæˆ‘ä»¬éœ€è¦ `os` æ¨¡å—é‡Œçš„  `os.cpus()` æ–¹æ³•æ¥å¾—åˆ° CPU çš„æ•°é‡ã€‚

`cluster` æ¨¡å—ç»™äº†æˆ‘ä»¬ä¸€ä¸ªä¾¿åˆ©çš„ Boolean å‚æ•° `isMaster` æ¥ç¡®å®š `cluster.js` æ˜¯å¦æ­£åœ¨è¢« master è¿›ç¨‹è¯»å–ã€‚å½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡æ‰§è¡Œè¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œæˆ‘ä»¬ä¼šæ‰§è¡Œåœ¨ master è¿›ç¨‹ä¸Šï¼Œå› æ­¤ `isMaster` ä¸º  trueã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è®© master è¿›ç¨‹å¤šæ¬¡ fork æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼Œç›´åˆ° fork çš„æ¬¡æ•°è¾¾åˆ° CPU çš„æ•°é‡ã€‚

ç°åœ¨æˆ‘ä»¬åªæ˜¯é€šè¿‡ `os` æ¨¡å—æ¥è¯»å– CPU çš„æ•°é‡ï¼Œç„¶åå¯¹è¿™ä¸ªæ•°å­—è¿›è¡Œä¸€ä¸ª for å¾ªç¯ï¼Œåœ¨å¾ªç¯å†…éƒ¨è°ƒç”¨ `cluster.fork` æ–¹æ³•ã€‚for å¾ªç¯å°†ä¼šç®€å•åœ°åˆ›å»ºå’Œ CPU æ•°é‡ä¸€æ ·å¤šçš„ worker è¿›ç¨‹ï¼Œä»¥æ­¤æ¥å……åˆ†åˆ©ç”¨æœåŠ¡å™¨å¯ç”¨çš„è®¡ç®—èƒ½åŠ›ã€‚

å½“ `cluster.fork` è¿™ä¸€è¡Œåœ¨ master è¿›ç¨‹ä¸­è¢«æ‰§è¡Œæ—¶ï¼Œå½“å‰çš„ `cluster.js` æ–‡ä»¶ä¼šå†è¿è¡Œä¸€æ¬¡ï¼Œä½†æ˜¯è¿™ä¸€æ¬¡æ˜¯åœ¨ **worker è¿›ç¨‹**ï¼Œå…¶ä¸­çš„ `isMaster` å‚æ•°ä¸º falseã€‚**å®é™…ä¸Šåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦å¤–ä¸€ä¸ªå‚æ•°å°†ä¸º trueï¼Œè¿™ä¸ªå‚æ•°æ˜¯ `isWorker` å‚æ•°**ã€‚

å½“åº”ç”¨è¿è¡Œåœ¨ worker è¿›ç¨‹ä¸Šï¼Œå®ƒå¼€å§‹åšå®é™…çš„å·¥ä½œã€‚æˆ‘ä»¬å°±åœ¨è¿™é‡Œå®šä¹‰æœåŠ¡å™¨çš„ä¸šåŠ¡é€»è¾‘ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¯·æ±‚å·²ç»æœ‰çš„ `server.js` æ–‡ä»¶æ¥å®ç°ä¸šåŠ¡é€»è¾‘ã€‚

åŸºæœ¬å°±æ˜¯è¿™æ ·äº†ã€‚è¿™æ ·å°±èƒ½ç®€å•åœ°å……åˆ†åˆ©ç”¨æœåŠ¡å™¨çš„è®¡ç®—èƒ½åŠ›ã€‚æƒ³è¦æµ‹è¯• clusterï¼Œè¿è¡Œ `cluster.js` æ–‡ä»¶ï¼š
![](https://cdn-images-1.medium.com/max/1600/1*c0S-W4GYgCGB_maJ94ZLPw.png)

æ¥è‡ª Pluralsight è¯¾ç¨‹ä¸­çš„æˆªå›¾â€Šâ€”â€ŠNode.js è¿›é˜¶

æˆ‘çš„æœåŠ¡å™¨æœ‰ 8 æ ¸å› æ­¤æˆ‘è¦å¼€å¯ 8 ä¸ªè¿›ç¨‹ã€‚å…¶ä¸­é‡è¦çš„æ˜¯è¦ç†è§£å®ƒä»¬å’Œ Node.js é‡Œçš„è¿›ç¨‹å®Œå…¨ä¸åŒã€‚æ¯ä¸ª worker è¿›ç¨‹æœ‰å…¶ç‹¬è‡ªçš„äº‹ä»¶å¾ªç¯å’Œå†…å­˜ç©ºé—´ã€‚

å½“æˆ‘ä»¬å¤šæ¬¡è¯·æ±‚ç½‘ç»œæœåŠ¡å™¨ï¼Œè¿™äº›è¯·æ±‚å°†ä¼šç”±ä¸åŒçš„ worker è¿›ç¨‹å¤„ç†ï¼Œworker è¿›ç¨‹çš„ id ä¹Ÿå„ä¸ç›¸åŒã€‚åºåˆ—é‡Œçš„ worker è¿›ç¨‹ä¸ä¼šå‡†ç¡®åœ°è¿›è¡Œè½®æ¢ï¼Œå› ä¸º cluster æ¨¡å—åœ¨æŒ‘é€‰ä¸‹ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„ worker è¿›ç¨‹æ—¶è¿›è¡Œäº†ä¸€äº›ä¼˜åŒ–ï¼Œè´Ÿè½½ä¼šåˆ†å¸ƒåœ¨ä¸åŒçš„ worker è¿›ç¨‹ä¸­ã€‚

æˆ‘ä»¬åŒæ ·å¯ä»¥ä½¿ç”¨å…ˆå‰çš„ `ab` å‘½ä»¤æ¥æµ‹è¯• cluster ä¸­çš„è¿›ç¨‹çš„è´Ÿè½½ï¼š

![](https://cdn-images-1.medium.com/max/2000/1*5_EogHG-Egf2uAMOj9PmCA.png)

æ¥è‡ª Pluralsight è¯¾ç¨‹ä¸­çš„æˆªå›¾â€Šâ€”â€ŠNode.js è¿›é˜¶

åŒæ ·æ˜¯å•ç‹¬çš„ node æœåŠ¡å™¨ï¼Œåˆ›å»º cluster åæœåŠ¡å™¨æ¯ç§’èƒ½å¤Ÿå¤„ç† 181 ä¸ªè¯·æ±‚ï¼Œæ²¡ç”¨ cluster æ¨¡å—ä¹‹å‰æ¯ç§’åªèƒ½å¤„ç† 51 ä¸ªè¯·æ±‚ã€‚æˆ‘ä»¬åªæ˜¯å¢åŠ äº†å‡ è¡Œä»£ç ï¼Œåº”ç”¨çš„æ€§èƒ½å°±æé«˜äº† 3 å€ã€‚

#### å¹¿æ’­æ‰€æœ‰ Worker è¿›ç¨‹

master è¿›ç¨‹ä¸ worker è¿›ç¨‹ä¹‹é—´èƒ½å¤Ÿç®€å•åœ°è¿›è¡Œé€šä¿¡ï¼Œå› ä¸º cluster æ¨¡å—æœ‰ä¸ª `child_process.fork` çš„ apiï¼Œè¿™æ„å‘³ç€ master è¿›ç¨‹ä¸æ¯ä¸ª worker è¿›ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡æ˜¯å¯èƒ½çš„ã€‚

åŸºäº `server.js`/`cluster.js` çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ `cluster.workers` è·å–ä¸€ä¸ªåŒ…å«æ‰€æœ‰ worker å¯¹è±¡çš„åˆ—è¡¨ï¼Œè¯¥åˆ—è¡¨æŒæœ‰æ‰€æœ‰ worker çš„å¼•ç”¨ï¼Œå¹¶å¯ä»¥é€šè¿‡è¿™ä¸ªå¼•ç”¨æ¥è¯»å– worker çš„ä¿¡æ¯ã€‚æœ‰äº†è®© master è¿›ç¨‹å’Œ worker è¿›ç¨‹é€šä¿¡çš„æ–¹æ³•åï¼Œæƒ³è¦å¹¿æ’­æ¯ä¸ª worker è¿›ç¨‹ï¼Œæˆ‘ä»¬åªéœ€è¦ç®€å•åœ°éå†æ‰€æœ‰çš„ workerã€‚ä¾‹å¦‚ï¼š

    Object.values(cluster.workers).forEach(worker => {
      worker.send(`Hello Worker ${worker.id}`);
    });

é€šè¿‡ `Object.values` å¯ä»¥ä» `cluster.workers` å¯¹è±¡é‡Œç®€å•åœ°æ¥è·å–ä¸€ä¸ªåŒ…å«æ‰€æœ‰ worker çš„æ•°ç»„ã€‚ç„¶åå¯¹äºæ¯ä¸ª workerï¼Œæˆ‘ä»¬ä½¿ç”¨ `send` å‡½æ•°æ¥ä¼ é€’ä»»æ„æˆ‘ä»¬è¦ä¼ çš„å€¼ã€‚

åœ¨ä¸€ä¸ª worker æ–‡ä»¶é‡Œï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ `server.js` è¦è¯»å–ä» master è¿›ç¨‹ä¸­æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¨å±€ `process` å¯¹è±¡ä¸­ç»™ `message` äº‹ä»¶æ³¨å†Œä¸€ä¸ª handlerã€‚

    process.on('message', msg => {
      console.log(`Message from master: ${msg}`);
    });

å½“æˆ‘åœ¨ cluster/server ä¸Šæµ‹è¯•è¿™ä¸¤é¡¹æ–°åŠ çš„ä¸œè¥¿æ—¶æ‰€çœ‹åˆ°ï¼š

![](https://cdn-images-1.medium.com/max/2000/1*6XfoWiNKTCiDjqar7L5_xw.png)

æ¥è‡ª Pluralsight è¯¾ç¨‹ä¸­çš„æˆªå›¾â€Šâ€”â€ŠNode.js è¿›é˜¶

æ¯ä¸ª worker éƒ½æ”¶åˆ°äº†æ¥è‡ª master è¿›ç¨‹çš„æ¶ˆæ¯ã€‚**æ³¨æ„åˆ° worker çš„å¯åŠ¨æ˜¯ä¹±åºçš„ã€‚**

è¿™æ¬¡æˆ‘ä»¬è®©é€šä¿¡çš„å†…å®¹å˜å¾—æ›´å®é™…ä¸€ç‚¹ã€‚è¿™æ¬¡æˆ‘ä»¬æƒ³è¦æœåŠ¡å™¨è¿”å›æ•°æ®åº“ä¸­ç”¨æˆ·çš„æ•°é‡ã€‚æˆ‘ä»¬å°†ä¼šåˆ›å»ºä¸€ä¸ª mock å‡½æ•°æ¥è¿”å›æ•°æ®åº“ä¸­ç”¨æˆ·çš„æ•°é‡ï¼Œå¹¶ä¸”æ¯æ¬¡å½“å®ƒè¢«è°ƒç”¨æ—¶å¯¹è¿™ä¸ªå€¼è¿›è¡Œå¹³æ–¹å¤„ç†ï¼ˆç†æƒ³æƒ…å†µä¸‹çš„å¢é•¿ï¼‰ï¼š

    // **** æ¨¡æ‹Ÿ DB è°ƒç”¨
    const numberOfUsersInDB = function() {
      this.count = this.count || 5;
      this.count = this.count * this.count;
      return this.count;
    }
    // ****

æ¯æ¬¡ `numberOfUsersInDB` è¢«è°ƒç”¨ï¼Œæˆ‘ä»¬ä¼šå‡è®¾å·²ç»è¿æ¥æ•°æ®åº“ã€‚æˆ‘ä»¬æƒ³è¦é¿å…å¤šæ¬¡æ•°æ®åº“çš„è¯·æ±‚ï¼Œå› æ­¤æˆ‘ä»¬ä¼šæ ¹æ®ä¸€å®šæ—¶é—´å¯¹è°ƒç”¨è¿›è¡Œç¼“å­˜ï¼Œä¾‹å¦‚æ¯ 10 ç§’ç¼“å­˜ä¸€æ¬¡ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä»ç„¶ä¸æƒ³è®© 8 ä¸ª forked worker ä½¿ç”¨ç‹¬è‡ªçš„æ•°æ®åº“è¿æ¥å’Œæ¯ 10 ç§’å…³é—­ 8 ä¸ªæ•°æ®åº“è¿æ¥ã€‚æˆ‘ä»¬å¯ä»¥è®© master è¿›ç¨‹åªè¯·æ±‚ä¸€æ¬¡æ•°æ®åº“è¿æ¥ï¼Œç„¶åé€šè¿‡é€šä¿¡æ¥å£å‘Šè¯‰è¿™ 8 ä¸ª worker ç”¨æˆ·æ•°é‡çš„æœ€æ–°å€¼ã€‚

ä¾‹å¦‚ï¼Œåœ¨ master è¿›ç¨‹æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥éå†æ‰€æœ‰ worker æ¥å¹¿æ’­ç”¨æˆ·æ•°é‡çš„å€¼ï¼š

    // åœ¨ isMaster=true çš„çŠ¶æ€ä¸‹è¿›è¡Œ fork å¾ªç¯å

    const updateWorkers = () => {
      const usersCount = numberOfUsersInDB();
      Object.values(cluster.workers).forEach(worker => {
        worker.send({ usersCount });
      });
    };

    updateWorkers();
    setInterval(updateWorkers, 10000);

è¿™é‡Œç¬¬ä¸€æ¬¡æˆ‘ä»¬è°ƒç”¨äº† `updateWorkers`ï¼Œç„¶åé€šè¿‡ `setInterval` æ¯ 10 ç§’è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚è¿™æ ·çš„è¯ï¼Œæ¯ 10 ç§’æ‰€æœ‰çš„ worker ä¼šä»¥é€šä¿¡çš„å½¢å¼æ”¶åˆ°ç”¨æˆ·æ•°é‡çš„å€¼ï¼Œå¹¶ä¸”æˆ‘ä»¬åªéœ€è¦åˆ›å»ºä¸€æ¬¡æ•°æ®åº“è¿æ¥ã€‚

åœ¨æœåŠ¡ç«¯çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥ä»åŒæ ·çš„ `message` äº‹ä»¶ handler ä¸­æ‹¿åˆ° `usersCount` çš„å€¼ã€‚æˆ‘ä»¬ç®€å•åœ°ç”¨ä¸€ä¸ªæ¨¡å—å…¨å±€å˜é‡ç¼“å­˜è¿™ä¸ªå€¼ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨ä»»ä½•åœ°æ–¹éƒ½èƒ½ä½¿ç”¨å®ƒã€‚

ä¾‹å¦‚ï¼š

    const http = require('http');
    const pid = process.pid;

    let usersCount;
    
    http.createServer((req, res) => {
      for (let i=0; i<1e7; i++); // simulate CPU work
      res.write(`Handled by process ${pid}\n`);
      res.end(`Users: ${usersCount}`);
    }).listen(8080, () => {
      console.log(`Started process ${pid}`);
    });

    process.on('message', msg => {
      usersCount = msg.usersCount;
    });

ä¸Šé¢çš„ä»£ç è®© worker çš„ web æœåŠ¡å™¨ç”¨ç¼“å­˜çš„ `usersCount` è¿›è¡Œå“åº”ã€‚å¦‚æœä½ ç°åœ¨æµ‹è¯• cluster çš„ä»£ç ï¼Œå‰ 10 ç§’ä½ ä¼šä»æ‰€æœ‰çš„ worker é‡Œå¾—åˆ°ç”¨æˆ·æ•°é‡ä¸º â€œ25â€ï¼ˆåŒæ—¶åªåˆ›å»ºäº†ä¸€ä¸ªæ•°æ®åº“è¿æ¥ï¼‰ã€‚ç„¶å 10 ç§’è¿‡åï¼Œæ‰€æœ‰çš„ worker å¼€å§‹æŠ¥å‘Šå½“å‰çš„ç”¨æˆ·æ•°é‡ï¼Œ625ï¼ˆåŒæ ·åªåˆ›å»ºäº†ä¸€ä¸ªæ•°æ®åº“è¿æ¥ï¼‰ã€‚

å¾—åŠ›äº master è¿›ç¨‹å’Œ worker ä¹‹é—´é€šä¿¡çš„æ–¹æ³•çš„å­˜åœ¨ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåšåˆ°è¿™ä¸€åˆ‡ã€‚

#### æé«˜æœåŠ¡å™¨çš„å¯ç”¨æ€§

æˆ‘ä»¬åœ¨è¿è¡Œå•ç‹¬ä¸€ä¸ª Node åº”ç”¨çš„å®ä¾‹æ—¶æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å½“è¿™ä¸ªå®ä¾‹å´©æºƒæ—¶ï¼Œæˆ‘ä»¬å¿…é¡»é‡å¯æ•´ä¸ªåº”ç”¨ã€‚è¿™æ„å‘³ç€å´©æºƒåçš„é‡å¯ä¹‹é—´ä¼šå­˜åœ¨ä¸€ä¸ªæ—¶é—´å·®ï¼Œå³ä½¿æˆ‘ä»¬è®©è¿™é¡¹æ“ä½œè‡ªåŠ¨æ‰§è¡Œä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚

åŒç†å½“æœåŠ¡å™¨æƒ³è¦éƒ¨ç½²æ–°ä»£ç å°±å¿…é¡»é‡å¯ã€‚åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œä¸ºæ­¤æ‰€é€ æˆçš„æ—¶é—´å·®ä¼šå½±å“ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚

è€Œå¦‚æœæˆ‘ä»¬æœ‰å¤šä¸ªå®ä¾‹çš„è¯ï¼Œåªéœ€æ·»åŠ å¯¥å¯¥æ•°è¡Œä»£ç å°±å¯ä»¥æé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚

ä¸ºäº†åœ¨æœåŠ¡å™¨ä¸­æ¨¡æ‹Ÿéšæœºå´©æºƒï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ª timer æ¥è°ƒç”¨ `process.exit`ï¼Œè®©å®ƒéšæœºæ‰§è¡Œã€‚

    // åœ¨ server.js æ–‡ä»¶

    setTimeout(() => {
      process.exit(1) // éšæ—¶é€€å‡ºè¿›ç¨‹
    }, Math.random() * 10000);

å½“ä¸€ä¸ª worker è¿›ç¨‹å› å´©æºƒè€Œé€€å‡ºï¼Œ`cluster` å¯¹è±¡é‡Œçš„ `exit` äº‹ä»¶ä¼šé€šçŸ¥ master è¿›ç¨‹ã€‚æˆ‘ä»¬å¯ä»¥ç»™è¿™ä¸ªäº‹ä»¶æ³¨å†Œä¸€ä¸ª handlerï¼Œå¹¶ä¸”å½“å…¶ä»– worker è¿›ç¨‹è¿˜å­˜åœ¨æ—¶è®©å®ƒ fork ä¸€ä¸ªæ–°çš„ worker è¿›ç¨‹ã€‚

ä¾‹å¦‚ï¼š

    // åœ¨ isMaster=true çš„çŠ¶æ€ä¸‹è¿›è¡Œ fork å¾ªç¯å

    cluster.on('exit', (worker, code, signal) => {
      if (code !== 0 && !worker.exitedAfterDisconnect) {
        console.log(`Worker ${worker.id} crashed. ` +
                    'Starting a new worker...');
        cluster.fork();
      }
    });

è¿™é‡Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ª if æ¡ä»¶æ¥ä¿è¯ worker è¿›ç¨‹çœŸçš„å´©æºƒäº†è€Œä¸æ˜¯æ‰‹åŠ¨æ–­å¼€è¿æ¥æˆ–è€…è¢« master è¿›ç¨‹æ€æ­»äº†ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†å¤ªå¤šçš„èµ„æºè¶…å‡ºäº†è´Ÿè½½çš„ä¸Šé™ï¼Œå› æ­¤ master è¿›ç¨‹å†³å®šæ€æ­»ä¸€éƒ¨åˆ† workerã€‚å› æ­¤æˆ‘ä»¬è°ƒç”¨ `disconnect` æ–¹æ³•ç»™ä»»æ„ workerï¼Œè¿™æ · `exitedAfterDisconnect` flag å°±ä¼šè®¾ä¸º trueã€‚if è¯­å¥ä¼šä¿è¯ä¸ä¼šå› æ­¤è€Œ fork æ–°çš„ workerã€‚

å¦‚æœæˆ‘ä»¬å¸¦ç€ä¸Šé¢çš„ handler è¿è¡Œ clusterï¼ˆåŒæ—¶ `server.js` é‡Œæœ‰éšæœºçš„å´©æºƒçš„ä»£ç ï¼‰ï¼Œåœ¨éšæœºæ•°ç§’è¿‡åï¼Œworker ä¼šå¼€å§‹å´©æºƒï¼Œmaster è¿›ç¨‹ä¼šç«‹åˆ» fork æ–°çš„ worker æ¥æé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚ä½ åŒæ ·å¯ä»¥ç”¨ `ab` å‘½ä»¤æ¥è¡¡é‡å¯ç”¨æ€§ï¼Œçœ‹çœ‹æœåŠ¡å™¨æœ‰å¤šå°‘çš„è¯·æ±‚æ²¡æœ‰å¤„ç†ï¼ˆå› ä¸ºæœ‰ä¸€äº›è¯·æ±‚ä¼šä¸èµ°è¿åœ°é‡åˆ°æ— æ³•é¿å…çš„å´©æºƒï¼‰ã€‚

å½“æˆ‘æµ‹è¯•è¿™æ®µä»£ç ï¼Œ10 ç§’å†…è¯·æ±‚ 1800 æ¬¡ï¼Œå…¶ä¸­æœ‰ 200 æ¬¡å¹¶å‘è¯·æ±‚ï¼Œæœ€ååªæœ‰ 17 æ¬¡è¯·æ±‚å¤±è´¥ã€‚

![](https://cdn-images-1.medium.com/max/2000/1*B72o6QhsyiNnEQU5Wx20RQ.png)

æ¥è‡ª Pluralsight è¯¾ç¨‹ä¸­çš„æˆªå›¾â€Šâ€”â€ŠNode.js è¿›é˜¶

è¿™æœ‰ 99% ä»¥ä¸Šçš„å¯ç”¨æ€§ã€‚åªæ˜¯æ·»åŠ æ•°è¡Œä»£ç ï¼Œç°åœ¨æˆ‘ä»¬ä¸å†æ‹…å¿ƒè¿›ç¨‹å´©æºƒäº†ã€‚master å®ˆæŠ¤å°†ä¼šæ›¿æˆ‘ä»¬å…³æ³¨è¿™äº›è¿›ç¨‹çš„æƒ…å†µã€‚

#### ç¬æ—¶é‡å¯

é‚£å½“æˆ‘ä»¬æƒ³è¦éƒ¨ç½²æ–°ä»£ç ï¼Œè€Œä¸å¾—ä¸é‡å¯æ‰€æœ‰çš„ worker è¿›ç¨‹æ—¶è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ

æˆ‘ä»¬æœ‰å¤šä¸ªå®ä¾‹åœ¨è¿è¡Œï¼Œæ‰€ä»¥ä¸å…¶è®©å®ƒä»¬ä¸€èµ·é‡å¯ï¼Œä¸å¦‚æ¯æ¬¡åªé‡å¯ä¸€ä¸ªï¼Œè¿™æ ·çš„è¯å³ä½¿é‡å¯ä¹Ÿèƒ½ä¿è¯å…¶ä»–çš„ worker è¿›ç¨‹èƒ½å¤Ÿç»§ç»­å¤„ç†è¯·æ±‚ã€‚

ç”¨ cluster æ¨¡å—èƒ½ç®€å•åœ°å®ç°è¿™ä¸€æƒ³æ³•ã€‚å½“ master è¿›ç¨‹å¼€å§‹è¿è¡Œä¹‹åæˆ‘ä»¬å°±ä¸æƒ³é‡å¯å®ƒï¼Œæˆ‘ä»¬éœ€è¦æƒ³åŠæ³•ä¼ é€’é‡å¯ worker çš„æŒ‡ä»¤ç»™ master è¿›ç¨‹ã€‚åœ¨ Linux ç³»ç»Ÿä¸Šè¿™æ ·åšå¾ˆå®¹æ˜“å› ä¸ºæˆ‘ä»¬èƒ½ç›‘å¬ä¸€ä¸ªè¿›ç¨‹çš„ä¿¡å·åƒ `SIGUSR2`ï¼Œå½“ `kill` å‘½ä»¤é‡Œé¢å¸¦æœ‰è¿›ç¨‹ id å’Œä¿¡å·æ—¶è¿™ä¸ªç›‘å¬äº‹ä»¶å°†ä¼šè§¦å‘ï¼š

    // åœ¨ Node é‡Œé¢
    process.on('SIGUSR2', () => { ... });

    // è§¦å‘ä¿¡å·
    $ kill -SIGUSR2 PID

è¿™æ ·ï¼Œmaster è¿›ç¨‹ä¸ä¼šè¢«æ€æ­»ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿåœ¨é‡Œé¢è¿›è¡Œä¸€ç³»åˆ—æ“ä½œäº†ã€‚`SIGUSR2` ä¿¡å·é€‚åˆè¿™ç§æƒ…å†µï¼Œå› ä¸ºæˆ‘ä»¬è¦æ‰§è¡Œç”¨æˆ·æŒ‡ä»¤ã€‚å¦‚æœä½ æƒ³çŸ¥é“ä¸ºä»€ä¹ˆä¸ç”¨ `SIGUSR1`ï¼Œé‚£æ˜¯å› ä¸ºè¿™ä¸ªä¿¡å·ç”¨åœ¨ Node çš„è°ƒè¯•å™¨ä¸Šï¼Œæˆ‘ä»¬ä¸ºäº†é¿å…å†²çªæ‰€ä»¥ä¸ç”¨å®ƒã€‚

ä¸å¹¸çš„æ˜¯ï¼Œåœ¨ Windows é‡Œé¢çš„è¿›ç¨‹ä¸æ”¯æŒè¿™ä¸ªä¿¡å·ï¼Œæˆ‘ä»¬è¦æ‰¾å…¶ä»–æ–¹æ³•è®© master è¿›ç¨‹åšè¿™ä»¶äº‹ã€‚æœ‰å‡ ç§ä»£æ›¿æ–¹æ¡ˆã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ ‡å‡†è¾“å…¥æˆ–è€… socket è¾“å…¥ã€‚æˆ–è€…æˆ‘ä»¬å¯ä»¥ç›‘æ§ `process.id` æ–‡ä»¶çš„åˆ é™¤äº‹ä»¶ã€‚ä½†æ˜¯ä¸ºäº†è®©è¿™ä¸ªæ•™ç¨‹æ›´å®¹æ˜“ï¼Œæˆ‘ä»¬è¿˜æ˜¯å‡å®šæœåŠ¡å™¨è¿è¡Œåœ¨ Linux å¹³å°ä¸Šã€‚

åœ¨ Windows ä¸Š Node è¿è¡Œè‰¯å¥½ï¼Œä½†æ˜¯æˆ‘è®¤ä¸ºè®©ä½œä¸ºäº§å“çš„ Node åº”ç”¨åœ¨ Linux å¹³å°ä¸Šè¿è¡Œä¼šæ›´å®‰å…¨ã€‚è¿™å’Œ Node æœ¬èº«æ— å…³ï¼Œåªæ˜¯å› ä¸ºåœ¨ Linux ä¸Šæœ‰æ›´å¤šç¨³å®šçš„ç”Ÿäº§å·¥å…·ã€‚è¿™åªæ˜¯æˆ‘çš„ä¸ªäººè§è§£ï¼Œæœ€å¥½è¿˜æ˜¯æ ¹æ®è‡ªå·±çš„æƒ…å†µé€‰æ‹©å¹³å°ã€‚

**é¡ºå¸¦ä¸€æï¼Œåœ¨æœ€è¿‘çš„ Windows ç‰ˆæœ¬é‡Œï¼Œå®é™…ä¸Šä½ å¯ä»¥åœ¨é‡Œé¢ä½¿ç”¨ Linux å­ç³»ç»Ÿã€‚æˆ‘è‡ªå·±æµ‹è¯•è¿‡äº†ï¼Œæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«æ˜æ˜¾çš„ç¼ºç‚¹ã€‚å¦‚æœä½ åœ¨ Windows ä¸Šå¼€å‘ Node åº”ç”¨ï¼Œå¯ä»¥çœ‹çœ‹ [**Bash on Windows**](https://msdn.microsoft.com/en-us/commandline/wsl/about) å¹¶å°è¯•ä¸€ä¸‹ã€‚**

åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå½“ master è¿›ç¨‹æ”¶åˆ° `SIGUSR2` ä¿¡å·ï¼Œå°±æ„å‘³ç€æ˜¯æ—¶å€™é‡å¯ worker äº†ï¼Œä½†æ˜¯æˆ‘ä»¬æƒ³è¦æ¯æ¬¡åªé‡å¯ä¸€ä¸ª workerã€‚å› æ­¤ master è¿›ç¨‹åº”è¯¥ç­‰åˆ°å½“å‰çš„ worker å·²ç»é‡å¯å®Œåå†é‡å¯ä¸‹ä¸€ä¸ª workerã€‚

æˆ‘ä»¬éœ€è¦ç”¨ `cluster.workers` å¯¹è±¡æ¥å¾—åˆ°å½“å‰æ‰€æœ‰ worker çš„å¼•ç”¨ï¼Œç„¶åæˆ‘ä»¬ç®€å•åœ°æŠŠå®ƒå­˜è¿›ä¸€ä¸ªæ•°ç»„ä¸­ï¼š

    const workers = Object.values(cluster.workers);

ç„¶åï¼Œæˆ‘ä»¬åˆ›å»º `restartWorker` å‡½æ•°æ¥æ¥å—è¦é‡å¯çš„ worker çš„ indexã€‚è¿™æ ·å½“ä¸‹ä¸€ä¸ª worker å¯ä»¥é‡å¯æ—¶ï¼Œæˆ‘ä»¬è®©å‡½æ•°è°ƒç”¨å½“å‰ workerï¼Œç›´åˆ°æœ€åé‡å¯æ•´ä¸ªåºåˆ—é‡Œçš„ workerã€‚è¿™æ˜¯éœ€è¦è°ƒç”¨çš„ `restartWorker` å‡½æ•°ï¼ˆè§£é‡Šåœ¨åé¢ï¼‰ï¼š

    const restartWorker = (workerIndex) => {
      const worker = workers[workerIndex];
      if (!worker) return;

      worker.on('exit', () => {
        if (!worker.exitedAfterDisconnect) return;
        console.log(`Exited process ${worker.process.pid}`);

        cluster.fork().on('listening', () => {
          restartWorker(workerIndex + 1);
        });
      });

      worker.disconnect();
    };

    restartWorker(0);

åœ¨ `restartWorker` å‡½æ•°é‡Œé¢ï¼Œæˆ‘ä»¬å¾—åˆ°äº†è¦é‡å¯çš„ worker çš„å¼•ç”¨ï¼Œç„¶åæˆ‘ä»¬ä¼šæ ¹æ®åºåˆ—é€’å½’è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç»“æŸé€’å½’çš„æ¡ä»¶ã€‚å½“æ²¡æœ‰ worker éœ€è¦é‡å¯ï¼Œæˆ‘ä»¬å°±ç›´æ¥ returnã€‚åŸºæœ¬ä¸Šæˆ‘ä»¬æƒ³è®©è¿™ä¸ª worker æ–­å¼€è¿æ¥ï¼ˆä½¿ç”¨ `worker.disconnect`ï¼‰ï¼Œä½†æ˜¯åœ¨é‡å¯ä¸‹ä¸€ä¸ª worker ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ fork ä¸€ä¸ªæ–°çš„ worker æ¥ä»£æ›¿å½“å‰æ–­å¼€è¿æ¥çš„ workerã€‚

å½“ç›®å‰è¦æ–­å¼€è¿æ¥çš„ worker è¿˜å­˜åœ¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ worker æœ¬èº«çš„ `exit` äº‹ä»¶æ¥ fork ä¸€ä¸ªæ–°çš„ workerï¼Œä½†æ˜¯æˆ‘ä»¬è¦ç¡®ä¿åœ¨å¹³å¸¸çš„æ–­å¼€è¿æ¥è°ƒç”¨å exit åŠ¨ä½œå°±ä¼šè¢«è§¦å‘ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ `exitedAfetrDisconnect` flagï¼Œå¦‚æœ flag ä¸ä¸º trueï¼Œé‚£ä¹ˆæ˜¯å› ä¸ºå…¶ä»–åŸå› è€Œå¯¼è‡´çš„ exitï¼Œè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬ä»€ä¹ˆéƒ½ä¸åšå°±ç›´æ¥ returnã€‚ä½†æ˜¯å¦‚æœ flag ä¸º trueï¼Œæˆ‘ä»¬å°±ç»§ç»­æ‰§è¡Œä¸‹å»ï¼Œfork ä¸€ä¸ªæ–°çš„ worker æ¥ä»£æ›¿å½“å‰è¦æ–­å¼€è¿æ¥çš„é‚£ä¸ªã€‚

å½“æ–°çš„ fork worker è¿›ç¨‹å‡†å¤‡å¥½äº†ï¼Œæˆ‘ä»¬å°±è¦é‡å¯ä¸‹ä¸€ä¸ªã€‚ç„¶è€Œï¼Œè®°ä½ fork çš„è¿‡ç¨‹ä¸æ˜¯åŒæ­¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½åœ¨è°ƒç”¨å®Œ fork åå°±ç›´æ¥é‡å¯ä¸‹ä¸ª workerã€‚æˆ‘ä»¬è¦åœ¨æ–°çš„ fork worker ä¸Šç›‘å¬ `listening` äº‹ä»¶ï¼Œè¿™ä¸ªäº‹ä»¶å‘Šè¯‰æˆ‘ä»¬è¿™ä¸ª worker å·²ç»è¿æ¥å¹¶å‡†å¤‡å¥½äº†ã€‚å½“æˆ‘ä»¬è§¦å‘è¿™ä¸ªäº‹ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®‰å…¨åœ°é‡å¯ä¸‹ä¸ªåœ¨åºåˆ—é‡Œ worker äº†ã€‚

è¿™å°±æ˜¯æˆ‘ä»¬ä¸ºäº†å®ç°ç¬æ—¶é‡å¯è¦åšçš„ä¸œè¥¿ã€‚è¦æµ‹è¯•å®ƒï¼Œä½ è¦çŸ¥é“éœ€è¦å‘é€ `SIGUSR2` ä¿¡å·çš„ master è¿›ç¨‹çš„ idï¼š

    console.log(`Master PID: ${process.pid}`);

å¼€å¯ clusterï¼Œå¤åˆ¶ master è¿›ç¨‹çš„ idï¼Œç„¶åç”¨ `kill -SIGUSR2 PID` å‘½ä»¤é‡å¯ clusterã€‚åŒæ ·ä½ å¯ä»¥åœ¨é‡å¯ cluster æ—¶ç”¨ `ab` å‘½ä»¤æ¥çœ‹çœ‹é‡å¯æ—¶çš„å¯ç”¨æ€§ã€‚å‰§é€ä¸€ä¸‹ï¼Œæ²¡æœ‰è¯·æ±‚å¤±è´¥ï¼š

![](https://cdn-images-1.medium.com/max/2000/1*NjG0e2ARIDQiYSHWNvdNPQ.png)

æ¥è‡ª Pluralsight è¯¾ç¨‹ä¸­çš„æˆªå›¾â€Šâ€”â€ŠNode.js è¿›é˜¶

åƒ PM2 è¿™æ ·çš„è¿›ç¨‹ç›‘æ§å™¨ï¼Œæˆ‘ä¸ªäººæŠŠå®ƒç”¨åœ¨ç”Ÿäº§ç¯å¢ƒä¸Šï¼Œå®ƒè®©æˆ‘ä»¬å®ç°ä¸Šè¿°å·¥ä½œå˜å¾—å¼‚å¸¸ç®€å•ï¼ŒåŒæ—¶å®ƒè¿˜æœ‰è®¸å¤šåŠŸèƒ½æ¥ç›‘æ§ Node.js åº”ç”¨çš„å¥å£®åº¦ã€‚ä¾‹å¦‚ï¼Œç”¨ PM2ï¼Œæƒ³è¦åœ¨ä»»æ„åº”ç”¨ä¸Šå¯åŠ¨ clusterï¼Œä½ åªéœ€è¦ç”¨ `-i` å‚æ•°ï¼š

    pm2 start server.js -i max

æƒ³è¦ç¬æ—¶é‡å¯ä½ åªéœ€è¦ä½¿ç”¨è¿™ä¸ªç¥å¥‡çš„å‘½ä»¤ï¼š

    pm2 reload all

ç„¶è€Œï¼Œæˆ‘è§‰å¾—åœ¨ä½¿ç”¨è¿™äº›å‘½ä»¤ä¹‹å‰å…ˆç†è§£å…¶èƒŒåçš„å®ç°æ˜¯æœ‰å¸®åŠ©çš„ã€‚

#### å…±äº«çŠ¶æ€å’Œç²˜æ€§è´Ÿè½½å‡è¡¡

å¥½ä¸œè¥¿æ€»æ˜¯éœ€è¦ä»˜å‡ºä»£ä»·ã€‚å½“æˆ‘ä»¬å¯¹ä¸€ä¸ª Node åº”ç”¨è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œæˆ‘ä»¬ä¹Ÿå¤±å»äº†ä¸€äº›åªèƒ½åœ¨å•è¿›ç¨‹é€‚ç”¨çš„åŠŸèƒ½ã€‚è¿™ä¸ªé—®é¢˜åœ¨å…¶ä»–è¯­è¨€ä¸Šè¢«ç§°ä¸ºçº¿ç¨‹å®‰å…¨ï¼Œå®ƒå’Œåœ¨çº¿ç¨‹ä¹‹é—´å…±äº«æ•°æ®æœ‰å…³ã€‚åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œé—®é¢˜åˆ™åœ¨äºå¦‚ä½•åœ¨ worker è¿›ç¨‹ä¹‹é—´å…±äº«æ•°æ®ã€‚

ä¾‹å¦‚ï¼Œè®¾ç«‹äº† cluster åï¼Œæˆ‘ä»¬å°±ä¸èƒ½åœ¨å†…å­˜ä¸Šç¼“å­˜ä¸œè¥¿äº†ï¼Œå› ä¸ºæ¯ä¸ª worker æœ‰å…¶ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œå¦‚æœæˆ‘ä»¬åœ¨å…¶ä¸­ä¸€ä¸ª worker çš„å†…å­˜é‡Œç¼“å­˜ä¸œè¥¿ï¼Œå…¶ä»–çš„ worker å°±æ²¡åŠæ³•æ‹¿åˆ°å®ƒã€‚

å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨ cluster é‡Œç¼“å­˜ä¸œè¥¿ï¼Œæˆ‘ä»¬è¦ä»æ‰€æœ‰ worker é‚£é‡Œåˆ†ç¦»å®ä½“å’Œè¯»å–ï¼å†™å…¥å®ä½“çš„ APIã€‚å®ä½“è¦å­˜æ”¾åœ¨æ•°æ®åº“æœåŠ¡å™¨ï¼Œæˆ–è€…å¦‚æœä½ æƒ³ç”¨å†…å­˜æ¥ç¼“å­˜ï¼Œä½ å¯ä»¥ä½¿ç”¨åƒ Redis è¿™æ ·çš„æœåŠ¡å™¨ï¼Œæˆ–è€…åˆ›å»ºä¸€ä¸ªä¸“æ³¨äºè¯»å–ï¼å†™å…¥ API çš„ Node è¿›ç¨‹ä¾›æ‰€æœ‰ worker ä½¿ç”¨ã€‚

![](https://cdn-images-1.medium.com/max/2000/1*dIR_CAkmtPFgtaGTOKBFkA.png)

æ¥è‡ª Pluralsight è¯¾ç¨‹ä¸­çš„æˆªå›¾â€Šâ€”â€ŠNode.js è¿›é˜¶

è¿™ä¸ªåšæ³•æœ‰ä¸ªå¥½å¤„ï¼Œå½“ä½ çš„åº”ç”¨ä¸ºäº†ç¼“å­˜è€Œåˆ†ç¦»äº†å®ä½“ï¼Œå®é™…ä¸Šè¿™æ˜¯**åˆ†è§£**çš„ä¸€éƒ¨åˆ†ï¼Œèƒ½è®©ä½ çš„åº”ç”¨æ›´å…·å¯æ‹“å±•æ€§ã€‚å³ä½¿ä½ è¿è¡Œåœ¨ä¸€ä¸ªå•æ ¸æœåŠ¡å™¨ï¼Œä½ ä¹Ÿåº”è¯¥è¿™æ ·åšã€‚

é™¤äº†ç¼“å­˜å¤–ï¼Œå½“æˆ‘ä»¬è¿è¡Œ clusterï¼Œæ€»ä½“æ¥è¯´çŠ¶æ€ä¹‹é—´çš„äº¤æµæˆä¸ºäº†ä¸€ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬ä¸èƒ½ç¡®ä¿äº¤æµå‘ç”Ÿåœ¨åŒä¸€ä¸ª worker ä¸Šï¼Œå› æ­¤ä¸èƒ½åœ¨ä»»ä½•ä¸€ä¸ª worker ä¸Šåˆ›å»ºä¸€ä¸ªçŠ¶æ€ç›¸å…³çš„äº¤æµé€šé“ã€‚

ä¸€ä¸ªæœ€å¸¸è§çš„ä¾‹å­æ˜¯ç”¨æˆ·è®¤è¯ã€‚

![](https://cdn-images-1.medium.com/max/2000/1*jKAmrLPMer6_kmpIjyGzxA.png)

æ¥è‡ª Pluralsight è¯¾ç¨‹ä¸­çš„æˆªå›¾â€Šâ€”â€ŠNode.js è¿›é˜¶

ç”¨ clusterï¼ŒéªŒè¯çš„è¯·æ±‚åˆ†é…åˆ° master è¿›ç¨‹ï¼Œè€Œè¿™ä¸ªè¿›ç¨‹æŠŠè¯·æ±‚åˆ†é…ç»™ä¸€ä¸ª workerï¼Œå‡å®šåˆ†é…ç»™ Aã€‚

![](https://cdn-images-1.medium.com/max/2000/1*dNUlcuEXPkk44A63ct0s0g.png)

æ¥è‡ª Pluralsight è¯¾ç¨‹ä¸­çš„æˆªå›¾â€Šâ€”â€ŠNode.js è¿›é˜¶

ç°åœ¨ Worker A è®¤å‡ºäº†ç”¨æˆ·çš„çŠ¶æ€ã€‚ä½†æ˜¯ï¼Œå½“åŒæ ·çš„ç”¨æˆ·è¿›è¡Œå¦å¤–ä¸€ä¸ªè¯·æ±‚ï¼Œæœ€ç»ˆè´Ÿè½½å‡è¡¡å™¨ä¼šæŠŠå®ƒåˆ†é…ç»™å…¶ä»– workerï¼Œè€Œè¿™äº› worker è¿˜æ²¡æœ‰éªŒè¯è¿™ä¸ªç”¨æˆ·ã€‚åœ¨å•ç‹¬ä¸€ä¸ªå®ä¾‹çš„å†…å­˜ä¸ŠæŒæœ‰éªŒè¯ç”¨æˆ·çš„å¼•ç”¨å¹¶ä¸ç®¡ç”¨ã€‚

æœ‰å¾ˆå¤šæ–¹æ³•å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚é€šè¿‡åœ¨å…±äº«æ•°æ®åº“æˆ–è€… Redis node ä¸Šå¯¹ä¼šè¯ä¿¡æ¯è¿›è¡Œæ’åºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ worker ä¹‹é—´å…±äº«çŠ¶æ€ã€‚ç„¶è€Œï¼Œå®ç°è¿™ä¸ªç­–ç•¥éœ€è¦æ”¹å˜ä¸€äº›ä»£ç ï¼Œè¿™ä¸æ˜¯æœ€å¥½çš„æ–¹æ³•ã€‚

å¦‚æœä½ ä¸æƒ³ä¿®æ”¹ä»£ç å°±å®ç°ä¸€ä¸ªä¼šè¯çš„å…±äº«å­˜å‚¨ä»“åº“ï¼Œæœ‰ä¸ªå…¥ä¾µæ€§ä½ä½†æ•ˆç‡ä¸é«˜çš„ç­–ç•¥ã€‚ä½ å¯ä»¥ç”¨ç²˜æ€§è´Ÿè½½å‡è¡¡ã€‚å’Œè®©æ™®é€šçš„è´Ÿè½½å‡è¡¡å™¨å®ç°ä¸Šè¿°ç­–ç•¥ç›¸æ¯”ï¼Œå®ƒæ›´ä¸ºç®€å•ã€‚æƒ³æ³•å¾ˆç®€å•ï¼Œå½“ worker çš„å®ä¾‹è¦éªŒè¯ç”¨æˆ·ï¼Œæˆ‘ä»¬åœ¨è´Ÿè½½å‡è¡¡å™¨ä¸Šè®°å½•ç›¸å…³çš„å…³ç³»ã€‚

![](https://cdn-images-1.medium.com/max/2000/1*P4LNRLkZ9n_p8OKtmRM9LA.png)

æ¥è‡ª Pluralsight è¯¾ç¨‹ä¸­çš„æˆªå›¾â€Šâ€”â€ŠNode.js è¿›é˜¶

ç„¶åï¼Œå½“åŒæ ·çš„ç”¨æˆ·å‘é€æ–°çš„è¯·æ±‚ï¼Œæˆ‘ä»¬å°±æ£€æŸ¥è®°å½•ï¼Œå‘ç°æœåŠ¡å™¨é‡Œå·²ç»æœ‰éªŒè¯çš„ä¼šè¯ï¼Œç„¶åæŠŠè¿™ä¸ªä¼šè¯å‘é€ç»™æœåŠ¡å™¨ï¼Œè€Œä¸æ˜¯æ‰§è¡Œæ™®é€šçš„éªŒè¯æ“ä½œã€‚ç”¨è¿™ä¸ªæ–¹æ³•ä¸éœ€è¦æ”¹å˜æœåŠ¡å™¨é‡Œçš„ä»£ç ï¼Œä½†åŒæ—¶æˆ‘ä»¬ä¸ä¼šå¾—åˆ°ç”¨è´Ÿè½½å‡è¡¡å™¨æ¥éªŒè¯ç”¨æˆ·çš„å¥½å¤„ï¼Œæ‰€ä»¥åªæœ‰åˆ«æ— é€‰æ‹©æ—¶æ‰ç”¨ç²˜æ€§è´Ÿè½½å‡è¡¡ã€‚

å®é™…ä¸Š cluster æ¨¡å—å¹¶ä¸æ”¯æŒç²˜æ€§è´Ÿè½½å‡è¡¡ï¼Œä½†æ˜¯å¤§å¤šæ•°è´Ÿè½½å‡è¡¡å™¨å¯ä»¥é»˜è®¤è®¾ç½®ä¸ºç²˜æ€§è´Ÿè½½å‡è¡¡ã€‚

---

æ„Ÿè°¢é˜…è¯»ã€‚å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç‚¹å‡»ä¸‹é¢çš„ ğŸ’šã€‚å…³æ³¨æˆ‘æ¥å¾—åˆ°æ›´å¤šæœ‰å…³ Node.js å’Œ JavaScript çš„æ–‡ç« ã€‚

æˆ‘ä¸º [Pluralsight](https://app.pluralsight.com/profile/author/samer-buna) å’Œ [Lynda](https://www.lynda.com/Samer-Buna/7060467-1.html) åˆ›å»ºäº†**ç½‘ç»œè¯¾ç¨‹**ã€‚æœ€è¿‘æˆ‘çš„è¯¾ç¨‹æ˜¯ [Advanced React.js](https://www.pluralsight.com/courses/reactjs-advanced)ï¼Œ[Advanced Node.js](https://www.pluralsight.com/courses/nodejs-advanced) å’Œ [Learning Full-stack JavaScript](https://www.lynda.com/Express-js-tutorials/Learning-Full-Stack-JavaScript-Development-MongoDB-Node-React/533304-2.html)ã€‚

åŒæ—¶æˆ‘ä¹Ÿä¸º JavaScriptï¼ŒNode.jsï¼ŒReact.jsï¼Œå’Œ GraphQL çš„æ°´å¹³åœ¨åˆçº§ä¸è¿›é˜¶ä¹‹é—´çš„äººä»¬åˆ›å»ºäº†**åœ¨çº¿ training**ã€‚å¦‚æœä½ æƒ³è¦æ‰¾ä¸€ä½å¯¼å¸ˆï¼Œå¯ä»¥ [å‘é‚®ä»¶ç»™æˆ‘](mailto:samer@jscomplete.com)ã€‚å¦‚å¯¹è¿™ç¯‡æ–‡ç« æˆ–è€…å…¶ä»–æˆ‘å†™çš„æ–‡ç« æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·åœ¨ [è¿™ä¸ª **slack** ç”¨æˆ·](https://slack.jscomplete.com/) ä¸Šæ‰¾åˆ°æˆ‘å¹¶ä¸”åœ¨ #question ç©ºé—´ä¸Šæé—®ã€‚


---

> [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner) æ˜¯ä¸€ä¸ªç¿»è¯‘ä¼˜è´¨äº’è”ç½‘æŠ€æœ¯æ–‡ç« çš„ç¤¾åŒºï¼Œæ–‡ç« æ¥æºä¸º [æ˜é‡‘](https://juejin.im) ä¸Šçš„è‹±æ–‡åˆ†äº«æ–‡ç« ã€‚å†…å®¹è¦†ç›– [Android](https://github.com/xitu/gold-miner#android)ã€[iOS](https://github.com/xitu/gold-miner#ios)ã€[React](https://github.com/xitu/gold-miner#react)ã€[å‰ç«¯](https://github.com/xitu/gold-miner#å‰ç«¯)ã€[åç«¯](https://github.com/xitu/gold-miner#åç«¯)ã€[äº§å“](https://github.com/xitu/gold-miner#äº§å“)ã€[è®¾è®¡](https://github.com/xitu/gold-miner#è®¾è®¡) ç­‰é¢†åŸŸï¼Œæƒ³è¦æŸ¥çœ‹æ›´å¤šä¼˜è´¨è¯‘æ–‡è¯·æŒç»­å…³æ³¨ [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)ã€[å®˜æ–¹å¾®åš](http://weibo.com/juejinfanyi)ã€[çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/juejinfanyi)ã€‚
