> * åŸæ–‡åœ°å€ï¼š[On Performant Arrays in Swift](http://jordansmith.io/on-performant-arrays-in-swift/)
> * åŸæ–‡ä½œè€…ï¼š[JORDAN SMITH](http://jordansmith.io/)
> * è¯‘æ–‡å‡ºè‡ªï¼š[æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)
> * æœ¬æ–‡æ°¸ä¹…é“¾æ¥ï¼š[https://github.com/xitu/gold-miner/blob/master/TODO/on-performant-arrays-in-swift.md](https://github.com/xitu/gold-miner/blob/master/TODO/on-performant-arrays-in-swift.md)
> * è¯‘è€…ï¼š[jingzhilehuakai](https://github.com/jingzhilehuakai)
> * æ ¡å¯¹è€…ï¼š[RickeyBoy](https://github.com/RickeyBoy)  [cbangchen](https://github.com/cbangchen)

# Swift ä¸Šçš„é«˜æ€§èƒ½æ•°ç»„

å¯¹äºæ—¥å¸¸åº”ç”¨å¼€å‘ï¼Œè€ƒè™‘æ•°ç»„æ€§èƒ½æ˜¯ä¸€ä»¶ä¸ä¼šç»å¸¸å‘ç”Ÿçš„äº‹ã€‚å¦‚æœä½ æ­£åœ¨å®ç°éœ€è¦æ‰©å±•çš„ç®—æ³•ï¼Œä¹Ÿè®¸é«˜æ€§èƒ½æ•°ç»„å°±èƒ½å‡ºç°åœ¨ä½ è„‘æµ·ä¸­ã€‚ä¹Ÿè®¸ä½ æ­£åœ¨å†™æ›´åå‘äºåº•å±‚çš„ä»£ç ï¼Œæ¯”å¦‚ä¸€ä¸ªæ¡†æ¶ï¼Œè¿™æ—¶ä»»ä½•çš„æ€§èƒ½ç¼ºé™·éƒ½ä¼šäº§ç”Ÿå¤åˆæ•ˆåº”ã€‚å½“æ•°ç»„æ€§èƒ½å˜å¾—é‡è¦çš„æ—¶å€™ï¼Œäº†è§£ä¸€äº›ä¼˜åŒ–æ•°ç»„æ€§èƒ½çš„æ–¹å¼ä¹Ÿæ˜¯å¾ˆä¸é”™çš„ã€‚è®©æˆ‘ä»¬æ¥æ·±å…¥çš„äº†è§£ä¸€ä¸‹ Swift ä¸­çš„æ•°ç»„å§ã€‚

## è¿ç»­çš„æ•°ç»„

[`Array`](https://developer.apple.com/documentation/swift/array) ä¸æ˜¯ Swift å”¯ä¸€æä¾›çš„æ•°ç»„ç±»å‹ã€‚ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ° [`ArraySlice`](https://developer.apple.com/documentation/swift/arrayslice) ç±»å‹ï¼Œå®ƒèƒ½åœ¨ä¸å¤åˆ¶æ•°ç»„çš„æƒ…å†µä¸‹ï¼Œå±•ç¤ºå‡ºæ•°ç»„çš„å±€éƒ¨ç‰‡æ®µã€‚å¦å¤–è¿˜æœ‰ [`ContiguousArray`](https://developer.apple.com/documentation/swift/contiguousarray) ç±»å‹ã€‚å’Œåå­—æ‰€æš—ç¤ºçš„ä¸åŒï¼Œå®ƒå…¶å®æ˜¯ Swift ä¸­æœ€ç®€å•çš„æ•°ç»„ç±»å‹ã€‚ç›¸æ¯”æ ‡å‡†çš„æ•°ç»„ï¼Œå®ƒå¯ä»¥æœ‰æ›´å¥½çš„æ€§èƒ½è¡¨ç°ï¼Œè€Œå³ä¾¿æ²¡æœ‰ï¼Œä¹Ÿè‡³å°‘å¯ä»¥æä¾›ä¸ `Array` ç›¸åŒæ€§èƒ½æ°´å¹³çš„è¡¨ç°ã€‚åŒæ—¶ä¹Ÿæš´éœ²å‡ºç›¸åŒçš„æ¥å£ã€‚æ‰€ä»¥ï¼Œä¸ºä»€ä¹ˆä¸ç”¨ `ContiguousArray` å»æ›¿ä»£ `Array` å‘¢ï¼Ÿ

```
let deliciousArray = ContiguousArray<String>(arrayLiteral: "ğŸŒ®", "ğŸ¥", "ğŸ¥–")
```

å¥½å§ï¼Œå› ä¸º Objective-C çš„å…¼å®¹æ€§ï¼Œ`Array` èƒ½æ— ç¼å¯¹æ¥æˆä¸€ä¸ª `NSArray`ã€‚åœ¨åº•å±‚ï¼Œä¸€ä¸ª `Array` å®ä¾‹åªè¦å®ƒçš„å…ƒç´ ç±»å‹æ˜¯ class æˆ–æ˜¯éµå¾ªäº† Objective-C å…¼å®¹åè®®çš„ç±»å‹ï¼Œå°±ä¼šå°†æ•°ç»„æ•°æ®å­˜å‚¨åœ¨ `NSArray` ä¸­ã€‚åªè¦ä¸æ˜¯è¿™ç§æƒ…å†µï¼ˆä¾‹å¦‚æ•°ç»„å…ƒç´ ä¸ºå€¼ç±»å‹çš„æ•°ç»„ï¼‰ï¼Œè¿™ä¸ªæ•°ç»„å°±ä¸ä¼šè¢«å­˜å‚¨åœ¨ `NSArray` ä¸­ï¼Œå¹¶ä¸”æ€§èƒ½å˜å¾—å’Œ `ContiguousArray` ç›¸å½“ã€‚

ä¸ºäº†æ¯”è¾ƒæ€§èƒ½ï¼Œæˆ‘ä»¬è¿è¡Œäº†è¿™æ ·ä¸€ä¸ªæµ‹è¯•ï¼Œå‘æ¯ä¸ªæ•°ç»„çš„å®ä¾‹ä¸­æ·»åŠ ä¸€ç™¾ä¸‡ä¸ªå•ç‹¬çš„å¼•ç”¨ç±»å‹ï¼Œç„¶ååˆ é™¤ã€‚è¿™äº›å¼•ç”¨ç±»å‹ä¼šåœ¨å¼€å§‹è®¡æ—¶å‰è¿›è¡Œé¢„æ„å»ºï¼Œè€Œç»“æœä¸ºè¶…è¿‡ 100 æ¬¡çš„è¿è¡Œåå¾—åˆ°çš„å¹³å‡å€¼ã€‚ä¸‹é¢çš„å€¼æ˜¯åœ¨è®¾ç½®äº†ç¼–è¯‘å™¨ä¼˜åŒ–çš„æƒ…å†µä¸‹è·å¾—çš„ã€‚æ€»çš„æ¥è¯´ï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæ•°ç»„æ€§èƒ½æ˜¯ç“¶é¢ˆçš„è¯ï¼Œåœ¨æ•°ç»„å…ƒç´ ä¸ºå¼•ç”¨ç±»å‹æˆ– `@objc` ç±»å‹çš„å‰æä¸‹ï¼Œåˆ‡æ¢ä¸º `ContiguousArray` çš„ä½¿ç”¨å¤§çº¦èƒ½è·å¾— 2 å€æ€§èƒ½çš„æå‡ã€‚

| **Array** | **ContiguousArray** |
| ---------- | ------------------ |
| 58.9 ms | 30.3 ms |

## æ•°ç»„å®¹é‡

çœ‹èµ·æ¥ Swift æ•°ç»„åˆ†é…çš„å†…å­˜ä¸å®ƒçš„é•¿åº¦æˆæ­£æ¯”ã€‚å¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œæ·»åŠ æˆ–åˆ é™¤ä¸€ä¸ªå…ƒç´ å°†éœ€è¦åˆ†é…æˆ–é‡Šæ”¾å†…å­˜ï¼Œå¹¶å¯¹æ•°ç»„é•¿åº¦çš„æ¯ä¸€ä¸ªå˜åŒ–éƒ½é€ æˆæ€§èƒ½æŸå¤±ã€‚ç›¸åï¼Œæå‰åˆ†é…æœ€å°‘çš„å†…å­˜ç©ºé—´æ˜¯æ›´æœ‰æ„ä¹‰çš„ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä¸å¼•èµ·å†…å­˜ç®¡ç†æ€§èƒ½æŸå¤±çš„æƒ…å†µä¸‹è¿›è¡Œæ¥ä¸‹æ¥çš„å‡ ä¸ªæ–°å¢æ“ä½œã€‚è¿™å®é™…ä¸Šæ˜¯ Swift æ‰€åšçš„ï¼šä»¥ä¸€ç§æ™ºèƒ½çš„æ–¹å¼è¿›è¡Œå†…å­˜åˆ†é…ï¼Œæ¥è®©åˆ†é…æ€§èƒ½æ¶ˆè€—ä¿æŒåœ¨æœ€ä½çš„æ°´å¹³ã€‚

å°½ç®¡æœ‰æ™ºèƒ½å†…å­˜åˆ†é…ï¼Œä½†å¦‚æœæ¸…æ¥šåœ°çŸ¥é“æ•°ç»„åº”è¯¥è¢«å®šä¹‰æŒæœ‰çš„å†…å­˜å¤§å°ï¼Œæ‰æ˜¯å†…å­˜åˆ†é…æœ€æœ‰æ•ˆçš„æ–¹å¼ã€‚è¿™æ ·ï¼Œåªéœ€è¦ä¸€ä¸ªå†…å­˜åˆ†é…å°±å¯ä»¥äº†ã€‚ Swift æ•°ç»„æä¾›äº†å®šä¹‰å’Œé¢„ç•™å®¹é‡çš„èƒ½åŠ›ï¼Œè€Œä¸”è¿™æ ·åšå¯ä»¥å®ç°è¾ƒå°çš„æ€§èƒ½å¢ç›Šã€‚


```
var healthyArray = ["ğŸ‰", "ğŸ¥•"]
healthyArray.reserveCapacity(50)
```

è¿è¡Œå¦ä¸€ä¸ªæµ‹è¯•ï¼Œå†æ¬¡å‘ä¸€ä¸ªæ•°ç»„ä¸­æ·»åŠ å’Œåˆ é™¤ä¸€ç™¾ä¸‡ä¸ªå¼•ç”¨ç±»å‹ï¼Œäº§ç”Ÿä»¥ä¸‹çš„ç»“æœã€‚è¯¥æµ‹è¯•æ˜¯é’ˆå¯¹è¿ç»­æ•°ç»„æœ‰æ— é¢„ç•™å†…å­˜å®¹é‡çš„æƒ…å†µã€‚

| **Without Reserved Capacity** | **With Reserved Capacity** |
| ------------------------------ | ------------------------- |
| 29.7 ms | 27.3 ms |

## C ç±»å‹æ•°ç»„

å¦‚æœä½ æƒ³è®¿é—®åŸå§‹å†…å­˜æ¥åŠ å¼ºæ•°ç»„ï¼Œä½ ä¹Ÿå¯ä»¥è¿™ä¹ˆåšã€‚å¯¹äºæ ‡å‡†çš„æ•°ç»„æ“ä½œï¼Œå®ƒä¸ä¼šæä¾›å¤ªå¤šçš„æ€§èƒ½å¢ç›Šã€‚å¯¹äºéæ ‡å‡†çš„æƒ…å†µï¼Œç”¨è¿™ç§æ–¹å¼è®¿é—®æˆ–ä¿®æ”¹æ•°æ®å¯èƒ½æ˜¯æœ‰å¿…è¦çš„ï¼Œæˆ–è€…æ˜¯å¯¹æ€§èƒ½æœ‰ç›Šçš„ã€‚

```
var balancedDietArray = ["ğŸ¥–", "ğŸ©", "ğŸ—"]
balancedDietArray.withUnsafeMutableBufferPointer { arrayPointer in
    arrayPointer[1] = "ğŸ‡"
}
```

---
å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äº Swift æ•°ç»„æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æ›´å¤šçš„å†…å®¹ï¼š[Swift Array Design](https://github.com/apple/swift/blob/master/docs/Arrays.rst)ã€‚


---

> [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner) æ˜¯ä¸€ä¸ªç¿»è¯‘ä¼˜è´¨äº’è”ç½‘æŠ€æœ¯æ–‡ç« çš„ç¤¾åŒºï¼Œæ–‡ç« æ¥æºä¸º [æ˜é‡‘](https://juejin.im) ä¸Šçš„è‹±æ–‡åˆ†äº«æ–‡ç« ã€‚å†…å®¹è¦†ç›– [Android](https://github.com/xitu/gold-miner#android)ã€[iOS](https://github.com/xitu/gold-miner#ios)ã€[React](https://github.com/xitu/gold-miner#react)ã€[å‰ç«¯](https://github.com/xitu/gold-miner#å‰ç«¯)ã€[åç«¯](https://github.com/xitu/gold-miner#åç«¯)ã€[äº§å“](https://github.com/xitu/gold-miner#äº§å“)ã€[è®¾è®¡](https://github.com/xitu/gold-miner#è®¾è®¡) ç­‰é¢†åŸŸï¼Œæƒ³è¦æŸ¥çœ‹æ›´å¤šä¼˜è´¨è¯‘æ–‡è¯·æŒç»­å…³æ³¨ [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)ã€[å®˜æ–¹å¾®åš](http://weibo.com/juejinfanyi)ã€[çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/juejinfanyi)ã€‚


