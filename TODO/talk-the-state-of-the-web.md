
> * åŸæ–‡åœ°å€ï¼š[The State of the Web](https://medium.com/@fox/talk-the-state-of-the-web-3e12f8e413b3)
> * åŸæ–‡ä½œè€…ï¼š[Karolina Szczur](https://medium.com/@fox?source=post_header_lockup)
> * è¯‘æ–‡å‡ºè‡ªï¼š[æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)
> * æœ¬æ–‡æ°¸ä¹…é“¾æ¥ï¼š[https://github.com/xitu/gold-miner/blob/master/TODO/talk-the-state-of-the-web.md](https://github.com/xitu/gold-miner/blob/master/TODO/talk-the-state-of-the-web.md)
> * è¯‘è€…ï¼š[undead25](https://github.com/undead25)
> * æ ¡å¯¹è€…ï¼š

ç½‘ç»œç°çŠ¶ï¼šæ€§èƒ½æå‡æŒ‡å—

äº’è”ç½‘æ­£åœ¨çˆ†å‘å¼åœ°å¢é•¿ï¼Œæˆ‘ä»¬åˆ›å»ºçš„ Web å¹³å°ä¹Ÿæ˜¯å¦‚æ­¤ã€‚**æˆ‘ä»¬é€šå¸¸éƒ½æ²¡æœ‰è€ƒè™‘åˆ°ç”¨æˆ·ç½‘ç»œçš„è¿é€šæ€§å’Œä½¿ç”¨æƒ…æ™¯**ã€‚å³ä½¿æ˜¯ä¸‡ç»´ç½‘çŠ¶å†µçš„ä¸€ç¥ï¼Œä¹Ÿå¯ä»¥çœ‹å‡ºæˆ‘ä»¬è¿˜æ²¡æœ‰å»ºç«‹èµ·æ„ŸåŒèº«å—å’Œå½¢åŠ¿å˜åŒ–çš„è®¤çŸ¥ï¼Œæ›´ä¸ç”¨è¯´æ€§èƒ½çš„è€ƒè™‘äº†ã€‚

é‚£ä¹ˆï¼Œç°ä»Šçš„ç½‘ç»œçŠ¶å†µæ˜¯æ€æ ·çš„å‘¢ï¼Ÿ

**åœ°çƒä¸Š 74 äº¿äººå£ä¸­ï¼Œåªæœ‰ 46% çš„äººèƒ½å¤Ÿä¸Šç½‘**ï¼Œå¹³å‡ç½‘ç»œé€Ÿåº¦ç«Ÿæœ‰ 7Mb/sã€‚æ›´é‡è¦çš„æ˜¯ï¼Œ93% çš„äº’è”ç½‘ç”¨æˆ·éƒ½æ˜¯é€šè¿‡ç§»åŠ¨è®¾å¤‡ä¸Šç½‘çš„ â€”â€” ä¸å»é€‚åº”æ‰‹æŒè®¾å¤‡æ˜¯ä¸å¯åŸè°…çš„ã€‚æ•°æ®å¾€å¾€æ¯”æˆ‘ä»¬æƒ³è±¡ä¸­è¦æ˜‚è´µå¾—å¤š â€”â€” 500MB çš„æ•°æ®åœ¨å¾·å›½åªè¦ 1 ä¸ªå°æ—¶ï¼Œè€Œåœ¨å·´è¥¿éœ€è¦ 13 ä¸ªå°æ—¶ï¼ˆæ›´å¤šæœ‰è¶£çš„ç»Ÿè®¡å¯ä»¥çœ‹çœ‹ [Ben Schwarz](https://twitter.com/benschwarz) çš„[ã€Šæ³¡æ²«ç ´ç­ï¼šçœŸå®çš„æ€§èƒ½ã€‹](https://speakerdeck.com/benschwarz/beyond-the-bubble)ï¼‰ã€‚

**æˆ‘ä»¬çš„ç½‘ç«™è¡¨ç°å¾—ä¹Ÿä¸å°½å¦‚äººæ„** â€”â€” å¹³å‡ä½“ç§¯å¤§æ¦‚[æ˜¯ç¬¬ä¸€ç‰ˆ Doom æ¸¸æˆçš„å¤§å°](https://www.wired.com/2016/04/average-webpage-now-size-original-doom/)ï¼ˆ3 MB å·¦å³ï¼‰ï¼ˆè¯·æ³¨æ„ï¼Œä¸ºäº†ç»Ÿè®¡å‡†ç¡®åº¦ï¼Œéœ€è¦ä½¿ç”¨[ä¸­ä½æ•°](https://zh.wikipedia.org/wiki/%E4%B8%AD%E4%BD%8D%E6%95%B8)ï¼Œæ¨èé˜…è¯» [Ilya Grigorik](https://twitter.com/igrigorik) çš„ [ã€Šâ€œå¹³å‡é¡µé¢â€æ˜¯ä¸€ä¸ªç¥è¯ã€‹](https://www.igvita.com/2016/01/12/the-average-page-is-a-myth/)ã€‚ä¸­ä½æ•°ç»Ÿè®¡å‡ºçš„ç½‘ç«™ä½“ç§¯ç›®å‰ä¸º 1.4MBï¼‰ã€‚å›¾ç‰‡å¯ä»¥è½»æ¾å ç”¨ 1.7 MBï¼Œè€Œ JavaScript å¹³å‡ä¸º 400KBã€‚ä¸ä»…ä»…åªæœ‰ Web å¹³å°ï¼Œæœ¬åœ°åº”ç”¨ç¨‹åºä¹Ÿæœ‰åŒæ ·çš„é—®é¢˜ï¼Œä½ æ˜¯å¦é‡åˆ°è¿‡ä¸ºäº†ä¿®å¤æŸäº› bugï¼Œä¸å¾—ä¸ä¸‹è½½ 200MB çš„åº”ç”¨å‘¢ï¼Ÿ

**æŠ€æœ¯äººå‘˜ç»å¸¸ä¼šå‘ç°è‡ªå·±å¤„äºç‰¹æƒåœ°ä½**ã€‚æ‹¥æœ‰æ–°å‹é«˜ç«¯çš„ç¬”è®°æœ¬ã€æ‰‹æœºå’Œå¿«é€Ÿçš„ç½‘ç»œè¿æ¥ã€‚æˆ‘ä»¬å¾ˆå®¹æ˜“å¿˜è®°ï¼Œå…¶å®å¹¶ä¸æ˜¯æ¯ä¸ªäººéƒ½æœ‰è¿™æ ·çš„æ¡ä»¶ï¼ˆå®é™…ä¸Šåªæœ‰å°‘éƒ¨åˆ†äººè€Œå·²ï¼‰ã€‚

> å¦‚æœæˆ‘ä»¬åªç«™åœ¨è‡ªå·±è€Œä¸æ˜¯ç”¨æˆ·çš„è§’åº¦æ¥æ„å»º web å¹³å°ï¼Œé‚£è¿™å°†å¯¼è‡´ç³Ÿç³•çš„ç”¨æˆ·ä½“éªŒã€‚

æˆ‘ä»¬å¦‚ä½•é€šè¿‡åœ¨è®¾è®¡å’Œå¼€å‘ä¸­è€ƒè™‘æ€§èƒ½æ¥åšå¾—æ›´å¥½å‘¢ï¼Ÿ

## èµ„æºä¼˜åŒ–

æœ€èƒ½æ˜æ˜¾æå‡æ€§èƒ½ä½†æœªè¢«å……åˆ†åˆ©ç”¨çš„æ–¹å¼æ˜¯ï¼Œä»äº†è§£æµè§ˆå™¨å¦‚ä½•åˆ†æå’Œå¤„ç†èµ„æºå¼€å§‹ã€‚äº‹å®è¯æ˜ï¼Œæµè§ˆå™¨åœ¨èµ„æºå‘ç°æ–¹é¢è¡¨ç°å¾—éå¸¸ä¸é”™ï¼ŒåŒæ—¶è§£æå’Œç«‹å³ç¡®å®šèµ„æºçš„ä¼˜å…ˆçº§ã€‚ä¸‹é¢æ˜¯å…³äº**å…³é”®è¯·æ±‚**çš„è§£é‡Šã€‚

> å¦‚æœè¯·æ±‚åŒ…å«ç”¨æˆ·è§†å›¾æ¸²æŸ“æ‰€éœ€çš„èµ„æºï¼Œé‚£è¯¥è¯·æ±‚å°±æ˜¯å…³é”®è¯·æ±‚ã€‚

å¯¹äºå¤§å¤šæ•°ç½‘ç«™ï¼Œå…³é”®è¯·æ±‚å¯ä»¥æ˜¯ HTMLï¼Œå¿…è¦çš„ CSSï¼ŒLOGOï¼Œç½‘ç»œå­—ä½“ï¼Œä¹Ÿå¯èƒ½æ˜¯å›¾ç‰‡ã€‚äº‹å®è¯æ˜ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå½“èµ„æºè¢«è¯·æ±‚æ—¶ï¼Œè®¸å¤šå…¶ä»–ä¸ç›¸å…³çš„ï¼ˆJavaScriptï¼Œè¿½è¸ªä»£ç ï¼Œå¹¿å‘Šç­‰ï¼‰ä¹Ÿè¢«è¯·æ±‚äº†ã€‚ä¸è¿‡æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡ä»”ç»†æŒ‘é€‰é‡è¦èµ„æºï¼Œå¹¶è°ƒæ•´å®ƒä»¬çš„ä¼˜å…ˆçº§æ¥é¿å…è¿™ç§æƒ…å†µå‘ç”Ÿã€‚

é€šè¿‡ `<link rel ='preload'>`ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å¼ºåˆ¶è®¾ç½®èµ„æºçš„ä¼˜å…ˆçº§ä¸º`é«˜`ï¼Œæ¥ç¡®ä¿æ‰€æœŸæœ›çš„å†…å®¹æŒ‰æ—¶æ¸²æŸ“ã€‚ è¿™ç§æŠ€æœ¯å¯ä»¥æ˜æ˜¾æ”¹å–„â€œäº¤äº’æ—¶é—´â€æŒ‡æ ‡ï¼Œä»è€Œä½¿æœ€ä½³ç”¨æˆ·ä½“éªŒæˆä¸ºå¯èƒ½ã€‚

![](https://cdn-images-1.medium.com/max/800/1*JT-53LslhwOOqTgv1dGoXg.png)

ç”±äºç›¸å…³èµ„æ–™çš„ç¼ºä¹ï¼Œå…³é”®è¯·æ±‚å¯¹è®¸å¤šäººæ¥è¯´ä¼¼ä¹ä»ç„¶æ˜¯ä¸€ä¸ªé»‘ç›’å­ã€‚å¹¸è¿çš„æ˜¯ï¼Œ[Ben Schwarz](https://twitter.com/benschwarz/) å‘è¡¨äº†ä¸€ç¯‡éå¸¸å…¨é¢ä¸”é€šä¿—æ˜“æ‡‚çš„æ–‡ç«  â€”â€” [ã€Šå…³é”®è¯·æ±‚ã€‹](https://css-tricks.com/the-critical-request/)ã€‚å¦å¤–ï¼Œä½ ä¹Ÿå¯ä»¥æŸ¥çœ‹ Addy å…³äºé¢„åŠ è½½çš„æ–‡ç«  â€”â€” [ã€ŠChrome ä¸­çš„é¢„åŠ è½½å’Œä¼˜å…ˆçº§ã€‹](https://medium.com/reloading/preload-prefetch-and-priorities-in-chrome-776165961bbf)ã€‚

![åœ¨ Chrome å¼€å‘è€…å·¥å…·ä¸­å¯ç”¨ä¼˜å…ˆçº§](https://cdn-images-1.medium.com/max/800/1*ju18GQzgF-TQDMrYdtPelg.gif)

ğŸ›  è¦è¿½è¸ªä¼˜å…ˆå¤„ç†è¯·æ±‚çš„æ•ˆæœï¼Œä½ å¯ä»¥ä½¿ç”¨ Lighthouse æ€§èƒ½æ£€æµ‹å·¥å…·å’Œ[å…³é”®è¯·æ±‚é“¾è·¯è¯„æµ‹](https://developers.google.com/web/tools/lighthouse/audits/critical-request-chains)ï¼Œæˆ–è€…æŸ¥çœ‹ Chrome å¼€å‘è€…å·¥å…·ç½‘ç»œæ ‡ç­¾ä¸‹çš„è¯·æ±‚ä¼˜å…ˆçº§ã€‚

**ğŸ“ å¸¸ç”¨æ€§èƒ½æ£€æŸ¥è¡¨**

1. ä¸»åŠ¨ç¼“å­˜
2. å¯ç”¨å‹ç¼©
3. ä¼˜å…ˆå…³é”®èµ„æº
4. ä½¿ç”¨ CDN

## å›¾ç‰‡ä¼˜åŒ–

é¡µé¢ä¼ è¾“çš„å¤§éƒ¨åˆ†æ•°æ®é€šå¸¸éƒ½æ˜¯å›¾ç‰‡ï¼Œå› æ­¤ä¼˜åŒ–å›¾ç‰‡å¯ä»¥å¸¦æ¥å¾ˆå¤§çš„æ€§èƒ½æå‡ã€‚æœ‰è®¸å¤šç°æœ‰çš„ç­–ç•¥å’Œå·¥å…·å¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ é™¤å¤šä½™çš„å­—èŠ‚ï¼Œä½†é¦–å…ˆè¦é—®çš„æ˜¯ï¼šâ€œå›¾ç‰‡å¯¹äºä¼ è¾¾åç»­çš„ä¿¡æ¯å’Œæ•ˆæœè‡³å…³é‡è¦å—â€ï¼Ÿ å¦‚æœå¯ä»¥ç§»é™¤ï¼Œä¸ä»…å¯ä»¥èŠ‚çœå¸¦å®½ï¼Œè¿˜å¯ä»¥å‡å°‘è¯·æ±‚ã€‚

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸åŒçš„æŠ€æœ¯æ¥å®ç°åŒæ ·çš„æ•ˆæœã€‚CSS æœ‰å¾ˆå¤šå…·æœ‰è‰ºæœ¯æ€§çš„å±æ€§ï¼Œä¾‹å¦‚é˜´å½±ï¼Œæ¸å˜ï¼ŒåŠ¨ç”»å’Œå½¢çŠ¶ï¼Œè¿™å°±å…è®¸æˆ‘ä»¬ç”¨å…·æœ‰åˆé€‚æ ·å¼çš„ DOM å…ƒç´ æ¥æ›¿ä»£å›¾ç‰‡ã€‚

### é€‰æ‹©åˆé€‚çš„æ ¼å¼

å¦‚æœå¿…é¡»ä½¿ç”¨å›¾ç‰‡ï¼Œé‚£ç¡®å®šå“ªç§æ ¼å¼æ¯”è¾ƒåˆé€‚æ˜¯å¾ˆé‡è¦çš„ã€‚ä¸€èˆ¬éƒ½åœ¨çŸ¢é‡å›¾å’Œæ …æ ¼å›¾ä¹‹é—´è¿›è¡Œé€‰æ‹©ï¼š

- **çŸ¢é‡å›¾å½¢**ï¼šä¸åˆ†è¾¨ç‡æ— å…³ï¼Œæ–‡ä»¶é€šå¸¸æ¯”è¾ƒå°ã€‚ç‰¹åˆ«é€‚ç”¨äº LOGOï¼Œå›¾æ ‡å’Œç”±ç®€å•å›¾å½¢ï¼ˆç‚¹ã€çº¿ã€åœ†å’Œå¤šè¾¹å½¢ï¼‰ç»„æˆçš„å›¾ç‰‡ã€‚
- **æ …æ ¼å›¾åƒ**ï¼šè¡¨ç°å†…å®¹æ›´ä¸°å¯Œã€‚é€‚ç”¨äºç…§ç‰‡ã€‚

åšå‡ºä¸Šé¢çš„å†³å®šåï¼Œæœ‰è¿™æ ·çš„å‡ ç§æ ¼å¼ä¾›æˆ‘ä»¬é€‰æ‹©ï¼šJPEGã€GIFã€PNG-8ã€PNG-24 æˆ–è€…æœ€æ–°çš„æ ¼å¼ï¼Œä¾‹å¦‚ WEBP æˆ– JPEG-XRã€‚æ—¢ç„¶æœ‰è¿™ä¹ˆå¤šçš„é€‰æ‹©ï¼Œé‚£å¦‚ä½•ç¡®ä¿æˆ‘ä»¬é€‰æ‹©çš„æ­£ç¡®æ€§å‘¢ï¼Ÿä»¥ä¸‹æ˜¯æ‰¾åˆ°æœ€ä½³æ ¼å¼çš„åŸºæœ¬æ–¹æ³•ï¼š

- **JPEG**ï¼šè‰²å½©ä¸°å¯Œçš„å›¾ç‰‡ï¼ˆä¾‹å¦‚ç…§ç‰‡ï¼‰
- **PNGâ€“8**ï¼šè‰²å½©ä¸æ˜¯å¾ˆä¸°å¯Œçš„å›¾ç‰‡
- **PNGâ€“24**ï¼šå…·æœ‰éƒ¨åˆ†é€æ˜åº¦çš„å›¾ç‰‡
- **GIF**ï¼šåŠ¨ç”»å›¾ç‰‡

Photoshop åœ¨å›¾ç‰‡å¯¼å‡ºæ—¶ï¼Œå¯ä»¥é€šè¿‡ä¸€äº›è®¾ç½®æ¥å¯¹ä¸Šè¿°æ ¼å¼çš„å›¾ç‰‡è¿›è¡Œä¼˜åŒ–ï¼Œä¾‹å¦‚é™ä½è´¨é‡ã€å‡å°‘é¢œè‰²çš„å™ªç‚¹å’Œæ•°é‡ã€‚è¿™å¯ä»¥è®©è®¾è®¡å¸ˆæ„è¯†åˆ°æ€§èƒ½å®è·µï¼Œå¹¶é€šè¿‡æ­£ç¡®çš„ä¼˜åŒ–é¢„è®¾æ¥å‡†å¤‡åˆé€‚çš„å›¾ç‰‡ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºå¦‚ä½•å¼€å‘å›¾ç‰‡çš„ä¿¡æ¯ï¼Œå¯ä»¥é˜…è¯» [Lara Hogan's](https://twitter.com/lara_hogan) çš„ [ã€Šé€Ÿåº¦ä¸æ¿€æƒ…ï¼šä»¥ç½‘ç«™æ€§èƒ½æå‡ç”¨æˆ·ä½“éªŒã€‹](http://designingforperformance.com/optimizing-images/#choosing-an-image-format)ã€‚

### å°è¯•æ–°æ ¼å¼

æœ‰è¿™æ ·å‡ ç§ç”±æµè§ˆå™¨å‚å•†å¼€å‘çš„æ–°å›¾ç‰‡æ ¼å¼ï¼šGoogle çš„ WebPï¼ŒApple çš„ JPEG 2000 å’Œ Microsoft çš„ JPEG-XRã€‚

**WebP** æ˜¯æœ€å…·æœ‰ç«äº‰åŠ›çš„ï¼Œæ”¯æŒæ— æŸå’Œæœ‰æŸå‹ç¼©ä½¿å¾—å®ƒè¢«å¹¿æ³›åº”ç”¨ã€‚**æ— æŸ WebP æ¯” PNG å° 26%ï¼Œæ¯” JPG å° 25-34%**ã€‚74% çš„æµè§ˆå™¨æ”¯æŒç‡åŠé™çº§æ–¹æ¡ˆä½¿å®ƒå¯ä»¥å®‰å…¨åœ°è¢«ä½¿ç”¨ï¼Œæœ€å¤šå¯èŠ‚çœ 1/3 çš„ä¼ è¾“å­—èŠ‚ã€‚JPG å’Œ PNG å¯ä»¥é€šè¿‡ Photoshop å’Œå…¶ä»–å›¾åƒå¤„ç†ç¨‹åºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œï¼ˆ`brew install webp`ï¼‰å°†å…¶è½¬æ¢ä¸º WebPã€‚

å¦‚æœä½ æƒ³æ¢ç´¢è¿™äº›æ ¼å¼ä¹‹é—´çš„è§†è§‰å·®å¼‚ï¼Œæˆ‘æ¨è[è¿™ä¸ªåœ¨ Github ä¸Šä¸é”™çš„ç¤ºä¾‹](https://xooyoozoo.github.io/yolo-octo-bugfixes)ã€‚

### ä½¿ç”¨å·¥å…·å’Œç®—æ³•è¿›è¡Œä¼˜åŒ–

**å³ä¾¿ä½¿ç”¨äº†é«˜æ•ˆçš„å›¾ç‰‡æ ¼å¼ä¹Ÿéœ€è¦åç»­çš„å¤„ç†å’Œä¼˜åŒ–**ã€‚è¿™ä¸€æ­¥å¾ˆé‡è¦ã€‚

å¦‚æœä½ é€‰æ‹©äº†ä½“ç§¯ç›¸å¯¹è¾ƒå°çš„ SVGï¼Œå®ƒä»¬ä¹Ÿéœ€è¦è¢«å‹ç¼©ã€‚[SVGO](https://github.com/svg/svgo) æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥é€šè¿‡å‰¥ç¦»ä¸å¿…è¦çš„å…ƒæ•°æ®æ¥å¿«é€Ÿä¼˜åŒ– SVGã€‚å¦å¤–ï¼Œå¦‚æœä½ å–œæ¬¢ Web ç•Œé¢æˆ–è€…ç”±äºæ“ä½œç³»ç»Ÿçš„é™åˆ¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ [Jake Archibald](https://twitter.com/jaffathecake) çš„ [SVGOMG](https://jakearchibald.github.io/svgomg/)ã€‚ç”±äº SVG æ˜¯åŸºäº XML çš„æ ¼å¼ï¼Œæ‰€ä»¥å®ƒä¹Ÿå¯ä»¥è¢«æœåŠ¡ç«¯ GZIP å‹ç¼©ã€‚

[ImageOptim](https://imageoptim.com/mac) æ˜¯å¤§å¤šæ•°å…¶ä»–å›¾ç‰‡æ ¼å¼çš„ç»ä½³é€‰æ‹©ï¼Œå®ƒå°† pngcrushã€pngquantã€MozJPEGã€Google Zopfli ç­‰ä¸€äº›ä¸é”™çš„å·¥å…·æ‰“åŒ…è¿›äº†ä¸€ä¸ªç»¼åˆçš„å¼€æºåŒ…é‡Œé¢ã€‚ä½œä¸ºä¸€ä¸ª Mac OS åº”ç”¨ç¨‹åºã€å‘½ä»¤è¡Œç•Œé¢å’Œ Sketch æ’ä»¶ï¼ŒImageOptim å¯ä»¥è½»æ¾åœ°ç”¨äºç°æœ‰çš„å·¥ä½œæµä¸­ã€‚å¤§å¤šæ•° ImageOptim ä¾èµ– CLI éƒ½å¯ä»¥åœ¨ Linux æˆ–è€… Windows å¹³å°ä¸Šä½¿ç”¨ã€‚

å¦‚æœä½ å€¾å‘äºå°è¯•æ–°å…´çš„ç¼–ç å™¨ï¼Œä»Šå¹´æ—©äº›æ—¶å€™ï¼ŒGoogle å‘å¸ƒäº† [Guetzli](https://research.googleblog.com/2017/03/announcing-guetzli-new-open-source-jpeg.html) â€”â€” ä¸€ä¸ªæºäºä»–ä»¬å¯¹ WebP å’Œ Zopfli ç ”ç©¶çš„å¼€æºç®—æ³•ã€‚**Guetzli å¯ä»¥ç”Ÿæˆæ¯”ä»»ä½•å…¶ä»–å¯ç”¨çš„å‹ç¼©æ–¹æ³•å°‘ 35% ä½“ç§¯çš„ JPEG**ã€‚å”¯ä¸€çš„ç¼ºç‚¹æ˜¯ï¼šå¤„ç†æ—¶é—´æ…¢ï¼ˆæ¯ç™¾ä¸‡åƒç´ çš„ CPU æ—¶é—´ä¸ºä¸€åˆ†é’Ÿï¼‰ã€‚

é€‰æ‹©å·¥å…·æ—¶ï¼Œè¯·ç¡®ä¿å®ƒä»¬èƒ½è¾¾åˆ°é¢„æœŸå¹¶é€‚åˆå›¢é˜Ÿçš„å·¥ä½œæµã€‚æœ€å¥½èƒ½è‡ªåŠ¨åŒ–ä¼˜åŒ–ï¼Œè¿™æ ·æ‰€æœ‰å›¾ç‰‡éƒ½æ˜¯ä¼˜åŒ–è¿‡äº†çš„ã€‚

### å“åº”å¼å›¾ç‰‡

åå¹´å‰ï¼Œä¹Ÿè®¸ä¸€ç§åˆ†è¾¨ç‡å°±èƒ½æ»¡è¶³æ‰€æœ‰çš„åœºæ™¯ï¼Œä½†éšç€æ—¶ä»£çš„å˜åŒ–ï¼Œå“åº”å¼ç½‘ç«™ç°ä»Šå·²æˆªç„¶ä¸åŒã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¿…é¡»ç‰¹åˆ«å°å¿ƒåœ°å®æ–½æˆ‘ä»¬ç²¾å¿ƒä¼˜åŒ–çš„è§†è§‰èµ„æºï¼Œå¹¶ç¡®ä¿å®ƒä»¬é€‚åº”å„ç§è§†å›¾å’Œè®¾å¤‡ã€‚å¹¸è¿çš„æ˜¯ï¼Œæ„Ÿè°¢[å“åº”å¼å›¾åƒç¤¾åŒºç»„ç»‡](https://responsiveimages.org/)ï¼Œé€šè¿‡ `picture` å…ƒç´ å’Œ `srcset` å±æ€§ï¼ˆéƒ½æœ‰ 85%+ çš„æµè§ˆå™¨æ”¯æŒç‡ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å®Œç¾åœ°åšåˆ°ã€‚

### srcset å±æ€§

`srcset` åœ¨åˆ†è¾¨ç‡åˆ‡æ¢åœºæ™¯ä¸­è¡¨ç°å¾—éå¸¸ä¸é”™ â€”â€” å½“æˆ‘ä»¬æƒ³æ ¹æ®ç”¨æˆ·çš„å±å¹•å¯†åº¦å’Œå¤§å°æ˜¾ç¤ºå›¾ç‰‡æ—¶ã€‚æ ¹æ® `srcset` å’Œ `sizes` å±æ€§ä¸­ä¸€äº›é¢„å®šä¹‰çš„è§„åˆ™ï¼Œæµè§ˆå™¨å°†ä¼šæ ¹æ®è§†å›¾é€‰æ‹©æœ€ä½³çš„å›¾ç‰‡è¿›è¡Œå±•ç¤ºã€‚è¿™ç§æŠ€æœ¯å¯ä»¥èŠ‚çœå¸¦å®½å’Œå‡å°‘è¯·æ±‚ï¼Œç‰¹åˆ«æ˜¯å¯¹äºç§»åŠ¨ç«¯ç”¨æˆ·ã€‚

![srcset å±æ€§ä½¿ç”¨ç¤ºä¾‹](https://cdn-images-1.medium.com/max/800/1*87BIfYsjZTh-bikjmp7eow.png)

### picture å…ƒç´ 

`picture` å…ƒç´ å’Œ `media` å±æ€§æ—¨åœ¨æ›´å®¹æ˜“åœ°é€šå¾€è‰ºæœ¯æ®¿å ‚ã€‚é€šè¿‡ä¸ºä¸åŒçš„æ¡ä»¶æä¾›ä¸åŒçš„æ¥æºï¼ˆé€šè¿‡ `media-queries`ï¼‰ï¼Œæ— è®ºåˆ†è¾¨ç‡å¦‚ä½•ï¼Œæˆ‘ä»¬å§‹ç»ˆèƒ½èšç„¦åœ¨æœ€é‡è¦çš„å›¾åƒå…ƒç´ ä¸Šã€‚

![picture å…ƒç´ ä½¿ç”¨ç¤ºä¾‹](https://cdn-images-1.medium.com/max/800/1*NeyfH6Vu1xCWE2SY5w1cDQ.png)

ğŸ“š é˜…è¯» [Jason Grigsby](https://twitter.com/grigs) çš„[ã€Šå“åº”å¼å›¾ç‰‡ 101ã€‹](https://cloudfour.com/thinks/responsive-images-101-definitions/) å¯ä»¥å…¨é¢åœ°äº†è§£è¿™ä¸¤ç§æ–¹å¼ã€‚

### ä½¿ç”¨å›¾ç‰‡ CDN

å›¾ç‰‡æ€§èƒ½çš„æœ€åä¸€æ­¥å°±æ˜¯åˆ†å‘äº†ã€‚æ‰€æœ‰èµ„æºéƒ½å¯ä»¥ä»ä½¿ç”¨ CDN ä¸­å—ç›Šï¼Œä½†æœ‰ä¸€äº›ç‰¹å®šçš„å·¥å…·æ˜¯ä¸“é—¨é’ˆå¯¹å›¾ç‰‡çš„ï¼Œä¾‹å¦‚ [Cloudinary](http://cloudinary.com/) æˆ–è€… [imgx](https://www.imgix.com/)ã€‚ä½¿ç”¨è¿™äº›æœåŠ¡çš„å¥½å¤„è¿œä¸æ­¢äºå‡å°‘æœåŠ¡å™¨æµé‡ï¼Œå®ƒè¿˜å¯ä»¥æ˜¾è‘—å‡å°‘å“åº”å»¶è¿Ÿã€‚

**CDN å¯ä»¥é™ä½é‡å›¾ç‰‡ç«™ç‚¹æä¾›è‡ªé€‚åº”å’Œé«˜æ€§èƒ½å›¾ç‰‡çš„å¤æ‚åº¦**ã€‚ä»–ä»¬æä¾›çš„æœåŠ¡å„ä¸ç›¸åŒï¼ˆä»·æ ¼ä¹Ÿä¸åŒï¼‰ï¼Œä½†æ˜¯å¤§å¤šæ•°éƒ½å¯ä»¥æ ¹æ®è®¾å¤‡å’Œæµè§ˆå™¨è¿›è¡Œå°ºå¯¸è°ƒæ•´ã€è£å‰ªå’Œç¡®å®šæœ€åˆé€‚çš„æ ¼å¼ï¼Œç”šè‡³æ›´å¤š â€”â€” å‹ç¼©ã€æ£€æµ‹åƒç´ å¯†åº¦ã€æ°´å°ã€äººè„¸è¯†åˆ«å’Œå…è®¸åå¤„ç†ã€‚å€ŸåŠ©è¿™äº›å¼ºå¤§çš„åŠŸèƒ½å’Œèƒ½å¤Ÿå°†å‚æ•°é™„åˆ° URL ä¸­ï¼Œä½¿å¾—æä¾›ä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒçš„å›¾ç‰‡å˜å¾—è½»è€Œæ˜“ä¸¾äº†ã€‚

ğŸ“ å›¾ç‰‡æ€§èƒ½æ£€æŸ¥è¡¨

1. é€‰æ‹©æ­£ç¡®çš„æ ¼å¼
2. å°½å¯èƒ½ä½¿ç”¨çŸ¢é‡å›¾
3. å¦‚æœå˜åŒ–ä¸æ˜æ˜¾ï¼Œåˆ™é™ä½è´¨é‡
4. å°è¯•æ–°æ ¼å¼
5. ä½¿ç”¨å·¥å…·å’Œç®—æ³•è¿›è¡Œä¼˜åŒ–
6. å­¦ä¹  srcset å±æ€§å’Œ picture å…ƒç´ 
7. ä½¿ç”¨å›¾ç‰‡ CDN

## Optimising web fonts

The ability to use custom fonts is an incredibly powerful design tool. But with power comes a lot of responsibility. With whooping **68% of websites leveraging web fonts this type of asset is one of the biggest performance offenders** (easily averaging 100KB, depending on the number of variants and typefaces).

Even when weight isnâ€™t the most major issue, **Flash of Invisible Text** (FOIT) is. FOIT occurs when web fonts are still loading or failed to be fetched, which results in an empty page and thus, inaccessible content. It might be worth it to [carefully examine whether we need web fonts in the first place](https://hackernoon.com/web-fonts-when-you-need-them-when-you-dont-a3b4b39fe0ae). If so, there are a few strategies to help us mitigate the negative effect on performance.

### Choosing the right format

There are four web font formats: EOT, TTF, WOFF and more recent WOFF2. TTF and WOFF are most widely adopted, boasting over 90% browser support. Depending on the support youâ€™re targeting **itâ€™s most likely safe to serve WOFF2** and fall back to WOFF for older browsers. The advantage of using WOFF2 is a set of custom preprocessing and compression algorithms (like [Brotli](https://github.com/google/brotli)) resulting in [approx. 30% file-size reduction](https://docs.google.com/presentation/d/10QJ_GABjwzfwUb5DZ3DULdv82k74QdPArkovYJZ-glc/present?slide=id.g1825bd881_0182) and improved parsing capabilities.

When defining the sources of web fonts in `@font-face` use the `format()` hint to specify which format should be utilised.

If youâ€™re using Google Fonts or Typekit to serve your fonts, both of these tools have implemented a few strategies to mitigate their performance footprint. Typekit now serves all kits asynchronously, preventing FOIT as well as allows for extended cache period of 10 days for their JavaScript kit code (instead of default 10 minutes). Google Fonts automatically serves the smallest file, based on the capabilities of the usersâ€™ device.

### Audit font selection

No matter whether self-hosting or not, the number of typefaces, font weights and styles will significantly affect your performance budgets.
Ideally, we can get away with one typeface featuring normal and bold stylistic variants. If youâ€™re not sure how to make font selection choices refer to Lara Hoganâ€™s [Weighing Aesthetics and Performance](http://designingforperformance.com/weighing-aesthetics-and-performance/).

### Use Unicode-range subsetting

Unicode-range subsetting allows splitting large fonts into smaller sets. Itâ€™s a relatively advanced strategy but might bring significant savings especially when targeting Asian languages (did you know Chinese fonts average at 20,000 glyphs?). The first step is to limit the font to the necessary language set, such as Latin, Greek or Cyrillic. If a web font is required only for logotype usage, itâ€™s worth it to use Unicode-range descriptor to pick specific characters.

The Filament Group released an Open Source command-line utility, [glyph hanger](https://github.com/filamentgroup/glyphhanger) that can generate a list of necessary glyphs based on files or URLs. Alternatively, the web-based [Font Squirrel Web Font Generator](https://www.fontsquirrel.com/tools/webfont-generator) offers advanced subsetting and optimisation options. If using Google Fonts or Typekit choosing a language subset is built into the typeface picker interface, making basic subsetting easier.

### Establish a font loading strategy

**Fonts are render-blocking**â€Šâ€”â€Šbecause the browser has to build both the DOM and CSSOM first; web fonts wonâ€™t be downloaded before theyâ€™re used in a CSS selector that matches an existing node. This behaviour significantly delays text rendering, often causing the **Flash of Invisible Text** (FOIT) mentioned before. FOIT is even more pronounced on slower networks and mobile devices.

Implementing a font loading strategy prevents users from not being able to access your content. Often, opting for **Flash of Unstyled Text** (FOUT) is the easiest and most effective solution.

`font-display` is a new CSS property providing a non-JavaScript reliant solution. Unfortunately, it has partial support (Chrome and Opera only) and is currently under development in Firefox and WebKit. Still, it can and should be used in combination with other font loading mechanisms.

![font-display property in action](https://cdn-images-1.medium.com/max/800/1*Kuky8fVepcjU3tMbTjewdw.png)

Luckily, Typekitâ€™s [Web Font Loader](https://github.com/typekit/webfontloader) and [Bram Steinâ€™s](https://twitter.com/bram_stein) [Font Face Observer](https://fontfaceobserver.com/) can help manage font loading behaviour. Additionally, [Zach Leatherman](https://twitter.com/zachleat), an expert on web font performance, published [A Comprehensive Guide to Font Loading Strategies](https://www.zachleat.com/web/comprehensive-webfonts) which will aid in choosing the right approach for your project.

ğŸ“ Web font performance checklist

1. Chose the right format
2. Audit the font selection
3. Use Unicode-range subsetting
4. Establish a font loading strategy

## Optimising JavaScript

At the moment, [the average size of JavaScript bundle is 446 KB](http://httparchive.org/trends.php#bytesJS&reqJS), which already makes it second biggest type of an asset size-wise (following images).

> What we might not realise is that thereâ€™s a much more sinister performance bottleneck hidden behind our beloved JavaScript.

### Monitor how much JavaScript is delivered

Optimising delivery is only one step in combating web page bloat. After JavaScript is downloaded, it has to be parsed, compiled and run by the browser. A quick look at a few popular sites and it becomes obvious that `gzipped` JS becomes **at least three times bigger after unpacking**. Effectively, we are sending giant blobs of code down the wire.

![](https://cdn-images-1.medium.com/max/800/1*Yrn4kTkaYHX0PWj4HB-mQg.jpeg)

Parse times for 1MB of JavaScript on different devices. Image courtesy of Addy Osmani and his [JavaScript Start-up Performance](https://medium.com/reloading/javascript-start-up-performance-69200f43b201) article.

Analysing parse and compile times becomes crucial to understanding when apps are ready to be interacted with. These timings vary significantly based the hardware capabilities of usersâ€™ device. **Parse and compile can easily be 2â€“5x times higher on lower end mobiles**. [Addyâ€™s](https://twitter.com/addyosmani) research confirms that on an average phone an app will take 16 seconds to reach an interactive state, compared to 8 seconds on a desktop. Itâ€™s crucial to analyse these metrics, and fortunately, we can do so through Chrome DevTools.

![Investigating parse and compile in Chrome Dev Tools](https://cdn-images-1.medium.com/max/800/1*eV83YP2fnoOllUleaWa5lw.gif)

ğŸ“š Make sure to read Addy Osmaniâ€™s detailed write-up on [JavaScript Start-up Performance](https://medium.com/reloading/javascript-start-up-performance-69200f43b201).

### Get rid of unnecessary dependencies

The way modern package managers work can easily obscure the number and the size of dependencies. [webpack-bundle-analyzer](https://www.npmjs.com/package/webpack-bundle-analyzer) and Bundle Buddy are great, visual tools helping identify code duplication, biggest performance offenders and outdated, unnecessary dependencies.

![Webpack bundle analyzer in action.](https://cdn-images-1.medium.com/max/800/1*dusVhPiL44VDoS4gJHMWSg.gif)

We can make imported package cost even more visible with `Import Cost` extension in [VS Code](https://marketplace.visualstudio.com/items?itemName=wix.vscode-import-cost) and [Atom](https://atom.io/packages/atom-import-cost).

![Import Code VS Code extension.](https://cdn-images-1.medium.com/max/800/1*LbfI4D9XXiZYS1Slwsys5g.gif)

### Implement code splitting

Whenever possible, **we should only serve the necessary assets to create the desired user experience**. Sending a full `bundle.js` file to the user, including code handling interactions they might never see is less than optimal (imagine downloading JavaScript handling an entire app when visiting a landing page). Similarly, we shouldnâ€™t be universally serving code targeting specific browsers or user agents.

Webpack, one of the most popular module bundlers, comes with [code splitting support](https://webpack.js.org/guides/code-splitting/). Most straightforward code splitting can be implemented per page (`home.js` for a landing page, `contact.js` for a contact page, etc.), but Webpack offers few advanced strategies like dynamic imports or [lazy loading](https://webpack.js.org/guides/lazy-loading/) that might be worth looking into as well.

### Consider framework alternatives

JavaScript front-end frameworks are constantly on the rise. According to the [State of JavaScript 2016 survey](https://stateofjs.com/2016/frontend/) React is the most popular option. Carefully auditing architecture choices though might show that youâ€™d be better off with a much more lightweight alternative such as [Preact](https://preactjs.com/) (note that Preact isnâ€™t trying to be a full React reimplementation, just a [highly performant](https://github.com/developit/preact-perf), less featured virtual DOM library). Similarly, we can swap bigger libraries for smaller altrnativesâ€Šâ€”â€Š`moment.js` for `date-fns` (or in particular case of `moment.js` [remove unused](https://github.com/distilagency/starward/issues/81) `locales`).

**Before starting a new project, itâ€™s worthwhile to determine what kind of features are necessary and pick the most performant framework for your needs and goals**. Sometimes that might mean opting for writing more vanilla JavaScript instead.

ğŸ“ JavaScript performance checklist

1. Monitor how much JavaScript is delivered
2. Get rid of unnecessary dependencies
3. Implement code splitting
4. Consider framework alternatives

## Tracking performance and the road forward

Weâ€™ve talked about several strategies that in most cases will yield positive changes to the user experience of products weâ€™re building. Performance can be a tricky beast though, and itâ€™s necessary to track the long-term results of our tweaks.

### User-centric performance metrics

Great performance metrics aim to be as close to portraying user experience as possible. Long established `onLoad`, `onContentLoaded` or `SpeedIndex` tell us very little about how soon sites can be interacted with. When focusing only on the delivery of assets, itâ€™s not easy to quantify [perceived performance](https://calibreapp.com/docs/metrics/user-focused-metrics). Fortunately, there are a few timings that paint quite a comprehensive picture of how soon content is both visible and interactive.

Those metrics are First Paint, First Meaningful Paint, Visually Complete and Time to Interactive.

![](https://cdn-images-1.medium.com/max/800/1*fjqW4fRUD7iIrzcKfUkfIg.png)

- **First Paint**: the browser changed from a white screen to the first visual change.
- **First Meaningful Paint**: text, images and major items are viewable.
- **Visually Complete**: all content in the viewport is visible.
- **Time to Interactive**: all content in the viewport is visible and ready to interact with (no major main thread JavaScript activity).
- 
These timings directly correspond to what the users see therefore make excellent candidates for tracking. If possible, record all, otherwise pick one or two to have a better understanding of perceived performance. Itâ€™s worth keeping an eye on other metrics as well, especially the number of bytes (optimised and unpacked) weâ€™re sending.

### Setting performance budgets

All of these figures might quickly become confusing and cumbersome to understand. Without actionable goals and targets, itâ€™s easy to lose track of what weâ€™re trying to achieve. A good few years ago [Tim Kadlec](https://twitter.com/tkadlec) wrote about the concept of [performance budgets](https://timkadlec.com/2013/01/setting-a-performance-budget/).

Unfortunately, thereâ€™s no magical formula for setting them. Often performance budgets boil down to competitive analysis and product goals, which are unique to each business.

When setting budgets, itâ€™s important to aim for a noticeable difference, which usually equals to at least 20% improvement. Experiment and iterate on your budgets, leveraging Lara Hoganâ€™s [Approach New Designs with a Performance Budget](http://designingforperformance.com/weighing-aesthetics-and-performance/#approach-new-designs-with-a-performance-budget) as a reference.

ğŸ›  Try out [Performance Budget Calculator](http://www.performancebudget.io/) or [Browser Calories](https://browserdiet.com/calories/) Chrome extension to aid in creating budgets.

### Continuous monitoring

Monitoring performance shouldnâ€™t be manual. There are quite a few powerful tools offering comprehensive reporting.

[Google Lighthouse](https://developers.google.com/web/tools/lighthouse/) is an Open Source project auditing performance, accessibility, progressive web apps, and more. Itâ€™s possible to use Lighthouse in the command line or as just recently, directly in Chrome Developer Tools.

![Lighthouse performing a performance audit.](https://cdn-images-1.medium.com/max/800/1*T3HA3VrN48JsCAHWFfnu3g.gif)

For continuous tracking opt-in for [Calibre](https://calibreapp.com/) that offers performance budgets, device emulation, distributed monitoring and many other features that are impossible to get without carefully building your own performance suite.

![Comprehensive performance tracking in Calibre.](https://cdn-images-1.medium.com/max/800/1*LTFZ7zMASCWUz3r0eqXdoQ.gif)

Wherever youâ€™re tracking, make sure to make the data transparent and accessible to the entire team, or in smaller organisations, the whole business.

> Performance is a shared responsibility, which spans further than developer teamsâ€Šâ€”â€Šweâ€™re all accountable for the user experience weâ€™re creating, no matter role or title.

Itâ€™s incredibly important to advocate for speed and establish collaboration processes to catch possible bottlenecks as early as product decisions or design phases.

**Building performance awareness and empathy
Caring about performance isnâ€™t only a business goal** (but if you need to sell it through sales statistics do so with [PWA Stats](https://www.pwastats.com/)). Itâ€™s about fundamental empathy and putting the best interest of the users first.

> As technologists, itâ€™s our responsibility not to hijack attention and time people could be happily spending elsewhere. Our objective is to [build tools that are conscious of time and human focus](http://www.timewellspent.io/).

Advocating for performance awareness should be everyoneâ€™s goal. Letâ€™s build a better, more mindful future for all of us with performance and empathy in mind.


---

> [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner) æ˜¯ä¸€ä¸ªç¿»è¯‘ä¼˜è´¨äº’è”ç½‘æŠ€æœ¯æ–‡ç« çš„ç¤¾åŒºï¼Œæ–‡ç« æ¥æºä¸º [æ˜é‡‘](https://juejin.im) ä¸Šçš„è‹±æ–‡åˆ†äº«æ–‡ç« ã€‚å†…å®¹è¦†ç›– [Android](https://github.com/xitu/gold-miner#android)ã€[iOS](https://github.com/xitu/gold-miner#ios)ã€[React](https://github.com/xitu/gold-miner#react)ã€[å‰ç«¯](https://github.com/xitu/gold-miner#å‰ç«¯)ã€[åç«¯](https://github.com/xitu/gold-miner#åç«¯)ã€[äº§å“](https://github.com/xitu/gold-miner#äº§å“)ã€[è®¾è®¡](https://github.com/xitu/gold-miner#è®¾è®¡) ç­‰é¢†åŸŸï¼Œæƒ³è¦æŸ¥çœ‹æ›´å¤šä¼˜è´¨è¯‘æ–‡è¯·æŒç»­å…³æ³¨ [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)ã€[å®˜æ–¹å¾®åš](http://weibo.com/juejinfanyi)ã€[çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/juejinfanyi)ã€‚
