> * åŸæ–‡åœ°å€ï¼š[A Complete React Redux Tutorial for 2019](https://daveceddia.com/redux-tutorial/)
> * åŸæ–‡ä½œè€…ï¼š[Dave Ceddia](https://daveceddia.com/)
> * è¯‘æ–‡å‡ºè‡ªï¼š[æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)
> * æœ¬æ–‡æ°¸ä¹…é“¾æ¥ï¼š[https://github.com/xitu/gold-miner/blob/master/TODO1/redux-tutorial.md](https://github.com/xitu/gold-miner/blob/master/TODO1/redux-tutorial.md)
> * è¯‘è€…ï¼š[xilihuasi](https://github.com/xilihuasi)
> * æ ¡å¯¹è€…ï¼š[xionglong58](https://github.com/xionglong58)ã€[Fengziyin1234](https://github.com/Fengziyin1234)

# 2019 React Redux å®Œå…¨æŒ‡å—

![A Complete Redux Tutorial (2019): why use it? - store - reducers - actions - thunks - data fetching](https://daveceddia.com/images/complete-redux-tutorial-2019.png)

æƒ³è¦ç†è§£ Redux å®Œæ•´çš„å·¥ä½œæœºåˆ¶çœŸçš„è®©äººå¤´ç–¼ã€‚ç‰¹åˆ«æ˜¯ä½œä¸ºåˆå­¦è€…ã€‚

æœ¯è¯­å¤ªå¤šäº†ï¼Actionsã€reducersã€action creatorsã€middlewareã€pure functionsã€immutabilityã€thunks ç­‰ç­‰ã€‚

æ€ä¹ˆæŠŠè¿™äº›å…¨éƒ½ä¸ React ç»“åˆèµ·æ¥æ„å»ºä¸€ä¸ªå¯è¿è¡Œçš„åº”ç”¨ï¼Ÿ

ä½ å¯ä»¥èŠ±å‡ ä¸ªå°æ—¶é˜…è¯»åšå®¢ä»¥åŠå°è¯•ä»å¤æ‚çš„â€œçœŸå®ä¸–ç•Œâ€åº”ç”¨ä¸­ç ”ä¹ ä»¥å°†å®ƒæ‹¼å‡‘èµ·æ¥ã€‚

åœ¨æœ¬ç¯‡ Redux æ•™ç¨‹ä¸­ï¼Œæˆ‘ä¼šæ¸è¿›åœ°è§£é‡Šå¦‚ä½•å°† Redux ä¸ React æ­é…ä½¿ç”¨ â€”â€” ä»ç®€å•çš„ React å¼€å§‹ â€”â€” ä»¥åŠä¸€ä¸ªéå¸¸ç®€å•çš„ React + Redux æ¡ˆä¾‹ã€‚æˆ‘ä¼šè§£é‡Š**ä¸ºä»€ä¹ˆ**æ¯ä¸ªåŠŸèƒ½éƒ½å¾ˆæœ‰ç”¨ï¼ˆä»¥åŠä»€ä¹ˆæƒ…å†µä¸‹åšå–èˆï¼‰ã€‚

æ¥ç€æˆ‘ä»¬ä¼šçœ‹åˆ°æ›´åŠ è¿›é˜¶çš„å†…å®¹ï¼Œæ‰‹æŠŠæ‰‹ï¼Œç›´åˆ°ä½ **å…¨éƒ¨**éƒ½ç†è§£ä¸ºæ­¢ã€‚æˆ‘ä»¬å¼€å§‹å§ :)

è¯·æ³¨æ„ï¼šæœ¬æ•™ç¨‹**ç›¸å½“é½å…¨**ã€‚ä¹Ÿå°±æ„å‘³ç¯‡å¹…ç€**æ¯”è¾ƒé•¿**ã€‚æˆ‘æŠŠå®ƒå˜æˆäº†ä¸€ä¸ªå®Œæ•´çš„å…è´¹è¯¾ç¨‹ï¼Œ**å¹¶ä¸”**æˆ‘åˆ¶ä½œäº†ç²¾ç¾çš„ PDF ä½ å¯ä»¥åœ¨ iPad æˆ–ã€ä»»ä½• Android è®¾å¤‡ã€‘ä¸Šé˜…è¯»ã€‚ç•™ä¸‹ä½ çš„é‚®ç®±åœ°å€å³å¯ç«‹å³è·å–ã€‚

## è§†é¢‘æ¦‚è¿° Redux è¦ç‚¹

å¦‚æœä½ æ›´å–œæ¬¢çœ‹è§†é¢‘è€Œä¸æ˜¯é˜…è¯»ï¼Œè¿™ä¸ªè§†é¢‘æ¶µç›–äº†å¦‚ä½•åœ¨ React åº”ç”¨ä¸­ä¸€æ­¥æ­¥æ·»åŠ  Reduxï¼š

[è§†é¢‘åœ°å€](https://youtu.be/sX3KeP7v7Kg)

è¿™ä¸æœ¬æ•™ç¨‹çš„ç¬¬ä¸€éƒ¨åˆ†ç›¸ä¼¼ï¼Œæˆ‘ä»¬éƒ½ä¼šåœ¨ä¸€ä¸ªç®€å• React åº”ç”¨ä¸­é€æ­¥åœ°æ·»åŠ  Reduxã€‚

æˆ–è€…ï¼Œç»§ç»­çœ‹ä¸‹å»ï¼æœ¬æ•™ç¨‹ä¸ä»…æ¶µç›–è§†é¢‘ä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œè¿˜æœ‰å…¶ä»–å¹²è´§ã€‚

## ä½ åº”è¯¥ç”¨ Redux å—ï¼Ÿ

éƒ½ 9102 å¹´äº†ï¼Œå¼„æ¸…æ¥šä½ æ˜¯å¦è¿˜åº”è¯¥ä½¿ç”¨ Redux ååˆ†å¿…è¦ã€‚ç°åœ¨æœ‰æ›´å¥½çš„æ›¿ä»£å“å‡ºç°å—ï¼Œä½¿ç”¨ Hooksï¼ŒContext è¿˜æ˜¯å…¶ä»–åº“ï¼Ÿ

ç®€è€Œè¨€ä¹‹ï¼šå³ä½¿æœ‰å¾ˆå¤šæ›¿ä»£å“ï¼Œ[Redux ä»æ—§ä¸æ­»](https://blog.isquaredsoftware.com/2018/03/redux-not-dead-yet/)ã€‚ä½†æ˜¯æ˜¯å¦é€‚ç”¨äºä½ çš„åº”ç”¨ï¼Œè¿˜å¾—çœ‹å…·ä½“åœºæ™¯ã€‚

è¶…çº§ç®€å•ï¼Ÿåªæœ‰ä¸€ä¸¤ä¸ªåœ°æ–¹éœ€è¦ç”¨åˆ°å‡ ä¸ª stateï¼Ÿç»„ä»¶å†…éƒ¨ state å°±å¾ˆå¥½äº†ã€‚ä½ å¯ä»¥é€šè¿‡ classesï¼Œ[Hooks](https://daveceddia.com/intro-to-hooks/) æˆ–è€…äºŒè€…ä¸€èµ·æ¥å®ç°ã€‚

å†å¤æ‚ä¸€ç‚¹ï¼Œæœ‰ä¸€äº›â€œå…¨å±€â€çš„ä¸œè¥¿éœ€è¦åœ¨æ•´ä¸ªåº”ç”¨ä¸­å…±äº«ï¼Ÿ[Context API](https://daveceddia.com/context-api-vs-redux/) å¯èƒ½å®Œç¾é€‚åˆä½ ã€‚

å¾ˆå¤šå…¨å±€çš„ stateï¼Œä¸åº”ç”¨çš„å„ç‹¬ç«‹éƒ¨åˆ†éƒ½æœ‰äº¤äº’ï¼Ÿæˆ–è€…ä¸€ä¸ªå¤§å‹åº”ç”¨å¹¶ä¸”éšç€æ—¶é—´æ¨ç§»åªä¼šè¶Šæ¥è¶Šå¤§ï¼Ÿè¯•è¯• Redux å§ã€‚

ä½ ä¹Ÿå¯ä»¥**ä»¥å**å†ä½¿ç”¨ Reduxï¼Œä¸å¿…åœ¨ç¬¬ä¸€å¤©å°±å†³å®šã€‚ä»ç®€å•å¼€å§‹ï¼Œåœ¨ä½ éœ€è¦çš„æ—¶å€™å†å¢åŠ å¤æ‚æ€§ã€‚

### ä½ çŸ¥é“ React å—ï¼Ÿ

React å¯ä»¥è„±ç¦» Redux å•ç‹¬ä½¿ç”¨ã€‚Redux æ˜¯ React çš„**é™„åŠ é¡¹**ã€‚

å³ä½¿ä½ æ‰“ç®—åŒæ—¶ä½¿ç”¨å®ƒä»¬ï¼Œæˆ‘è¿˜æ˜¯å¼ºçƒˆå»ºè®®å…ˆ**è„±ç¦»** Redux å­¦ä¹ çº¯ç²¹çš„ Reactã€‚ç†è§£ propsï¼Œstate ä»¥åŠå•å‘æ•°æ®æµï¼Œåœ¨å­¦ä¹  Redux ä¹‹å‰å…ˆå­¦ä¹  â€œReact ç¼–ç¨‹æ€æƒ³â€ã€‚åŒæ—¶å­¦ä¹ è¿™ä¸¤ä¸ªè‚¯å®šä¼šæŠŠä½ ææ™•ã€‚

å¦‚æœä½ æƒ³è¦å…¥é—¨ React ï¼Œæˆ‘æ•´ç†äº†ä¸€ä¸ªä¸ºæœŸ 5 å¤©çš„å…è´¹è¯¾ç¨‹ï¼Œæ•™æˆæ‰€æœ‰åŸºç¡€çŸ¥è¯†ï¼š

æ¥ä¸‹æ¥çš„ 5 å¤©é€šè¿‡æ„å»ºä¸€äº›ç®€å•çš„åº”ç”¨æ¥å­¦ä¹  Reactã€‚

ç¬¬ä¸€è¯¾

## Redux çš„å¥½å¤„

å¦‚æœä½ ç¨å¾®ä½¿ç”¨è¿‡ä¸€æ®µæ—¶é—´çš„ Reactï¼Œä½ å¯èƒ½å°±äº†è§£äº† props å’Œå•å‘æ•°æ®æµã€‚æ•°æ®é€šè¿‡ props åœ¨ç»„ä»¶æ ‘é—´å‘**ä¸‹**ä¼ é€’ã€‚å°±åƒè¿™ä¸ªç»„ä»¶ä¸€æ ·ï¼š

![Counter component](https://daveceddia.com/images/counter-component.png)

`count` å­˜åœ¨ `App` çš„ state é‡Œï¼Œä¼šä»¥ prop çš„å½¢å¼å‘ä¸‹ä¼ é€’ï¼š

![Passing props down](https://daveceddia.com/images/passing-props-down.png)

è¦æƒ³æ•°æ®å‘**ä¸Š**ä¼ é€’ï¼Œéœ€è¦é€šè¿‡å›è°ƒå‡½æ•°å®ç°ï¼Œå› æ­¤å¿…é¡»é¦–å…ˆå°†å›è°ƒå‡½æ•°å‘**ä¸‹**ä¼ é€’åˆ°ä»»ä½•æƒ³é€šè¿‡è°ƒç”¨å®ƒæ¥ä¼ é€’æ•°æ®çš„ç»„ä»¶ä¸­ã€‚

![Passing callbacks down](https://daveceddia.com/images/passing-callbacks-down.png)

ä½ å¯ä»¥æŠŠæ•°æ®æƒ³è±¡æˆ**ç”µæµ**ï¼Œé€šè¿‡å½©è‰²ç”µçº¿è¿æ¥éœ€è¦å®ƒçš„ç»„ä»¶ã€‚æ•°æ®é€šè¿‡çº¿è·¯ä¸Šä¸‹æµåŠ¨ï¼Œä½†æ˜¯çº¿è·¯ä¸èƒ½åœ¨ç©ºæ°”ä¸­è´¯ç©¿ â€”â€” å®ƒä»¬å¿…é¡»ä»ä¸€ä¸ªç»„ä»¶è¿æ¥åˆ°å¦ä¸€ä¸ªç»„ä»¶ã€‚

### å¤šçº§ä¼ é€’æ•°æ®æ˜¯ä¸€ç§ç—›è‹¦

è¿Ÿæ—©ä½ ä¼šé™·å…¥è¿™ç±»åœºæ™¯ï¼Œé¡¶çº§å®¹å™¨ç»„ä»¶æœ‰ä¸€äº›æ•°æ®ï¼Œæœ‰ä¸€ä¸ª 4 çº§ä»¥ä¸Šçš„å­ç»„ä»¶éœ€è¦è¿™äº›æ•°æ®ã€‚è¿™æœ‰ä¸€ä¸ª Twitter çš„ä¾‹å­ï¼Œæ‰€æœ‰å¤´åƒéƒ½åœˆå‡ºæ¥äº†ï¼š

![Twitter user data](https://daveceddia.com/images/twitter-user-data.png)

æˆ‘ä»¬å‡è®¾æ ¹ç»„ä»¶ `App` çš„ state æœ‰ `user` å¯¹è±¡ã€‚è¯¥å¯¹è±¡åŒ…å«å½“å‰ç”¨æˆ·å¤´åƒã€æ˜µç§°å’Œå…¶ä»–èµ„æ–™ä¿¡æ¯ã€‚

ä¸ºäº†æŠŠ `user` æ•°æ®ä¼ é€’ç»™å…¨éƒ¨ 3 ä¸ª `Avatar` ç»„ä»¶ï¼Œå¿…é¡»è¦ç»è¿‡ä¸€å †å¹¶ä¸éœ€è¦è¯¥æ•°æ®çš„ä¸­é—´ç»„ä»¶ã€‚

![Sending the user data down to the Avatar components](https://daveceddia.com/images/twitter-hierarchy.png)

è·å–æ•°æ®å°±åƒç”¨é’ˆåœ¨é‡‡çŸ¿æ¢é™©ä¸€æ ·ã€‚ç­‰ç­‰ï¼Œé‚£æ ¹æœ¬æ²¡æœ‰æ„ä¹‰ã€‚æ— è®ºå¦‚ä½•ï¼Œ**è¿™å¾ˆç—›è‹¦**ã€‚ä¹Ÿè¢«ç§°ä¸º â€œprop-drillingâ€ã€‚

æ›´é‡è¦çš„æ˜¯ï¼Œè¿™ä¸æ˜¯å¥½çš„è½¯ä»¶è®¾è®¡ã€‚ä¸­é—´ç»„ä»¶è¢«è¿«æ¥å—å’Œä¼ é€’ä»–ä»¬å¹¶ä¸å…³å¿ƒçš„ propsã€‚ä¹Ÿå°±æ„å‘³ç€é‡æ„å’Œé‡ç”¨è¿™äº›ç»„ä»¶ä¼šå˜å¾—æ¯”åŸæœ¬æ›´éš¾ã€‚

å¦‚æœä¸éœ€è¦è¿™äº›æ•°æ®çš„ç»„ä»¶æ ¹æœ¬ä¸ç”¨çœ‹åˆ°å®ƒä»¬çš„è¯ä¸æ˜¯å¾ˆæ£’å—ï¼Ÿ

Redux å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ç§æ–¹æ³•ã€‚

### ç›¸é‚»ç»„ä»¶é—´çš„æ•°æ®ä¼ é€’

å¦‚æœä½ æœ‰äº›å…„å¼Ÿç»„ä»¶éœ€è¦å…±äº«æ•°æ®ï¼ŒReact çš„æ–¹å¼æ˜¯æŠŠæ•°æ®å‘**ä¸Š**ä¼ åˆ°çˆ¶ç»„ä»¶ä¸­ï¼Œç„¶åå†é€šè¿‡ props å‘ä¸‹ä¼ é€’ã€‚

ä½†è¿™å¯èƒ½å¾ˆéº»çƒ¦ã€‚Redux ä¼šä¸ºä½ æä¾›ä¸€ä¸ªå¯ä»¥å­˜å‚¨æ•°æ®çš„å…¨å±€ "parent"ï¼Œç„¶åä½ å¯ä»¥é€šè¿‡ React-Redux æŠŠå…„å¼Ÿç»„ä»¶å’Œæ•°æ® `connect` èµ·æ¥ã€‚

### ä½¿ç”¨ React-Redux å°†æ•°æ®è¿æ¥åˆ°ä»»ä½•ç»„ä»¶

ä½¿ç”¨ `react-redux` çš„ `connect` å‡½æ•°ï¼Œä½ å¯ä»¥å°†ä»»ä½•ç»„ä»¶æ’å…¥ Redux çš„ store ä»¥åŠå–å‡ºéœ€è¦çš„æ•°æ®ã€‚

![Connecting Redux to the Avatar components](https://daveceddia.com/images/redux-connected-twitter.png)

Redux è¿˜åšäº†ä¸€äº›å¾ˆé…·çš„äº‹æƒ…ï¼Œæ¯”å¦‚ä½¿è°ƒè¯•æ›´è½»æ¾ï¼ˆRedux DevTools è®©ä½ æ£€æŸ¥æ¯ä¸€ä¸ª state çš„å˜åŒ–ï¼‰ï¼Œtime-travel debuggingï¼ˆä½ å¯ä»¥**å›æ»š** state å˜åŒ–ï¼Œçœ‹çœ‹ä½ çš„åº”ç”¨ä»¥å‰çš„æ ·å­ï¼‰ï¼Œä»é•¿è¿œæ¥çœ‹ï¼Œå®ƒè®©ä»£ç å˜å¾—æ›´æ˜“äºç»´æŠ¤ã€‚å®ƒä¹Ÿä¼šæ•™ä½ æ›´å¤šå…³äºå‡½æ•°å¼ç¼–ç¨‹çš„çŸ¥è¯†ã€‚

## å†…ç½® Redux æ›¿ä»£å“

å¦‚æœ Redux å¯¹ä½ æ¥è¯´å¤ªè¿‡ç¹çäº†ï¼Œå¯ä»¥çœ‹çœ‹è¿™äº›æ›¿ä»£å“ã€‚å®ƒä»¬å†…ç½®åœ¨ React ä¸­ã€‚

### Redux æ›¿ä»£å“: The React Context API

åœ¨åº•å±‚ï¼ŒReact-Redux ä½¿ç”¨ React å†…ç½®çš„ Context API æ¥ä¼ é€’æ•°æ®ã€‚å¦‚æœä½ æ„¿æ„ï¼Œä½ å¯ä»¥è·³è¿‡ Redux ç›´æ¥ä½¿ç”¨ Contextã€‚ä½ ä¼šé”™è¿‡ä¸Šé¢æåˆ°çš„ Redux å¾ˆæ£’çš„ç‰¹æ€§ï¼Œä½†æ˜¯å¦‚æœä½ çš„åº”ç”¨å¾ˆç®€å•å¹¶ä¸”æƒ³ç”¨ç®€å•çš„æ–¹å¼ä¼ é€’æ•°æ®ï¼ŒContext å°±å¤Ÿäº†ã€‚

æ—¢ç„¶ä½ è¯»åˆ°è¿™é‡Œï¼Œæˆ‘è®¤ä¸ºä½ çœŸæƒ³å­¦ä¹  Reduxï¼Œæˆ‘ä¸ä¼šåœ¨è¿™é‡Œ[æ¯”è¾ƒ Redux å’Œ Context API](https://daveceddia.com/context-api-vs-redux/) æˆ–è€…[ä½¿ç”¨ Context](https://daveceddia.com/usecontext-hook/) å’Œ[ä½¿ç”¨ Reducer](https://daveceddia.com/usereducer-hook-examples/) Hooksã€‚ä½ å¯ä»¥ç‚¹å‡»é“¾æ¥è¯¦ç»†äº†è§£ã€‚

å¦‚æœä½ æƒ³æ·±å…¥ç ”ç©¶ Context APIï¼Œçœ‹æˆ‘åœ¨ egghead çš„è¯¾ç¨‹ [React Context çŠ¶æ€ç®¡ç†](https://egghead.io/courses/react-context-for-state-management)

### å…¶ä»–æ›¿ä»£å“ï¼šä½¿ç”¨ `children` Prop

å–å†³äºä½ æ„å»ºåº”ç”¨ç¨‹åºçš„æ–¹å¼ï¼Œä½ å¯èƒ½ä¼šç”¨æ›´ç›´æ¥çš„æ–¹å¼æŠŠæ•°æ®ä¼ é€’ç»™å­ç»„ä»¶ï¼Œé‚£å°±æ˜¯ä½¿ç”¨ `children` å’Œå…¶ä»– props ç»“åˆçš„æ–¹å¼ä½œä¸ºâ€œæ’æ§½â€ã€‚å¦‚æœä½ ç»„ç»‡çš„æ–¹å¼æ­£ç¡®ï¼Œå°±å¯ä»¥æœ‰æ•ˆåœ°è·³è¿‡å±‚æ¬¡ç»“æ„ä¸­çš„å‡ ä¸ªå±‚çº§ã€‚

æˆ‘æœ‰ä¸€ç¯‡ç›¸å…³æ–‡ç«  [â€œæ’æ§½â€æ¨¡å¼ä»¥åŠå¦‚ä½•ç»„ç»‡ç»„ä»¶æ ‘](https://daveceddia.com/pluggable-slots-in-react-components/) æ¥æœ‰æ•ˆåœ°ä¼ é€’æ•°æ®ã€‚

## å­¦ä¹  Reduxï¼Œä»ç®€å• React å¼€å§‹

æˆ‘ä»¬å°†é‡‡ç”¨å¢é‡çš„æ–¹æ³•ï¼Œä»å¸¦æœ‰ç»„ä»¶ state çš„ç®€å• React åº”ç”¨å¼€å§‹ï¼Œä¸€ç‚¹ç‚¹æ·»åŠ  Reduxï¼Œä»¥åŠè§£å†³è¿‡ç¨‹ä¸­é‡åˆ°çš„é”™è¯¯ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œé”™è¯¯é©±åŠ¨å‹å¼€å‘â€ :)

è¿™æ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼š

![Counter component](https://daveceddia.com/images/counter-plain.png)

è¿™æœ¬ä¾‹ä¸­ï¼ŒCounter ç»„ä»¶æœ‰ stateï¼ŒåŒ…è£¹ç€å®ƒçš„ App æ˜¯ä¸€ä¸ªç®€å•åŒ…è£…å™¨ã€‚

Counter.js

```js
import React from 'react';

class Counter extends React.Component {
  state = { count: 0 }

  increment = () => {
    this.setState({
      count: this.state.count + 1
    });
  }

  decrement = () => {
    this.setState({
      count: this.state.count - 1
    });
  }

  render() {
    return (
      <div>
        <h2>Counter</h2>
        <div>
          <button onClick={this.decrement}>-</button>
          <span>{this.state.count}</span>
          <button onClick={this.increment}>+</button>
        </div>
      </div>
    )
  }
}

export default Counter;
```

å¿«é€Ÿå›é¡¾ä¸€ä¸‹ï¼Œå®ƒæ˜¯å¦‚ä½•è¿è¡Œçš„ï¼š

- `count` state å­˜å‚¨åœ¨ `Counter` ç»„ä»¶
- å½“ç”¨æˆ·ç‚¹å‡» "+" æ—¶ï¼Œä¼šè°ƒç”¨æŒ‰é’®çš„ `onClick` å¤„ç†å™¨æ‰§è¡Œ `increment` å‡½æ•°ã€‚
- `increment` å‡½æ•°ä¼šæ›´æ–° state çš„ count å€¼ã€‚
- å› ä¸º state æ”¹å˜äº†ï¼ŒReact ä¼šé‡æ–°æ¸²æŸ“ `Counter` ç»„ä»¶ï¼ˆä»¥åŠå®ƒçš„å­å…ƒç´ ï¼‰ï¼Œè¿™æ ·å°±ä¼šæ˜¾ç¤ºæ–°è®¡æ•°å€¼ã€‚

å¦‚æœä½ æƒ³è¦äº†è§£ state å˜åŒ–æœºåˆ¶çš„æ›´å¤šç»†èŠ‚ï¼Œå»çœ‹ [React ä¸­çš„ state å¯è§†æŒ‡å—](https://daveceddia.com/visual-guide-to-state-in-react/)ç„¶åå†å›åˆ°è¿™é‡Œã€‚

ä¸è¿‡è¯´å®è¯ï¼šå¦‚æœä¸Šé¢å†…å®¹å¯¹ä½ æ¥è®²**ä¸æ˜¯**å¤ä¹ çš„è¯ï¼Œä½ éœ€è¦åœ¨å­¦ Redux **ä¹‹å‰**äº†è§£ä¸‹ React çš„ state å¦‚ä½•å·¥ä½œï¼Œå¦åˆ™ä½ ä¼šå·¨å›°æƒ‘ã€‚å‚åŠ æˆ‘[å…è´¹çš„ 5 å¤© React è¯¾ç¨‹](https://daveceddia.com/pure-react-email-course)ï¼Œç”¨ç®€å•çš„ React è·å¾—ä¿¡å¿ƒï¼Œç„¶åå†å›åˆ°è¿™é‡Œã€‚

### è·Ÿä¸Šæ¥ï¼

æœ€å¥½çš„å­¦ä¹ æ–¹å¼å°±æ˜¯åŠ¨æ‰‹å°è¯•ï¼æ‰€ä»¥è¿™æœ‰ä¸ª CodeSandbox ä½ å¯ä»¥è·Ÿç€åšï¼š

--> [åœ¨æ–° tab ä¸­æ‰“å¼€ CodeSandbox](https://codesandbox.io/s/98153xy79w)

æˆ‘å¼ºçƒˆå»ºè®®ä½ å°† CodeSandbox ä¸è¯¥æ•™ç¨‹ä¿æŒåŒæ­¥å¹¶ä¸”éšç€ä½ è¿›è¡Œæ—¶å®é™…åŠ¨æ‰‹æ•²å‡ºè¿™äº›ä¾‹å­ã€‚

## åœ¨ React åº”ç”¨ä¸­æ·»åŠ  Redux

åœ¨ CodeSandbox ä¸­ï¼Œå±•å¼€å·¦ä¾§çš„ Dependencies é€‰é¡¹ï¼Œç„¶åç‚¹å‡» Add Dependencyã€‚

æœç´¢ `redux` æ·»åŠ ä¾èµ–ï¼Œç„¶åå†æ¬¡ç‚¹å‡» Add Dependency æœç´¢ `react-redux` æ·»åŠ ã€‚

![](https://daveceddia.com/images/add-redux-in-codesandbox.gif)

åœ¨æœ¬åœ°é¡¹ç›®ï¼Œä½ å¯ä»¥é€šè¿‡ Yarn æˆ–è€… NPM å®‰è£…ï¼š`npm install --save redux react-redux`ã€‚

### redux vs react-redux

`redux` ç»™ä½ ä¸€ä¸ª storeï¼Œè®©ä½ å¯ä»¥åœ¨é‡Œé¢ä¿å­˜ stateï¼Œå–å‡º stateï¼Œä»¥åŠå½“ state å‘ç”Ÿæ”¹å˜æ—¶åšå‡ºå“åº”ã€‚ä½†é‚£å°±æ˜¯å®ƒæ‰€æœ‰èƒ½åšçš„äº‹ã€‚

å®é™…ä¸Šæ˜¯ `react-redux` æŠŠå„ä¸ª state å’Œ React ç»„ä»¶è¿æ¥èµ·æ¥ã€‚

æ²¡é”™ï¼š`redux` å¯¹ React **æ ¹æœ¬**ä¸äº†è§£ã€‚

è™½ç„¶ï¼Œè¿™ä¸¤ä¸ªåº“å°±åƒè±†èšé‡Œçš„ä¸¤ä¸ªè±Œè±†ã€‚99.999% çš„æƒ…å†µä¸‹ï¼Œå½“ä»»ä½•äººåœ¨ React çš„åœºæ™¯ä¸‹æåˆ° "Redux"ï¼Œä»–ä»¬æŒ‡çš„æ˜¯è¿™ä¸¤ä¸ªåº“ã€‚å› æ­¤å½“ä½ åœ¨ StackOverflowã€Reddit æˆ–è€…å…¶ä»–åœ°æ–¹çœ‹åˆ° Redux æ—¶ï¼Œè®°ä½è¿™ä¸€ç‚¹ã€‚

`redux` åº“å¯ä»¥è„±ç¦» React åº”ç”¨ä½¿ç”¨ã€‚å®ƒå¯ä»¥å’Œ Vueã€Angular ç”šè‡³åç«¯çš„ Node/Express åº”ç”¨ä¸€èµ·ä½¿ç”¨ã€‚

## Redux æœ‰å…¨å±€å”¯ä¸€ Store

æˆ‘ä»¬å°†é¦–å…ˆä» Redux ä¸­çš„ä¸€å°éƒ¨åˆ†å…¥æ‰‹ï¼šstoreã€‚

æˆ‘ä»¬å·²ç»è®¨è®ºè¿‡ Redux æ€æ ·åœ¨ä¸€ä¸ªç‹¬ç«‹ store é‡Œä¿å­˜ä½ åº”ç”¨çš„ stateã€‚ä»¥åŠæ€æ ·æå– state çš„ä¸€éƒ¨åˆ†æŠŠå®ƒä½œä¸º props åµŒå…¥ä½ çš„ç»„ä»¶ã€‚

ä½ ä¼šç»å¸¸çœ‹åˆ° "state" å’Œ "store" è¿™ä¸¤ä¸ªè¯äº’æ¢ä½¿ç”¨ã€‚æŠ€æœ¯ä¸Šæ¥è®²ï¼Œstate æ˜¯æ•°æ®ï¼Œstore æ˜¯ä¿å­˜æ•°æ®çš„åœ°æ–¹ã€‚

å› æ­¤ï¼šä½œä¸ºæˆ‘ä»¬ä»ç®€å•çš„ React åˆ° Redux é‡æ„çš„ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ª store æ¥ä¿æŒ stateã€‚

## åˆ›å»º Redux Store

Redux æœ‰ä¸€ä¸ªå¾ˆæ–¹ä¾¿çš„å‡½æ•°ç”¨æ¥åˆ›å»º storesï¼Œå«åš `createStore`ã€‚å¾ˆåˆé€»è¾‘ï¼Œå—¯ï¼Ÿ

æˆ‘ä»¬åœ¨ `index.js` ä¸­åˆ›å»ºä¸€ä¸ª storeã€‚å¼•å…¥ `createStore` ç„¶ååƒè¿™æ ·è°ƒç”¨ï¼š

index.js

```js
import { createStore } from 'redux';

const store = createStore();

const App = () => (
  <div>
    <Counter/>
  </div>
);
```

è¿™æ ·ä¼šé‡åˆ° "Expected the reducer to be a function." é”™è¯¯ã€‚

![Error: Expected the reducer to be a function.](https://daveceddia.com/images/error-expected-reducer-to-be-a-function.png)

### Store éœ€è¦ä¸€ä¸ª Reducer

å› æ­¤ï¼Œæœ‰ä»¶å…³äº Redux çš„äº‹ï¼šå®ƒå¹¶ä¸æ˜¯éå¸¸æ™ºèƒ½ã€‚

ä½ å¯èƒ½æœŸå¾…é€šè¿‡åˆ›å»ºä¸€ä¸ª storeï¼Œå®ƒä¼šç»™ä½ çš„ state ä¸€ä¸ªåˆé€‚çš„é»˜è®¤å€¼ã€‚æˆ–è®¸æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ï¼Ÿ

ä½†æ˜¯å¹¶éå¦‚æ­¤ã€‚è¿™é‡Œæ²¡æœ‰çº¦å®šä¼˜äºé…ç½®ã€‚

Redux **ä¸ä¼š**å¯¹ä½ çš„ state åšä»»ä½•å‡è®¾ã€‚å®ƒå¯èƒ½æ˜¯ä¸€ä¸ª objectã€numberã€stringï¼Œæˆ–è€…ä»»ä½•ä½ éœ€è¦çš„ã€‚è¿™å–å†³äºä½ ã€‚

æˆ‘ä»¬å¿…é¡»æä¾›ä¸€ä¸ªè¿”å› state çš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°è¢«ç§°ä¸º reducerï¼ˆæˆ‘ä»¬é©¬ä¸Šå°±çŸ¥é“ä¸ºä»€ä¹ˆäº†ï¼‰ã€‚é‚£ä¹ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªéå¸¸ç®€å•çš„ reducerï¼ŒæŠŠå®ƒä¼ ç»™ `createStore`ï¼Œç„¶åçœ‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼š

index.js

```js
function reducer(state, action) {
  console.log('reducer', state, action);
  return state;
}

const store = createStore(reducer);
```

ä¿®æ”¹å®Œåï¼Œæ‰“å¼€æ§åˆ¶å°ï¼ˆåœ¨ CodeSandbox é‡Œï¼Œç‚¹å‡»åº•éƒ¨çš„ Console æŒ‰é’®ï¼‰ã€‚

ä½ åº”è¯¥å¯ä»¥çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„æ—¥å¿—ä¿¡æ¯ï¼š

![reducer undefined Object { type: @@redux/INIT }](https://daveceddia.com/images/reducer-console-log.png)

ï¼ˆINIT åé¢çš„å­—æ¯å’Œæ•°å­—æ˜¯ Redux éšæœºç”Ÿæˆçš„ï¼‰

æ³¨æ„åœ¨ä½ åˆ›å»º store çš„åŒæ—¶ Redux å¦‚ä½•è°ƒç”¨ä½ çš„ reducerã€‚ï¼ˆä¸ºäº†è¯å®è¿™ç‚¹ï¼šè°ƒç”¨ `createStore` ä¹‹åç«‹å³è¾“å‡º `console.log`ï¼Œçœ‹çœ‹ reducer åé¢ä¼šæ‰“å°ä»€ä¹ˆï¼‰

åŒæ ·æ³¨æ„ Redux å¦‚ä½•ä¼ é€’äº†ä¸€ä¸ª `undefined` çš„ `state`ï¼ŒåŒæ—¶ action æ˜¯ä¸€ä¸ªæœ‰ `type` å±æ€§çš„å¯¹è±¡ã€‚

æˆ‘ä»¬ç¨åä¼šæ›´å¤šåœ°è®¨è®º actionsã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹ **reducer**ã€‚

## Redux Reducer æ˜¯ä»€ä¹ˆï¼Ÿ

"reducer" æœ¯è¯­çœ‹èµ·æ¥å¯èƒ½æœ‰ç‚¹é™Œç”Ÿå’Œå®³æ€•ï¼Œä½†æ˜¯æœ¬èŠ‚è¿‡åï¼Œæˆ‘è®¤ä¸ºä½ ä¼šåŒæ„å¦‚ä¸‹è§‚ç‚¹ï¼Œæ­£å¦‚ä¿—è¯æ‰€è¯´çš„é‚£æ ·ï¼Œâ€œåªæ˜¯ä¸€ä¸ªå‡½æ•°â€ã€‚

ä½ ç”¨è¿‡æ•°ç»„çš„ `reduce` å‡½æ•°å—ï¼Ÿ

å®ƒæ˜¯è¿™æ ·ç”¨çš„ï¼šä½ ä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼Œéå†æ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ æ—¶éƒ½ä¼šè°ƒç”¨ä½ ä¼ å…¥çš„å‡½æ•°ï¼Œç±»ä¼¼ `map` çš„ä½œç”¨ â€”â€” ä½ å¯èƒ½åœ¨ React é‡Œé¢æ¸²æŸ“åˆ—è¡¨è€Œå¯¹ `map` å¾ˆç†Ÿæ‚‰ã€‚

ä½ çš„å‡½æ•°è°ƒç”¨æ—¶ä¼šæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šä¸Šä¸€æ¬¡è¿­ä»£çš„ç»“æœï¼Œå’Œå½“å‰æ•°ç»„å…ƒç´ ã€‚å®ƒç»“åˆå½“å‰å…ƒç´ å’Œä¹‹å‰çš„ "total" ç»“æœç„¶åè¿”å›æ–°çš„ total å€¼ã€‚

ç»“åˆä¸‹é¢ä¾‹å­çœ‹ä¼šæ›´åŠ æ¸…æ™°æ˜äº†ï¼š

```js
var letters = ['r', 'e', 'd', 'u', 'x'];

// `reduce` æ¥æ”¶ä¸¤ä¸ªå‚æ•°:
//   - ä¸€ä¸ªç”¨æ¥ reduce çš„å‡½æ•° (ä¹Ÿç§°ä¸º "reducer")
//   - ä¸€ä¸ªè®¡ç®—ç»“æœçš„åˆå§‹å€¼
var word = letters.reduce(
  function(accumulatedResult, arrayItem) {
    return accumulatedResult + arrayItem;
  },
''); // <-- æ³¨æ„è¿™ä¸ªç©ºå­—ç¬¦ä¸²ï¼šå®ƒæ˜¯åˆå§‹å€¼

console.log(word) // => "redux"
```

ä½ ç»™ `reduce` ä¼ å…¥çš„å‡½æ•°ç†æ‰€åº”å½“è¢«å«åš "reducer"ï¼Œå› ä¸ºå®ƒå°†æ•´ä¸ªæ•°ç»„çš„å…ƒç´  **reduces** æˆä¸€ä¸ªç»“æœã€‚

Redux **åŸºæœ¬ä¸Š**æ˜¯æ•°ç»„ `reduce` çš„è±ªåç‰ˆã€‚å‰é¢ï¼Œä½ çœ‹åˆ° Redux reducers å¦‚ä½•æ‹¥æœ‰è¿™ä¸ªæ˜¾è‘—ç‰¹å¾ï¼š

```js
(state, action) => newState
```

å«ä¹‰ï¼šå®ƒæ¥æ”¶å½“å‰ `state` å’Œä¸€ä¸ª `action`ï¼Œç„¶åè¿”å› `newState`ã€‚çœ‹èµ·æ¥å¾ˆåƒ `Array.reduce` é‡Œ reducer çš„ç‰¹ç‚¹ï¼

```js
(accumulatedValue, nextItem) => nextAccumulatedValue
```

Redux reducers å°±åƒä½ ä¼ ç»™ Array.reduce çš„å‡½æ•°ä½œç”¨ä¸€æ ·ï¼:) å®ƒä»¬ reduce çš„æ˜¯ actionsã€‚å®ƒä»¬æŠŠä¸€ç»„ actionsï¼ˆéšç€æ—¶é—´ï¼‰reduce æˆä¸€ä¸ªå•ç‹¬çš„ stateã€‚ä¸åŒä¹‹å¤„åœ¨äº Array çš„ reduce ç«‹å³å‘ç”Ÿï¼Œè€Œ Redux åˆ™éšç€æ­£è¿è¡Œåº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸä¸€ç›´å‘ç”Ÿã€‚

å¦‚æœä½ ä»ç„¶éå¸¸ä¸ç¡®å®šï¼ŒæŸ¥çœ‹ä¸‹æˆ‘çš„ [Redux reducers å·¥ä½œæœºåˆ¶]æŒ‡å—(https://daveceddia.com/what-is-a-reducer/)ã€‚ä¸ç„¶çš„è¯ï¼Œæˆ‘ä»¬ç»§ç»­å‘ä¸‹çœ‹ã€‚

## ç»™ Reducer ä¸€ä¸ªåˆå§‹çŠ¶æ€

è®°ä½ reducer çš„èŒè´£æ˜¯æ¥æ”¶å½“å‰ `state` å’Œä¸€ä¸ª `action` ç„¶åè¿”å›æ–°çš„ stateã€‚

å®ƒè¿˜æœ‰å¦ä¸€ä¸ªèŒè´£ï¼šåœ¨é¦–æ¬¡è°ƒç”¨çš„æ—¶å€™åº”è¯¥è¿”å›åˆå§‹ stateã€‚å®ƒæœ‰ç‚¹åƒåº”ç”¨çš„â€œå¼•å¯¼é¡µâ€ã€‚å®ƒå¿…é¡»ä»æŸå¤„å¼€å§‹ï¼Œå¯¹å§ï¼Ÿ

æƒ¯ç”¨çš„æ–¹å¼æ˜¯å®šä¹‰ä¸€ä¸ª `initialState` å˜é‡ç„¶åä½¿ç”¨ ES6 é»˜è®¤å‚æ•°ç»™ `state` èµ‹åˆå§‹å€¼ã€‚

æ—¢ç„¶è¦æŠŠ `Counter` state è¿ç§»åˆ° Reduxï¼Œæˆ‘ä»¬å…ˆç«‹é©¬åˆ›å»ºå®ƒçš„åˆå§‹ stateã€‚åœ¨ `Counter` ç»„ä»¶é‡Œï¼Œæˆ‘ä»¬çš„ state æ˜¯ä¸€ä¸ªæœ‰ `count` å±æ€§çš„å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™åˆ›å»ºä¸€ä¸ªä¸€æ ·çš„ initialStateã€‚

index.js

```js
const initialState = {
  count: 0
};

function reducer(state = initialState, action) {
  console.log('reducer', state, action);
  return state;
}
```

å¦‚æœä½ å†çœ‹ä¸‹æ§åˆ¶å°ï¼Œä½ ä¼šçœ‹åˆ° `state` æ‰“å°çš„å€¼ä¸º `{count: 0}`ã€‚é‚£å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚

æ‰€ä»¥è¿™å‘Šè¯‰æˆ‘ä»¬ä¸€æ¡å…³äº reducers çš„é‡è¦è§„åˆ™ã€‚

Reducers é‡è¦è§„åˆ™ä¸€ï¼šreducer ç»ä¸èƒ½è¿”å› undefinedã€‚

é€šå¸¸ state åº”è¯¥æ€»æ˜¯å·²å®šä¹‰çš„ã€‚å·²å®šä¹‰çš„ state æ˜¯è‰¯å¥½çš„ stateã€‚è€Œ**æœª**å®šä¹‰çš„åˆ™**ä¸**é‚£ä¹ˆå¥½ï¼ˆå¹¶ä¸”ä¼šç ´åä½ çš„åº”ç”¨ï¼‰ã€‚

## Dispatch Actions æ¥æ”¹å˜ State

æ˜¯çš„ï¼Œä¸€ä¸‹æ¥äº†ä¸¤ä¸ªåå­—ï¼šæˆ‘ä»¬å°† "dispatch" ä¸€äº› "actions"ã€‚

### ä»€ä¹ˆæ˜¯ Redux Actionï¼Ÿ

åœ¨ Redux ä¸­ï¼Œå…·æœ‰ `type` å±æ€§çš„æ™®é€šå¯¹è±¡å°±è¢«ç§°ä¸º actionã€‚å°±æ˜¯è¿™æ ·ï¼Œåªè¦éµå¾ªè¿™ä¸¤ä¸ªè§„åˆ™ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª actionï¼š

```js
{
  type: "add an item",
  item: "Apple"
}
```

This is also an action:

```js
{
  type: 7008
}
```

Here's another one:

```js
{
  type: "INCREMENT"
}
```

Actions çš„æ ¼å¼éå¸¸è‡ªç”±ã€‚åªè¦å®ƒæ˜¯ä¸ªå¸¦æœ‰ `type` å±æ€§çš„å¯¹è±¡å°±å¯ä»¥äº†ã€‚

ä¸ºäº†ä¿è¯äº‹åŠ¡çš„åˆç†æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œæˆ‘ä»¬ Redux ç”¨æˆ·é€šå¸¸ç»™ actions çš„ type å±æ€§èµ‹ç®€å•å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”é€šå¸¸æ˜¯å¤§å†™çš„ï¼Œæ¥è¡¨æ˜å®ƒä»¬æ˜¯å¸¸é‡ã€‚

Action å¯¹è±¡æè¿°ä½ æƒ³åšå‡ºçš„æ”¹å˜ï¼ˆå¦‚â€œå¢åŠ  counterâ€ï¼‰æˆ–è€…å°†è§¦å‘çš„äº‹ä»¶ï¼ˆå¦‚â€œè¯·æ±‚æœåŠ¡å¤±è´¥å¹¶æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯â€ï¼‰ã€‚

å°½ç®¡ Actions åå£°å“äº®ï¼Œä½†å®ƒæ˜¯æ— è¶£çš„ï¼Œå‘†æ¿çš„å¯¹è±¡ã€‚å®ƒä»¬äº‹å®ä¸Šä¸**åš**ä»»ä½•äº‹æƒ…ã€‚åæ­£å®ƒä»¬è‡ªå·±ä¸åšã€‚

ä¸ºäº†è®© action **åš**ç‚¹äº‹æƒ…ï¼Œä½ éœ€è¦ dispatchã€‚

## Redux Dispatch å·¥ä½œæœºåˆ¶

æˆ‘ä»¬åˆšæ‰åˆ›å»ºçš„ store æœ‰ä¸€ä¸ªå†…ç½®å‡½æ•° `dispatch`ã€‚è°ƒç”¨çš„æ—¶å€™æºå¸¦ actionï¼ŒRedux è°ƒç”¨ reducer æ—¶å°±ä¼šæºå¸¦ actionï¼ˆç„¶å reducer çš„è¿”å›å€¼ä¼šæ›´æ–° stateï¼‰ã€‚

æˆ‘ä»¬åœ¨ store ä¸Šè¯•è¯•çœ‹ã€‚

index.js

```js
const store = createStore(reducer);
store.dispatch({ type: "INCREMENT" });
store.dispatch({ type: "INCREMENT" });
store.dispatch({ type: "DECREMENT" });
store.dispatch({ type: "RESET" });
```

åœ¨ä½ çš„ CodeSandbox ä¸­æ·»åŠ è¿™äº› dispatch è°ƒç”¨ç„¶åæ£€æŸ¥æ§åˆ¶å°

![reducer undefined Object { type: @@redux/INIT }](https://daveceddia.com/images/dispatching-redux-actions.png)

æ¯ä¸€æ¬¡è°ƒç”¨ `dispatch` æœ€ç»ˆéƒ½ä¼šè°ƒç”¨ reducerï¼

åŒæ ·æ³¨æ„åˆ° state æ¯æ¬¡éƒ½ä¸€æ ·ï¼Ÿ`{count: 0}` ä¸€ç›´æ²¡å˜ã€‚

è¿™æ˜¯å› ä¸ºæˆ‘ä»¬çš„ reducer æ²¡æœ‰**ä½œç”¨äº**é‚£äº› actionsã€‚ä¸è¿‡å¾ˆå®¹æ˜“è§£å†³ã€‚ç°åœ¨å°±å¼€å§‹å§ã€‚

## åœ¨ Redux Reducer ä¸­å¤„ç† Actions

ä¸ºäº†è®© actions åšç‚¹äº‹æƒ…ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ reducer é‡Œé¢å†™å‡ è¡Œä»£ç æ¥æ ¹æ®æ¯ä¸ª action çš„ `type` å€¼æ¥å¯¹åº”å¾—æ›´æ–° stateã€‚

æœ‰å‡ ç§æ–¹å¼å®ç°ã€‚

ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ¥é€šè¿‡ action çš„ type æ¥æŸ¥æ‰¾å¯¹åº”çš„å¤„ç†å‡½æ•°ã€‚

æˆ–è€…ä½ å¯ä»¥å†™ä¸€å¤§å † if/else è¯­å¥

```js
if(action.type === "INCREMENT") {
  ...
} else if(action.type === "RESET") {
  ...
}
```

æˆ–è€…ä½ å¯ä»¥ç”¨ä¸€ä¸ªç®€å•çš„ `switch` è¯­å¥ï¼Œä¹Ÿæ˜¯æˆ‘ä¸‹é¢é‡‡ç”¨çš„æ–¹å¼ï¼Œå› ä¸ºå®ƒå¾ˆç›´è§‚ï¼Œä¹Ÿæ˜¯è¿™ç§åœºæ™¯çš„å¸¸ç”¨æ–¹æ³•ã€‚

å°½ç®¡æœ‰äº›äººè®¨åŒ `switch`ï¼Œå¦‚æœä½ ä¹Ÿæ˜¯ â€”â€” éšæ„ç”¨ä½ å–œæ¬¢çš„æ–¹å¼å†™ reducers å°±å¥½ :)

ä¸‹é¢æ˜¯æˆ‘ä»¬å¤„ç† actions çš„é€»è¾‘ï¼š

index.js

```js
function reducer(state = initialState, action) {
  console.log('reducer', state, action);

  switch(action.type) {
    case 'INCREMENT':
      return {
        count: state.count + 1
      };
    case 'DECREMENT':
      return {
        count: state.count - 1
      };
    case 'RESET':
      return {
        count: 0
      };
    default:
      return state;
  }
}
```

è¯•ä¸€ä¸‹ç„¶ååœ¨æ§åˆ¶å°çœ‹çœ‹ä¼šè¾“å‡ºä»€ä¹ˆã€‚

![reducer undefined Object { type: @@redux/INIT }](https://daveceddia.com/images/handling-redux-actions.png)

å¿«çœ‹ï¼`count` å˜äº†!

æˆ‘ä»¬å‡†å¤‡å¥½æŠŠå®ƒè¿æ¥åˆ° React äº†ï¼Œåœ¨æ­¤ä¹‹å‰è®©æˆ‘ä»¬å…ˆè°ˆè°ˆè¿™æ®µ reducer ä»£ç ã€‚

## å¦‚ä½•ä¿æŒçº¯ Reducers

å¦ä¸€ä¸ªå…³äº reducers çš„è§„åˆ™æ˜¯å®ƒä»¬å¿…é¡»æ˜¯çº¯å‡½æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸èƒ½ä¿®æ”¹å®ƒä»¬çš„å‚æ•°ï¼Œä¹Ÿä¸èƒ½æœ‰å‰¯ä½œç”¨ï¼ˆside effectï¼‰ã€‚

Reducer è§„åˆ™äºŒï¼šReducers å¿…é¡»æ˜¯çº¯å‡½æ•°ã€‚

â€œå‰¯ä½œç”¨ï¼ˆside effectï¼‰â€æ˜¯æŒ‡å¯¹å‡½æ•°ä½œç”¨åŸŸä¹‹å¤–çš„ä»»ä½•æ›´æ”¹ã€‚ä¸è¦æ”¹å˜å‡½æ•°ä½œç”¨åŸŸä»¥å¤–çš„å˜é‡ï¼Œä¸è¦è°ƒç”¨å…¶ä»–ä¼šæ”¹å˜çš„å‡½æ•°ï¼ˆæ¯”å¦‚ `fetch`ï¼Œè·Ÿç½‘ç»œå’Œå…¶ä»–ç³»ç»Ÿæœ‰å…³ï¼‰ï¼Œä¹Ÿä¸è¦ dispatch actions ç­‰ã€‚

æŠ€æœ¯è§’åº¦æ¥çœ‹ `console.log` æ˜¯å‰¯ä½œç”¨ï¼ˆside effectï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬å¿½ç•¥å®ƒã€‚

æœ€é‡è¦çš„äº‹æƒ…æ˜¯ï¼šä¸è¦ä¿®æ”¹ `state` å‚æ•°ã€‚

è¿™æ„å‘³ç€ä½ ä¸èƒ½æ‰§è¡Œ `state.count = 0`ã€`state.items.push(newItem)`ã€`state.count++` åŠå…¶ä»–ç±»å‹çš„å˜åŠ¨ â€”â€” ä¸è¦æ”¹å˜ `state` æœ¬èº«ï¼ŒåŠå…¶ä»»ä½•å­å±æ€§ã€‚

ä½ å¯ä»¥æŠŠå®ƒæƒ³æˆä¸€ä¸ªæ¸¸æˆï¼Œä½ å”¯ä¸€èƒ½åšçš„äº‹å°±æ˜¯ `return { ... }`ã€‚è¿™æ˜¯ä¸ªæœ‰è¶£çš„æ¸¸æˆã€‚å¼€å§‹ä¼šæœ‰ç‚¹æ¼äººã€‚ä½†æ˜¯é€šè¿‡ç»ƒä¹ ä½ ä¼šå˜å¾—æ›´å¥½ã€‚

æˆ‘æ•´ç†äº†ä¸€ä¸ª[å¦‚ä½•åœ¨ Redux é‡Œåš Immutable æ›´æ–°](https://daveceddia.com/react-redux-immutability-guide/)å®Œå…¨æŒ‡å—ï¼ŒåŒ…å«æ›´æ–° state ä¸­å¯¹è±¡å’Œæ•°ç»„çš„ä¸ƒä¸ªé€šç”¨æ¨¡å¼ã€‚

å®‰è£… [Immer](https://github.com/mweststrate/immer) åœ¨ reducers é‡Œé¢ä½¿ç”¨ä¹Ÿæ˜¯ä¸€ç§å¾ˆå¥½çš„æ–¹å¼ã€‚Immer è®©ä½ å¯ä»¥åƒå†™æ™®é€š mutable ä»£ç ä¸€æ ·ï¼Œæœ€ç»ˆä¼šè‡ªåŠ¨ç”Ÿæˆ immutable ä»£ç ã€‚[ç‚¹å‡»äº†è§£å¦‚ä½•ä½¿ç”¨ Immer](https://daveceddia.com/react-redux-immutability-guide/#easy-state-updates-with-immer)ã€‚

å»ºè®®ï¼šå¦‚æœä½ æ˜¯å¼€å§‹ä¸€ä¸ªå…¨æ–°çš„åº”ç”¨ç¨‹åºï¼Œä¸€å¼€å§‹å°±ä½¿ç”¨ Immerã€‚å®ƒä¼šä¸ºä½ çœå»å¾ˆå¤šéº»çƒ¦ã€‚ä½†æ˜¯æˆ‘å‘ä½ å±•ç¤ºè¿™ç§**å›°éš¾**æ–¹å¼æ˜¯å› ä¸ºå¾ˆå¤šä»£ç ä»ç„¶é‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œä½ ä¸€å®šä¼šçœ‹åˆ°æ²¡æœ‰ç”¨ Immer å†™çš„ reducers

## å…¨éƒ¨è§„åˆ™

å¿…é¡»è¿”å›ä¸€ä¸ª stateï¼Œä¸è¦æ”¹å˜ stateï¼Œä¸è¦ connect æ¯ä¸€ä¸ªç»„ä»¶ï¼Œè¦åƒè¥¿å…°èŠ±ï¼Œ11 ç‚¹åä¸è¦å¤–å‡ºâ€¦è¿™ç®€ç›´æ²¡å®Œæ²¡äº†ã€‚å°±åƒä¸€ä¸ªè§„åˆ™å·¥å‚ï¼Œæˆ‘ç”šè‡³ä¸çŸ¥é“é‚£æ˜¯ä»€ä¹ˆã€‚

æ˜¯çš„ï¼ŒRedux å°±åƒä¸€ä¸ªéœ¸é“çš„çˆ¶æ¯ã€‚ä½†å®ƒæ˜¯å‡ºäºçˆ±ã€‚å‡½æ•°å¼ç¼–ç¨‹çš„çˆ±ã€‚

Redux å»ºç«‹åœ¨ä¸å˜æ€§çš„åŸºç¡€ä¸Šï¼Œå› ä¸ºå˜åŒ–çš„å…¨å±€ state æ˜¯ä¸€æ¡é€šå¾€åºŸå¢Ÿä¹‹è·¯ã€‚

ä½ è¯•è¿‡åœ¨å…¨å±€å¯¹è±¡é‡Œé¢ä¿å­˜ä½ çš„ state å—ï¼Ÿèµ·åˆå®ƒè¿˜å¾ˆå¥½ã€‚ç¾å¦™å¹¶ä¸”ç®€å•ã€‚ä»»ä½•ä¸œè¥¿éƒ½èƒ½æ¥è§¦åˆ° state å› ä¸ºå®ƒä¸€ç›´æ˜¯å¯ç”¨çš„å¹¶ä¸”å¾ˆå®¹æ˜“æ›´æ”¹ã€‚

ç„¶å state å¼€å§‹ä»¥ä¸å¯é¢„æµ‹çš„æ–¹å¼å‘ç”Ÿæ”¹å˜ï¼Œæƒ³è¦æ‰¾åˆ°æ”¹å˜å®ƒçš„ä»£ç å˜å¾—å‡ ä¹ä¸å¯èƒ½ã€‚

ä¸ºäº†é¿å…è¿™äº›é—®é¢˜ï¼ŒRedux æå‡ºäº†ä»¥ä¸‹è§„åˆ™ã€‚

- State æ˜¯åªè¯»çš„ï¼Œå”¯ä¸€ä¿®æ”¹å®ƒçš„æ–¹å¼æ˜¯ actionsã€‚
- æ›´æ–°çš„å”¯ä¸€æ–¹å¼ï¼šdispatch(action) -> reducer -> new stateã€‚
- Reducer å‡½æ•°å¿…é¡»æ˜¯â€œçº¯â€çš„ â€”â€” ä¸èƒ½ä¿®æ”¹å®ƒçš„å‚æ•°ï¼Œä¹Ÿä¸èƒ½æœ‰å‰¯ä½œç”¨ï¼ˆside effectï¼‰ã€‚

## å¦‚ä½•åœ¨ React ä¸­ä½¿ç”¨ Redux

æ­¤æ—¶æˆ‘ä»¬æœ‰ä¸ªå¾ˆå°çš„å¸¦æœ‰ `reducer` çš„ `store`ï¼Œå½“æ¥æ”¶åˆ° `action` æ—¶å®ƒçŸ¥é“å¦‚ä½•æ›´æ–° `state`ã€‚

ç°åœ¨æ˜¯æ—¶å€™å°† Redux è¿æ¥åˆ° React äº†ã€‚

è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œè¦ç”¨åˆ° `react-redux` åº“çš„ä¸¤æ ·ä¸œè¥¿ï¼šä¸€ä¸ªåä¸º `Provider` çš„ç»„ä»¶å’Œä¸€ä¸ª `connect` å‡½æ•°ã€‚

é€šè¿‡ç”¨ `Provider` ç»„ä»¶åŒ…è£…æ•´ä¸ªåº”ç”¨ï¼Œå¦‚æœå®ƒæƒ³çš„è¯ï¼Œåº”ç”¨æ ‘é‡Œçš„**æ¯ä¸€ä¸ªç»„ä»¶**éƒ½å¯ä»¥è®¿é—® Redux storeã€‚

åœ¨ `index.js` é‡Œï¼Œå¼•å…¥ `Provider` ç„¶åç”¨å®ƒæŠŠ `App` çš„å†…å®¹åŒ…è£…èµ·æ¥ã€‚`store` ä¼šä»¥ prop å½¢å¼ä¼ é€’ã€‚

index.js

```js
import { Provider } from 'react-redux';

...

const App = () => (
  <Provider store={store}>
    <Counter/>
  </Provider>
);
```

è¿™æ ·ä¹‹åï¼Œ`Counter`ï¼Œ `Counter` çš„å­å…ƒç´ ï¼Œä»¥åŠå­å…ƒç´ çš„å­å…ƒç´ ç­‰ç­‰â€”â€”æ‰€æœ‰è¿™äº›ç°åœ¨éƒ½å¯ä»¥è®¿é—® Redux stroeã€‚

ä½†ä¸æ˜¯è‡ªåŠ¨çš„ã€‚æˆ‘ä»¬éœ€è¦åœ¨æˆ‘ä»¬çš„ç»„ä»¶ä½¿ç”¨ `connect` å‡½æ•°æ¥è®¿é—® storeã€‚

### React-Redux Provider å·¥ä½œæœºåˆ¶

`Provider` å¯èƒ½çœ‹èµ·æ¥æœ‰ä¸€ç‚¹ç‚¹åƒé­”æ³•ã€‚å®ƒåœ¨åº•å±‚å®é™…æ˜¯ç”¨äº† React çš„ [Context ç‰¹æ€§](https://daveceddia.com/context-api-vs-redux/)ã€‚

Context å°±åƒæ˜¯è¿æ¥æ¯ä¸ªç»„ä»¶çš„ç§˜å¯†é€šé“ï¼Œä½¿ç”¨ `connect` å°±å¯æ‰“å¼€ç§˜å¯†é€šé“çš„å¤§é—¨ã€‚

æƒ³è±¡ä¸€ä¸‹ï¼Œåœ¨ä¸€å †ç…é¥¼ä¸Šæµ‡ç³–æµ†ä»¥åŠå®ƒé“ºæ»¡**æ‰€æœ‰**ç…é¥¼çš„æ–¹å¼ï¼Œå³ä½¿ä½ åªåœ¨æœ€ä¸Šå±‚å€’äº†ç³–æµ†ã€‚`Provider` å¯¹ Redux åšäº†åŒæ ·çš„äº‹æƒ…ã€‚

## ä¸º Redux å‡†å¤‡ Counter ç»„ä»¶

ç°åœ¨ Counter æœ‰äº†å†…éƒ¨ stateã€‚æˆ‘ä»¬æ‰“ç®—æŠŠå®ƒå¹²æ‰ï¼Œä¸ºä» Redux ä»¥ prop æ–¹å¼è·å– `count` åšå‡†å¤‡ã€‚

ç§»é™¤é¡¶éƒ¨çš„ state åˆå§‹åŒ–ï¼Œä»¥åŠ `increment` å’Œ `decrement` å†…éƒ¨è°ƒç”¨çš„ `setState`ã€‚ç„¶åï¼ŒæŠŠ `this.state.count` æ›¿æ¢æˆ `this.props.count`ã€‚

Counter.js

```js
class Counter extends React.Component {
  // state = { count: 0 }; // åˆ é™¤

  increment = () => {
    /*
    // åˆ é™¤
    this.setState({
      count: this.state.count + 1
    });
    */
  };

  decrement = () => {
    /*
    // åŒæ ·åˆ é™¤
    this.setState({
      count: this.state.count - 1
    });
    */
  };

  render() {
    return (
      <div className="counter">
        <h2>Counter</h2>
        <div>
          <button onClick={this.decrement}>-</button>
          <span className="count">{
            // æŠŠ state:
            //// this.state.count
            // æ›¿æ¢æˆ:
            this.props.count
          }</span>
          <button onClick={this.increment}>+</button>
        </div>
      </div>
    );
  }
}
```

ç°åœ¨ `increment` å’Œ `decrement` æ˜¯ç©ºçš„ã€‚æˆ‘ä»¬ä¼šå¾ˆå¿«å†æ¬¡å¡«å……å®ƒä»¬ã€‚

ä½ ä¼šæ³¨æ„åˆ° count æ¶ˆå¤±äº† â€”â€” å®ƒç¡®å®åº”è¯¥è¿™æ ·ï¼Œå› ä¸ºç›®å‰è¿˜æ²¡æœ‰ç»™ `Counter` ä¼ é€’ `count` propã€‚

## è¿æ¥ç»„ä»¶å’Œ Redux

è¦ä» Redux è·å– `count`ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦åœ¨ Counter.js é¡¶éƒ¨å¼•å…¥ `connect` å‡½æ•°ã€‚

Counter.js

```js
import { connect } from 'react-redux';
```

ç„¶åæˆ‘ä»¬éœ€è¦åœ¨åº•éƒ¨æŠŠ Counter ç»„ä»¶å’Œ Redux è¿æ¥èµ·æ¥ï¼š

Counter.js

```js
// æ·»åŠ è¿™ä¸ªå‡½æ•°:
function mapStateToProps(state) {
  return {
    count: state.count
  };
}

// ç„¶åæŠŠ:
// export default Counter;

// æ›¿æ¢æˆ:
export default connect(mapStateToProps)(Counter);
```

ä¹‹å‰æˆ‘ä»¬åªå¯¼å‡ºäº†ç»„ä»¶æœ¬èº«ã€‚ç°åœ¨æˆ‘ä»¬ç”¨ `connect` å‡½æ•°è°ƒç”¨æŠŠå®ƒåŒ…è£…èµ·æ¥ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¯¼å‡º**å·²è¿æ¥çš„** Counterã€‚è‡³äºåº”ç”¨çš„å…¶ä½™éƒ¨åˆ†ï¼Œçœ‹èµ·æ¥å°±åƒä¸€ä¸ªå¸¸è§„ç»„ä»¶ã€‚

ç„¶å count åº”è¯¥å°±é‡æ–°å‡ºç°äº†ï¼ç›´åˆ°æˆ‘ä»¬é‡æ–°å®ç° increment/decrementï¼Œå®ƒæ˜¯ä¸ä¼šå˜åŒ–çš„ã€‚

## å¦‚ä½•ä½¿ç”¨ React ReduxÂ `connect`

ä½ å¯èƒ½æ³¨æ„åˆ°è¿™ä¸ªè°ƒç”¨çœ‹èµ·æ¥æœ‰ç‚¹â€¦â€¦å¥‡æ€ªã€‚ä¸ºä»€ä¹ˆæ˜¯ `connect(mapStateToProps)(Counter)` è€Œä¸æ˜¯ `connect(mapStateToProps, Counter)` æˆ–è€… `connect(Counter, mapStateToProps)`ï¼Ÿå®ƒåšäº†ä»€ä¹ˆï¼Ÿ

è¿™æ ·å†™æ˜¯å› ä¸º `connect` æ˜¯ä¸€ä¸ª**é«˜é˜¶å‡½æ•°**ï¼Œå®ƒç®€å•è¯´å°±æ˜¯å½“ä½ è°ƒç”¨å®ƒæ—¶ä¼šè¿”å›ä¸€ä¸ªå‡½æ•°ã€‚ç„¶åè°ƒç”¨**è¿”å›çš„**å‡½æ•°ä¼ å…¥ä¸€ä¸ªç»„ä»¶æ—¶ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªæ–°ï¼ˆåŒ…è£…çš„ï¼‰ç»„ä»¶ã€‚

å®ƒçš„å¦ä¸€ä¸ªåç§°æ˜¯ [**é«˜é˜¶ç»„ä»¶**](https://daveceddia.com/extract-state-with-higher-order-components/) (ç®€ç§° "HOC")ã€‚HOCs è¿‡å»æ›¾æœ‰è¿‡ä¸€äº›ç³Ÿç³•çš„æ–°é—»ï¼Œä½†å®ƒä»ç„¶æ˜¯ä¸€ä¸ªç›¸å½“æœ‰ç”¨çš„æ¨¡å¼ï¼Œ`connect` å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚

`Connect` åšçš„æ˜¯åœ¨ Redux å†…éƒ¨ hookï¼Œå–å‡ºæ•´ä¸ª stateï¼Œç„¶åæŠŠå®ƒä¼ è¿›ä½ æä¾›çš„ `mapStateToProps` å‡½æ•°ã€‚å®ƒæ˜¯ä¸ªè‡ªå®šä¹‰å‡½æ•°ï¼Œå› ä¸ºåªæœ‰**ä½ **çŸ¥é“ä½ å­˜åœ¨ Redux é‡Œé¢çš„ state çš„â€œç»“æ„â€ã€‚

## mapStateToProps å·¥ä½œæœºåˆ¶

`connect` æŠŠæ•´ä¸ª state ä¼ ç»™äº†ä½ çš„ `mapStateToProps` å‡½æ•°ï¼Œå°±å¥½åƒåœ¨è¯´ï¼Œâ€œå˜¿ï¼Œå‘Šè¯‰æˆ‘ä½ æƒ³ä»è¿™å †ä¸œè¥¿é‡Œé¢è¦ä»€ä¹ˆã€‚â€

`mapStateToProps` è¿”å›çš„å¯¹è±¡ä»¥ props å½¢å¼ä¼ ç»™äº†ä½ çš„ç»„ä»¶ã€‚ä»¥ä¸Šé¢ä¸ºä¾‹å°±æ˜¯æŠŠ `state.count` çš„å€¼ç”¨ `count` prop ä¼ é€’ï¼šå¯¹è±¡çš„å±æ€§å˜æˆäº† prop åç§°ï¼Œå®ƒä»¬å¯¹åº”çš„å€¼ä¼šå˜æˆ props çš„å€¼ã€‚ä½ çœ‹ï¼Œè¿™ä¸ªå‡½æ•°å°±åƒå­—é¢å«ä¹‰ä¸€æ ·**å®šä¹‰ä» state åˆ° props çš„æ˜ å°„**ã€‚

é¡ºä¾¿è¯´è¯´ â€”â€” `mapStateToProps` çš„åç§°æ˜¯ä½¿ç”¨æƒ¯ä¾‹ï¼Œä½†å¹¶ä¸æ˜¯ç‰¹å®šçš„ã€‚ä½ å¯ä»¥ç®€å†™æˆ `mapState` æˆ–è€…ç”¨ä»»ä½•ä½ æƒ³çš„æ–¹å¼è°ƒç”¨ã€‚åªè¦ä½ æ¥æ”¶ `state` å¯¹è±¡ç„¶åè¿”å›å…¨æ˜¯ props çš„å¯¹è±¡ï¼Œé‚£å°±æ²¡é—®é¢˜ã€‚

### ä¸ºä»€ä¹ˆä¸ä¼ æ•´ä¸ª stateï¼Ÿ

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çš„ state ç»“æ„**å·²ç»**æ˜¯å¯¹çš„äº†ï¼Œçœ‹èµ·æ¥ `mapDispatchToProps` å¯èƒ½æ˜¯ä¸å¿…è¦çš„ã€‚å¦‚æœä½ å®è´¨ä¸Šå¤åˆ¶å‚æ•°ï¼ˆstateï¼‰ç»™ä¸€ä¸ªè·Ÿ state ç›¸åŒçš„å¯¹è±¡ï¼Œè¿™æœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿ

åœ¨å¾ˆå°çš„ä¾‹å­ä¸­ï¼Œå¯èƒ½ä¼šä¼ å…¨éƒ¨ stateï¼Œä½†é€šå¸¸ä½ åªä¼šä»æ›´å¤§çš„ state é›†åˆä¸­é€‰æ‹©éƒ¨åˆ†ç»„ä»¶éœ€è¦çš„æ•°æ®ã€‚

å¹¶ä¸”ï¼Œæ²¡æœ‰ `mapStateToProps` å‡½æ•°ï¼Œ`connect` ä¸ä¼šä¼ é€’ä»»ä½• stateã€‚

ä½ **å¯ä»¥**ä¼ æ•´ä¸ª stateï¼Œç„¶åè®©ç»„ä»¶æ¢³ç†ã€‚ä½†é‚£ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¹ æƒ¯ï¼Œå› ä¸ºç»„ä»¶éœ€è¦çŸ¥é“ Redux state çš„ç»“æ„ç„¶åä»ä¸­æŒ‘é€‰å®ƒéœ€è¦çš„æ•°æ®ï¼Œåé¢å¦‚æœä½ æƒ³æ›´æ”¹ç»“æ„ä¼šå˜å¾—æ›´éš¾ã€‚

## ä» React ç»„ä»¶ Dispatch Redux Actions

ç°åœ¨æˆ‘ä»¬çš„ Counter å·²ç»è¢« `connect` äº†ï¼Œæˆ‘ä»¬ä¹Ÿè·å–åˆ°äº† `count` å€¼ã€‚ç°åœ¨æˆ‘ä»¬å¦‚ä½• dispatch actions æ¥æ”¹å˜ countï¼Ÿ

å¥½å§ï¼Œ`connect` ä¸ºä½ æä¾›æ”¯æŒï¼šé™¤äº†ä¼ é€’ï¼ˆmappedï¼‰stateï¼Œå®ƒ**è¿˜**ä» store ä¼ é€’äº† `dispatch` å‡½æ•°!

è¦åœ¨ Counter å†…éƒ¨ dispatch actionï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ `this.props.dispatch` æºå¸¦ä¸€ä¸ª actionã€‚

æˆ‘ä»¬çš„ reducer å·²ç»å‡†å¤‡å¥½å¤„ç† `INCREMENT` å’Œ `DECREMENT` actions äº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥ä» increment/decrement ä¸­ dispatchï¼š

Counter.js

```js
increment = () => {
  this.props.dispatch({ type: "INCREMENT" });
};

decrement = () => {
  this.props.dispatch({ type: "DECREMENT" });
};
```

ç°åœ¨æˆ‘ä»¬å®Œæˆäº†ã€‚æŒ‰é’®åº”è¯¥åˆé‡æ–°ç”Ÿæ•ˆäº†ã€‚

### è¯•è¯•è¿™ä¸ªï¼åŠ ä¸€ä¸ªé‡ç½®æŒ‰é’®

è¿™æœ‰ä¸ªå°ç»ƒä¹ ï¼šç»™ counter æ·»åŠ â€œé‡ç½®â€æŒ‰é’®ï¼Œç‚¹å‡»æ—¶ dispatch "RESET" actionã€‚

Reducer å·²ç»å†™å¥½å¤„ç†è¿™ä¸ª actionï¼Œå› æ­¤ä½ åªéœ€è¦ä¿®æ”¹ Counter.jsã€‚

## Action å¸¸é‡

åœ¨å¤§éƒ¨åˆ† Redux åº”ç”¨ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ° action å¸¸é‡éƒ½æ˜¯ä¸€äº›ç®€å•å­—ç¬¦ä¸²ã€‚è¿™æ˜¯ä¸€ä¸ªé¢å¤–çš„æŠ½è±¡çº§åˆ«ï¼Œä»é•¿è¿œæ¥çœ‹å¯ä»¥ä¸ºä½ èŠ‚çœä¸å°‘æ—¶é—´ã€‚

Action å¸¸é‡å¸®ä½ é¿å…é”™åˆ«å­—ï¼Œaction å‘½åçš„é”™åˆ«å­—ä¼šæ˜¯ä¸€ä¸ªå·¨å¤§çš„ç—›è‹¦ï¼šæ²¡æœ‰æŠ¥é”™ï¼Œæ²¡æœ‰å“ªé‡Œåæ‰çš„æ˜æ˜¾æ ‡å¿—ï¼Œå¹¶ä¸”ä½ çš„ action æ²¡æœ‰åšä»»ä½•äº‹æƒ…ï¼Ÿé‚£å°±å¯èƒ½æ˜¯ä¸ªé”™åˆ«å­—ã€‚

Action å¸¸é‡å¾ˆå®¹æ˜“ç¼–å†™ï¼šç”¨å˜é‡ä¿å­˜ä½ çš„ action å­—ç¬¦ä¸²ã€‚

æŠŠè¿™äº›å˜é‡æ”¾åœ¨ä¸€ä¸ª `actions.js` æ–‡ä»¶é‡Œæ˜¯ä¸ªå¥½åŠæ³•ï¼ˆå½“ä½ çš„åº”ç”¨å¾ˆå°æ—¶ï¼‰ã€‚

actions.js

```js
export const INCREMENT = "INCREMENT";
export const DECREMENT = "DECREMENT";
```

ç„¶åä½ å°±å¯ä»¥å¼•å…¥è¿™äº› action åç§°ï¼Œç”¨å®ƒä»¬æ¥ä»£æ›¿æ‰‹å†™å­—ç¬¦ä¸²ï¼š

Counter.js

```js
import React from "react";
import { INCREMENT, DECREMENT } from './actions';

class Counter extends React.Component {
  state = { count: 0 };

  increment = () => {
    this.props.dispatch({ type: INCREMENT });
  };

  decrement = () => {
    this.props.dispatch({ type: DECREMENT });
  };

  render() {
    ...
  }
}
```

## Redux Action ç”Ÿæˆå™¨æ˜¯ä»€ä¹ˆï¼Ÿ

ç°åœ¨æˆ‘ä»¬å·²ç»æ‰‹å†™ action å¯¹è±¡ã€‚åƒä¸ªå¼‚æ•™å¾’ã€‚

å¦‚æœä½ æœ‰ä¸€ä¸ª**å‡½æ•°**ä¼šä¸ºä½ ç¼–å†™å®ƒä¼šæ€ä¹ˆæ ·ï¼Ÿä¸è¦å†è¯¯å†™ actinos äº†ï¼

æˆ‘å¯ä»¥å‘Šè¯‰ä½ ï¼Œè¿™å¾ˆç–¯ç‹‚ã€‚æ‰‹å†™ `{ type: INCREMENT }` å¹¶ä¿è¯æ²¡æœ‰å¼„ä¹±æœ‰å¤šå›°éš¾ï¼Ÿ

å½“ä½ çš„åº”ç”¨å˜å¾—è¶Šæ¥è¶Šå¤§ï¼Œactions è¶Šæ¥è¶Šå¤šï¼Œå¹¶ä¸”è¿™äº› actions å¼€å§‹å˜å¾—æ›´å¤æ‚ â€”â€” è¦ä¼ æ›´å¤šæ•°æ®è€Œä¸ä»…æ˜¯ä¸€ä¸ª `type` â€”â€” action ç”Ÿæˆå™¨ä¼šå¸®ä¸Šå¤§å¿™ã€‚

å°±åƒ action å¸¸é‡ä¸€æ ·ï¼Œä½†å®ƒä»¬ä¸æ˜¯**å¿…é¡»å“**ã€‚è¿™æ˜¯å¦ä¸€å±‚çš„æŠ½è±¡ï¼Œå¦‚æœä½ ä¸æƒ³åœ¨ä½ çš„åº”ç”¨é‡Œé¢ä½¿ç”¨ï¼Œé‚£ä¹Ÿæ²¡å…³ç³»ã€‚

ä¸è¿‡æˆ‘è¿˜æ˜¯ä¼šè§£é‡Šä¸‹å®ƒä»¬æ˜¯ä»€ä¹ˆã€‚ç„¶åä½ å¯ä»¥å†³å®šä½ æ˜¯å¦æœ‰æ—¶/æ€»æ˜¯/ç»ä¸æƒ³ä½¿ç”¨å®ƒä»¬ã€‚

Actions ç”Ÿæˆå™¨åœ¨ Redex æœ¯è¯­ä¸­æ˜¯ä¸€ä¸ªç®€å•çš„å‡½æ•°æœ¯è¯­ï¼Œå®ƒè¿”å›ä¸€ä¸ª action å¯¹è±¡ã€‚å°±è¿™äº› :)

è¿™æ˜¯å…¶ä¸­ä¸¤ä¸ªï¼Œè¿”å›ç†Ÿæ‚‰çš„ actionsã€‚é¡ºä¾¿è¯´ä¸€å¥ï¼Œå®ƒä»¬åœ¨ action å¸¸é‡çš„ "actions.js" ä¸­å®Œç¾å¥‘åˆã€‚

actions.js

```js
export const INCREMENT = "INCREMENT";
export const DECREMENT = "DECREMENT";

export function increment() {
  return { type: INCREMENT };
}

export const decrement = () => ({ type: DECREMENT });
```

æˆ‘ç”¨äº†ä¸¤ç§ä¸åŒæ–¹å¼â€”â€”ä¸€ä¸ª `function` å’Œä¸€ä¸ªç®­å¤´å‡½æ•°â€”â€”æ¥è¡¨æ˜ä½ ç”¨å“ªç§æ–¹å¼å†™å¹¶ä¸é‡è¦ã€‚æŒ‘é€‰ä½ å–œæ¬¢çš„æ–¹å¼å°±å¥½ã€‚

ä½ å¯èƒ½æ³¨æ„åˆ°å‡½æ•°å‘½åæ˜¯å°å†™çš„ï¼ˆå¥½å§ï¼Œå¦‚æœè¾ƒé•¿çš„è¯ä¼šæ˜¯é©¼å³°å‘½åï¼‰ï¼Œè€Œ action å¸¸é‡ä¼šæ˜¯ `UPPER_CASE_WITH_UNDERSCORES`ã€‚åŒæ ·ï¼Œè¿™ä¹Ÿåªæ˜¯æƒ¯ä¾‹ã€‚è¿™ä¼šè®©ä½ ä¸€çœ¼åŒºåˆ† action ç”Ÿæˆå™¨å’Œ action å¸¸é‡ã€‚ä½†ä½ ä¹Ÿå¯ä»¥æŒ‰ä½ å–œæ¬¢çš„æ–¹å¼å‘½åã€‚Redux å¹¶ä¸å…³å¿ƒã€‚

ç°åœ¨ï¼Œå¦‚ä½•ä½¿ç”¨ action ç”Ÿæˆå™¨å‘¢ï¼Ÿå¼•å…¥ç„¶å dispatch å°±å¥½äº†ï¼Œå½“ç„¶ï¼

Counter.js

```js
import React from "react";
import { increment, decrement } from './actions';

class Counter extends React.Component {
  state = { count: 0 };

  increment = () => {
    this.props.dispatch(increment()); // << åœ¨è¿™ä½¿ç”¨
  };

  decrement = () => {
    this.props.dispatch(decrement());
  };

  render() {
    ...
  }
}
```

å…³é”®æ˜¯è¦è®°å¾—è°ƒç”¨ action creator()ï¼

ä¸è¦ `dispatch(increment)` ğŸš«

åº”è¯¥ `dispatch(increment())` âœ…

ç‰¢è®° action ç”Ÿæˆå™¨æ˜¯ä¸€ä¸ªå¹³å‡¡æ— å¥‡çš„å‡½æ•°ã€‚Dispatch éœ€è¦ action æ˜¯ä¸€ä¸ª**å¯¹è±¡**ï¼Œè€Œä¸æ˜¯å‡½æ•°ã€‚

è€Œä¸”ï¼šä½ è‚¯å®šä¼šåœ¨è¿™é‡Œå‡ºé”™å¹¶ä¸”éå¸¸å›°æƒ‘ã€‚è‡³å°‘ä¸€æ¬¡ï¼Œæˆ–è®¸å¾ˆå¤šæ¬¡ã€‚é‚£å¾ˆæ­£å¸¸ã€‚æˆ‘æœ‰æ—¶ä¹Ÿ**ä¾æ—§**ä¼šå¿˜è®°ã€‚

## å¦‚ä½•ä½¿ç”¨ React Redux mapDispatchToProps

ç°åœ¨ä½ çŸ¥é“ action ç”Ÿæˆå™¨æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥è®¨è®º**åˆä¸€ä¸ª**çº§åˆ«çš„æŠ½è±¡ã€‚ï¼ˆæˆ‘çŸ¥é“ï¼Œæˆ‘**çŸ¥é“**ã€‚è¿™æ˜¯å¯é€‰çš„ã€‚ï¼‰

ä½ çŸ¥é“ `connect` å¦‚ä½•ä¼ é€’ `dispatch` å‡½æ•°å—ï¼Ÿä½ çŸ¥é“ä½ æ˜¯å¦‚ä½•åŒå€¦ä¸€ç›´æ•² `this.props.dispatch` å¹¶ä¸”å®ƒçœ‹èµ·æ¥å¤šä¹ˆæ··ä¹±ï¼Ÿï¼ˆè·Ÿæˆ‘æ¥ï¼‰

å†™ä¸€ä¸ª `mapDispatchToProps` å¯¹è±¡ï¼ˆæˆ–è€…å‡½æ•°ï¼ä½†é€šå¸¸æ˜¯å¯¹è±¡ï¼‰ç„¶åä¼ ç»™ä½ è¦åŒ…è£…ç»„ä»¶çš„ `connect` å‡½æ•°ï¼Œä½ å°†æ”¶åˆ°è¿™äº› action ç”Ÿæˆå™¨ä½œä¸º**å¯è°ƒç”¨ props**ã€‚çœ‹ä»£ç ï¼š

Counter.js

```js
import React from 'react';
import { connect } from 'react-redux';
import { increment, decrement } from './actions';

class Counter extends React.Component {
  increment = () => {
    // æˆ‘ä»¬å¯ä»¥è°ƒç”¨ `increment` prop,
    // å®ƒä¼š dispatch action:
    this.props.increment();
  }

  decrement = () => {
    this.props.decrement();
  }

  render() {
    // ...
  }
}

function mapStateToProps(state) {
  return {
    count: state.count
  };
}

// åœ¨è¿™ä¸ªå¯¹è±¡ä¸­, å±æ€§åä¼šæˆä¸º prop çš„ names,
// å±æ€§å€¼åº”è¯¥æ˜¯ action ç”Ÿæˆå™¨å‡½æ•°.
// å®ƒä»¬è·Ÿ `dispatch` ç»‘å®šèµ·æ¥.
const mapDispatchToProps = {
  increment,
  decrement
};

export default connect(mapStateToProps, mapDispatchToProps)(Counter);
```

è¿™å¾ˆæ£’ï¼Œå› ä¸ºå®ƒæŠŠä½ ä»æ‰‹åŠ¨è°ƒç”¨ `dispatch` ä¸­è§£æ”¾å‡ºæ¥ã€‚

ä½ å¯ä»¥æŠŠ `mapDispatch` å†™æˆä¸€ä¸ªå‡½æ•°ï¼Œä½†æ˜¯å¯¹è±¡èƒ½æ»¡è¶³ 95% ä½ æ‰€éœ€çš„åœºæ™¯ã€‚è¯¦ç»†å†…å®¹è¯·çœ‹ [å‡½æ•°å¼ mapDispatch ä»¥åŠä¸ºä»€ä¹ˆä½ å¯èƒ½å¹¶ä¸éœ€è¦å®ƒ](https://daveceddia.com/redux-mapdispatchtoprops-object-form/)ã€‚

## å¦‚ä½•ä½¿ç”¨ Redux Thunk è·å–æ•°æ®

æ—¢ç„¶ reducers åº”è¯¥æ˜¯â€œçº¯â€çš„ï¼Œæˆ‘ä»¬ä¸èƒ½åšåœ¨ reducer é‡Œé¢åšä»»ä½• API è°ƒç”¨æˆ–è€… dispatch actionsã€‚

æˆ‘ä»¬ä¹Ÿä¸èƒ½åœ¨ action ç”Ÿæˆå™¨é‡Œé¢åšè¿™äº›äº‹ï¼

ä½†æ˜¯å¦‚æœæˆ‘ä»¬æŠŠ action ç”Ÿæˆå™¨**è¿”å›**ä¸€ä¸ªå¯ä»¥å¤„ç†æˆ‘ä»¬å·¥ä½œçš„å‡½æ•°ä¼šæ€æ ·å‘¢ï¼Ÿå°±åƒè¿™æ ·ï¼š

```js
function getUser() {
  return function() {
    return fetch('/current_user');
  };
}
```

è¶Šç•Œäº†ï¼ŒRedux ä¸æ”¯æŒè¿™ç§ actionsã€‚å›ºæ‰§çš„ Redux åªæ¥å—**ç®€å•å¯¹è±¡**ä½œä¸º actionsã€‚

è¿™æ—¶å°±éœ€è¦ redux-thunk äº†ã€‚å®ƒæ˜¯ä¸ªä¸­é—´ä»¶ï¼ŒåŸºæœ¬æ˜¯ Redux çš„ä¸€ä¸ªæ’ä»¶ï¼Œå®ƒå¯ä»¥ä½¿ Redux å¤„ç†åƒä¸Šé¢ `getUser()` é‚£æ ·çš„ actionsã€‚

ä½ å¯ä»¥åƒå…¶ä»– action ç”Ÿæˆå™¨ä¸€æ · dispatch è¿™äº› "thunk actions"ï¼š`dispatch(getUser())`ã€‚

### "thunk" æ˜¯ä»€ä¹ˆï¼Ÿ

"thunk" æ˜¯ï¼ˆå°‘è§ï¼‰æŒ‡è¢«å…¶å®ƒå‡½æ•°ä½œä¸ºè¿”å›å€¼çš„**å‡½æ•°**ã€‚

åœ¨ Redux æœ¯è¯­ä¸­ï¼Œå®ƒæ˜¯ä¸€ä¸ªè¿”å›å€¼ä¸ºå‡½æ•°è€Œéç®€å• action å¯¹è±¡çš„ action ç”Ÿæˆå™¨ï¼Œå°±åƒè¿™æ ·ï¼š

```js
function doStuff() {
  return function(dispatch, getState) {
    // åœ¨è¿™é‡Œ dispatch actions
    // æˆ–è€…è·å–æ•°æ®
    // æˆ–è€…è¯¥å¹²å•¥å¹²å•¥
  }
}
```

ä»æŠ€æœ¯è§’åº¦è®²ï¼Œè¢«è¿”å›çš„å‡½æ•°å°±æ˜¯ "thunk"ï¼ŒæŠŠå®ƒä½œä¸ºè¿”å›å€¼çš„å°±æ˜¯â€œaction ç”Ÿæˆå™¨â€ã€‚é€šå¸¸æˆ‘æŠŠå®ƒä»¬ä¸€èµ·ç§°ä¸º "thunk action"ã€‚

Action ç”Ÿæˆå™¨è¿”å›çš„å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š`dispatch` å‡½æ•°å’Œ `getState`ã€‚

å¤§å¤šæ•°åœºæ™¯ä½ åªéœ€è¦ `dispatch`ï¼Œä½†æœ‰æ—¶ä½ æƒ³æ ¹æ® Redux state é‡Œé¢çš„å€¼é¢å¤–åšäº›äº‹æƒ…ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œè°ƒç”¨ `getState()` ä½ å°±ä¼šè·å¾—æ•´ä¸ª state çš„å€¼ç„¶åæŒ‰éœ€æ‰€å–ã€‚

## å¦‚ä½•å®‰è£… Redux Thunk

ä½¿ç”¨ NPM æˆ–è€… Yarn å®‰è£… redux-thunkï¼Œè¿è¡Œ `npm install --save redux-thunk`ã€‚

ç„¶åï¼Œåœ¨ index.jsï¼ˆæˆ–è€…å…¶ä»–ä½ åˆ›å»º store çš„åœ°æ–¹ï¼‰ï¼Œå¼•å…¥ `redux-thunk` ç„¶åé€šè¿‡ Redux çš„ `applyMiddleware` å‡½æ•°æŠŠå®ƒåº”ç”¨åˆ° store ä¸­ã€‚

```js
import thunk from 'redux-thunk';
import { createStore, applyMiddleware } from 'redux';

function reducer(state, action) {
  // ...
}

const store = createStore(
  reducer,
  applyMiddleware(thunk)
);
```

å¿…é¡»ç¡®ä¿ `thunk` åŒ…è£…åœ¨ `applyMiddleware` è°ƒç”¨é‡Œé¢ï¼Œå¦åˆ™ä¸ä¼šç”Ÿæ•ˆã€‚ä¸è¦ç›´æ¥ä¼  `thunk`ã€‚

## ç»“åˆ Redux è¯·æ±‚æ•°æ®çš„ä¾‹å­

è®¾æƒ³ä¸€ä¸‹ä½ æƒ³å±•ç¤ºä¸€ä¸ªäº§å“åˆ—è¡¨ã€‚ä½ å·²ç»è·å¾—äº†åç«¯ API å¯ä»¥å“åº” `GET /products`ï¼Œæ‰€ä»¥ä½ åˆ›å»ºäº†ä¸€ä¸ª thunk action æ¥ä»åç«¯è¯·æ±‚æ•°æ®ï¼š

productActions.js

```js
export function fetchProducts() {
  return dispatch => {
    dispatch(fetchProductsBegin());
    return fetch("/products")
      .then(res => res.json())
      .then(json => {
        dispatch(fetchProductsSuccess(json.products));
        return json.products;
      })
      .catch(error => dispatch(fetchProductsFailure(error)));
  };
}
```

`fetch("/products")` æ˜¯å®é™…ä¸Šè¯·æ±‚æ•°æ®çš„éƒ¨åˆ†ã€‚ç„¶åæˆ‘ä»¬åœ¨å®ƒå‰ååˆ†åˆ«åšäº†ä¸€äº› `dispatch` è°ƒç”¨ã€‚

## Dispatch Action æ¥è·å–æ•°æ®

è¦å¼€å§‹è°ƒç”¨å¹¶ä¸”å®é™…è·å–æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦ dispatch `fetchProducts` actionã€‚

åœ¨å“ªé‡Œè°ƒç”¨å‘¢ï¼Ÿ

å¦‚æœæŸä¸€ç‰¹å®šçš„ç»„ä»¶éœ€è¦æ•°æ®ï¼Œæœ€å¥½çš„è°ƒç”¨åœ°æ–¹é€šå¸¸æ˜¯åœ¨ç»„ä»¶åˆšåˆšåŠ è½½**ä¹‹å**ï¼Œä¹Ÿå°±æ˜¯å®ƒçš„ `componentDidMount` ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚

æˆ–è€…ï¼Œå¦‚æœä½ åœ¨ä½¿ç”¨ Hooksï¼ŒuseEffect hook é‡Œé¢ä¹Ÿæ˜¯ä¸ªå¥½åœ°æ–¹ã€‚

æœ‰æ—¶ä½ è¦è·å–æ•´ä¸ªåº”ç”¨éƒ½éœ€è¦çš„çœŸæ­£çš„**å…¨å±€**æ•°æ® â€”â€” å¦‚â€œç”¨æˆ·ä¿¡æ¯â€æˆ–è€…â€œå›½é™…åŒ–â€ã€‚è¿™ç§åœºæ™¯ï¼Œå°±åœ¨ä½ åˆ›å»º store åä½¿ç”¨ `store.dispatch` æ¥ dispatch actionï¼Œè€Œä¸æ˜¯ç­‰å¾…ç»„ä»¶åŠ è½½åã€‚

### å¦‚ä½•ç»™ Redux Actions å‘½å

è·å–æ•°æ®çš„ Redux actions é€šå¸¸ä½¿ç”¨æ ‡å‡†ä¸‰è¿ï¼šBEGINã€SUCCESSã€FAILUREã€‚è¿™ä¸æ˜¯ç¡¬æ€§è¦æ±‚ï¼Œåªæ˜¯æƒ¯ä¾‹ã€‚

BEGIN/SUCCESS/FAILURE æ¨¡å¼å¾ˆæ£’ï¼Œå› ä¸ºå®ƒç»™ä½ æä¾›é’©å­æ¥è·Ÿè¸ªå‘ç”Ÿäº†ä»€ä¹ˆ â€”â€” æ¯”å¦‚ï¼Œè®¾ç½® "loading" æ ‡å¿—ä¸º "true" ä»¥å“åº” BEGIN æ“ä½œï¼Œåœ¨ SUCCESS æˆ– FAILURE ä¹‹åè®¾ä¸º `false`ã€‚

è€Œä¸”ï¼Œä¸ Redux ä¸­çš„å…¶ä»–æ‰€æœ‰å†…å®¹ä¸€æ ·ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ä¸€ä¸ªæƒ¯ä¾‹ï¼Œå¦‚æœä½ ä¸éœ€è¦çš„è¯å¯ä»¥å¿½ç•¥æ‰ã€‚

åœ¨ä½ è°ƒç”¨ API **ä¹‹å‰**ï¼Œdispatch BEGIN actionã€‚

è°ƒç”¨æˆåŠŸ**ä¹‹å**ï¼Œä½ å¯ä»¥ dispatch SUCCESS æ•°æ®ã€‚å¦‚æœè¯·æ±‚å¤±è´¥ï¼Œä½ å¯ä»¥ dispatch é”™è¯¯ä¿¡æ¯ã€‚

æœ‰æ—¶æœ€åä¸€ä¸ªè°ƒç”¨ ERRORã€‚å…¶å®è°ƒç”¨ä»€ä¹ˆä¸€ç‚¹ä¹Ÿä¸é‡è¦ï¼Œåªè¦ä½ ä¿æŒä¸€è‡´å°±å¥½ã€‚

æ³¨æ„ï¼šdispatch Error action æ¥å¤„ç† FAILURE ä¼šå¯¼è‡´ä½ è·Ÿè¸ªä»£ç çš„æ—¶å€™æ¯«æ— å¤´ç»ªï¼ŒçŸ¥é“ action æ­£ç¡® dispatch ä½†æ˜¯æ•°æ®å´æ²¡æ›´æ–°ã€‚å¸å–æˆ‘çš„æ•™è®­ :)

è¿™æ˜¯é‚£å‡ ä¸ª actionsï¼Œä»¥åŠå®ƒä»¬çš„ action ç”Ÿæˆå™¨ï¼š

productActions.js

```js
export const FETCH_PRODUCTS_BEGIN   = 'FETCH_PRODUCTS_BEGIN';
export const FETCH_PRODUCTS_SUCCESS = 'FETCH_PRODUCTS_SUCCESS';
export const FETCH_PRODUCTS_FAILURE = 'FETCH_PRODUCTS_FAILURE';

export const fetchProductsBegin = () => ({
  type: FETCH_PRODUCTS_BEGIN
});

export const fetchProductsSuccess = products => ({
  type: FETCH_PRODUCTS_SUCCESS,
  payload: { products }
});

export const fetchProductsFailure = error => ({
  type: FETCH_PRODUCTS_FAILURE,
  payload: { error }
});
```

æ¥æ”¶åˆ° `FETCH_PRODUCTS_SUCCESS` action è¿”å›çš„äº§å“æ•°æ®åï¼Œæˆ‘ä»¬å†™ä¸€ä¸ª reducer æŠŠå®ƒå­˜è¿› Redux store ä¸­ã€‚å¼€å§‹è¯·æ±‚æ—¶æŠŠ `loading` æ ‡å¿—è®¾ä¸º trueï¼Œå¤±è´¥æˆ–è€…å®Œæˆæ—¶è®¾ä¸º falseã€‚

productReducer.js

```js
import {
  FETCH_PRODUCTS_BEGIN,
  FETCH_PRODUCTS_SUCCESS,
  FETCH_PRODUCTS_FAILURE
} from './productActions';

const initialState = {
  items: [],
  loading: false,
  error: null
};

export default function productReducer(state = initialState, action) {
  switch(action.type) {
    case FETCH_PRODUCTS_BEGIN:
      // æŠŠ state æ ‡è®°ä¸º "loading" è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ˜¾ç¤º spinner æˆ–è€…å…¶ä»–å†…å®¹
      // åŒæ ·ï¼Œé‡ç½®æ‰€æœ‰é”™è¯¯ä¿¡æ¯ã€‚æˆ‘ä»¬ä»æ–°å¼€å§‹ã€‚
      return {
        ...state,
        loading: true,
        error: null
      };

    case FETCH_PRODUCTS_SUCCESS:
      // å…¨éƒ¨å®Œæˆï¼šè®¾ç½® loading ä¸º "false"ã€‚
      // åŒæ ·ï¼ŒæŠŠä»æœåŠ¡ç«¯è·å–çš„æ•°æ®èµ‹ç»™ itemsã€‚
      return {
        ...state,
        loading: false,
        items: action.payload.products
      };

    case FETCH_PRODUCTS_FAILURE:
      // è¯·æ±‚å¤±è´¥ï¼Œè®¾ç½® loading ä¸º "false".
      // ä¿å­˜é”™è¯¯ä¿¡æ¯ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨å…¶ä»–åœ°æ–¹å±•ç¤ºã€‚
      // æ—¢ç„¶å¤±è´¥äº†ï¼Œæˆ‘ä»¬æ²¡æœ‰äº§å“å¯ä»¥å±•ç¤ºï¼Œå› æ­¤è¦æŠŠ `items` æ¸…ç©ºã€‚
      //
      // å½“ç„¶è¿™å–å†³äºä½ å’Œåº”ç”¨æƒ…å†µï¼š
      // æˆ–è®¸ä½ æƒ³ä¿ç•™ items æ•°æ®ï¼
      // æ— è®ºå¦‚ä½•é€‚åˆä½ çš„åœºæ™¯å°±å¥½ã€‚
      return {
        ...state,
        loading: false,
        error: action.payload.error,
        items: []
      };

    default:
      // reducer éœ€è¦æœ‰ default caseã€‚
      return state;
  }
}
```

æœ€åï¼Œæˆ‘ä»¬éœ€è¦æŠŠäº§å“æ•°æ®ä¼ ç»™å±•ç¤ºå®ƒä»¬å¹¶ä¸”ä¹Ÿè´Ÿè´£è¯·æ±‚æ•°æ®çš„ `ProductList` ç»„ä»¶ã€‚

ProductList.js

```js
import React from "react";
import { connect } from "react-redux";
import { fetchProducts } from "/productActions";

class ProductList extends React.Component {
  componentDidMount() {
    this.props.dispatch(fetchProducts());
  }

  render() {
    const { error, loading, products } = this.props;

    if (error) {
      return <div>Error! {error.message}</div>;
    }

    if (loading) {
      return <div>Loading...</div>;
    }

    return (
      <ul>
        {products.map(product =>
          <li key={product.id}>{product.name}</li>
        )}
      </ul>
    );
  }
}

const mapStateToProps = state => ({
  products: state.products.items,
  loading: state.products.loading,
  error: state.products.error
});

export default connect(mapStateToProps)(ProductList);
```

æˆ‘æŒ‡çš„æ˜¯å¸¦æœ‰ `state.products.<whatever>` çš„æ•°æ®è€Œä¸ä»…ä»…æ˜¯ `state.<whatever>`ï¼Œå› ä¸ºæˆ‘å‡è®¾ä½ å¯èƒ½ä¼šæœ‰ä¸æ­¢ä¸€ä¸ª reducerï¼Œæ¯ä¸€ä¸ªéƒ½å¤„ç†å„è‡ªçš„ stateã€‚ä¸ºäº†ç¡®ä¿è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ª `rootReducer.js` æ–‡ä»¶æŠŠå®ƒä»¬æ”¾åœ¨ä¸€èµ·ï¼š

rootReducer.js

```js
import { combineReducers } from "redux";
import products from "./productReducer";

export default combineReducers({
  products
});
```

ç„¶åï¼Œå½“æˆ‘ä»¬åˆ›å»º store æˆ‘ä»¬å¯ä»¥ä¼ é€’è¿™ä¸ªâ€œæ ¹â€ reducerï¼š

index.js

```js
import rootReducer from './rootReducer';

// ...

const store = createStore(rootReducer);
```

## Redux ä¸­é”™è¯¯å¤„ç†

è¿™é‡Œçš„é”™è¯¯å¤„ç†æ¯”è¾ƒè½»é‡ï¼Œä½†æ˜¯å¯¹å¤§éƒ¨åˆ†è°ƒç”¨ API çš„ actions æ¥è¯´åŸºæœ¬ç»“æ„æ˜¯ä¸€æ ·çš„ã€‚åŸºæœ¬è§‚ç‚¹æ˜¯ï¼š

1. å½“è°ƒç”¨å¤±è´¥æ—¶ï¼Œdispatch ä¸€ä¸ª FAILURE action
2. é€šè¿‡è®¾ç½®ä¸€äº›æ ‡å¿—å˜é‡å’Œ/æˆ–ä¿å­˜é”™è¯¯ä¿¡æ¯æ¥å¤„ç† reducer ä¸­çš„ FAILURE actionã€‚
3. æŠŠé”™è¯¯æ ‡å¿—å’Œä¿¡æ¯ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ä¼ ç»™éœ€è¦å¤„ç†é”™è¯¯çš„ç»„ä»¶ï¼Œç„¶åæ ¹æ®ä»»ä½•ä½ è§‰å¾—åˆé€‚çš„æ–¹å¼æ¸²æŸ“é”™è¯¯ä¿¡æ¯ã€‚

### èƒ½é¿å…é‡å¤æ¸²æŸ“å—ï¼Ÿ

è¿™ç¡®å®ä¸ªå¸¸è§é—®é¢˜ã€‚æ˜¯çš„ï¼Œå®ƒ**ä¼š**ä¸æ­¢ä¸€æ¬¡è§¦å‘æ¸²æŸ“ã€‚

å®ƒé¦–å…ˆä¼šæ¸²æŸ“ç©º stateï¼Œç„¶åå†æ¸²æŸ“ loading stateï¼Œæ¥ç€ä¼š**å†æ¬¡**æ¸²æŸ“å±•ç¤ºäº§å“ã€‚å¯æ€•ï¼ä¸‰æ¬¡æ¸²æŸ“ï¼ï¼ˆå¦‚æœä½ ç›´æ¥è·³è¿‡ "loading" state å°±å¯ä»¥æŠŠæ¸²æŸ“æ¬¡æ•°å°†ä¸ºä¸¤æ¬¡ï¼‰

ä½ å¯èƒ½ä¼šæ‹…å¿ƒä¸å¿…è¦çš„æ¸²æŸ“å½±å“æ€§èƒ½ï¼Œä½†æ˜¯ä¸ä¼šï¼šå•æ¬¡æ¸²æŸ“éå¸¸å¿«ã€‚å¦‚æœä½ åœ¨å¼€å‘çš„åº”ç”¨è‚‰çœ¼å¯è§çš„æ…¢çš„è¯ï¼Œåˆ†æä¸€ä¸‹æ‰¾å‡ºæ…¢çš„åŸå› ã€‚

è¿™æ ·æƒ³å§ï¼šå½“æ²¡æœ‰å•†å“æˆ–è€…æ­£åœ¨åŠ è½½æˆ–è€…å‘ç”Ÿé”™è¯¯çš„æ—¶å€™åº”ç”¨éœ€è¦å±•ç¤º**ä¸€äº›ä¸œè¥¿**ã€‚åœ¨æ•°æ®å‡†å¤‡å¥½ä¹‹å‰ï¼Œä½ å¯èƒ½ä¸æƒ³åªå±•ç¤ºä¸€ä¸ªç©ºç™½å±å¹•ã€‚è¿™ç»™ä½ äº†ä¸€ä¸ªæä¾›è‰¯å¥½ç”¨æˆ·ä½“éªŒçš„æœºä¼šã€‚

## æ¥ä¸‹æ¥å‘¢ï¼Ÿ

å¸Œæœ›è¿™ç¯‡æ•™ç¨‹èƒ½å¸®ä½ æ›´åŠ ç†è§£ Reduxï¼

å¦‚æœä½ æƒ³æ·±å…¥äº†è§£é‡Œé¢çš„ç»†èŠ‚ï¼Œ[Redux æ–‡æ¡£](https://redux.js.org/)æœ‰å¾ˆå¤šå¾ˆå¥½çš„ä¾‹å­ã€‚Mark Erikson (Redux ç»´æŠ¤è€…ä¹‹ä¸€)çš„åšå®¢æœ‰ä¸€ä¸ªä¸é”™çš„[å¸¸ç”¨çš„ Redux ç³»åˆ—](https://blog.isquaredsoftware.com/series/idiomatic-redux/)ã€‚

ä¸‹å‘¨ï¼Œæˆ‘ä¼šå‘å¸ƒä¸€ä¸ªæ–°è¯¾ç¨‹ï¼Œ[Pure Redux](https://daveceddia.com/pure-redux/)ï¼Œæ¶µç›–è¿™é‡Œçš„æ‰€æœ‰å†…å®¹ï¼Œä¸°å¯Œäº†æ›´å¤šç»†èŠ‚ï¼š

- å¦‚ä½•åš immutable æ›´æ–°
- ä½¿ç”¨ Immer è½»æ¾å®ç° immutable
- ä½¿ç”¨ Redux DevTools è°ƒè¯•åº”ç”¨
- ä¸º reducersã€actions å’Œ thunk actions ç¼–å†™å•å…ƒæµ‹è¯•

è¿˜æœ‰ä¸€æ•´ä¸ªæ¨¡å—è®²è§£æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„åº”ç”¨ï¼Œä»å¼€å§‹åˆ°ç»“æŸï¼ŒåŒ…å«è¿™äº›ï¼š

- å°† CRUD æ“ä½œä¸ Redux é›†æˆ â€”â€” å¢åˆ æŸ¥æ”¹
- åˆ›å»º API æœåŠ¡
- å¯è®¿é—®è·¯ç”±ä»¥åŠè·¯ç”±åŠ è½½æ—¶è¯·æ±‚æ•°æ®
- å¤„ç†æ¨¡æ€å¯¹è¯æ¡†
- å°†å¤šä¸ª reducer ä¸ combineReducers ç»“åˆä½¿ç”¨
- å¦‚ä½•ä½¿ç”¨é€‰æ‹©å™¨ä»¥åŠ `reselect` ä»¥æé«˜æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§
- æƒé™å’Œ session ç®¡ç†
- ç®¡ç†å‘˜å’Œæ™®é€šç”¨æˆ·è§†å›¾åˆ†ç¦»

> å¦‚æœå‘ç°è¯‘æ–‡å­˜åœ¨é”™è¯¯æˆ–å…¶ä»–éœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼Œæ¬¢è¿åˆ° [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner) å¯¹è¯‘æ–‡è¿›è¡Œä¿®æ”¹å¹¶ PRï¼Œä¹Ÿå¯è·å¾—ç›¸åº”å¥–åŠ±ç§¯åˆ†ã€‚æ–‡ç« å¼€å¤´çš„ **æœ¬æ–‡æ°¸ä¹…é“¾æ¥** å³ä¸ºæœ¬æ–‡åœ¨ GitHub ä¸Šçš„ MarkDown é“¾æ¥ã€‚

---

> [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner) æ˜¯ä¸€ä¸ªç¿»è¯‘ä¼˜è´¨äº’è”ç½‘æŠ€æœ¯æ–‡ç« çš„ç¤¾åŒºï¼Œæ–‡ç« æ¥æºä¸º [æ˜é‡‘](https://juejin.im) ä¸Šçš„è‹±æ–‡åˆ†äº«æ–‡ç« ã€‚å†…å®¹è¦†ç›– [Android](https://github.com/xitu/gold-miner#android)ã€[iOS](https://github.com/xitu/gold-miner#ios)ã€[å‰ç«¯](https://github.com/xitu/gold-miner#å‰ç«¯)ã€[åç«¯](https://github.com/xitu/gold-miner#åç«¯)ã€[åŒºå—é“¾](https://github.com/xitu/gold-miner#åŒºå—é“¾)ã€[äº§å“](https://github.com/xitu/gold-miner#äº§å“)ã€[è®¾è®¡](https://github.com/xitu/gold-miner#è®¾è®¡)ã€[äººå·¥æ™ºèƒ½](https://github.com/xitu/gold-miner#äººå·¥æ™ºèƒ½)ç­‰é¢†åŸŸï¼Œæƒ³è¦æŸ¥çœ‹æ›´å¤šä¼˜è´¨è¯‘æ–‡è¯·æŒç»­å…³æ³¨ [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)ã€[å®˜æ–¹å¾®åš](http://weibo.com/juejinfanyi)ã€[çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/juejinfanyi)ã€‚
