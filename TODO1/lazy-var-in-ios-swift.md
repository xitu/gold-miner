> * åŸæ–‡åœ°å€ï¼š[lazy var in ios swift](https://medium.com/@abhimuralidharan/lazy-var-in-ios-swift-96c75cb8a13a)
> * åŸæ–‡ä½œè€…ï¼š[Abhimuralidharan](https://medium.com/@abhimuralidharan)
> * è¯‘æ–‡å‡ºè‡ªï¼š[æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)
> * æœ¬æ–‡æ°¸ä¹…é“¾æ¥ï¼š[https://github.com/xitu/gold-miner/blob/master/TODO1/lazy-var-in-ios-swift.md](https://github.com/xitu/gold-miner/blob/master/TODO1/lazy-var-in-ios-swift.md)
> * è¯‘è€…ï¼š[kirinzer](https://github.com/kirinzer)
> * æ ¡å¯¹è€…ï¼š[portandbridge](https://github.com/portandbridge), [iWeslie](https://github.com/iWeslie)

# åœ¨ iOS Swift ä¸­çš„æ‡’åŠ è½½å˜é‡

> è¿™ç¯‡æ–‡ç« è§£é‡Šäº†åœ¨ Swift ä¸­æ‡’åŠ è½½å˜é‡æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä½ å¿…é¡»å¯¹é—­åŒ…æœ‰ä¸€äº›äº†è§£ã€‚

**[é˜…è¯»è¿™ç¯‡æ–‡ç« è·å–æ›´å¤šå…³äºé—­åŒ…çš„ä¿¡æ¯](https://medium.com/@abhimuralidharan/functional-swift-all-about-closures-310bc8af31dd).**

å½“æˆ‘ä»¬è¿›è¡Œ iOS å¼€å‘æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥éå¸¸å…³æ³¨åº”ç”¨ç¨‹åºçš„å†…å­˜å ç”¨æƒ…å†µã€‚å¦‚æœåº”ç”¨ç¨‹åºå¾ˆå¤æ‚ï¼Œé‚£ä¹ˆå†…å­˜é—®é¢˜å°±ä¼šæ˜¯å¯¹äºå¼€å‘è€…çš„ä¸€ä¸ªä¸»è¦çš„æŒ‘æˆ˜ã€‚æ‰€ä»¥ï¼Œé¦–å…ˆè€ƒè™‘åˆ°å†…å­˜åˆ†é…é—®é¢˜çš„å¼€å‘è€…èƒ½å¤ŸçœŸæ­£çš„å†™å‡ºä¼˜åŒ–çš„ä»£ç ã€‚é™¤éç¡®å®æœ‰å¿…è¦ï¼Œå¦åˆ™å¼€å‘è€…è¦é¿å…åšä¸€äº›è€—æ—¶çš„å·¥ä½œã€‚é‚£äº›å¤æ‚çš„åˆ†é…å†…å­˜æ“ä½œä¼šæ¶ˆè€—æ›´å¤šçš„æ—¶é—´ï¼Œå¹¶ä¸”å¯¹äºç¨‹åºçš„æ€§èƒ½æœ‰ä¸¥é‡çš„å½±å“ã€‚

![](https://cdn-images-1.medium.com/max/2000/1*HRKGc4RHwRXiyIHOzlpKbA.png)

Swift æœ‰å†…ç½®åœ¨è¯­è¨€ä¸­çš„æœºåˆ¶ï¼Œå¯ä»¥å³æ—¶çš„è®¡ç®—é‚£äº›è€—æ—¶å·¥ä½œã€‚å®ƒå«åš**æ‡’åŠ è½½å˜é‡**ã€‚è¿™ç§å˜é‡åªæœ‰åœ¨ä½ ç¬¬ä¸€æ¬¡éœ€è¦å®ƒçš„æ—¶å€™æ‰è¢«æŒ‡å®šçš„æ–¹æ³•åˆ›å»ºã€‚å¦‚æœä»æ²¡æœ‰ä½¿ç”¨è¿‡è¯¥å˜é‡ã€‚é‚£ä¹ˆæ–¹æ³•å°±ä¸ä¼šè¿è¡Œï¼Œæ‰€ä»¥å®ƒå¯ä»¥å¸®åŠ©å‡å°‘ä¸€äº›å¤„ç†æ—¶é—´ã€‚

*è‹¹æœçš„å®˜æ–¹æ–‡æ¡£å†™é“ï¼š*

**ä¸€ä¸ªæ‡’åŠ è½½å‚¨å­˜å±æ€§æ˜¯ç§åªæœ‰åœ¨é¦–æ¬¡ä½¿ç”¨æ—¶ï¼Œæ‰è®¡ç®—å…¶åˆå§‹å€¼çš„å±æ€§ã€‚ä½ å¯ä»¥é€šè¿‡åœ¨å£°æ˜å‰åŠ  `lazy` ä¿®é¥°ç¬¦æ¥æ ‡ç¤ºä¸€ä¸ªæ‡’åŠ è½½å­˜å‚¨å±æ€§ã€‚**

> ä½ å¿…é¡»å°†ä¸€ä¸ªæ‡’åŠ è½½å±æ€§å£°æ˜ä¸ºä¸€ä¸ªå˜é‡(é€šè¿‡ `var` å…³é”®å­—)ï¼Œå› ä¸ºå®ƒçš„åˆå§‹åŒ–å€¼ä¹Ÿè®¸ä¸èƒ½è·å¾—ï¼Œç›´åˆ°å®ä¾‹çš„åˆå§‹åŒ–å®Œæˆã€‚å¸¸é‡å±æ€§åœ¨åˆå§‹åŒ–å®Œæˆ**ä¹‹å‰**ä¸€å®šä¼šæœ‰ä¸€ä¸ªå€¼ï¼Œå› æ­¤ä¸èƒ½ç”¨æ‡’åŠ è½½å£°æ˜ã€‚

ä¸ºäº†è§£é‡Šè¿™äº›ï¼Œæˆ‘ä¼šä½¿ç”¨ä¸€ä¸ªå¾ˆåŸºç¡€çš„ç¤ºä¾‹ï¼šå‡è®¾æœ‰ä¸€ä¸ªç»“æ„ä½“å«åš InterviewCandidateã€‚å®ƒæœ‰ä¸€ä¸ªå¯é€‰çš„å¸ƒå°”å€¼ï¼Œå†³å®šå€™é€‰äººæ­£åœ¨ç”³è¯· iOS æˆ–è€… Androidã€‚iOSResumeDescription å’Œ androidResumeDescription è¢«å£°æ˜ä¸ºæ‡’åŠ è½½å±æ€§ã€‚é‚£ä¹ˆåœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œä¸€ä¸ªäººæ˜¯ iOS å¼€å‘è€…ï¼Œæ‡’åŠ è½½å˜é‡ **iOSResumeDescription** å°†ä¼šåœ¨è°ƒç”¨æ‰“å°æ–¹æ³•çš„æ—¶å€™è¢«åˆå§‹åŒ–ã€‚æ²¡æœ‰è¢«è°ƒç”¨çš„ **androidResumeDescription** å°±ä¼šæ˜¯ nilã€‚

```swift
//: Playground - noun: äººä»¬ç”¨æ¥ç©è€çš„åœ°æ–¹
import UIKit


struct InterviewCandidate {
    var isiOS:Bool?
    
    lazy var iOSResumeDescription: String = {
        return "I am an iOS developer"
    }()
    lazy var androidResumeDescription: String = {
        return "I am an android developer"
    }()
}

var person1 = InterviewCandidate()
person1.isiOS = true

if person1.isiOS! {
    print(person1.iOSResumeDescription)
} else {
    print(person1.androidResumeDescription)

}
```

è¿™æ˜¯ä¸€ä¸ªéå¸¸åŸºç¡€çš„ä¾‹å­ã€‚å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªå¤æ‚çš„ç±»æˆ–ç»“æ„ï¼Œå®ƒåŒ…å«ä»å¾ªç¯çš„å‡½æ•°è¿”å›ç»“æœçš„è®¡ç®—å˜é‡ï¼Œå¹¶ä¸”å¦‚æœæˆ‘ä»¬åˆ›å»º 1000 ä¸ªè¿™æ ·çš„å¯¹è±¡ï¼Œé‚£ä¹ˆæ€§èƒ½å’Œå†…å­˜å°†ä¼šå—åˆ°å½±å“ã€‚

## æ‡’åŠ è½½å­˜å‚¨å±æ€§ vs å­˜å‚¨å±æ€§

è¿™æœ‰ä¸€äº›æ‡’åŠ è½½å±æ€§ç›¸å¯¹äºå­˜å‚¨å±æ€§çš„ä¼˜ç‚¹ã€‚

 1. åªæœ‰åœ¨è¯»å–æ‡’åŠ è½½å±æ€§æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œä¸è¯¥å±æ€§å…³è”çš„é—­åŒ…ã€‚ å› æ­¤ï¼Œå¦‚æœç”±äºæŸç§åŸå› è¯¥å±æ€§æœªè¢«ä½¿ç”¨ï¼ˆå¯èƒ½æ˜¯å› ä¸ºç”¨æˆ·çš„æŸäº›å†³å®šï¼‰ï¼Œåˆ™å¯ä»¥é¿å…ä¸å¿…è¦çš„åˆ†é…å’Œè®¡ç®—ã€‚

 2. ä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå­˜å‚¨å±æ€§ç»™æ‡’åŠ è½½å±æ€§èµ‹å€¼ã€‚

 3. **æ³¨æ„** ä½ èƒ½å¤Ÿåœ¨æ‡’åŠ è½½çš„å±æ€§é—­åŒ…å†…éƒ¨ä½¿ç”¨ `self`ã€‚è¿™ä¸ä¼šå¯¼è‡´ä»»ä½•å¾ªç¯å¼•ç”¨ã€‚åŸå› åœ¨äºå®ƒç«‹å³ä½¿ç”¨çš„è¿™ä¸ªé—­åŒ… `{}()` è¢«è®¤ä¸ºæ˜¯ `@noescape`ã€‚å®ƒä¸ä¼šå¼•ç”¨æ•è·çš„ `self`ã€‚
> ä½†æ˜¯ï¼Œå¦‚æœä½ åœ¨ **æ–¹æ³•** ä¸­ä½¿ç”¨ `self`ã€‚äº‹å®ä¸Šï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªç±»è€Œä¸æ˜¯ç»“æ„ä½“ï¼Œä½ ä¹Ÿåº”è¯¥åœ¨ä½ çš„æ–¹æ³•å†…å£°æ˜ `[unowned self]` é‚£æ ·ä½ æ‰ä¸ä¼šåˆ›å»ºä¸€ä¸ªå¼ºå¼•ç”¨ï¼ˆæŸ¥çœ‹ä¸‹é¢çš„ä»£ç ï¼‰ã€‚

```swift
// playground code

import UIKit
import Foundation

class InterviewTest {
	var name: String
	lazy var greeting : String = { return â€œHello \(self.name)â€ }()
	// è¿™é‡Œæ²¡æœ‰å¾ªç¯å¼•ç”¨ ..

	init(name: String) {
		self.name = name
	}
}

let testObj = InterviewTest(name:â€abhiâ€)

testObj.greeting
```

ä½ èƒ½å¤Ÿå¼•ç”¨è¿™ä¸ªå˜é‡ï¼Œæ— è®ºä½ æ˜¯å¦ä½¿ç”¨äº†é—­åŒ…ã€‚

```swift
lazy var iOSResumeDescription = â€œI am an iOS developerâ€
```

è¿™æ ·çš„è¯­æ³•ä¹Ÿå¯ä»¥è¿è¡Œã€‚

> **æ³¨æ„ï¼šè®°ä½ï¼Œæ‡’åŠ è½½å±æ€§çš„ç”¨é€”æ˜¯åªæœ‰å®ƒä»¬ç¬¬ä¸€æ¬¡è¢«éœ€è¦çš„æ—¶å€™æ‰ä¼šè¢«è®¡ç®—ï¼Œåœ¨è¿™ä¹‹åå®ƒä»¬çš„å€¼å°±è¢«å­˜å‚¨ä¸‹æ¥äº†ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ ç¬¬äºŒæ¬¡ä½¿ç”¨ `iOSResumeDescription `ï¼Œé¢„å…ˆå­˜å‚¨çš„å±æ€§å°±ä¼šè¿”å›ã€‚**

## æ‡’åŠ è½½è§„åˆ™:

* ä½ ä¸èƒ½å¯¹ `let` ç±»å‹ä½¿ç”¨ `lazy`ã€‚

* ä½ ä¸èƒ½å¯¹äº `è®¡ç®—å±æ€§` ä½¿ç”¨å®ƒã€‚å› ä¸ºä¸€ä¸ªè®¡ç®—å±æ€§ä¼šåœ¨æ¯æ¬¡æˆ‘ä»¬è¯•å›¾è®¿é—®å®ƒçš„æ—¶å€™å»æ‰§è¡Œåœ¨è®¡ç®—ä»£ç å—ä¸­çš„ä»£ç å¹¶è¿”å›ç›¸åº”çš„å€¼ã€‚

* ä½ åªèƒ½å¯¹ `struct` å’Œ `class` çš„æˆå‘˜ä½¿ç”¨ `lazy`ã€‚

* æ‡’åŠ è½½å˜é‡ä¸æ˜¯åŸå­åˆå§‹åŒ–ç±»å‹ï¼Œæ‰€ä»¥å®ƒå¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚

**å¦‚æœä½ å–œæ¬¢é˜…è¯»è¿™ç¯‡æ–‡ç« ï¼Œé‚£ä¹ˆåˆ†äº«å’Œæ¨èå®ƒä»¥ä¾¿å…¶ä»–äººèƒ½å¤Ÿçœ‹åˆ°ğŸ’šğŸ’šğŸ’šğŸ’šğŸ’šğŸ’šï¼**

> å¦‚æœå‘ç°è¯‘æ–‡å­˜åœ¨é”™è¯¯æˆ–å…¶ä»–éœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼Œæ¬¢è¿åˆ° [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner) å¯¹è¯‘æ–‡è¿›è¡Œä¿®æ”¹å¹¶ PRï¼Œä¹Ÿå¯è·å¾—ç›¸åº”å¥–åŠ±ç§¯åˆ†ã€‚æ–‡ç« å¼€å¤´çš„ **æœ¬æ–‡æ°¸ä¹…é“¾æ¥** å³ä¸ºæœ¬æ–‡åœ¨ GitHub ä¸Šçš„ MarkDown é“¾æ¥ã€‚

---

> [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner) æ˜¯ä¸€ä¸ªç¿»è¯‘ä¼˜è´¨äº’è”ç½‘æŠ€æœ¯æ–‡ç« çš„ç¤¾åŒºï¼Œæ–‡ç« æ¥æºä¸º [æ˜é‡‘](https://juejin.im) ä¸Šçš„è‹±æ–‡åˆ†äº«æ–‡ç« ã€‚å†…å®¹è¦†ç›– [Android](https://github.com/xitu/gold-miner#android)ã€[iOS](https://github.com/xitu/gold-miner#ios)ã€[å‰ç«¯](https://github.com/xitu/gold-miner#å‰ç«¯)ã€[åç«¯](https://github.com/xitu/gold-miner#åç«¯)ã€[åŒºå—é“¾](https://github.com/xitu/gold-miner#åŒºå—é“¾)ã€[äº§å“](https://github.com/xitu/gold-miner#äº§å“)ã€[è®¾è®¡](https://github.com/xitu/gold-miner#è®¾è®¡)ã€[äººå·¥æ™ºèƒ½](https://github.com/xitu/gold-miner#äººå·¥æ™ºèƒ½)ç­‰é¢†åŸŸï¼Œæƒ³è¦æŸ¥çœ‹æ›´å¤šä¼˜è´¨è¯‘æ–‡è¯·æŒç»­å…³æ³¨ [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)ã€[å®˜æ–¹å¾®åš](http://weibo.com/juejinfanyi)ã€[çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/juejinfanyi)ã€‚
