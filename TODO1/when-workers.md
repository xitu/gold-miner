> * åŸæ–‡åœ°å€ï¼š[When should you be using Web Workers?](https://dassur.ma/things/when-workers/)
> * åŸæ–‡ä½œè€…ï¼š[Surma](https://dassur.ma/)
> * è¯‘æ–‡å‡ºè‡ªï¼š[æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)
> * æœ¬æ–‡æ°¸ä¹…é“¾æ¥ï¼š[https://github.com/xitu/gold-miner/blob/master/TODO1/when-workers.md](https://github.com/xitu/gold-miner/blob/master/TODO1/when-workers.md)
> * è¯‘è€…ï¼š[weibinzhu](https://github.com/weibinzhu)
> * æ ¡å¯¹è€…ï¼š[ahabhgk](https://github.com/ahabhgk)ï¼Œ[febrainqu](https://github.com/febrainqu)

# åœ¨ä»€ä¹ˆæ—¶å€™éœ€è¦ä½¿ç”¨ Web Workersï¼Ÿ

ä½ åº”è¯¥åœ¨ä»€ä¹ˆæ—¶å€™éƒ½ä½¿ç”¨ Web Workersã€‚ä¸æ­¤åŒæ—¶åœ¨æˆ‘ä»¬å½“å‰çš„æ¡†æ¶ä¸–ç•Œä¸­ï¼Œè¿™å‡ ä¹ä¸å¯èƒ½ã€‚

æˆ‘è¿™ä¹ˆè¯´å¸å¼•åˆ°ä½ çš„æ³¨æ„å—ï¼Ÿå¾ˆå¥½ã€‚å½“ç„¶å¯¹äºä»»ä½•ä¸€ä¸ªä¸»é¢˜ï¼Œéƒ½ä¼šæœ‰å…¶ç²¾å¦™ä¹‹å¤„ï¼Œæˆ‘ä¼šå°†ä»–ä»¬éƒ½å±•ç¤ºå‡ºæ¥ã€‚ä½†æˆ‘ä¼šæœ‰è‡ªå·±çš„è§‚ç‚¹ï¼Œå¹¶ä¸”å®ƒä»¬å¾ˆé‡è¦ã€‚ç³»ç´§ä½ çš„å®‰å…¨å¸¦ï¼Œæˆ‘ä»¬é©¬ä¸Šå‡ºå‘ã€‚

## æ€§èƒ½å·®å¼‚æ­£åœ¨æ‰©å¤§

> **æ³¨æ„ï¼š** æˆ‘è®¨åŒâ€œæ–°å…´å¸‚åœºâ€è¿™ä¸ªè¯ï¼Œä½†æ˜¯ä¸ºäº†è®©è¿™ç¯‡åšå®¢å°½å¯èƒ½åœ°é€šä¿—æ˜“æ‡‚ï¼Œæˆ‘ä¼šåœ¨è¿™é‡Œä½¿ç”¨å®ƒã€‚

æ‰‹æœºæ­£å˜å¾—è¶Šæ¥è¶Šå¿«ã€‚æˆ‘æƒ³ä¸ä¼šæœ‰äººä¸åŒæ„ã€‚æ›´å¼ºå¤§çš„ GPUï¼Œæ›´å¿«å¹¶ä¸”æ›´å¤šçš„ CPUï¼Œæ›´å¤šçš„ RAMã€‚æ‰‹æœºæ­£ç»å†ä¸ 2000 å¹´ä»£æ—©æœŸæ¡Œé¢è®¡ç®—æœºç»å†è¿‡çš„ä¸€æ ·çš„å¿«é€Ÿå‘å±•æ—¶æœŸã€‚

![å›¾ç‰‡å±•ç¤ºäº†ä» iPhone 4 åˆ° iPhone X çš„ä¸æ–­ä¸Šæ¶¨çš„ geekbench åˆ†æ•°](https://dassur.ma/iphone-scores-89f089e4.svg)

ä» [Geekbench](https://browser.geekbench.com/ios-benchmarks) è·å¾—çš„åŸºå‡†æµ‹è¯•åˆ†æ•°ï¼ˆå•æ ¸ï¼‰ã€‚

ç„¶è€Œï¼Œè¿™ä»…ä»…æ˜¯çœŸå®æƒ…å†µçš„å…¶ä¸­ä¸€ä¸ªéƒ¨åˆ†ã€‚**ä½é˜¶çš„æ‰‹æœºè¿˜ç•™åœ¨ 2014 å¹´ã€‚**ç”¨äºåˆ¶ä½œ 5 å¹´å‰çš„èŠ¯ç‰‡çš„æµç¨‹å·²ç»å˜å¾—éå¸¸ä¾¿å®œï¼Œä»¥è‡³äºæ‰‹æœºèƒ½å¤Ÿä»¥å¤§çº¦ 20 ç¾å…ƒçš„ä»·æ ¼å–å‡ºï¼ŒåŒæ—¶ä¾¿å®œçš„æ‰‹æœºèƒ½å¸å¼•æ›´å¹¿çš„äººç¾¤ã€‚å…¨ä¸–ç•Œå¤§çº¦æœ‰ 50% çš„äººèƒ½æ¥è§¦åˆ°ç½‘ç»œï¼ŒåŒæ—¶ä¹Ÿæ„å‘³ç€è¿˜æœ‰å¤§çº¦ 50% çš„äººæ²¡æœ‰ã€‚ç„¶è€Œï¼Œè¿™äº›è¿˜æ²¡ä¸Šç½‘çš„äººä¹Ÿ**æ­£åœ¨**å»ä¸Šç½‘çš„è·¯ä¸Šå¹¶ä¸”ä¸»è¦æ˜¯åœ¨æ–°å…´å¸‚åœºï¼Œé‚£é‡Œçš„äººä¹°ä¸èµ·[æœ‰é’±çš„è¥¿æ–¹ç½‘ç»œï¼ˆWealthy Western Webï¼‰](https://www.smashingmagazine.com/2017/03/world-wide-web-not-wealthy-western-web-part-1/)çš„æ——èˆ°æ‰‹æœºã€‚

åœ¨ Google I/O 2019 å¤§ä¼šæœŸé—´ï¼Œ[Elizabeth Sweeny](https://twitter.com/egsweeny) ä¸ [Barb Palser](https://twitter.com/barb_palser) åœ¨ä¸€ä¸ªåˆä½œä¼™ä¼´ä¼šè®®ä¸Šæ‹¿å‡ºäº† Nokia 2 å¹¶é¼“åŠ±åˆä½œä¼™ä¼´å»ä½¿ç”¨å®ƒä¸€ä¸ªæ˜ŸæœŸï¼Œå»**çœŸæ­£**æ„Ÿå—ä¸€ä¸‹è¿™ä¸ªä¸–ç•Œä¸Šå¾ˆå¤šäººæ—¥å¸¸æ˜¯åœ¨ç”¨ä»€ä¹ˆçº§åˆ«çš„è®¾å¤‡ã€‚Nokia 2 æ˜¯å¾ˆæœ‰æ„æ€çš„ï¼Œå› ä¸ºå®ƒçœ‹èµ·æ¥æœ‰ä¸€ç§é«˜ç«¯æ‰‹æœºçš„æ„Ÿè§‰ä½†æ˜¯åœ¨å¤–è¡¨ä¸‹é¢å®ƒæ›´åƒæ˜¯ä¸€å°æœ‰ç€ç°ä»£æµè§ˆå™¨å’Œæ“ä½œç³»ç»Ÿçš„ 5 å¹´å‰çš„æ™ºèƒ½æ‰‹æœº â€”â€” ä½ èƒ½æ„Ÿå—åˆ°è¿™ä»½ä¸åè°ƒã€‚

è®©äº‹æƒ…å˜å¾—æ›´åŠ æç«¯çš„æ˜¯ï¼ŒåŠŸèƒ½æ‰‹æœºæ­£åœ¨å›å½’ã€‚è®°å¾—å“ªäº›æ²¡æœ‰è§¦æ‘¸å±ï¼Œç›¸åæœ‰ç€æ•°å­—é”®å’Œåå­—é”®çš„æ‰‹æœºå—ï¼Ÿæ˜¯çš„ï¼Œå®ƒä»¬æ­£åœ¨å›å½’å¹¶ä¸”ç°åœ¨å®ƒä»¬è¿è¡Œç€ä¸€ä¸ªæµè§ˆå™¨ã€‚è¿™äº›æ‰‹æœºæœ‰ç€æ›´å¼±çš„ç¡¬ä»¶ï¼Œä¹Ÿè®¸æœ‰äº›å¥‡æ€ªï¼Œå´æœ‰ç€æ›´å¥½çš„æ€§èƒ½ã€‚éƒ¨åˆ†åŸå› æ˜¯å®ƒä»¬åªéœ€è¦æ§åˆ¶æ›´å°‘çš„åƒç´ ã€‚æˆ–è€…æ¢å¦ä¸€ç§è¯´æ³•ï¼Œå¯¹æ¯” Nodia 2ï¼Œå®ƒä»¬æœ‰æ›´é«˜çš„ CPU æ€§èƒ½ - åƒç´ æ¯”ã€‚

![ä¸€å¼ ä¿ç½—æ­£åœ¨ä½¿ç”¨ Nokia 8110 ç© PROXX çš„ç…§ç‰‡](https://dassur.ma/banana-5c71e1f7.jpg)

Nokia 8110ï¼Œæˆ–è€…è¯´â€œé¦™è•‰æ‰‹æœºâ€

è™½ç„¶æˆ‘ä»¬æ¯ä¸ªå‘¨æœŸéƒ½èƒ½æ‹¿åˆ°æ›´å¿«çš„æ——èˆ°æ‰‹æœºï¼Œä½†æ˜¯å¤§éƒ¨åˆ†äººè´Ÿæ‹…ä¸èµ·è¿™äº›æ‰‹æœºã€‚æ›´ä¾¿å®œçš„æ‰‹æœºè¿˜ç•™åœ¨è¿‡å»å¹¶æœ‰ç€é«˜åº¦æ³¢åŠ¨çš„æ€§èƒ½æŒ‡æ ‡ã€‚åœ¨æ¥ä¸‹æ¥çš„å‡ å¹´é‡Œï¼Œè¿™äº›ä½ç«¯æ‰‹æœºæ›´æœ‰å¯èƒ½è¢«å¤§é‡çš„äººæ°‘ç”¨æ¥ä¸Šç½‘ã€‚**æœ€å¿«çš„æ‰‹æœºä¸æœ€æ…¢çš„æ‰‹æœºä¹‹é—´çš„å·®è·æ­£åœ¨å˜å¤§ï¼Œä¸­ä½æ•°åœ¨å‡å°‘ã€‚**

![ä¸€ä¸ªå †å æŸ±çŠ¶å›¾å±•ç¤ºäº†ä½ç«¯æ‰‹æœºç”¨æˆ·å æ‰€æœ‰æ‰‹æœºç”¨æˆ·çš„æ¯”ä¾‹åœ¨ä¸æ–­å¢åŠ ã€‚](https://dassur.ma/demographic-4c15c204.svg)

æ‰‹æœºæ€§èƒ½çš„ä¸­ä½æ•°åœ¨é™ä½ï¼Œæ‰€æœ‰ä¸Šç½‘ç”¨æˆ·ä¸­ä½¿ç”¨ä½ç«¯æ‰‹æœºçš„æ¯”ä¾‹åˆ™åœ¨ä¸Šå‡ã€‚**è¿™ä¸æ˜¯ä¸€ä¸ªçœŸå®çš„æ•°æ®ï¼Œåªæ˜¯ä¸ºäº†ç›´è§‚å±•ç°ã€‚**æˆ‘æ˜¯æ ¹æ®è¥¿æ–¹ä¸–ç•Œå’Œæ–°å…´å¸‚åœºçš„äººå£å¢é•¿æ•°æ®ä»¥åŠå¯¹è°ä¼šæ‹¥æœ‰é«˜ç«¯æ‰‹æœºçš„çŒœæµ‹æ¨æ–­å‡ºæ¥çš„ã€‚

## JavaScript æ˜¯é˜»å¡çš„

ä¹Ÿè®¸æœ‰å¿…è¦è§£é‡Šæ¸…æ¥šï¼šé•¿æ—¶é—´è¿è¡Œçš„ JavaScript çš„ç¼ºç‚¹å°±æ˜¯å®ƒæ˜¯é˜»å¡çš„ã€‚å½“ JavaScript åœ¨è¿è¡Œæ—¶ï¼Œä¸èƒ½å»åšä»»ä½•å…¶ä»–äº‹æƒ…ã€‚**é™¤äº†è¿è¡Œä¸€ä¸ªç½‘é¡µåº”ç”¨çš„ JavaScript ä»¥å¤–ï¼Œä¸»çº¿ç¨‹è¿˜æœ‰åˆ«çš„æŒ‡è´£ã€‚**å®ƒä¹Ÿéœ€è¦æ¸²æŸ“é¡µé¢ï¼ŒåŠæ—¶å°†æ‰€æœ‰åƒç´ å±•ç¤ºåœ¨å±å¹•ä¸Šï¼Œå¹¶ä¸”ç›‘å¬è¯¸å¦‚ç‚¹å‡»æˆ–è€…æ»‘åŠ¨è¿™æ ·çš„ç”¨æˆ·äº¤äº’ã€‚åœ¨ JavaScript è¿è¡Œçš„æ—¶å€™è¿™äº›éƒ½ä¸èƒ½å‘ç”Ÿã€‚

æµè§ˆå™¨å·²ç»å¯¹æ­¤åšäº†ä¸€äº›ç¼“è§£æªæ–½ï¼Œä¾‹å¦‚åœ¨ç‰¹å®šæƒ…å†µä¸‹ä¼šæŠŠæ»šåŠ¨é€»è¾‘æ”¾åˆ°ä¸åŒçš„çº¿ç¨‹ã€‚ä¸è¿‡æ•´ä½“è€Œè¨€ï¼Œå¦‚æœä½ é˜»å¡äº†ä¸»çº¿ç¨‹ï¼Œé‚£ä¹ˆä½ çš„ç”¨æˆ·å°†ä¼šæœ‰**å¾ˆå·®**çš„ä½“éªŒã€‚ä»–ä»¬ä¼šæ„¤æ€’åœ°ç‚¹å‡»ä½ çš„æŒ‰é’®ï¼Œè¢«å¡é¡¿çš„åŠ¨ç”»ä¸æ»šåŠ¨æ‰€æŠ˜ç£¨ã€‚

## äººç±»çš„æ„ŸçŸ¥

å¤šå°‘çš„é˜»å¡æ‰ç®—è¿‡å¤šçš„é˜»å¡ï¼Ÿ[RAIL](https://developers.google.com/web/fundamentals/performance/rail) é€šè¿‡ç»™ä¸åŒçš„ä»»åŠ¡æä¾›åŸºäºäººç±»æ„ŸçŸ¥çš„æ—¶é—´é¢„ç®—æ¥å°è¯•å›ç­”è¿™ä¸ªé—®é¢˜ã€‚æ¯”å¦‚è¯´ï¼Œä¸ºäº†è®©äººçœ¼æ„Ÿåˆ°åŠ¨ç”»æµç•…ï¼Œåœ¨ä¸‹ä¸€å¸§è¢«æ¸²æŸ“ä¹‹å‰ä½ è¦æœ‰å¤§çº¦ 16 æ¯«ç§’çš„é—´éš”ã€‚**è¿™äº›æ•°å­—æ˜¯å›ºå®šçš„**ï¼Œå› ä¸ºäººç±»å¿ƒç†å­¦ä¸ä¼šå› ä¸ºä½ æ‰€æ‹¿ç€çš„è®¾å¤‡è€Œæ”¹å˜ã€‚

çœ‹ä¸€ä¸‹æ—¥è¶‹æ‰©å¤§çš„æ€§èƒ½å·®è·ã€‚ä½ å¯ä»¥æ„å»ºä½ çš„ appï¼Œåšä½ çš„å°½èŒè°ƒæŸ¥ä»¥åŠæ€§èƒ½åˆ†æï¼Œè§£å†³æ‰€æœ‰çš„ç“¶é¢ˆå¹¶è¾¾æˆæ‰€æœ‰ç›®æ ‡ã€‚**ä½†æ˜¯é™¤éä½ æ˜¯åœ¨æœ€ä½ç«¯çš„æ‰‹æœºä¸Šå¼€å‘ï¼Œä¸ç„¶æ˜¯æ— æ³•é¢„æµ‹ä¸€æ®µä»£ç åœ¨å¦‚ä»Šæœ€ä½ç«¯æ‰‹æœºä¸Šè¦è¿è¡Œå¤šä¹…ï¼Œæ›´ä¸è¦è¯´æœªæ¥çš„æœ€ä½ç«¯æ‰‹æœºã€‚**

è¿™å°±æ˜¯ç”±ä¸ä¸€æ ·çš„æ°´å¹³å¸¦ç»™ web çš„è´Ÿæ‹…ã€‚ä½ æ— æ³•é¢„æµ‹ä½ çš„ app å°†ä¼šè¿è¡Œåœ¨ä»€ä¹ˆçº§åˆ«çš„è®¾å¤‡ä¸Šã€‚ä½ å¯ä»¥è¯´â€œSuraï¼Œè¿™äº›æ€§èƒ½ä½ä¸‹çš„æ‰‹æœºä¸æˆ‘/æˆ‘çš„ç”Ÿæ„æ— å…³ï¼â€ï¼Œä½†å¯¹æˆ‘æ¥è®²ï¼Œè¿™å¦‚åŒâ€œé‚£äº›ä¾èµ–å±å¹•é˜…è¯»å™¨çš„äººä¸æˆ‘/æˆ‘çš„ç”Ÿæ„æ— å…³ï¼â€ä¸€æ ·çš„æ¶å¿ƒã€‚**è¿™æ˜¯ä¸€ä¸ªåŒ…å®¹æ€§çš„é—®é¢˜ã€‚æˆ‘å»ºè®®ä½  ä»”ç»†æƒ³æƒ³ï¼Œæ˜¯å¦æ­£åœ¨é€šè¿‡ä¸æ”¯æŒä½ç«¯æ‰‹æœºæ¥æ’é™¤æ‰æŸäº›äººç¾¤ã€‚**æˆ‘ä»¬åº”è¯¥åŠªåŠ›ä½¿æ¯ä¸€ä¸ªäººéƒ½èƒ½è·å–åˆ°è¿™ä¸ªä¸–ç•Œçš„ä¿¡æ¯ï¼Œè€Œä¸ç®¡å–œä¸å–œæ¬¢ï¼Œä½ çš„ app æ­£æ˜¯å…¶ä¸­çš„ä¸€éƒ¨åˆ†ã€‚

è¯è™½å¦‚æ­¤ï¼Œç”±äºæ¶‰åŠåˆ°å¾ˆå¤šæœ¯è¯­å’ŒèƒŒæ™¯çŸ¥è¯†ï¼Œæœ¬åšå®¢æ— æ³•ç»™æ‰€æœ‰äººæä¾›æŒ‡å¯¼ã€‚ä¸Šé¢çš„é‚£äº›æ®µè½ä¹Ÿä¸€æ ·ã€‚æˆ‘ä¸ä¼šå‡è£…æ— éšœç¢è®¿é—®æˆ–è€…ç»™ä½ç«¯æ‰‹æœºç¼–ç¨‹æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹ï¼Œä½†æˆ‘ç›¸ä¿¡ä½œä¸ºä¸€ä¸ªå·¥å…·ç¤¾åŒºå’Œæ¡†æ¶ä½œè€…è¿˜æ˜¯æœ‰å¾ˆå¤šäº‹æƒ…å¯ä»¥å»åšï¼Œå»ä»¥æ­£ç¡®çš„æ–¹å¼å¸®åŠ©äººä»¬ï¼Œè®©ä»–ä»¬çš„æˆæœé»˜è®¤å°±æ›´å…·æ— éšœç¢æ€§å¹¶ä¸”æ€§èƒ½æ›´å¥½ï¼Œé»˜è®¤å°±æ›´åŠ åŒ…å®¹ã€‚

## è§£å†³å®ƒ

å¥½äº†ï¼Œå°è¯•ä»æ²™å­å¼€å§‹å»ºé€ åŸå ¡ã€‚å°è¯•å»åˆ¶ä½œé‚£äº›èƒ½åœ¨å„ç§å„æ ·çš„ï¼Œä½ éƒ½æ— æ³•é¢„æµ‹ä¸€æ®µåœ¨ä»£ç åœ¨ä¸Šé¢éœ€è¦è¿è¡Œå¤šä¹…çš„è®¾å¤‡ä¸Šéƒ½èƒ½ä¿æŒç¬¦åˆ RAIL æ¨¡å‹æ€§èƒ½è¯„ä¼°çš„æ—¶é—´é¢„ç®—çš„ appã€‚

### å…±åŒåˆä½œ

ä¸€ä¸ªè§£å†³é˜»å¡çš„æ–¹å¼æ˜¯â€œåˆ†å‰²ä½ çš„ JavaScriptâ€æˆ–è€…è¯´æ˜¯â€œè®©æ¸¡ç»™æµè§ˆå™¨â€ã€‚æ„æ€æ˜¯é€šè¿‡åœ¨ä»£ç æ·»åŠ ä¸€äº›å›ºå®šæ—¶é—´é—´éš”çš„**æ–­ç‚¹**æ¥ç»™æµè§ˆå™¨ä¸€ä¸ªæš‚åœè¿è¡Œä½ çš„ JavaScript çš„æœºä¼šç„¶åå»æ¸²æŸ“ä¸‹ä¸€å¸§æˆ–è€…å¤„ç†ä¸€ä¸ªè¾“å…¥äº‹ä»¶ã€‚ä¸€æ—¦æµè§ˆå™¨å®Œæˆè¿™äº›å·¥ä½œï¼Œå®ƒå°±ä¼šå›å»æ‰§è¡Œä½ çš„ä»£ç ã€‚è¿™ç§åœ¨ web åº”ç”¨ä¸Šè®©æ¸¡ç»™æµè§ˆå™¨çš„æ–¹å¼å°±æ˜¯å®‰æ’ä¸€ä¸ªå®ä»»åŠ¡ï¼Œè€Œè¿™å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®ç°ã€‚

> **å¿…è¦çš„é˜…è¯»ï¼š** å¦‚æœä½ å¯¹å®ä»»åŠ¡æˆ–è€…å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡çš„åŒºåˆ«ï¼Œæˆ‘æ¨èä½ å»é˜…è¯» [Jake Archibald](https://twitter.com/jaffathecake) çš„[è°ˆè°ˆäº‹ä»¶å¾ªç¯](https://www.youtube.com/watch?v=cCOL7MC4Pl0)ã€‚

åœ¨ PROXYï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª `MessageChannel` å¹¶ä¸”ä½¿ç”¨ `postMessage()` å»å®‰æ’ä¸€ä¸ªå®ä»»åŠ¡ã€‚ä¸ºäº†åœ¨æ·»åŠ æ–­ç‚¹ä¹‹åä»£ç ä»èƒ½ä¿æŒå¯è¯»æ€§ï¼Œæˆ‘å¼ºçƒˆæ¨èä½¿ç”¨ `async/await`ã€‚åœ¨ [PROXX](https://proxx.app) ä¸Šï¼Œç”¨æˆ·åœ¨ä¸»ç•Œé¢ä¸æ¸¸æˆäº¤äº’çš„åŒæ—¶ï¼Œæˆ‘ä»¬åœ¨åå°ç”Ÿæˆç²¾çµã€‚

```js
const { port1, port2 } = new MessageChannel();
port2.start();

export function task() {
  return new Promise(resolve => {
    const uid = Math.random();
    port2.addEventListener("message", function f(ev) {
      if (ev.data !== uid) {
        return;
      }
      port2.removeEventListener("message", f);
      resolve();
    });
    port1.postMessage(uid);
  });
}

export async function generateTextures() {
  // ...
  for (let frame = 0; frame < numSprites; frame++) {
    drawTexture(frame, ctx);
    await task(); // æ–­ç‚¹
  }
  // ...
}
```

ä½†æ˜¯**åˆ†å‰²ä¾æ—§å—åˆ°æ—¥è¶‹æ‰©å¤§çš„æ€§èƒ½å·®è·çš„å½±å“ï¼š**ä¸€æ®µä»£ç è¿è¡Œåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹çš„æ—¶é—´æ˜¯å–å†³äºè®¾å¤‡çš„ã€‚åœ¨ä¸€å°ä½ç«¯æ‰‹æœºä¸Šè€—æ—¶å°äº 16 æ¯«ç§’ï¼Œä½†åœ¨å¦ä¸€å°ä½ç«¯æ‰‹æœºä¸Šä¹Ÿè®¸å°±ä¼šè€—è´¹æ›´å¤šæ—¶é—´ã€‚

## ç§»å‡ºä¸»çº¿ç¨‹

æˆ‘ä¹‹å‰è¯´è¿‡ï¼Œä¸»çº¿ç¨‹é™¤äº†æ‰§è¡Œç½‘é¡µåº”ç”¨çš„ JavaScript ä»¥å¤–ï¼Œè¿˜æœ‰åˆ«çš„ä¸€äº›èŒè´£ã€‚è€Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ä¸æƒœä»£ä»·é¿å…é•¿çš„ï¼Œé˜»å¡çš„ JavaScript åœ¨ä¸»çº¿ç¨‹ã€‚ä½†å‡å¦‚è¯´æˆ‘ä»¬æŠŠå¤§éƒ¨åˆ†çš„ JavaScript ç§»åŠ¨åˆ°ä¸€æ¡**ä¸“é—¨**ç”¨æ¥è¿è¡Œæˆ‘ä»¬çš„ JavaScriptï¼Œé™¤æ­¤ä¹‹å¤–ä¸åšåˆ«çš„äº‹æƒ…çš„çº¿ç¨‹ä¸­å‘¢ã€‚ä¸€æ¡æ²¡æœ‰å…¶ä»–èŒè´£çš„çº¿ç¨‹ã€‚åœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‹…å¿ƒæˆ‘ä»¬çš„ä»£ç å—åˆ°æ—¥è¶‹æ‰©å¤§çš„æ€§èƒ½å·®è·çš„å½±å“ï¼Œå› ä¸ºä¸»çº¿ç¨‹ä¸ä¼šæ”¶åˆ°å½±å“ï¼Œä¾ç„¶èƒ½å¤„ç†ç”¨æˆ·è¾“å…¥å¹¶ä¿æŒå¸§ç‡ç¨³å®šã€‚

### Web Workers æ˜¯ä»€ä¹ˆï¼Ÿ

**[Web Workers](https://developer.mozilla.org/en-US/docs/Web/API/Worker)ï¼Œä¹Ÿè¢«å«åš â€œDedicated Workersâ€ï¼Œæ˜¯ JavaScript åœ¨çº¿ç¨‹æ–¹é¢çš„å°è¯•ã€‚**JavaScript å¼•æ“åœ¨è®¾è®¡æ—¶å°±å‡è®¾åªæœ‰ä¸€æ¡çº¿ç¨‹ï¼Œå› æ­¤æ—¶æ²¡æœ‰å¹¶å‘è®¿é—®çš„ JavaScript å¯¹è±¡å†…å­˜ï¼Œè€Œè¿™ç¬¦åˆæ‰€æœ‰åŒæ­¥æœºåˆ¶çš„éœ€æ±‚ã€‚å¦‚æœä¸€æ¡å…·æœ‰å…±äº«å†…å­˜æ¨¡å‹çš„æ™®é€šçº¿ç¨‹è¢«æ·»åŠ åˆ° JavaScriptï¼Œé‚£ä¹ˆå°‘è¯´ä¹Ÿæ˜¯ä¸€åœºç¾éš¾ã€‚ç›¸åï¼Œæˆ‘ä»¬æœ‰äº† [Web Workers](https://developer.mozilla.org/en-US/docs/Web/API/Worker)ï¼Œå®ƒåŸºæœ¬ä¸Šå°±æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨å¦ä¸€æ¡ç‹¬ç«‹çº¿ç¨‹ä¸Šçš„å®Œæ•´çš„ JavaScript ä½œç”¨åŸŸï¼Œæ²¡æœ‰ä»»ä½•çš„å…±äº«å†…å­˜æˆ–è€…å…±äº«å€¼ã€‚ä¸ºäº†ä½¿è¿™äº›å®Œå…¨åˆ†ç¦»å¹¶ä¸”å­¤ç«‹çš„ JavaScript ä½œç”¨åŸŸèƒ½å…±åŒå·¥ä½œï¼Œä½ å¯ä»¥ä½¿ç”¨ [`postMessage()`](https://developer.mozilla.org/en-US/docs/Web/API/Worker/postMessage)ï¼Œå®ƒä½¿ä½ èƒ½å¤Ÿåœ¨**å¦ä¸€ä¸ª** JavaScript ä½œç”¨åŸŸå†…è§¦å‘ä¸€ä¸ª `message` äº‹ä»¶å¹¶å¸¦æœ‰ä¸€ä¸ªä½ æä¾›çš„å€¼çš„æ‹·è´ï¼ˆä½¿ç”¨[ç»“æ„åŒ–å…‹éš†ç®—æ³•](https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm) æ¥æ‹·è´ï¼‰ã€‚

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œé™¤äº†ä¸€äº›é€šå¸¸æ¶‰åŠé•¿æ—¶é—´è¿è¡Œçš„è®¡ç®—å¯†é›†ä»»åŠ¡çš„â€œé“¶å¼¹â€ç”¨ä¾‹ä»¥å¤– workers åŸºæœ¬æ²¡å¾—åˆ°é‡‡ç”¨ã€‚æˆ‘æƒ³è¿™åº”è¯¥è¢«æ”¹å˜ã€‚**æˆ‘ä»¬åº”è¯¥å¼€å§‹ä½¿ç”¨ workersã€‚ç»å¸¸ä½¿ç”¨ã€‚**

### æ‰€æœ‰é…·å°å­©éƒ½åœ¨è¿™ä¹ˆåš

è¿™ä¸æ˜¯ä¸€ä¸ªæ–°çš„æƒ³æ³•ï¼Œå®é™…ä¸Šè¿˜æŒºè€çš„ã€‚**å¤§éƒ¨åˆ†åŸç”Ÿå¹³å°éƒ½æŠŠä¸»çº¿ç¨‹ç§°ä¸º UI çº¿ç¨‹ï¼Œå› ä¸ºå®ƒåº”è¯¥åªä¼šè¢«ç”¨æ¥å¤„ç† UI å·¥ä½œ**ï¼Œå¹¶ä¸”å®ƒä»¬ç»™ä½ æä¾›äº†å·¥å…·å»å®ç°ã€‚å®‰å“ä»å¾ˆæ—©çš„ç‰ˆæœ¬å¼€å§‹å°±æœ‰ä¸€ä¸ªå« [`AsyncTask`](https://developer.android.com/reference/android/os/AsyncTask) çš„ä¸œè¥¿ï¼Œå¹¶ä»é‚£å¼€å§‹æ·»åŠ äº†æ›´å¤šæ›´æ–¹ä¾¿çš„ APIï¼ˆæœ€è¿‘çš„æ˜¯ [Coroutines](https://kotlinlang.org/docs/reference/coroutines/basics.html) å®ƒå¯ä»¥å¾ˆå®¹æ˜“åœ°è¢«æ´¾å‘åœ¨ä¸åŒçº¿ç¨‹ï¼‰ã€‚å¦‚æœä½ é€‰ç”¨äº†[â€œä¸¥æ ¼æ¨¡å¼â€](https://developer.android.com/reference/android/os/StrictMode)ï¼Œé‚£ä¹ˆåœ¨ UI çº¿ç¨‹ä¸Šä½¿ç”¨æŸäº› API â€”â€” ä¾‹å¦‚æ–‡ä»¶æ“ä½œ â€”â€” ä¼šå¯¼è‡´ä½ çš„åº”ç”¨å¥”æºƒï¼Œä»¥æ­¤æ¥æé†’ä½ åœ¨ UI çº¿ç¨‹ä¸Šåšäº†ä¸€äº›ä¸ UI æ— å…³çš„æ“ä½œã€‚

ä»ä¸€å¼€å§‹ iOS å°±æœ‰ä¸€ä¸ªå« [Grand Central Dispatch](https://developer.apple.com/documentation/dispatch) (â€œGCDâ€)çš„ä¸œè¥¿ï¼Œç”¨æ¥åœ¨ä¸åŒçš„ç³»ç»Ÿæä¾›çš„çº¿ç¨‹æ± ä¸Šæ´¾å‘ä»»åŠ¡ï¼Œå…¶ä¸­åŒ…æ‹¬ UI çº¿ç¨‹ã€‚é€šè¿‡è¿™æ–¹å¼ä»–ä»¬å¼ºåˆ¶äº†ä¸¤ä¸ªæ¨¡å¼ï¼šä½ æ€»æ˜¯è¦å°†ä½ çš„é€»è¾‘åˆ†å‰²æˆè‹¥å¹²ä»»åŠ¡ï¼Œç„¶åæ‰èƒ½è¢«æ”¾åˆ°é˜Ÿåˆ—ä¸­ï¼Œå…è®¸ UI çº¿ç¨‹åœ¨éœ€è¦çš„æ—¶å€™å°†å…¶æ”¾å…¥å¯¹åº”çš„çº¿ç¨‹ï¼Œä½†åŒæ—¶ä¹Ÿå…è®¸ä½ é€šè¿‡ç®€å•åœ°å°†ä»»åŠ¡æ”¾åˆ°ä¸åŒçš„é˜Ÿåˆ—æ¥åœ¨ä¸åŒçš„çº¿ç¨‹æ‰§è¡Œé UI ç›¸å…³çš„å·¥ä½œã€‚é”¦ä¸Šæ·»èŠ±çš„æ˜¯è¿˜å¯ä»¥ç»™ä»»åŠ¡æŒ‡å®šä¼˜å…ˆçº§ï¼Œè¿™æ ·å¸®åŠ©æˆ‘ä»¬ç¡®ä¿æ—¶é—´æ•æ„Ÿçš„å·¥ä½œèƒ½å°½å¿«è¢«å®Œæˆï¼Œå¹¶ä¸”ä¸ä¼šç‰ºç‰²ç³»ç»Ÿæ•´ä½“çš„å“åº”ã€‚

æˆ‘çš„è§‚ç‚¹æ˜¯è¿™äº›åŸç”Ÿå¹³å°ä»ä¸€å¼€å§‹å°±å·²ç»æ”¯æŒä½¿ç”¨é UI çº¿ç¨‹ã€‚æˆ‘è§‰å¾—å¯ä»¥å…¬æ­£åœ°è¯´ï¼Œç»è¿‡è¿™ä¹ˆå¤šæ—¶é—´ï¼Œä»–ä»¬å·²ç»è¯æ˜æ¥è¿™æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚å°†åœ¨ UI çº¿ç¨‹çš„å·¥ä½œé‡é™åˆ°æœ€ä½æœ‰åŠ©äºè®©ä½ çš„ app ä¿æŒå“åº”çµæ•ã€‚ä¸ºä»€ä¹ˆä¸æŠŠè¿™æ ·çš„æ¨¡å¼ç”¨åœ¨ web ä¸Šå‘¢ï¼Ÿ

## å¼€å‘ä½“éªŒæ˜¯ä¸€ä¸ªéšœç¢

æˆ‘ä»¬åªèƒ½é€šè¿‡ Web Worker è¿™ä¹ˆä¸€ä¸ªç®€é™‹çš„å·¥å…·åœ¨ web ä¸Šä½¿ç”¨çº¿ç¨‹ã€‚å½“ä½ å¼€å§‹ä½¿ç”¨ Workers ä»¥åŠä»–ä»¬æä¾›çš„ API æ—¶ï¼Œ`message` äº‹ä»¶å¤„ç†å™¨å°±æ˜¯å…¶ä¸­çš„æ ¸å¿ƒã€‚è¿™æ„Ÿè§‰å¹¶ä¸å¥½ã€‚æ­¤å¤–ï¼ŒWorkers **åƒ**çº¿ç¨‹ï¼Œä½†åˆè·Ÿçº¿ç¨‹ä¸å®Œå…¨ä¸€æ ·ã€‚ä½ æ— æ³•è®©å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå˜é‡ï¼ˆä¾‹å¦‚ä¸€ä¸ªé™æ€å¯¹è±¡ï¼‰ï¼Œæ‰€æœ‰çš„ä¸œè¥¿éƒ½è¦é€šè¿‡æ¶ˆæ¯ä¼ é€’ï¼Œè¿™äº›æ¶ˆæ¯èƒ½æºå¸¦å¾ˆå¤šä½†ä¸æ˜¯å…¨éƒ¨ JavaScript å€¼ã€‚ä¾‹å¦‚ä½ ä¸èƒ½å‘é€ä¸€ä¸ª `Event` æˆ–è€…æ²¡æœ‰æ•°æ®æŸå¤±çš„å¯¹è±¡å®ä¾‹ã€‚æˆ‘æƒ³ï¼Œå¯¹äºå¼€å‘è€…æ¥è¯´è¿™æ˜¯æœ€å¤§çš„é˜»ç¢ã€‚

### Comlink

å› ä¸ºè¿™æ ·çš„åŸå› ï¼Œæˆ‘ç¼–å†™äº† [Comlink](https://github.com/GoogleChromeLabs/comlink) å®ƒä¸ä»…å¸®ä½ éšè—æ‰ `postMessage()`ï¼Œç”šè‡³èƒ½è®©ä½ å¿˜è®°æ­£åœ¨ä½¿ç”¨ Workersã€‚**æ„Ÿè§‰**å°±åƒæ˜¯ä½ èƒ½å¤Ÿè®¿é—®åˆ°æ¥è‡ªåˆ«çš„çº¿ç¨‹çš„å…±äº«å˜é‡ï¼š

```js
// main.js
import * as Comlink from "https://unpkg.com/comlink?module";

const worker = new Worker("worker.js");
// è¿™ä¸ª `state` å˜é‡å…¶å®æ˜¯åœ¨åˆ«çš„ worker ä¸­ï¼
const state = await Comlink.wrap(worker);
await state.inc();
console.log(await state.currentCount);
```

```js
// worker.js
import * as Comlink from "https://unpkg.com/comlink?module";

const state = {
  currentCount: 0,

  inc() {
    this.currentCount++;
  }
}

Comlink.expose(state);
```

> **è¯´æ˜ï¼š**æˆ‘ç”¨äº†é¡¶å±‚ await ä»¥åŠæ¨¡å— workerï¼ˆmodules-in-workersï¼‰æ¥è®©ä¾‹å­å˜çŸ­ã€‚è¯·åˆ° [Comlink çš„ä»£ç ä»“åº“](https://github.com/GoogleChromeLabs/comlink)æŸ¥çœ‹çœŸå®çš„ä¾‹å­ä»¥åŠæ›´å¤šç»†èŠ‚ã€‚

åœ¨è¿™é—®é¢˜ä¸Š Comlink ä¸æ˜¯å”¯ä¸€çš„è§£å†³æ–¹æ¡ˆï¼Œåªæ˜¯æˆ‘æœ€ç†Ÿæ‚‰å®ƒï¼ˆå¾ˆæ­£å¸¸ï¼Œè€ƒè™‘åˆ°æ˜¯æˆ‘å†™çš„  ğŸ™„ï¼‰ã€‚å¦‚æœä½ å¯¹å…¶ä»–æ–¹æ³•æ„Ÿå…´è¶£ï¼Œçœ‹ä¸€ä¸‹ [Andrea Giammarchi](https://twitter.com/webreflection) çš„ [workway](https://github.com/WebReflection/workway) æˆ–è€… [Jason Miller](https://twitter.com/_developit) çš„ [workerize](https://github.com/developit/workerize)ã€‚

æˆ‘ä¸åœ¨æ„ä½ ç”¨å“ªä¸ªåº“ï¼Œåªè¦ä½ æœ€ç»ˆè½¬æ¢åˆ°â€œç¦»å¼€ä¸»çº¿ç¨‹â€æ¶æ„ã€‚æˆ‘ä»¬åœ¨ [PROXX](https://proxx.app) å’Œ [Squoosh](https://squoosh.app) ä¸ŠæˆåŠŸä½¿ç”¨äº† Comlinkï¼Œå› ä¸ºå®ƒå¾ˆå°(gzip å 1.2KiB)å¹¶ä¸”è®©æˆ‘ä»¬ä¸éœ€è¦åœ¨å¼€å‘ä¸Šæ”¹åŠ¨å¤ªå¤šå°±èƒ½ä½¿ç”¨å¾ˆå¤šæ¥è‡ªå…¶ä»–æœ‰â€œçœŸæ­£â€çº¿ç¨‹çš„è¯­è¨€çš„å¸¸ç”¨æ¨¡å¼ã€‚

### å‚ä¸è€…

æœ€è¿‘æˆ‘å’Œ [Paul Lewis](https://twitter.com/aerotwist) ä¸€èµ·è¯„ä¼°è¿‡å…¶ä»–çš„æ–¹æ³•ã€‚é™¤äº†è¯´éšè—ä½ æ­£åœ¨ä½¿ç”¨ Worker çš„äº‹å®ä»¥åŠ `postMessage`ï¼Œæˆ‘ä»¬è¿˜ä» 70 å¹´ä»£å’Œä½¿ç”¨è¿‡çš„[å‚ä¸è€…æ¨¡å¼](https://dassur.ma/things/actormodel/)ä¸­å¾—åˆ°çµæ„Ÿï¼Œè¿™ç§æ¶æ„æ¨¡å¼å°†æ¶ˆæ¯ä¼ é€’å½“ä½œåŸºæœ¬çš„ç§¯æœ¨ã€‚ç»è¿‡é‚£æ¬¡æ€æƒ³å®éªŒï¼Œæˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ª[æ”¯æ’‘å‚ä¸è€…æ¨¡å¼çš„åº“](https://github.com/PolymerLabs/actor-helpers)ï¼Œä¸€ä¸ª[å…¥é—¨å¥—ä»¶](https://github.com/PolymerLabs/actor-boilerplate)ï¼Œå¹¶åœ¨ 2018 Chrome å¼€å‘è€…å³°ä¼šä¸Šåšäº†[ä¸€æ¬¡æ¼”è®²](https://www.youtube.com/watch?v=Vg60lf92EkM)ï¼Œä»‹ç»äº†è¿™ä¸ªæ¶æ„ä»¥åŠå®ƒçš„åº”ç”¨ã€‚

## â€œåŸºå‡†æµ‹è¯•â€

ä½ ä¹Ÿè®¸ä¼šæƒ³ï¼š**æ˜¯ä¸æ˜¯å€¼å¾—å»ä½¿ç”¨â€œç¦»å¼€ä¸»çº¿ç¨‹â€æ¶æ„ï¼Ÿ**è®©æˆ‘ä»¬æ¥åšä¸€ä¸ªæŠ•å…¥/äº§å‡ºåˆ†æï¼šæœ‰äº† [Comlink](https://github.com/GoogleChromeLabs/comlink) è¿™æ ·çš„åº“ï¼Œåˆ‡æ¢åˆ°â€œç¦»å¼€ä¸»çº¿ç¨‹â€æ¶æ„çš„ä»£ä»·åº”è¯¥ä¼šæ¯”ä»¥å‰æœ‰æ˜¾è‘—çš„é™ä½ï¼Œéå¸¸æ¥è¿‘äºé›¶ã€‚é‚£ä¹ˆå¥½å¤„å‘¢ï¼Ÿ

[Dion Almaer](https://twitter.com/dalmaer) å«è¿‡æˆ‘å»ç»™ [PROXX](https://proxx.app) å†™ä¸€ä¸ªå®Œå…¨è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸Šçš„ç‰ˆæœ¬ï¼Œè¿™ä¹Ÿè®¸èƒ½è§£ç­”é‚£ä¸ªé—®é¢˜ã€‚å› æ­¤[æˆ‘å°±è¿™ä¹ˆåšäº†](https://github.com/GoogleChromeLabs/proxx/pull/437)ã€‚åœ¨ Pixel 3 æˆ–è€… MacBook ä¸Šä»…ä»…æœ‰ä¸€ç‚¹å¯æ„ŸçŸ¥çš„å·®åˆ«ã€‚ä½†æ˜¯åœ¨ Nokia 2 ä¸Šåˆ™æœ‰äº†æ˜æ˜¾ä¸åŒã€‚**å¦‚æœæŠŠæ‰€æœ‰ä¸œè¥¿éƒ½è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸Šï¼Œåœ¨æœ€å·®çš„æƒ…å½¢ä¸‹åº”ç”¨å¡ä½äº†é«˜è¾¾ 6.6 ç§’ã€‚**å¹¶ä¸”è¿˜æœ‰å¾ˆå¤šæ­£åœ¨æµé€šçš„è®¾å¤‡çš„æ€§èƒ½æ¯” Nokia 2 è¿˜è¦ä½ï¼è€Œè¿è¡Œä½¿ç”¨äº†â€œç¦»å¼€ä¸»çº¿ç¨‹â€æ¶æ„çš„ PROXX ç‰ˆæœ¬ï¼Œæ‰§è¡Œä¸€ä¸ª `tap` äº‹ä»¶å¤„ç†å‡½æ•°ä»…ä»…è€—æ—¶ 48 æ¯«ç§’ï¼Œå› ä¸ºæ‰€åšçš„ä»…ä»…æ˜¯é€šè¿‡è°ƒç”¨ `postMessage()` å‘äº†ä¸€æ¡æ¶ˆæ¯åˆ° Worker ä¸­ã€‚è¿™ä»£è¡¨ç€ï¼Œç‰¹åˆ«æ˜¯è€ƒè™‘åˆ°æ—¥è¶‹æ‰©å¤§çš„æ€§èƒ½å·®è·ï¼Œ**â€œç¦»å¼€ä¸»çº¿ç¨‹â€æ¶æ„èƒ½å¤Ÿæé«˜å¤„ç†æ„æƒ³ä¸åˆ°çš„å¤§ä¸”é•¿çš„ä»»åŠ¡çš„éŸ§æ€§**ã€‚

![ä¸€ä¸ªé‡‡ç”¨â€œç¦»å¼€ä¸»çº¿ç¨‹â€æ¶æ„çš„ PROXX çš„è¿è¡Œè·Ÿè¸ª](https://dassur.ma/trace-omt-bb7bc9f7.png)

PROXX çš„äº‹ä»¶å¤„ç†å™¨æ˜¯éå¸¸ç®€æ´çš„å¹¶ä¸”åªä¼šè¢«ç”¨æ¥ç»™æŒ‡å®šçš„ worker å‘é€æ¶ˆæ¯ã€‚æ€»è€Œè¨€ä¹‹è¿™ä¸ªä»»åŠ¡è€—æ—¶ 48 æ¯«ç§’ã€‚

![ä¸€ä¸ªé‡‡ç”¨æ‰€æœ‰éƒ½è¿è¡Œåœ¨ä¸»çº¿ç¨‹çš„ PROXX çš„è¿è¡Œè·Ÿè¸ª](https://dassur.ma/trace-nonomt-0d7f2457.png)

åœ¨ä¸€ä¸ªæ‰€æœ‰ä¸œè¥¿éƒ½è¿è¡Œåœ¨ä¸»çº¿ç¨‹çš„ PROXX ç‰ˆæœ¬ï¼Œæ‰§è¡Œä¸€ä¸ªäº‹ä»¶å¤„ç†å™¨éœ€è¦è€—æ—¶è¶…è¿‡ 6 ç§’ã€‚

æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»»åŠ¡å¹¶æ²¡æœ‰æ¶ˆå¤±ã€‚å³ä½¿ä½¿ç”¨äº†â€œç¦»å¼€ä¸»çº¿ç¨‹â€æ¶æ„ï¼Œä»£ç ä»éœ€è¦è¿è¡Œå¤§çº¦ 6 ç§’çš„äº‹ä»¶ï¼ˆåœ¨ PROXX è¿™å®é™…ä¸Šä¼šæ›´åŠ é•¿ï¼‰ã€‚ç„¶è€Œç”±äºè¿™äº›å·¥ä½œæ˜¯åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸Šè¿›è¡Œçš„ï¼ŒUI çº¿ç¨‹ä»ç„¶èƒ½ä¿æŒå“åº”ã€‚æˆ‘ä»¬çš„ worker ä¹Ÿä¼šæŠŠä¸­é—´ç»“æœä¼ å›ä¸»çº¿ç¨‹ã€‚**é€šè¿‡ä¿æŒäº‹ä»¶å¤„ç†å™¨çš„ç®€æ´ï¼Œæˆ‘ä»¬ä¿è¯äº† UI çº¿ç¨‹èƒ½ä¿æŒå“åº”å¹¶èƒ½æ›´æ–°è§†è§‰çŠ¶æ€ã€‚**

## æ¡†æ¶çš„çª˜å›°

ç°åœ¨è¯´ä¸€ä¸‹æˆ‘ä¸€ä¸ªè„±å£è€Œå‡ºçš„æ„è§ï¼š**æˆ‘ä»¬ç°æœ‰çš„æ¡†æ¶è®©â€œç¦»å¼€ä¸»çº¿ç¨‹â€æ¶æ„å˜å¾—å›°éš¾å¹¶å‡å°‘äº†å®ƒçš„å›å½’ã€‚** UI æ¡†æ¶åº”è¯¥å»åš UI çš„å·¥ä½œï¼Œä¹Ÿå› æ­¤æœ‰æƒå»è¿è¡Œåœ¨ UI çº¿ç¨‹ã€‚ç„¶è€Œå®é™…ä¸Šï¼Œå®ƒä»¬æ‰€åšçš„å·¥ä½œæ˜¯ UI å·¥ä½œä»¥åŠå…¶ä»–ä¸€äº›ç›¸å…³ä½†æ˜¯é UI çš„å·¥ä½œã€‚

è®©æˆ‘ä»¬æ‹¿ VDOM diff åšä¾‹å­ï¼šè™šæ‹Ÿ DOM çš„ç›®çš„å°†å¼€å‘è€…çš„ä»£ç ä¸çœŸå® DOM çš„æ›´æ–°è§£è€¦ã€‚è™šæ‹Ÿ DOM ä»…ä»…æ˜¯ä¸€ä¸ªæ¨¡æ‹ŸçœŸå® DOM çš„æ•°æ®ç»“æ„ï¼Œè¿™æ ·å®ƒçš„æ”¹å˜å°±ä¸ä¼šå¼•èµ·é«˜æ¶ˆè€—çš„å‰¯ä½œç”¨ã€‚åªæœ‰å½“æ¡†æ¶è®¤ä¸ºæ—¶æœºåˆé€‚çš„æ—¶å€™ï¼Œè™šæ‹Ÿ DOM çš„æ”¹å˜æ‰ä¼šå¼•èµ·çœŸå® DOM çš„æ›´æ–°ã€‚è¿™é€šå¸¸è¢«ç§°ä¸ºâ€œå†²æ´—ï¼ˆflushingï¼‰â€ã€‚ç›´åˆ°å†²æ´—ä¹‹å‰çš„æ‰€æœ‰å·¥ä½œæ˜¯ç»å¯¹ä¸éœ€è¦è¿è¡Œåœ¨ UI çº¿ç¨‹çš„ã€‚ç„¶è€Œå®é™…ä¸Šå®ƒæ­£åœ¨è€—è´¹ä½ å®è´µçš„ UI çº¿ç¨‹èµ„æºã€‚é‰´äºä½ç«¯æ‰‹æœºæ— æ³•åº”ä»˜ diff çš„å·¥ä½œé‡ï¼Œåœ¨ [PROXX](https://proxx.app) æˆ‘ä»¬[å»é™¤äº† VDOM diff](https://github.com/GoogleChromeLabs/proxx/blob/94b08d0b410493e2867ff870dee1441690a00700/src/services/preact-canvas/components/board/index.tsx#L116-L118) å¹¶å®ç°äº†æˆ‘ä»¬è‡ªå·±çš„ DOM æ“ä½œã€‚

VDOM diff ä»…ä»…æ˜¯å…¶ä¸­ä¸€ä¸ªæ¡†æ¶å¼•å¯¼çš„å¼€å‘ä½“éªŒçš„ä¾‹å­ï¼Œæˆ–è€…ä¸€ä¸ªç®€å•çš„å…‹æœç”¨æˆ·è®¾å¤‡æ€§èƒ½çš„ä¾‹å­ã€‚ä¸€ä¸ªé¢å‘å…¨çƒå‘å¸ƒçš„æ¡†æ¶ï¼Œé™¤éå®ƒæ˜ç¡®è¡¨æ˜è‡ªå·±åªé’ˆå¯¹å“ªäº›[å¯Œæœ‰çš„è¥¿æ–¹ç½‘ç»œ](https://www.smashingmagazine.com/2017/03/world-wide-web-not-wealthy-western-web-part-1/)ï¼Œ**å¦åˆ™ä»–æ˜¯æœ‰è´£ä»»å»å¸®åŠ©å¼€å‘è€…å¼€å‘æ”¯æŒä¸åŒçº§åˆ«æ‰‹æœºçš„åº”ç”¨ã€‚**

## ç»“è®º

Web Worker å¸®åŠ©ä½ çš„åº”ç”¨è¿è¡Œåœ¨æ›´å¹¿æ³›çš„è®¾å¤‡ä¸Šã€‚åƒ [Comlink](https://github.com/GoogleChromeLabs/comlink) è¿™æ ·çš„åº“ååŠ©ä½ åœ¨æ— éœ€æ”¾å¼ƒä¾¿åˆ©ä»¥åŠå¼€å‘é€Ÿåº¦çš„æƒ…å†µä¸‹ä½¿ç”¨ workerã€‚æˆ‘æƒ³**æˆ‘ä»¬åº”è¯¥æ€è€ƒçš„æ˜¯ï¼Œä¸ºä»€ä¹ˆé™¤äº† web ä»¥å¤–çš„æ‰€æœ‰å¹³å°éƒ½åœ¨å°½å¯èƒ½çš„å°‘å ç”¨ UI çº¿ç¨‹çš„èµ„æº**ã€‚æˆ‘ä»¬åº”è¯¥æ”¹å˜è‡ªå·±çš„è€åŠæ³•ï¼Œå¹¶å¸®åŠ©ä¿ƒæˆä¸‹ä¸€ä»£æ¡†æ¶æ”¹å˜ã€‚

---

ç‰¹åˆ«æ„Ÿè°¢ [Jose AlcÃ©rreca](https://twitter.com/ppvi) å’Œ [Moritz Lang](https://twitter.com/slashmodev)ï¼Œä»–ä»¬å¸®æˆ‘äº†è§£åŸç”Ÿå¹³å°æ˜¯å¦‚ä½•è§£å†³ç±»ä¼¼é—®é¢˜çš„ã€‚

> å¦‚æœå‘ç°è¯‘æ–‡å­˜åœ¨é”™è¯¯æˆ–å…¶ä»–éœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼Œæ¬¢è¿åˆ° [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner) å¯¹è¯‘æ–‡è¿›è¡Œä¿®æ”¹å¹¶ PRï¼Œä¹Ÿå¯è·å¾—ç›¸åº”å¥–åŠ±ç§¯åˆ†ã€‚æ–‡ç« å¼€å¤´çš„ **æœ¬æ–‡æ°¸ä¹…é“¾æ¥** å³ä¸ºæœ¬æ–‡åœ¨ GitHub ä¸Šçš„ MarkDown é“¾æ¥ã€‚

---

> [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner) æ˜¯ä¸€ä¸ªç¿»è¯‘ä¼˜è´¨äº’è”ç½‘æŠ€æœ¯æ–‡ç« çš„ç¤¾åŒºï¼Œæ–‡ç« æ¥æºä¸º [æ˜é‡‘](https://juejin.im) ä¸Šçš„è‹±æ–‡åˆ†äº«æ–‡ç« ã€‚å†…å®¹è¦†ç›– [Android](https://github.com/xitu/gold-miner#android)ã€[iOS](https://github.com/xitu/gold-miner#ios)ã€[å‰ç«¯](https://github.com/xitu/gold-miner#å‰ç«¯)ã€[åç«¯](https://github.com/xitu/gold-miner#åç«¯)ã€[åŒºå—é“¾](https://github.com/xitu/gold-miner#åŒºå—é“¾)ã€[äº§å“](https://github.com/xitu/gold-miner#äº§å“)ã€[è®¾è®¡](https://github.com/xitu/gold-miner#è®¾è®¡)ã€[äººå·¥æ™ºèƒ½](https://github.com/xitu/gold-miner#äººå·¥æ™ºèƒ½)ç­‰é¢†åŸŸï¼Œæƒ³è¦æŸ¥çœ‹æ›´å¤šä¼˜è´¨è¯‘æ–‡è¯·æŒç»­å…³æ³¨ [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)ã€[å®˜æ–¹å¾®åš](http://weibo.com/juejinfanyi)ã€[çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/juejinfanyi)ã€‚
