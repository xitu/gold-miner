> * åŸæ–‡åœ°å€ï¼š[Increase your Appâ€™s performance with React hooks and the React Dev Tools](https://medium.com/clever-franke/increase-your-apps-performance-with-react-hooks-and-the-react-dev-tools-bfa67e72299c)
> * åŸæ–‡ä½œè€…ï¼š[Koen Poelhekke](https://medium.com/@kpoelhekke)
> * è¯‘æ–‡å‡ºè‡ªï¼š[æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)
> * æœ¬æ–‡æ°¸ä¹…é“¾æ¥ï¼š[https://github.com/xitu/gold-miner/blob/master/TODO1/increase-your-apps-performance-with-react-hooks-and-the-react-dev-tools.md](https://github.com/xitu/gold-miner/blob/master/TODO1/increase-your-apps-performance-with-react-hooks-and-the-react-dev-tools.md)
> * è¯‘è€…ï¼š[Baddyo](https://juejin.im/user/5b0f6d4b6fb9a009e405dda1)
> * æ ¡å¯¹è€…ï¼š[wuyanan](https://github.com/wuyanan)ï¼Œ[Jerry-FD](https://github.com/Jerry-FD)

# ç”¨ React Hooks å’Œè°ƒè¯•å·¥å…·æå‡åº”ç”¨æ€§èƒ½

![](https://cdn-images-1.medium.com/max/5120/1*fftOIi1nxu9tJZ74EaLMMg.png)

åœ¨æ„å»º React åº”ç”¨æ—¶ï¼Œä½ ä¼šå‘ç°éšç€åµŒå¥—ç»„ä»¶å¢å¤šï¼Œç”¨æˆ·ç•Œé¢çš„æŸäº›éƒ¨åˆ†å¼€å§‹å˜å¾—ç¼“æ…¢è¿Ÿæ»ã€‚è¿™æ˜¯å› ä¸ºï¼Œè¢«æ”¹å˜ state çš„å…ƒç´ åœ¨ç»„ä»¶æ ‘ä¸­çš„å±‚çº§è¶Šé«˜ï¼Œæµè§ˆå™¨éœ€è¦é‡ç»˜çš„ç»„ä»¶è¶Šå¤šã€‚

æœ¬æ–‡å°†å‘Šè¯‰ä½ å¦‚ä½•**é€šè¿‡å¤‡å¿˜ï¼ˆ[memoization](https://en.wikipedia.org/wiki/Memoization)ï¼‰æŠ€æœ¯é¿å…ä¸å¿…è¦çš„é‡ç»˜ï¼Œè®©ä½ çš„ React åº”ç”¨å¿«å¦‚é—ªç”µã€‚âš¡**

***

åœ¨ [CLEVERÂ°FRANKE](https://www.cleverfranke.com) çš„ä¸€ä¸ªå®¢æˆ·ç«¯é¡¹ç›®ä¸­ï¼Œæˆ‘åšè¿‡ä¸€ä¸ªè¿‡æ»¤å™¨ç»„ä»¶ï¼Œè¯¥ç»„ä»¶åŒ…å«ä¸€ä¸ªå±•ç¤ºæ­¥æ•°çš„ç›´æ–¹å›¾ã€‚

![ç›´æ–¹å›¾è¿‡æ»¤å™¨ç»„ä»¶](https://cdn-images-1.medium.com/max/2000/1*DEaGq8vzh_oESuid9YAlbg.png)

æˆ‘å‘ç°æ¯å½“æ‹–æ‹½è¿‡æ»¤å™¨çš„æ“çºµæ†ï¼ŒåŠ¨ç”»å¸§ç‡å°±ä¼šéª¤é™ï¼Œå¯¼è‡´ç»„ä»¶å¤±å»æ•ˆç”¨ã€‚æ•…æ­¤æˆ‘å†³å®šä¸€æ¢ç©¶ç«Ÿã€‚

## æŠ½ä¸å‰¥èŒ§

åªæœ‰æ˜ç™½ç”¨æˆ·æ‹–æ‹½æ“çºµæ†æ—¶çš„å†…éƒ¨è¿ä½œåŸç†ï¼Œæ‰èƒ½ç¡®å®šä»ä½•å¤„ä¸‹æ‰‹è°ƒè¯•ã€‚React ä½¿ç”¨[è™šæ‹Ÿ DOM](https://www.codecademy.com/articles/react-virtual-dom) æ¥ä»£è¡¨ DOM ä¸­çœŸå®çš„å…ƒç´ ã€‚æ¯å½“ç”¨æˆ·æ“ä½œç•Œé¢å…ƒç´ ï¼Œåº”ç”¨çš„ state éƒ½ä¼šæ”¹å˜ã€‚React ä¼šéå†æ‰€æœ‰å— state æ”¹å˜å½±å“çš„ç»„ä»¶ï¼Œè®¡ç®—ç”Ÿæˆæ–°çš„è™šæ‹Ÿ DOMã€‚React å°†æ–°æ—§ç‰ˆæœ¬çš„è™šæ‹Ÿ DOM è¿›è¡Œæ¯”è¾ƒï¼Œè‹¥å‘ç°äºŒè€…æœ‰å·®å¼‚ï¼Œå°±å°†å¯¹åº”çš„å˜åŒ–æ›´æ–°åˆ°çœŸå® DOM ä¸Šã€‚è¯¥è¿‡ç¨‹å«åš [reconciliation](https://reactjs.org/docs/reconciliation.html)ã€‚

æ“çºµ DOM å…ƒç´ å¯æ˜¯ä¸€ä¸ªéå¸¸è€—è´¹èµ„æºçš„ä»»åŠ¡ã€‚åŒæ ·ï¼Œéå†æ‰€æœ‰å—å½±å“ç»„ä»¶çš„ render å‡½æ•°ä¹Ÿå¾ˆè€—æ—¶ï¼Œ`render` å‡½æ•°ä¸­çš„è®¡ç®—é‡å¾ˆå¤§æ—¶å°¤å…¶å¦‚æ­¤ã€‚å› æ­¤æˆ‘ä»¬è¦å°½é‡å‡å°‘è¿™äº›**æµªè´¹æ€§æ¸²æŸ“**ã€‚

***

ç°åœ¨å›åˆ°æˆ‘ä»¬çš„æ¡ˆä¾‹ï¼šå› ä¸ºè¿‡æ»¤å™¨ç»„ä»¶çš„ state ç”±å…¶çˆ¶ç»„ä»¶æŒæ§ï¼Œæ‰€ä»¥æˆ‘çš„æ¨è®ºæ˜¯å¯èƒ½å‘ç”Ÿäº†ä¸å¿…è¦çš„æ¸²æŸ“å’Œè®¡ç®—ã€‚ä¸ºäº†å¿«é€Ÿç¡®è¯Šï¼Œæˆ‘ä»¬è¦ä½¿ç”¨ Chrome è°ƒè¯•å·¥å…·ã€‚å®ƒæœ‰ä¸ª **Paint Flashing** åŠŸèƒ½ï¼Œå¯ä»¥å°†å‘ç”Ÿæ”¹å˜çš„ DOM é«˜äº®æ˜¾ç¤ºã€‚ä½ å¯ä»¥åœ¨ **Rendering** æ ‡ç­¾é¡µä¸´æ—¶æ¿€æ´»è¯¥åŠŸèƒ½ï¼š

![åœ¨ Chrome è°ƒè¯•å·¥å…·ä¸­æ¿€æ´» Paint Flashing åŠŸèƒ½](https://cdn-images-1.medium.com/max/2000/1*ZmzAER8ng6Xo4a67bmV_vw.png)

ä¸€ç»æ¿€æ´»ï¼Œæµè§ˆå™¨å°±ä¼šæ˜¾ç¤ºå“ªäº›å…ƒç´ è¢«é‡ç»˜äº†ã€‚åœ¨æœ¬æ¡ˆä¾‹ä¸­æ•ˆæœå¦‚ä¸‹ï¼š

![ç”¨ Paint Flashing åŠŸèƒ½é«˜äº®è¿‡æ»¤å™¨ç»„ä»¶](https://cdn-images-1.medium.com/max/2000/1*fJNSgWgEbPRlPNeuzbkY2A.gif)

çœ‹èµ·æ¥åˆæƒ…åˆç†ï¼Œåªæœ‰æˆ‘æ“çºµçš„ç»„ä»¶å¼•å‘äº† DOM æ“çºµã€‚ä¹Ÿå°±æ˜¯è¯´æµè§ˆå™¨æ²¡æœ‰åšä¸å¿…è¦çš„ç»˜åˆ¶ã€‚é‚£æˆ‘ä»¬å°±è¦è¿›ä¸€æ­¥æ·±å…¥æ¥æ¢ç©¶åŸå› äº†ã€‚

***

ä¸ºäº†æŠŠ React ç»„ä»¶é‡ç»˜çš„æƒ…å†µçœ‹å¾—æ›´çœŸåˆ‡ï¼Œæˆ‘ä»¬å¾—ç”¨ [React è°ƒè¯•å·¥å…·](https://github.com/facebook/react-devtools)ä¸­ä¸€ä¸ªç±»ä¼¼çš„å·¥å…·ã€‚å®ƒå«åš **Highlight Updates**ï¼Œä½ å¯ä»¥åœ¨ React è°ƒè¯•å·¥å…·çš„é¦–é€‰é¡¹é¢æ¿ä¸­æ‰¾åˆ°å®ƒã€‚æ¿€æ´»åï¼Œå®ƒä¼šé«˜äº®æ˜¾ç¤ºæ‰€æœ‰æ­£åœ¨æ¸²æŸ“çš„ç»„ä»¶ã€‚å¦‚æœæ¸²æŸ“æ—¶é—´è¿‡é•¿ï¼Œå®ƒè¿˜ä¼šç”¨ç‰¹æ®Šé¢œè‰²æ ‡è¯†å‡ºæ¥ã€‚

![ç”¨ Highlight Updates åŠŸèƒ½é«˜äº®è¿‡æ»¤å™¨ç»„ä»¶](https://cdn-images-1.medium.com/max/2000/1*xdxAnoef3kv0yqa7yE2v-Q.gif)

> React è°ƒè¯•å·¥å…·ä½¿ä½ èƒ½å¤Ÿæ£€æŸ¥ React ç»„ä»¶å±‚çº§ï¼Œä»¥åŠå¯¹åº”ç»„ä»¶çš„ props å’Œ stateã€‚<br />
> å®ƒæœ‰æµè§ˆå™¨æ’ä»¶ï¼ˆæ”¯æŒ [Chrome](https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi) å’Œ [Firefox](https://addons.mozilla.org/firefox/addon/react-devtools/)ï¼‰å’Œ[ç‹¬ç«‹åº”ç”¨](https://github.com/facebook/react-devtools/tree/master/packages/react-devtools)ï¼ˆæ”¯æŒ Safariã€IEã€å’Œ React Native ç­‰è¿è¡Œç¯å¢ƒï¼‰ä¸¤ç§å½¢å¼ã€‚

***

**è¿™é‡Œå°±æ¸…æ™°åœ°æ­ç¤ºäº†é—®é¢˜æ‰€åœ¨ï¼šå½“æˆ‘åœ¨ä¸€ä¸ªè¿‡æ»¤å™¨ä¸Šæ‹–æ‹½ï¼ŒåŒ…å«ç›´æ–¹å›¾çš„å¦ä¸€ä¸ªè¿‡æ»¤å™¨ä¹Ÿè¢«é‡ç»˜äº†ã€‚** è¿™å°±æ˜¯åº”è¯¥è¢«é¿å…çš„å¤„ç†å™¨èµ„æºæµªè´¹ã€‚åƒç›´æ–¹å›¾è¿™æ ·çš„ç¬¨é‡ç»„ä»¶å°¤å…¶å¦‚æ­¤ã€‚

ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†é—®é¢˜æ‰€åœ¨ï¼Œä½†è¿˜ä¸çŸ¥é“å¯¼è‡´ç•Œé¢å“åº”ç¼“æ…¢çš„åŸå› ã€‚ä¸ºäº†æ‰¾åˆ°åŸå› ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Chrome è°ƒè¯•å·¥å…·çš„ **Performance** é¢æ¿ã€‚å®ƒå¯ä»¥å¸®åŠ©ä½ æŸ¥çœ‹åœ¨æµè§ˆå™¨åœ¨æ‰§è¡ŒæŸä¸€ç‰¹å®šä»»åŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸€å¸§å…·ä½“åšäº†ä»€ä¹ˆã€‚

**å…³äº Performance é¢æ¿çš„ä½¿ç”¨ç»†èŠ‚ï¼Œä¸åœ¨æœ¬æ–‡è®¨è®ºèŒƒå›´ä¹‹å†…ã€‚ä½†ä½ å¯ä»¥åœ¨[è¿™é‡Œ](https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/)æ‰¾åˆ°æ•™ç¨‹ã€‚**

***

æˆ‘ä½¿ç”¨ **Performance** é¢æ¿è®°å½•äº†è¿‡æ»¤å™¨ç»„ä»¶ä¸­çš„ä¸€æ¬¡å˜æ›´ã€‚æ”¾å¤§ç«ç„°å›¾åï¼Œæˆ‘æœ‰äº†ä»¥ä¸‹å‘ç°ï¼š

![Performance é¢æ¿ä¸­çš„ç«ç„°å›¾ ğŸ”¥](https://cdn-images-1.medium.com/max/2534/1*hSQUcxdZ-HHh_o8b8-yIhQ.png)

å¦‚ä½ æ‰€è§ï¼Œè¿™ä¸¤ä¸ªç«ç„°å›¾å¤§ä½“ç›¸åŒã€‚ç¬¬ä¸€å¼ å›¾ï¼ˆåœ¨ **Timings** ä¸‹æ–¹ï¼‰å±•ç¤ºäº† React ç»„ä»¶çš„å®é™…çš„åŠ è½½å’Œæ›´æ–°ã€‚React è°ƒç”¨äº†[ç”¨æˆ·æ—¶é—´æ¥å£](https://developer.mozilla.org/en-US/docs/Web/API/User_Timing_API)ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½çœ‹åˆ°è¿™å¼ é¢å¤–çš„å›¾ã€‚ç¬¬äºŒå¼ å›¾å±•ç¤ºäº†ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œçš„æ‰€æœ‰ä»»åŠ¡ï¼Œè¿™å¼ å›¾æ›´ä¸ºè¯¦ç»†ã€‚

æˆ‘æ›´å–œæ¬¢ç”¨ç¬¬ä¸€å¼ å›¾æ¥çœ‹å“ªäº›ç»„ä»¶æ€§èƒ½å·®ï¼Œç”¨ç¬¬äºŒå¼ å›¾æ·±å…¥äº†è§£å…·ä½“å“ªä¸ªå‡½æ•°å’Œè®¡ç®—è¿‡ç¨‹è€—æ—¶æ›´å¤šã€‚

***

ç¬¬ä¸€æ¬¡çœ‹åˆ° **Performance** é¢æ¿çš„é»˜è®¤ç«ç„°å›¾ï¼Œä½ å¯èƒ½ä¼šè¢«å“åˆ°ã€‚ä¸‡å¹¸ React è°ƒè¯•å·¥å…·ä¹Ÿæœ‰ä¸€ä¸ªç›¸ä¼¼åŠŸèƒ½ï¼Œåœ¨ **Profiler** æ ‡ç­¾é¡µä¸­ï¼Œèƒ½å¤Ÿæ ¹æ®[ç”¨æˆ·æ—¶é—´æ¥å£](https://developer.mozilla.org/en-US/docs/Web/API/User_Timing_API)ç”ŸæˆåŒæ ·çš„ç«ç„°å›¾ã€‚æˆ‘è®¤ä¸º React è°ƒè¯•å·¥å…·ä¸­çš„ç«ç„°å›¾æ›´æ˜“äºç†è§£ï¼Œè€Œä¸”å®ƒè¿˜æœ‰å¾ˆå¤šè¶æ‰‹çš„é™„åŠ åŠŸèƒ½ï¼š

* ä½ å¯ä»¥æ ¹æ®ç»„ä»¶æ¸²æŸ“æ—¶é•¿å°†æ‰€æœ‰ç»„ä»¶æ’åºï¼ˆè§ä¸‹æ–¹æˆªå›¾ï¼‰ã€‚
* ä½ å¯ä»¥å¿«é€Ÿæµè§ˆä¸åŒçš„æ¸²æŸ“è®°å½•ã€‚
* ä½ å¯ä»¥ç‚¹å‡»æŸç»„ä»¶æŸ¥çœ‹ç‰¹å®šæ¸²æŸ“é˜¶æ®µçš„ **props**ã€‚

![æŒ‰æ¸²æŸ“æ—¶é•¿æ’åˆ—ç»„ä»¶](https://cdn-images-1.medium.com/max/2560/1*DZda1hD432v2ylP_KhNJ2g.png)

***

ä»¥ä¸Šå›¾å½¢æ­éœ²äº†ç½ªé­ç¥¸é¦–ï¼š`Histogram`ã€‚ç‰¹åˆ«æ˜¯æ¸²æŸ“ç¬¬äºŒä¸ªç›´æ–¹å›¾ï¼ˆå³ä¾§é‚£ä¸ªï¼‰ï¼Œè€—è´¹äº†å¾ˆé•¿æ—¶é—´ï¼ˆ402.8 æ¯«ç§’ï¼ï¼‰ï¼Œå³ä½¿æˆ‘æ ¹æœ¬æ²¡æœ‰æ‹–æ‹½å®ƒã€‚æˆ‘ä»¬ç ´æ¡ˆäº†ï¼æ¥ä¸‹æ¥å°±è¯¥ä¿®å¤é—®é¢˜ã€ä¼˜åŒ–ç»„ä»¶æ€§èƒ½äº†ã€‚

> æ³¨æ„ï¼šæˆ‘è®°å½•æ€§èƒ½æ—¶æ‰“å¼€äº† CPU èŠ‚æµåŠŸèƒ½ï¼Œç”¨ 1/4 å€é€Ÿæ¨¡æ‹Ÿé‚£äº›å¹¶éä½¿ç”¨æœ€æ–°ç‰ˆ Macbook Pro çš„ç”¨æˆ·ï¼Œä»¥æ­¤æ¥çªæ˜¾æ€§èƒ½é—®é¢˜ã€‚

## æå‡ç»„ä»¶æ€§èƒ½

ä¸ºé˜²æ­¢æµªè´¹æ€§æ¸²æŸ“çš„å‘ç”Ÿï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¤‡å¿˜æŠ€æœ¯ä¼˜åŒ–ç»„ä»¶ã€‚æˆ‘ä»¬è¦ä½¿ç”¨ `React.memo` æ¥è®°å¿†ç»„ä»¶ï¼Œç”¨ React çš„å¤‡å¿˜ hooks `useMemo` å’Œ `useCallback` è®°å¿†å˜é‡å’Œå‡½æ•°ã€‚

### React.memo

ä» `16.6.0` ç‰ˆæœ¬èµ·ï¼ŒReact å°±æ”¯æŒé«˜é˜¶ç»„ä»¶ [`React.memo`](https://reactjs.org/docs/react-api.html#reactmemo) äº†ã€‚å®ƒç­‰ä»·äº `React.PureComponent`ï¼Œä½†åªé€‚ç”¨äºå‡½æ•°ç»„ä»¶ã€‚ç¤¾åŒºæ­£é€æ­¥ä» class çš„ç»„ä»¶é£æ ¼è½¬å‘å¸¦æœ‰ hooks çš„å‡½æ•°ç»„ä»¶é£æ ¼ï¼Œè€Œ `React.memo` æ­£æ˜¯è¿™ç§ç»„ä»¶ã€‚

å½“ä½ ç”¨ `React.memo` åŒ…è£¹ä¸€ä¸ªå‡½æ•°ç»„ä»¶æ—¶ï¼Œå®ƒä¼šå°†ä¼ å…¥çš„ props è¿›è¡Œæµ…å±‚æ¯”è¾ƒã€‚å½“æ¯”è¾ƒçš„ props ä¸ä¸€è‡´æ—¶ï¼Œæ‰ä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚ä½ ä¹Ÿå¯ä»¥è‡ªå·±å†™ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°ï¼Œä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ã€‚ä½†è¦æ…ç”¨ï¼Œä»¥é¿å…æ„å¤–æ•…éšœã€‚

æˆ‘ä»¬å¯ä»¥å°†ç»„ä»¶åˆ†è§£ä¸ºæ›´å°çš„ç»„ä»¶ï¼Œå¹¶æŠŠæ¯ä¸ªæ›´å°çš„ç»„ä»¶éƒ½ç”¨ `React.memo` åŒ…è£¹èµ·æ¥ã€‚å¦‚æ­¤ä½ èƒ½ä¿è¯å½“ props æ›´æ–°ï¼Œä»…æœ‰ç»„ä»¶çš„ä¸€éƒ¨åˆ†é‡æ–°æ¸²æŸ“äº†ã€‚ä½†ä¹Ÿä¸è¦æŠŠæ‰€æœ‰ä¸œè¥¿éƒ½åšå¤‡å¿˜ï¼Œå› ä¸ºæ¯”è¾ƒ **props** æ‰€èŠ±æ—¶é—´å¯èƒ½è¦æ¯”æ¸²æŸ“ç»„ä»¶çš„æ—¶é—´è¿˜è¦é•¿ã€‚

åœ¨æœ¬æ–‡æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ç”¨ `React.memo` åŒ…è£¹äº†è¿‡æ»¤å™¨ç»„ä»¶ï¼ˆ`RangeSlider`ï¼‰å’Œ `Histogram` ç»„ä»¶ã€‚æ­¤å¤–ï¼Œæˆ‘æŠŠç›´æ–¹å›¾åˆ†è§£ä¸ºåŒ…è£¹ç»„ä»¶å’Œ `HistogramBuckets` ç»„ä»¶ä¸¤éƒ¨åˆ†ï¼Œå°†é€»è¾‘éƒ¨åˆ†å’Œå±•ç°éƒ¨åˆ†å‰¥ç¦»å¼€æ¥ã€‚

```javascript
const RangeSlider = React.memo(props => {
   ...
});
```

### å¤‡å¿˜ hooks

React `16.8.0` ç‰ˆæœ¬ä¸ºæˆ‘ä»¬å¸¦æ¥åŠŸèƒ½å¼ºå¤§çš„ hooksï¼Œæœ‰äº† hooksï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾å¤‡å¿˜ç»„ä»¶ä¸­çš„å€¼å’Œå›è°ƒå‡½æ•°ã€‚åœ¨å¼•å…¥ hooks ä¹‹å‰ï¼Œä½ å½“ç„¶ä¹Ÿå¯ä»¥ç”¨ä¸€ä¸ªå•ç‹¬çš„åº“å®ç°å¤‡å¿˜åŠŸèƒ½ï¼Œä½†è‡ªä»å®ƒæˆä¸º React åŸç”Ÿåº“çš„ä¸€éƒ¨åˆ†ï¼Œé›†æˆå’Œå¡‘é€ å·¥ä½œæµå˜å¾—æ›´åŠ ç®€å•æ˜“è¡Œã€‚

[`useMemo`](https://reactjs.org/docs/hooks-reference.html#usememo) ä¼šè®°å¿†ä¸€ä¸ªå€¼ï¼Œè¿™æ ·å°±ä¸ç”¨åœ¨ä¸‹ä¸€è½®æ¸²æŸ“ä¸­é‡æ–°è®¡ç®—å®ƒäº†ã€‚[`useCallback`](https://reactjs.org/docs/hooks-reference.html#usecallback) è®°å¿†çš„åˆ™æ˜¯å›è°ƒå‡½æ•°ã€‚ä½ å¯ä»¥ç»™äºŒè€…ä¼ å…¥ä¸€ä¸ªä¾èµ–æ•°ç»„ï¼Œè¯¥æ•°ç»„åŒ…å«äº†ç»„ä»¶ä½œç”¨åŸŸçš„å€¼ï¼ˆæ¯”å¦‚ props å’Œ stateï¼‰ï¼Œè¿™äº›å€¼å°†åœ¨ hooks å†…éƒ¨è¢«ç”¨åˆ°ã€‚æ¯æ¬¡æ¸²æŸ“æ—¶ï¼ŒReact éƒ½ä¼šæ¯”è¾ƒè¿™äº›ä¾èµ–å€¼ï¼Œä¸€æ—¦å®ƒä»¬å‘ç”Ÿæ”¹å˜ï¼ŒReact å°±ä¼šæ›´æ–°å¤‡å¿˜çš„å€¼æˆ–å‡½æ•°ã€‚

> æ³¨æ„ï¼šReact ä¸ºäº†å°½å¯èƒ½å¿«åœ°è¿›è¡Œæ¯”è¾ƒï¼Œä½¿ç”¨äº†æ¯”è¾ƒç®—æ³• [Object.is](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is#Description) æ¥ä¼˜åŒ–æ¯”è¾ƒçš„é€Ÿåº¦ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ æŠŠå¯¹è±¡æˆ–æ•°ç»„çš„æ–°å®ä¾‹ä½œä¸º props ä¼ å…¥ï¼Œæ¯”è¾ƒæ—¶è¯¥ç®—æ³•ä¼šè¿”å› `false`ï¼Œå¹¶é‡æ–°è®¡ç®—å¤‡å¿˜çš„å€¼ã€‚

### ä¼ å…¥å¤‡å¿˜çš„ props

åœ¨æœ¬ä¾‹ä¸­ï¼Œæœªç»ä½¿ç”¨ `React.memo` çš„è¿‡æ»¤å™¨ç»„ä»¶éœ€è¦ä¼˜åŒ–ã€‚è¿™æ›¾æ˜¯çˆ¶ç»„ä»¶è®¾ç½® props çš„æ–¹å¼ï¼š

```javascript
function handleChange(value => {
  ...
});

<RangeSlider  
  value={[minValue, maxValue]}  
  onChange={handleChange}
/>
```

æ¯æ¸²æŸ“ä¸€æ¬¡ï¼Œéƒ½è¦åˆ›å»º `handleChange` çš„ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶ä¼ å…¥ä¸€ä¸ªæ–°çš„æ•°ç»„å®ä¾‹ä½œä¸º propsã€‚è¿™å°±å¯¼è‡´ `RangeSlider` ç»„ä»¶æ€»æ˜¯æ›´æ–°ï¼Œå°½ç®¡æœ‰ `React.memo` åŒ…è£¹ï¼Œå› ä¸º `Object.is()` æ¯”è¾ƒç®—æ³•æ€»æ˜¯è¿”å› `false`ã€‚ä¸ºäº†ç²¾ç¡®ä¼˜åŒ–ï¼Œæˆ‘å¾—ç”¨ä¸‹åˆ—ä»£ç é‡æ„ï¼š

```javascript
const handleChange = useCallback((value) => {
    ...
}, []);

const value = useMemo(() => [minValue, maxValue], [minValue, maxValue]);

<RangeSlider  
  value={value}  
  onChange={handleChange}
/>
```

å¦‚æœä¾èµ–æ•°ç»„ä¸ºç©ºï¼Œé‚£ä¹ˆ `handleChange` åˆ™ä»…åœ¨æŒ‚è½½æ—¶æ›´æ–°ã€‚æ— è®º `minValue` æˆ– `maxValue` ä½•æ—¶æ›´æ”¹ï¼Œ`value` æ€»ä¼šè¿”å›ä¸€ä¸ªæ–°æ•°ç»„ã€‚

æˆ‘å¯¹ `Histogram` ç»„ä»¶åšäº†åŒæ ·çš„ä¼˜åŒ–ï¼Œ`Histogram` ç»„ä»¶æŠŠ props ä¼ åˆ° `HistogramBuckets` å­ç»„ä»¶ä¸­ã€‚

> å°æç¤ºï¼šè¦æƒ³å¿«é€Ÿæ‰¾å‡ºä¸¤æ¬¡æ¸²æŸ“ä¸­å“ªäº› props å‘ç”Ÿäº†å˜åŒ–ï¼Œå¯ä»¥ç”¨è¿™ä¸ªç²¾å·§çš„ hooksï¼š[useWhyDidYouUpdate](https://usehooks.com/useWhyDidYouUpdate/)ã€‚

## æˆæœ

é€šè¿‡æ–¹ä¾¿å¿«æ·çš„ä¼˜åŒ–ï¼Œç»„ä»¶çš„æ€§èƒ½å¾—åˆ°äº†æ˜¾è‘—æå‡ã€‚ç»è¿‡å¤‡å¿˜ä¼˜åŒ–åï¼Œåœ¨ç›¸åŒçš„æ“ä½œä¸‹ï¼Œ`Histogram` ç»„ä»¶çš„æ¸²æŸ“æ—¶é—´ç¼©çŸ­åˆ°äº† 0.5 æ¯«ç§’ã€‚æ¯”èµ·åŸæ¥çš„ 72.7 æ¯«ç§’åŠ ä¸Šç¬¬äºŒä¸ªç›´æ–¹å›¾æ¶ˆè€—çš„ 402.8 æ¯«ç§’ï¼Œ**è¿™å¯æ˜¯è¶…è¿‡åƒå€çš„æé€Ÿå•Šï¼ğŸ¤©** æœ€ç»ˆæˆæœå°±æ˜¯ï¼Œä»…ç”¨äº†æå°çš„åŠªåŠ›ï¼Œå°±è·å¾—äº†æ›´æµç•…çš„ç”¨æˆ·ä½“éªŒã€‚

![å¤‡å¿˜ä¼˜åŒ–åçš„ç›´æ–¹å›¾æ¸²æŸ“æ—¶é—´](https://cdn-images-1.medium.com/max/5112/1*iGs_fQ2NfXbeLNO0xVQ9GQ.png)

***

## åŠ å…¥ CÂ°F

å¦å¤–ï¼Œå¦‚æœä½ è¢«æœ¬æ–‡æƒŠè‰³åˆ°äº†ï¼ŒCLEVERÂ°FRANKE çš„å¤§é—¨æ°¸è¿œä¸ºè¾¾äººæ•å¼€å“¦ã€‚æ¥[æˆ‘ä»¬çš„æ‹›è˜ä¼ é€é—¨](http://jobs.cleverfranke.com/)çœ‹çœ‹ï¼Œå¦‚æœæ„Ÿå…´è¶£ï¼Œæ¬¢è¿å‘æˆ‘ä»¬å±•ç¤ºä½ çš„è¶…èƒ½åŠ›ã€‚

> å¦‚æœå‘ç°è¯‘æ–‡å­˜åœ¨é”™è¯¯æˆ–å…¶ä»–éœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼Œæ¬¢è¿åˆ° [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner) å¯¹è¯‘æ–‡è¿›è¡Œä¿®æ”¹å¹¶ PRï¼Œä¹Ÿå¯è·å¾—ç›¸åº”å¥–åŠ±ç§¯åˆ†ã€‚æ–‡ç« å¼€å¤´çš„ **æœ¬æ–‡æ°¸ä¹…é“¾æ¥** å³ä¸ºæœ¬æ–‡åœ¨ GitHub ä¸Šçš„ MarkDown é“¾æ¥ã€‚

---

> [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner) æ˜¯ä¸€ä¸ªç¿»è¯‘ä¼˜è´¨äº’è”ç½‘æŠ€æœ¯æ–‡ç« çš„ç¤¾åŒºï¼Œæ–‡ç« æ¥æºä¸º [æ˜é‡‘](https://juejin.im) ä¸Šçš„è‹±æ–‡åˆ†äº«æ–‡ç« ã€‚å†…å®¹è¦†ç›– [Android](https://github.com/xitu/gold-miner#android)ã€[iOS](https://github.com/xitu/gold-miner#ios)ã€[å‰ç«¯](https://github.com/xitu/gold-miner#å‰ç«¯)ã€[åç«¯](https://github.com/xitu/gold-miner#åç«¯)ã€[åŒºå—é“¾](https://github.com/xitu/gold-miner#åŒºå—é“¾)ã€[äº§å“](https://github.com/xitu/gold-miner#äº§å“)ã€[è®¾è®¡](https://github.com/xitu/gold-miner#è®¾è®¡)ã€[äººå·¥æ™ºèƒ½](https://github.com/xitu/gold-miner#äººå·¥æ™ºèƒ½)ç­‰é¢†åŸŸï¼Œæƒ³è¦æŸ¥çœ‹æ›´å¤šä¼˜è´¨è¯‘æ–‡è¯·æŒç»­å…³æ³¨ [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](https://github.com/xitu/gold-miner)ã€[å®˜æ–¹å¾®åš](http://weibo.com/juejinfanyi)ã€[çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/juejinfanyi)ã€‚
