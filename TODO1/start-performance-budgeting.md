> * 原文地址：[Start Performance Budgeting](https://medium.com/@addyosmani/start-performance-budgeting-dabde04cf6a3)
> * 原文作者：[Addy Osmani](https://medium.com/@addyosmani?source=post_header_lockup)
> * 译文出自：[掘金翻译计划](https://github.com/xitu/gold-miner)
> * 本文永久链接：[https://github.com/xitu/gold-miner/blob/master/TODO1/start-performance-budgeting.md](https://github.com/xitu/gold-miner/blob/master/TODO1/start-performance-budgeting.md)
> * 译者：
> * 校对者：

# Start Performance Budgeting

![](https://cdn-images-1.medium.com/max/2000/1*BTZwTbmKyBE60tuXPDy34g.png)

**If you’re building a web experience and want to stay fast, a** [**performance budget**](https://timkadlec.com/2013/01/setting-a-performance-budget/) **can be** [**critical**](https://infrequently.org/2017/10/can-you-afford-it-real-world-web-performance-budgets/)**. For success, embrace performance budgets and learn to live within them. Network & CPU limits on mobile can require asking hard questions like, “what is really important to my users?”**

When we talk to Fortune 500 companies that put in the work to improve performance, perf metrics will often **rapidly regress** once they return to feature development. Performance budgets help teams prioritize features, optimizations and [facilitate](https://tobias.is/blogging/web-performance-budgets-as-currency/) discussions on what is really important to users.

> _“Having a pre-defined ‘budget’ is a clear, tangible way to frame decisions about what can and can’t be included, and at a suitably early stage in the project” — Mark Perkins_

### What’s a performance budget?

A performance budget is a **limit** for pages which the team is not allowed to exceed. It could be a max JavaScript bundle size, total image weight, a specific load time (e.g [Time-to-Interactive](https://calendar.perfplanet.com/2017/time-to-interactive-measuring-more-of-the-user-experience/) in under 5s on 3G/4G) or threshold on any number of other metrics.

![](https://cdn-images-1.medium.com/max/800/0*qe3ZW3Vvf8lsdxMq.png)

**Performance budgets are not just thresholds however. Much like a financial budget, they’re something consciously spent.** View them as a currency to spend and trade on user-experience. In an environment where the [cost of JavaScript](https://medium.com/@addyosmani/the-cost-of-javascript-in-2018-7d8950fbb5d4) is still high on mobile devices, budgets are one of the few tools that can help guide us to success.

### Metrics for perf budgets

[Metrics](https://timkadlec.com/2014/11/performance-budget-metrics/) for perf budgets can include milestone timings, quantity-based metrics or rule-based metrics.

![](https://cdn-images-1.medium.com/max/800/0*bP485as_8xmWGD9s.png)

**Milestone timings**: timings based on the user-experience loading a page (e.g [Time-to-Interactive](https://developers.google.com/web/fundamentals/performance/user-centric-performance-metrics#time_to_interactive), [First Contentful Paint](https://developers.google.com/web/fundamentals/performance/user-centric-performance-metrics#first_paint_and_first_contentful_paint)). You’ll often want to pair several milestone timings to accurately represent the complete story during page load. Some teams also maintain custom metrics, like “[Time to first tweet](https://blog.alexmaccaw.com/time-to-first-tweet)” for Twitter.

**Quantity-based metrics**: based on raw values (e.g. weight of JavaScript (KB/MB), number of HTTP requests). These are focused on the browser experience.

**Rule-based metrics**: scores generated by tools such as [Lighthouse](https://developers.google.com/web/tools/lighthouse/) or [WebPageTest](https://webpagetest.org/). Often, a single number or series to grade your site.

Teams who incorporate perf budgets will often have CI warn or error a build if a PR regresses performance. [Lighthouse CI](https://github.com/ebidel/lighthouse-ci#3-call-lighthouse-ci) now supports failing a Lighthouse score when a category (such as performance) has fallen under a certain value:

![](https://cdn-images-1.medium.com/max/800/0*30uWWuN-yRDK4awS.png)

An example of a “rule” based performance budget in action. Using Lighthouse CI, we can enforce budgets on a performance score. PRs can be failed if their perf score falls below a certain value.

### Examples of budgets

*   Our product page must ship less than 170KB of JavaScript on mobile
*   Our search page must include less than 2MB of images on desktop
*   Our home page must load and get interactive in < 5s on Slow 3G/Moto G4
*   Our blog must score > 80 on Lighthouse performance audits

Below is a quantity metric — [JS Size](https://t.co/ZKpkSJfnLy) for The Guardian’s desktop site on [SpeedCurve](https://speedcurve.com/). It highlights in yellow when under budget and red when over budget.

![](https://cdn-images-1.medium.com/max/800/0*JHF8gX8AMSLf9Wj1.jpg)

We can also visualize a milestone metric. Below is [First Interactive](https://developers.google.com/web/tools/lighthouse/audits/first-interactive) (now First CPU Idle) — marking the point when the browser’s main thread is not blocked for more than 50ms by any single task so user input can be responded to quickly.

![](https://cdn-images-1.medium.com/max/800/0*hm42fQwOmOdAsHwr.png)

Budgets can vary by a number of factors including target device class. Comparing the Guardian’s mobile and desktop experiences we can see their total weights differ heavily:

![](https://cdn-images-1.medium.com/max/800/0*KzrhYg-dqQ59LL-c.jpg)

This may suggest having **budgets for different device classes are worth considering**. e.g. < 170KB JS (min/gzip) for mobile and < 1.5MB for desktop where users may have faster CPUs and network connections.

### Quantifying the impact of new features

> _“Deciding a page can’t exceed 500kB when a mock-up containing three carousels and a full-screen high-resolution background image has already been approved isn’t going to do you much good” — Tim Kadlec_

Often, **non-engineering stakeholders are unaware of the performance consequences of their decisions** on features or design. This is not their fault. We need to make it easier for PMs, designers and stakeholders to understand the **user-experience impact** of their choices.

Stakeholders may need help understanding that another JavaScript carousel or plethora of images can heavily impact the performance of a site. Perf budgets can help strategically change mindset towards questioning the value of each thing we add.

Even better is if we can make performance part of project goals from the start. This shifts the mentality of perf budgets only being a factor thought of during development to one where it’s key throughout the project lifecycle.

### Making trade-offs for user-experience

![](https://cdn-images-1.medium.com/max/800/0*KKs6HE9r_U2vUc9d.png)

As with any financial budget, there may be times when your perf budget will be **low**. This can require you to make cuts or trade-offs in order to maintain a consistently fast user-experience. What features are really important to your users? Which ones excite or retain them the most?. This is a difficult conversation and is not always clear cut.

This conversation can result in **dropping one feature to allow for another**. ‘Dropping’ could mean removing it from the critical-path — the feature could still be loaded on-demand at a later point when the user needs it.

In such situations, you can make a call on a page-by-page basis while consulting the performance budget as the source of truth so you can continue to reach your goals.

### Operationalizing budgets

Performance budgets are aided by having internal processes for [operationalizing a performance culture](https://rigor.com/blog/2016/06/5978) within a business.

**Organizational performance budgets ensure that a budget is owned by everyone rather than just being defined by one group.** Perf budgets can’t be something only engineering teams care about.

> _“Web performance budgets should be a collaborative effort about the right factors to create an equation to help the business make the right decisions and generate necessary insights to move its product forward. This is far more fruitful than a potentially antagonizing conversation about sticking to a fixed web performance threshold.” — Tobias Baldauf_

When budgets have been set and the entire organization is aware early on what the budget parameters are, you’re able to say performance isn’t just an engineering issue, but a critical piece of the whole package as a site is constructed.

It provides a guideline for design and engineering when considering performance and should be checked with each decision that could impact performance.

Monitoring services like SpeedCurve also enable you to [benchmark](https://support.speedcurve.com/get-the-most-out-of-speedcurve/benchmark-yourself-against-your-competitors) your site against competitors, allowing you to easily visualize how they perform on your budgets. This can be a powerful aid when speaking to stakeholders about why staying “under-budget” is important.

![](https://cdn-images-1.medium.com/max/800/0*u16guMcsuAKpzCwH.jpg)

### Tools for enforcing performance budgets

Many tools exist for enforcing performance budgets.

[**bundlesize**](https://github.com/siddharthkp/bundlesize) is excellent for catching **JavaScript size regressions** in CI:

![](https://cdn-images-1.medium.com/max/800/0*9jRDyljdEMDmsqSs.jpg)

Tinder.com uses bundlesize to set JavaScript bundle budgets which are checked on each PR commit. Their React app has a main bundle budget of 170KB and a CSS budget of 20KB. Code-splitting enables them to remain within budgets. Sites like Trivago, Zendesk & OpenTable also use it.

Other teams use [**Webpack’s built-in support for perf budgets**](https://medium.com/webpack/webpack-performance-budgets-13d4880fbf6d). You can configure [performance.hints](https://webpack.js.org/configuration/performance/) to warn or fail a build when budgets are crossed. Webpack supports a max [asset size](https://webpack.js.org/configuration/performance/#performance-maxassetsize) or [entry point size](https://webpack.js.org/configuration/performance/#performance-maxentrypointsize) for JavaScript bundles.

![](https://cdn-images-1.medium.com/max/800/0*A_YYVf6zDLhQZtUD.png)

[**SpeedCurve**](http://support.speedcurve.com/get-the-most-out-of-speedcurve/create-performance-budgets-and-set-alerts) support setting budgets for a wide range of metrics, resource sizes and Lighthouse audit categories.

![](https://cdn-images-1.medium.com/max/800/0*Ae57J3LinlF-4M3R.jpg)

![](https://cdn-images-1.medium.com/max/800/1*Y4k7aQHDKEGGqqIobKAmQw.png)

A demo tracking the Lighthouse performance score of blog.google with a budget of 80/100. Red shows where the budget has been exceeded.

Zillow [use](https://www.zillow.com/engineering/bigger-faster-more-engaging-budget/) SpeedCurve to set budgets for their quantity (e.g. image size) and milestone timing metrics in mobile search. Other performance monitoring services like [Calibre](https://calibreapp.com/docs/metrics/budgets) also support setting budgets and alerting.

![](https://cdn-images-1.medium.com/max/800/1*Lh3B43rKikOFLbataMNSdg.png)

If you’re at the planning stages of deciding what your target budgets should be, [**https://performancebudget.io**](https://performancebudget.io) is a visual aid with presets for different network speeds.

![](https://cdn-images-1.medium.com/max/800/0*c_mNxUFA58JBEwIz.png)

and of course, as mentioned earlier, [Lighthouse CI](https://github.com/ebidel/lighthouse-ci#3-call-lighthouse-ci) is a great option for teams that want to enforce rule-based performance budgeting for PRs.

### Closing thoughts

Performance budgets usher a culture of **accountability** that enable stakeholders to weigh the impact to [user-centric metrics](https://developers.google.com/web/fundamentals/performance/user-centric-performance-metrics) of each change to a site. Talk to your organization and see if you can get by in to adopt performance budgets for your projects. If it’s worth getting fast, it’s worth staying fast. ❤️

> 如果发现译文存在错误或其他需要改进的地方，欢迎到 [掘金翻译计划](https://github.com/xitu/gold-miner) 对译文进行修改并 PR，也可获得相应奖励积分。文章开头的 **本文永久链接** 即为本文在 GitHub 上的 MarkDown 链接。


---

> [掘金翻译计划](https://github.com/xitu/gold-miner) 是一个翻译优质互联网技术文章的社区，文章来源为 [掘金](https://juejin.im) 上的英文分享文章。内容覆盖 [Android](https://github.com/xitu/gold-miner#android)、[iOS](https://github.com/xitu/gold-miner#ios)、[前端](https://github.com/xitu/gold-miner#前端)、[后端](https://github.com/xitu/gold-miner#后端)、[区块链](https://github.com/xitu/gold-miner#区块链)、[产品](https://github.com/xitu/gold-miner#产品)、[设计](https://github.com/xitu/gold-miner#设计)、[人工智能](https://github.com/xitu/gold-miner#人工智能)等领域，想要查看更多优质译文请持续关注 [掘金翻译计划](https://github.com/xitu/gold-miner)、[官方微博](http://weibo.com/juejinfanyi)、[知乎专栏](https://zhuanlan.zhihu.com/juejinfanyi)。
